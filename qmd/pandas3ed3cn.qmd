---
title: "Python æ•°æ®åˆ†æ"
subtitle: "ç¬¬ 3 ç« ï¼šå†…ç½®æ•°æ®ç»“æ„ã€å‡½æ•°å’Œæ–‡ä»¶"
---

## ç¬¬ 3 ç« ï¼šå†…ç½®æ•°æ®ç»“æ„ã€å‡½æ•°å’Œæ–‡ä»¶

æœ¬ç« æ·±å…¥æ¢è®¨ Python ä¸­å¯¹æ•°æ®åˆ†æè‡³å…³é‡è¦çš„åŸºæœ¬æ„å»ºå—ã€‚æˆ‘ä»¬å°†æ¢ç´¢ Python çš„å†…ç½®æ•°æ®ç»“æ„ï¼Œå¦‚ä½•åˆ›å»ºå¯é‡ç”¨çš„å‡½æ•°ï¼Œä»¥åŠå¦‚ä½•ä¸æ–‡ä»¶äº¤äº’ã€‚

::: {.callout-note}
è™½ç„¶åƒ pandas å’Œ NumPy è¿™æ ·çš„åº“ä¸ºæ›´å¤§çš„æ•°æ®é›†æä¾›äº†é«˜çº§åŠŸèƒ½ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®çš„æ˜¯ä¸ Python çš„æ ¸å¿ƒæ•°æ®æ“ä½œå·¥å…·ååŒå·¥ä½œã€‚æŒæ¡è¿™äº›åŸºç¡€çŸ¥è¯†è‡³å…³é‡è¦ï¼ğŸ› ï¸
:::



## æ•°æ®ç»“æ„å’Œåºåˆ—

Python æä¾›äº†å‡ ç§é€šç”¨çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å°†ä»ä»¥ä¸‹å‡ ä¸ªå¼€å§‹ï¼š

-   **å…ƒç»„ (Tuples)**
-   **åˆ—è¡¨ (Lists)**
-   **å­—å…¸ (Dictionaries)**

ç†è§£è¿™äº›æ˜¯æŒæ¡ Python çš„å…³é”®ä¸€æ­¥ã€‚ğŸ



## å…ƒç»„ï¼šå®šä¹‰

å…ƒç»„æ˜¯**å›ºå®šé•¿åº¦**ã€**ä¸å¯å˜**çš„ Python å¯¹è±¡åºåˆ—ã€‚ä¸€æ—¦åˆ›å»ºï¼Œå°±*ä¸èƒ½*æ›´æ”¹å…¶å…ƒç´ æˆ–å¤§å°ã€‚

::: {.callout-tip}
## ä¸å¯å˜æ€§
ä¸å¯å˜æ€§æ„å‘³ç€å†…å®¹åœ¨åˆ›å»ºåä¸èƒ½æ›´æ”¹ã€‚è¿™ç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¯†å°çš„å®¹å™¨ğŸ“¦â€”â€”ä½ å¯ä»¥çœ‹åˆ°é‡Œé¢çš„ä¸œè¥¿ï¼Œä½†ä½ ä¸èƒ½äº¤æ¢ä¸œè¥¿ã€‚
:::



## å…ƒç»„ï¼šåˆ›å»º

ä½¿ç”¨é€—å·åˆ†éš”çš„å€¼åˆ›å»ºå…ƒç»„ï¼Œé€šå¸¸åœ¨æ‹¬å·ä¸­ï¼š

```{python}
tup = (4, 5, 6)  # ä½¿ç”¨åœ†æ‹¬å·åˆ›å»ºå…ƒç»„
print(tup)      # è¾“å‡º: (4, 5, 6)
```

æ‹¬å·é€šå¸¸æ˜¯å¯é€‰çš„ï¼š

```{python}
tup = 4, 5, 6  # ä¸ä½¿ç”¨æ‹¬å·åˆ›å»ºå…ƒç»„
print(tup)    # è¾“å‡º: (4, 5, 6)
```



## å…ƒç»„ï¼šè½¬æ¢å’Œè®¿é—®

ä½¿ç”¨ `tuple()` å°†åºåˆ—/è¿­ä»£å™¨è½¬æ¢ä¸ºå…ƒç»„ï¼š

```{python}
my_list = [4, 0, 2]           # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
my_tuple = tuple(my_list)     # å°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„
print(my_tuple)              # è¾“å‡º: (4, 0, 2)

string_tuple = tuple('string') # å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå…ƒç»„
print(string_tuple)           # è¾“å‡º: ('s', 't', 'r', 'i', 'n', 'g')
```

ä½¿ç”¨ `[]` è®¿é—®å…ƒç´ ï¼ˆä» 0 å¼€å§‹ç´¢å¼•ï¼‰ï¼š

```{python}
print(string_tuple[0])  # è®¿é—®å…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡º: 's'
```



## å…ƒç»„ï¼šåµŒå¥—å…ƒç»„

å…ƒç»„å¯ä»¥åŒ…å«å…¶ä»–å…ƒç»„ï¼š

```{python}
nested_tup = (4, 5, 6), (7, 8) # åˆ›å»ºä¸€ä¸ªåµŒå¥—å…ƒç»„
print(nested_tup)             # è¾“å‡º: ((4, 5, 6), (7, 8))
print(nested_tup[0])          # è®¿é—®ç¬¬ä¸€ä¸ªå…ƒç»„ï¼Œè¾“å‡º: (4, 5, 6)
print(nested_tup[1][0])       # è®¿é—®ç¬¬äºŒä¸ªå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡º: 7
```



## å…ƒç»„ï¼šä¸å¯å˜æ€§ï¼ˆè¯¦ç»†ç¤ºä¾‹ï¼‰

è™½ç„¶å…ƒç»„*å†…*çš„å¯¹è±¡å¯èƒ½æ˜¯å¯å˜çš„ï¼Œä½†å…ƒç»„æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼š

```{python}
tup = tuple(['foo', [1, 2], True]) # åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ—è¡¨çš„å…ƒç»„
# tup[2] = False  # è¿™è¡Œä»£ç ä¼šå¼•å‘ TypeErrorï¼Œå› ä¸ºå…ƒç»„ä¸å¯å˜ï¼

# ä½†æ˜¯ï¼Œå¯ä»¥*åœ¨åŸå¤„*ä¿®æ”¹å¯å˜å…ƒç´ ï¼š
tup[1].append(3)  # å‘åˆ—è¡¨ [1, 2] ä¸­è¿½åŠ å…ƒç´  3
print(tup)       # è¾“å‡º: ('foo', [1, 2, 3], True)
```

::: {.callout-caution}
ä½ ä¸èƒ½å°†*æ–°*å¯¹è±¡åˆ†é…ç»™å…ƒç»„ä¸­çš„ä½ç½®ï¼Œä½†æ˜¯ä½ å¯ä»¥ä¿®æ”¹å…ƒç»„ä¸­å¯å˜å¯¹è±¡çš„*å†…å®¹*ã€‚
:::



## å…ƒç»„ï¼šè¿æ¥å’Œé‡å¤

ä½¿ç”¨ `+` è¿æ¥ï¼š

```{python}
tuple1 = (4, None, 'foo')          # åˆ›å»ºå…ƒç»„ tuple1
tuple2 = (6, 0)                   # åˆ›å»ºå…ƒç»„ tuple2
tuple3 = ('bar',)                 # åˆ›å»ºå•å…ƒç´ å…ƒç»„ tuple3ï¼ˆæ³¨æ„é€—å·ï¼‰
combined_tuple = tuple1 + tuple2 + tuple3 # è¿æ¥ä¸‰ä¸ªå…ƒç»„
print(combined_tuple)             # è¾“å‡º: (4, None, 'foo', 6, 0, 'bar')
```

ä½¿ç”¨ `*` é‡å¤ï¼š

```{python}
repeated_tuple = ('foo', 'bar') * 4 # å°†å…ƒç»„é‡å¤ 4 æ¬¡
print(repeated_tuple)             # è¾“å‡º: ('foo', 'bar', 'foo', 'bar', 'foo', 'bar', 'foo', 'bar')
```

::: {.callout-note}
åªä¼šå¤åˆ¶å¯¹è±¡çš„*å¼•ç”¨*ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚
:::



## å…ƒç»„ï¼šè§£åŒ…

å°†å…ƒç»„è§£åŒ…åˆ°å˜é‡ä¸­ï¼š

```{python}
tup = (4, 5, 6) # åˆ›å»ºä¸€ä¸ªå…ƒç»„
a, b, c = tup    # å°†å…ƒç»„è§£åŒ…åˆ°å˜é‡ a, b, c ä¸­
print(b)        # è¾“å‡º: 5
```

åµŒå¥—å…ƒç»„ä¹Ÿå¯ä»¥ï¼š

```{python}
tup = 4, 5, (6, 7) # åˆ›å»ºä¸€ä¸ªåµŒå¥—å…ƒç»„
a, b, (c, d) = tup  # è§£åŒ…åµŒå¥—å…ƒç»„
print(d)         # è¾“å‡º: 7
```



## å…ƒç»„ï¼šäº¤æ¢å˜é‡

ä¼˜é›…çš„å˜é‡äº¤æ¢ï¼š

```{python}
a, b = 1, 2        # å°† a èµ‹å€¼ä¸º 1ï¼Œb èµ‹å€¼ä¸º 2
print(f"a: {a}, b: {b}") # è¾“å‡º: a: 1, b: 2
b, a = a, b        # äº¤æ¢ a å’Œ b çš„å€¼
print(f"a: {a}, b: {b}") # è¾“å‡º: a: 2, b: 1
```



## å…ƒç»„ï¼š\*rest (å’Œ \_)

`*rest` æ•è·å‰©ä½™çš„å…ƒç´ ï¼š

```{python}
values = 1, 2, 3, 4, 5 # åˆ›å»ºä¸€ä¸ªå…ƒç»„
a, b, *rest = values   # å°†å‰ä¸¤ä¸ªå…ƒç´ èµ‹å€¼ç»™ a å’Œ bï¼Œå…¶ä½™èµ‹å€¼ç»™ rest
print(a)             # è¾“å‡º: 1
print(b)             # è¾“å‡º: 2
print(rest)          # è¾“å‡º: [3, 4, 5]
```

`_` ç”¨äºä¸éœ€è¦çš„å˜é‡ï¼š

```{python}
a, b, *_ = values  # å¿½ç•¥å‰©ä½™çš„å…ƒç´ 
```



## å…ƒç»„ï¼šæ–¹æ³• (count)

ç”±äºä¸å¯å˜æ€§ï¼Œå…ƒç»„çš„æ–¹æ³•å¾ˆå°‘ã€‚`count()` å¾ˆæœ‰ç”¨ï¼š

```{python}
a = (1, 2, 2, 2, 3, 4, 2) # åˆ›å»ºä¸€ä¸ªå…ƒç»„
count_of_2 = a.count(2)   # è®¡ç®—å…ƒç»„ä¸­ 2 å‡ºç°çš„æ¬¡æ•°
print(count_of_2)         # è¾“å‡º: 4
```

```python
# `count` æ–¹æ³•è¿”å›æŒ‡å®šå€¼å‡ºç°çš„æ¬¡æ•°ã€‚
```

## åˆ—è¡¨ï¼šå®šä¹‰å’Œå¯å˜æ€§

åˆ—è¡¨æ˜¯**å¯å˜é•¿åº¦**ä¸”**å¯å˜**çš„ã€‚ä½ å¯ä»¥åœ¨åˆ›å»ºåæ›´æ”¹å…¶å†…å®¹å’Œå¤§å°ã€‚

::: {.callout-tip}
## å¯å˜æ€§
å¯å˜æ€§æ„å‘³ç€ä½ *å¯ä»¥*åœ¨åˆ›å»ºåæ›´æ”¹å…ƒç´ ã€æ·»åŠ æ–°å…ƒç´ æˆ–åˆ é™¤ç°æœ‰å…ƒç´ ã€‚åˆ—è¡¨éå¸¸çµæ´»ï¼ğŸ¤¸â€â™€ï¸
:::

## åˆ—è¡¨ï¼šåˆ›å»º

ä½¿ç”¨ `[]` æˆ– `list()` åˆ›å»ºåˆ—è¡¨ï¼š

```{python}
a_list = [2, 3, 7, None]     # ä½¿ç”¨æ–¹æ‹¬å·åˆ›å»ºåˆ—è¡¨
tup = ('foo', 'bar', 'baz')  # åˆ›å»ºä¸€ä¸ªå…ƒç»„
b_list = list(tup)          # å°†å…ƒç»„è½¬æ¢ä¸ºåˆ—è¡¨
print(b_list)               # è¾“å‡º: ['foo', 'bar', 'baz']
```

ä¿®æ”¹å…ƒç´ ï¼š

```{python}
b_list[1] = 'peekaboo' # å°†åˆ—è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ ä¿®æ”¹ä¸º 'peekaboo'
print(b_list)          # è¾“å‡º: ['foo', 'peekaboo', 'baz']
```

## åˆ—è¡¨ï¼šå®ä½“åŒ–è¿­ä»£å™¨

`list()` å®ä½“åŒ–è¿­ä»£å™¨/ç”Ÿæˆå™¨ï¼š

```{python}
gen = range(10)     # åˆ›å»ºä¸€ä¸ª range å¯¹è±¡ï¼ˆè¿­ä»£å™¨ï¼‰
print(gen)          # è¾“å‡º: range(0, 10)
my_list = list(gen) # å°† range å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨
print(my_list)      # è¾“å‡º: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
```

## åˆ—è¡¨ï¼šæ·»åŠ å…ƒç´ 

-   `append()`: æ·»åŠ åˆ°*æœ«å°¾*ã€‚

```{python}
b_list.append('dwarf') # åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ  'dwarf'
print(b_list)         # è¾“å‡º: ['foo', 'peekaboo', 'baz', 'dwarf']
```

-   `insert()`: åœ¨*ç‰¹å®šä½ç½®*æ’å…¥ã€‚

```{python}
b_list.insert(1, 'red') # åœ¨ç´¢å¼• 1 å¤„æ’å…¥ 'red'
print(b_list)           # è¾“å‡º: ['foo', 'red', 'peekaboo', 'baz', 'dwarf']
```

::: {.callout-caution}
`insert` æ¯” `append` å¼€é”€æ›´å¤§ï¼ˆå®ƒä¼šç§»åŠ¨å…ƒç´ ï¼‰ã€‚
:::

## åˆ—è¡¨ï¼šåˆ é™¤å…ƒç´  (pop å’Œ remove)

-   `pop()`: åˆ é™¤å¹¶*è¿”å›*æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚

```{python}
removed_element = b_list.pop(2) # åˆ é™¤ç´¢å¼• 2 å¤„çš„å…ƒç´ ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ removed_element
print(removed_element)         # è¾“å‡º: peekaboo
print(b_list)                   # è¾“å‡º: ['foo', 'red', 'baz', 'dwarf']
```

-   `remove()`: åˆ é™¤*ç¬¬ä¸€ä¸ª*å‡ºç°çš„æŒ‡å®šå€¼ã€‚

```{python}
b_list.append('foo')         # å†æ¬¡åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ  'foo'
b_list.remove('foo')        # åˆ é™¤ç¬¬ä¸€ä¸ªå‡ºç°çš„ 'foo'
print(b_list)               # è¾“å‡º: ['red', 'baz', 'dwarf', 'foo']
```

## åˆ—è¡¨ï¼šæ£€æŸ¥æˆå‘˜èµ„æ ¼ (in å’Œ not in)

```{python}
print('dwarf' in b_list)     # æ£€æŸ¥ 'dwarf' æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼Œè¾“å‡º: True
print('dwarf' not in b_list) # æ£€æŸ¥ 'dwarf' æ˜¯å¦ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œè¾“å‡º: False
```

::: {.callout-note}
å¯¹äºåˆ—è¡¨ï¼Œ`in` / `not in` é€Ÿåº¦å¾ˆ*æ…¢*ï¼ˆçº¿æ€§æ‰«æï¼‰ã€‚å­—å…¸å’Œé›†åˆå¿«å¾—å¤šï¼ˆå“ˆå¸Œè¡¨ï¼Œå¸¸æ•°æ—¶é—´ï¼‰ã€‚
:::

## åˆ—è¡¨ï¼šè¿æ¥å’Œåˆå¹¶

ä½¿ç”¨ `+` è¿æ¥ï¼š

```{python}
list1 = [4, None, 'foo']      # åˆ›å»ºåˆ—è¡¨ list1
list2 = [7, 8, (2, 3)]      # åˆ›å»ºåˆ—è¡¨ list2
combined_list = list1 + list2 # è¿æ¥ä¸¤ä¸ªåˆ—è¡¨
print(combined_list)         # è¾“å‡º: [4, None, 'foo', 7, 8, (2, 3)]
```

`extend()` è¿½åŠ å¤šä¸ªå…ƒç´ ï¼š

```{python}
x = [4, None, 'foo']       # åˆ›å»ºåˆ—è¡¨ x
x.extend([7, 8, (2, 3)]) # ä½¿ç”¨ extend æ–¹æ³•è¿½åŠ å¤šä¸ªå…ƒç´ 
print(x)                   # è¾“å‡º: [4, None, 'foo', 7, 8, (2, 3)]
```

::: {.callout-tip}
`extend()` é€šå¸¸æ¯” `+` å¿«ï¼ˆä¸åˆ›å»ºæ–°åˆ—è¡¨ï¼‰ã€‚
:::

## åˆ—è¡¨ï¼šæ’åº (sort å’Œ sorted)

-   `sort()`: *å°±åœ°*æ’åºã€‚

```{python}
a = [7, 2, 5, 1, 3] # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
a.sort()            # å¯¹åˆ—è¡¨è¿›è¡Œå°±åœ°æ’åº
print(a)            # è¾“å‡º: [1, 2, 3, 5, 7]
```

- `key` å‚æ•°:  æä¾›è‡ªå®šä¹‰æ’åºæ–¹æ³•ã€‚

```{python}
b = ['saw', 'small', 'He', 'foxes', 'six'] # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
b.sort(key=len)   # æŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦å¯¹åˆ—è¡¨è¿›è¡Œæ’åº
print(b)            # è¾“å‡º: ['He', 'saw', 'six', 'small', 'foxes']
```

## åˆ—è¡¨ï¼šåˆ‡ç‰‡

ä½¿ç”¨ `start:stop` é€‰æ‹©éƒ¨åˆ†ï¼š

```{python}
seq = [7, 2, 3, 7, 5, 6, 0, 1] # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
sub_list = seq[1:5]          # ä»ç´¢å¼• 1ï¼ˆåŒ…å«ï¼‰åˆ° 5ï¼ˆä¸åŒ…å«ï¼‰è¿›è¡Œåˆ‡ç‰‡
print(sub_list)              # è¾“å‡º: [2, 3, 7, 5]

seq[3:5] = [6,3] # ä½¿ç”¨åˆ‡ç‰‡æ›¿æ¢å…ƒç´ 
print(seq) # è¾“å‡º: [7, 2, 3, 6, 3, 6, 0, 1]
```

## åˆ—è¡¨ï¼šåˆ‡ç‰‡ï¼ˆçœç•¥ start/stop å’Œè´Ÿç´¢å¼•ï¼‰

-   çœç•¥ `start`: é»˜è®¤ä¸ºå¼€å¤´ã€‚
-   çœç•¥ `stop`: é»˜è®¤ä¸ºç»“å°¾ã€‚
-   è´Ÿç´¢å¼•ï¼šä»æœ«å°¾å¼€å§‹è®¡æ•°ã€‚

```{python}
print(seq[:5])    # è·å–å‰ 5 ä¸ªå…ƒç´ ï¼Œè¾“å‡º: [7, 2, 3, 6, 3]
print(seq[3:])    # ä»ç´¢å¼• 3 å¼€å§‹åˆ°ç»“å°¾ï¼Œè¾“å‡º: [6, 3, 6, 0, 1]
print(seq[-4:])   # è·å–æœ€å 4 ä¸ªå…ƒç´ ï¼Œè¾“å‡º: [3, 6, 0, 1]
print(seq[-6:-2]) # è·å–å€’æ•°ç¬¬ 6 ä¸ªåˆ°å€’æ•°ç¬¬ 2 ä¸ªå…ƒç´ ï¼ˆä¸åŒ…å«ï¼‰ï¼Œè¾“å‡º: [3, 6, 3, 6]
```

## åˆ—è¡¨ï¼šåˆ‡ç‰‡ï¼ˆæ­¥é•¿ï¼‰

ä½¿ç”¨*æ­¥é•¿*é€‰æ‹©æ¯ n ä¸ªå…ƒç´ ï¼š

```{python}
print(seq[::2])   # æ¯éš”ä¸€ä¸ªå…ƒç´ å–ä¸€ä¸ªï¼Œè¾“å‡º: [7, 3, 3, 0]
print(seq[::-1])  # åè½¬åˆ—è¡¨ï¼Œè¾“å‡º: [1, 0, 6, 3, 6, 3, 2, 7]
```

## åˆ—è¡¨åˆ‡ç‰‡å›¾ç¤º

<center>

| 0    | 1    | 2    | 3    | 4    | 5    |
| :--- | :--- | :--- | :--- | :--- | :--- |
| H    | E    | L    | L    | O    | !    |
| 0    | 1    | 2    | 3    | 4    | 5    | 6    |
| -6   | -5   | -4   | -3   | -2   | -1   |      |

</center>

```{python}
string = "HELLO!"
print(string[2:4]) # ä½¿ç”¨æ­£ç´¢å¼•è¿›è¡Œåˆ‡ç‰‡ï¼Œè¾“å‡º: LL
print(string[-5:-2]) # ä½¿ç”¨è´Ÿç´¢å¼•è¿›è¡Œåˆ‡ç‰‡, è¾“å‡º: ELL
```
æ­¤å›¾è¯´æ˜äº†åœ¨å­—ç¬¦ä¸²â€œHELLO!â€ä¸Šçš„åˆ‡ç‰‡ã€‚ç´¢å¼•æ˜¾ç¤ºåœ¨â€œæ ¼å­è¾¹ç¼˜â€ï¼Œä»¥å¸®åŠ©æ˜¾ç¤ºä½¿ç”¨æ­£ç´¢å¼•æˆ–è´Ÿç´¢å¼•æ—¶åˆ‡ç‰‡é€‰æ‹©çš„å¼€å§‹å’Œåœæ­¢ä½ç½®ã€‚

## å­—å…¸ (dict)ï¼šå®šä¹‰

å­—å…¸ï¼ˆæˆ– `dict`ï¼‰è‡³å…³é‡è¦ã€‚å®ƒä»¬å­˜å‚¨*é”®å€¼å¯¹*ï¼ˆç±»ä¼¼äºå“ˆå¸Œæ˜ å°„ï¼‰ã€‚

::: {.callout-tip}
### é”®å€¼å¯¹
æ¯ä¸ª*é”®*éƒ½ä¸ä¸€ä¸ª*å€¼*ç›¸å…³è”ã€‚é”®æ˜¯*å”¯ä¸€*ä¸”*ä¸å¯å˜*çš„ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å…ƒç»„ï¼‰ã€‚å€¼å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚
:::

## å­—å…¸ï¼šåˆ›å»º

ä½¿ç”¨ `{}` å’Œ `:`ï¼š

```{python}
empty_dict = {} # åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸
d1 = {'a': 'some value', 'b': [1, 2, 3, 4]} # åˆ›å»ºä¸€ä¸ªå­—å…¸
print(d1) # è¾“å‡º: {'a': 'some value', 'b': [1, 2, 3, 4]}
```

## å­—å…¸ï¼šè®¿é—®ã€æ’å…¥ã€è®¾ç½®

```{python}
d1[7] = 'an integer'  # æ·»åŠ é”®å€¼å¯¹ 7: 'an integer'
print(d1)            # è¾“å‡º: {'a': 'some value', 'b': [1, 2, 3, 4], 7: 'an integer'}
print(d1['b'])       # è®¿é—®é”® 'b' å¯¹åº”çš„å€¼ï¼Œè¾“å‡º: [1, 2, 3, 4]
```

## å­—å…¸ï¼šæ£€æŸ¥é”® (in)

```{python}
print('b' in d1)  # æ£€æŸ¥é”® 'b' æ˜¯å¦å­˜åœ¨äºå­—å…¸ä¸­ï¼Œè¾“å‡º: True
```

## å­—å…¸ï¼šåˆ é™¤ (del å’Œ pop)

-   `del`:

```{python}
d1[5] = 'some value'      # æ·»åŠ é”®å€¼å¯¹ 5: 'some value'
d1['dummy'] = 'another value' # æ·»åŠ é”®å€¼å¯¹ 'dummy': 'another value'
print(d1)                   # è¾“å‡º: {'a': 'some value', 'b': [1, 2, 3, 4], 7: 'an integer', 5: 'some value', 'dummy': 'another value'}
del d1[5]                 # åˆ é™¤é”® 5 åŠå…¶å¯¹åº”çš„å€¼
print(d1)                   # è¾“å‡º: {'a': 'some value', 'b': [1, 2, 3, 4], 7: 'an integer', 'dummy': 'another value'}
```

-   `pop()`: åˆ é™¤å¹¶*è¿”å›*ã€‚

```{python}
ret = d1.pop('dummy') # åˆ é™¤é”® 'dummy' åŠå…¶å¯¹åº”çš„å€¼ï¼Œå¹¶å°†å€¼èµ‹ç»™ ret
print(ret)            # è¾“å‡º: another value
print(d1)            # è¾“å‡º: {'a': 'some value', 'b': [1, 2, 3, 4], 7: 'an integer'}
```

## å­—å…¸ï¼škeys(), values() å’Œ items() æ–¹æ³•

-   `keys()`: é”®çš„è¿­ä»£å™¨ã€‚
-   `values()`: å€¼çš„è¿­ä»£å™¨ã€‚
-   `items()`: é”®å€¼å¯¹çš„è¿­ä»£å™¨ã€‚

```{python}
print(list(d1.keys()))   # è·å–å­—å…¸ä¸­æ‰€æœ‰é”®çš„åˆ—è¡¨ï¼Œè¾“å‡º: ['a', 'b', 7]
print(list(d1.values())) # è·å–å­—å…¸ä¸­æ‰€æœ‰å€¼çš„åˆ—è¡¨ï¼Œè¾“å‡º: ['some value', [1, 2, 3, 4], 'an integer']
print(list(d1.items()))  # è·å–å­—å…¸ä¸­æ‰€æœ‰é”®å€¼å¯¹çš„åˆ—è¡¨ï¼Œè¾“å‡º: [('a', 'some value'), ('b', [1, 2, 3, 4]), (7, 'an integer')]
```

::: {.callout-note}
é”®çš„é¡ºåºå–å†³äºæ’å…¥é¡ºåºã€‚`keys` å’Œ `values` ä»¥*ç›¸åŒ*çš„é¡ºåºè¿”å›è¿­ä»£å™¨ã€‚
:::

## å­—å…¸ï¼šä½¿ç”¨ update() åˆå¹¶

`update()` åˆå¹¶å­—å…¸ï¼š

```{python}
d1.update({'b': 'foo', 'c': 12})  # æ›´æ–°é”® 'b' çš„å€¼ï¼Œå¹¶æ·»åŠ é”®å€¼å¯¹ 'c': 12
print(d1)                       # è¾“å‡º: {'a': 'some value', 'b': 'foo', 7: 'an integer', 'c': 12}
```

::: {.callout-caution}
`update()` æ˜¯*å°±åœ°*æ“ä½œã€‚ç°æœ‰é”®çš„å€¼ä¼šè¢«ä¸¢å¼ƒã€‚
:::

## å­—å…¸ï¼šä»åºåˆ—åˆ›å»º

```{python}
key_list = ['a', 'b', 'c']             # åˆ›å»ºä¸€ä¸ªé”®åˆ—è¡¨
value_list = [1, 2, 3]               # åˆ›å»ºä¸€ä¸ªå€¼åˆ—è¡¨
mapping = {}                          # åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸
for key, value in zip(key_list, value_list): # ä½¿ç”¨ zip å°†é”®åˆ—è¡¨å’Œå€¼åˆ—è¡¨é…å¯¹
    mapping[key] = value            # å°†é”®å€¼å¯¹æ·»åŠ åˆ°å­—å…¸ä¸­
print(mapping)                      # è¾“å‡º: {'a': 1, 'b': 2, 'c': 3}

# ç®€æ´å†™æ³•ï¼šdict() å’Œ zip()
mapping = dict(zip(range(5), reversed(range(5)))) # ä½¿ç”¨ zip å’Œ reversed åˆ›å»ºå­—å…¸
print(mapping)                                  # è¾“å‡º: {0: 4, 1: 3, 2: 2, 3: 1, 4: 0}
```
`zip` å‡½æ•°å¯ä»¥å°†å¤šä¸ªåºåˆ—çš„å…ƒç´ é…å¯¹ã€‚`dict` æ¥å—ä¸€ä¸ªç”± 2 å…ƒç»„ç»„æˆçš„åˆ—è¡¨ã€‚

## å­—å…¸ï¼šé»˜è®¤å€¼ (get å’Œ setdefault)

```{python}
#| eval: false
# å†—é•¿å†™æ³•ï¼š
if 'some_key' in some_dict:   # æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
    value = some_dict['some_key'] # å¦‚æœå­˜åœ¨ï¼Œè·å–å€¼
else:
    value = default_value     # å¦‚æœä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å€¼

# ç®€æ´å†™æ³•ï¼šget()
value = some_dict.get('some_key', default_value) # å¦‚æœé”®å­˜åœ¨ï¼Œè¿”å›å€¼ï¼›å¦åˆ™è¿”å›é»˜è®¤å€¼
```

å¦‚æœé”®ä¸å­˜åœ¨ï¼Œ`get` è¿”å› `None`ï¼ˆæˆ–æŒ‡å®šçš„é»˜è®¤å€¼ï¼‰ï¼Œè€Œ `pop` ä¼šå¼•å‘å¼‚å¸¸ã€‚

```{python}
words = ['apple', 'bat', 'bar', 'atom', 'book'] # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
by_letter = {}                                  # åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸
for word in words:                             # éå†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯
    letter = word[0]                          # è·å–å•è¯çš„é¦–å­—æ¯
    by_letter.setdefault(letter, []).append(word) # ä½¿ç”¨ setdefault è®¾ç½®é»˜è®¤å€¼ï¼Œå¹¶è¿½åŠ å•è¯
print(by_letter)                                # è¾“å‡º: {'a': ['apple', 'atom'], 'b': ['bat', 'bar', 'book']}
```

`setdefault(key, default)`: å¦‚æœ `key` å­˜åœ¨ï¼Œåˆ™è¿”å›å…¶å€¼ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ `key` å¹¶è®¾ç½®å€¼ä¸º `default`ï¼Œç„¶åè¿”å› `default`ã€‚

## å­—å…¸ï¼šdefaultdict

`collections.defaultdict` ç®€åŒ–äº†åˆå§‹åŒ–ï¼š

```{python}
from collections import defaultdict # å¯¼å…¥ defaultdict

by_letter = defaultdict(list)      # åˆ›å»ºä¸€ä¸ª defaultdictï¼Œé»˜è®¤å€¼ä¸ºåˆ—è¡¨
for word in words:                # éå†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯
    by_letter[word[0]].append(word) # è‡ªåŠ¨åˆ›å»ºåˆ—è¡¨å¹¶è¿½åŠ å•è¯
print(by_letter)                   # è¾“å‡º: defaultdict(<class 'list'>, {'a': ['apple', 'atom'], 'b': ['bat', 'bar', 'book']})
```

## å­—å…¸ï¼šæœ‰æ•ˆçš„é”®ç±»å‹ï¼ˆå“ˆå¸Œæ€§ï¼‰

-   é”®å¿…é¡»æ˜¯*ä¸å¯å˜*çš„ã€‚
-   ä½¿ç”¨ `hash()` æ£€æŸ¥ï¼š

```{python}
print(hash('string'))        # å­—ç¬¦ä¸²å¯ä»¥å“ˆå¸Œï¼Œè¾“å‡ºä¸€ä¸ªå“ˆå¸Œå€¼
print(hash((1, 2, (2, 3)))) # å…ƒç»„å¯ä»¥å“ˆå¸Œï¼Œè¾“å‡ºä¸€ä¸ªå“ˆå¸Œå€¼
# print(hash((1, 2, [2, 3])))  # è¿™è¡Œä»£ç ä¼šå¼•å‘ TypeError: unhashable type: 'list'ï¼Œå› ä¸ºåˆ—è¡¨ä¸å¯å“ˆå¸Œ

# åˆ—è¡¨ä½œä¸ºé”®ï¼Ÿè½¬æ¢ä¸ºå…ƒç»„ï¼š
d = {}                      # åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸
d[tuple([1, 2, 3])] = 5    # å°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„ä½œä¸ºé”®
print(d)                    # è¾“å‡º: {(1, 2, 3): 5}
```

## é›†åˆï¼šå®šä¹‰å’Œå”¯ä¸€æ€§

é›†åˆæ˜¯*æ— åº*çš„*å”¯ä¸€*å…ƒç´ é›†åˆï¼ˆç±»ä¼¼äºåªæœ‰é”®çš„å­—å…¸ï¼‰ã€‚

## é›†åˆï¼šåˆ›å»º

```{python}
set1 = {2, 2, 2, 1, 3, 3}  # ä½¿ç”¨ {} åˆ›å»ºé›†åˆ
print(set1)               # è¾“å‡º: {1, 2, 3} ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
set2 = set([2, 2, 2, 1, 3, 3])  # ä½¿ç”¨ set() åˆ›å»ºé›†åˆ
print(set2)                      # è¾“å‡º: {1, 2, 3}
```

## é›†åˆï¼šè¿ç®—ï¼ˆå¹¶é›†ã€äº¤é›†ç­‰ï¼‰

```{python}
a = {1, 2, 3, 4, 5} # åˆ›å»ºé›†åˆ a
b = {3, 4, 5, 6, 7, 8} # åˆ›å»ºé›†åˆ b

# å¹¶é›† (| æˆ– union())
print(a.union(b))     # è¾“å‡º: {1, 2, 3, 4, 5, 6, 7, 8}
print(a | b)          # è¾“å‡º: {1, 2, 3, 4, 5, 6, 7, 8}

# äº¤é›† (& æˆ– intersection())
print(a.intersection(b)) # è¾“å‡º: {3, 4, 5}
print(a & b)          # è¾“å‡º: {3, 4, 5}

# å·®é›† (- æˆ– difference())
print(a.difference(b)) # è¾“å‡º: {1, 2}
print(a - b) #è¾“å‡ºï¼š {1, 2}
```

## é›†åˆè¿ç®—

| å‡½æ•°                             | æ›¿ä»£è¯­æ³•     | æè¿°                                                                      |
| :-------------------------------- | :----------- | :------------------------------------------------------------------------ |
| `a.add(x)`                       | N/A          | å°†å…ƒç´  x æ·»åŠ åˆ°é›†åˆ a                                                        |
| `a.clear()`                     | N/A          | å°†é›†åˆ a é‡ç½®ä¸ºç©ºé›†ï¼Œä¸¢å¼ƒæ‰€æœ‰å…ƒç´                                              |
| `a.remove(x)`                    | N/A          | ä»é›†åˆ a ä¸­ç§»é™¤å…ƒç´  x                                                         |
| `a.pop()`                        | N/A          | ä»é›†åˆ a ä¸­ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªä»»æ„å…ƒç´ ï¼Œå¦‚æœé›†åˆä¸ºç©ºåˆ™å¼•å‘ KeyError                   |
| `a.union(b)`                    | `a \| b`     | a å’Œ b ä¸­çš„æ‰€æœ‰å”¯ä¸€å…ƒç´                                                         |
| `a.update(b)`                   | `a \|= b`    | å°† a çš„å†…å®¹è®¾ç½®ä¸º a å’Œ b ä¸­å…ƒç´ çš„å¹¶é›†                                          |
| `a.intersection(b)`             | `a & b`      | a å’Œ b ä¸­çš„æ‰€æœ‰å…ƒç´                                                            |
| `a.intersection_update(b)`      | `a &= b`     | å°† a çš„å†…å®¹è®¾ç½®ä¸º a å’Œ b ä¸­å…ƒç´ çš„äº¤é›†                                          |
| `a.difference(b)`               | `a - b`      | a ä¸­ä¸åœ¨ b ä¸­çš„å…ƒç´                                                           |
| `a.difference_update(b)`        | `a -= b`     | å°† a è®¾ç½®ä¸º a ä¸­ä¸åœ¨ b ä¸­çš„å…ƒç´                                                    |
| `a.symmetric_difference(b)`     | `a ^ b`      | a æˆ– b ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œä½†ä¸åŒæ—¶åœ¨ä¸¤è€…ä¸­                                              |
| `a.symmetric_difference_update(b)` | `a ^= b`     | å°† a è®¾ç½®ä¸ºåŒ…å« a æˆ– b ä¸­çš„å…ƒç´ ï¼Œä½†ä¸åŒæ—¶åœ¨ä¸¤è€…ä¸­                                    |
| `a.issubset(b)`                 | `<=`         | å¦‚æœ a çš„æ‰€æœ‰å…ƒç´ éƒ½åŒ…å«åœ¨ b ä¸­ï¼Œåˆ™ä¸º True                                     |
| `a.issuperset(b)`               | `>=`         | å¦‚æœ b çš„æ‰€æœ‰å…ƒç´ éƒ½åŒ…å«åœ¨ a ä¸­ï¼Œåˆ™ä¸º True                                     |
| `a.isdisjoint(b)`               | N/A          | å¦‚æœ a å’Œ b æ²¡æœ‰å…±åŒå…ƒç´ ï¼Œåˆ™ä¸º True                                             |

## é›†åˆï¼šå°±åœ°è¿ç®—

å­˜åœ¨å°±åœ°ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œ`a |= b`ï¼‰ï¼š

```{python}
c = a.copy() # åˆ›å»º a çš„å‰¯æœ¬
c |= b       # å°±åœ°å¹¶é›†
print(c)     # è¾“å‡º: {1, 2, 3, 4, 5, 6, 7, 8}

d = a.copy()  # åˆ›å»º a çš„å‰¯æœ¬
d &= b        # å°±åœ°äº¤é›†
print(d)      # è¾“å‡º: {3, 4, 5}
```

::: {.callout-tip}
å¯¹äºå¤§å‹é›†åˆï¼Œå°±åœ°è¿ç®—æ›´æœ‰æ•ˆã€‚
:::

## é›†åˆï¼šå…ƒç´ å“ˆå¸Œæ€§

ä¸å­—å…¸é”®ä¸€æ ·ï¼Œé›†åˆå…ƒç´ å¿…é¡»æ˜¯*ä¸å¯å˜*ä¸”*å¯å“ˆå¸Œ*çš„ã€‚

```{python}
my_data = [1, 2, 3, 4]   # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
# my_set = {my_data}  # è¿™è¡Œä»£ç ä¼šå¼•å‘ TypeErrorï¼Œå› ä¸ºåˆ—è¡¨ä¸å¯å“ˆå¸Œ
my_set = {tuple(my_data)} # å°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„
print(my_set)            # è¾“å‡º: {(1, 2, 3, 4)}
```

## é›†åˆï¼šå­é›†å’Œè¶…é›†

```{python}
a_set = {1, 2, 3, 4, 5} # åˆ›å»ºä¸€ä¸ªé›†åˆ
print({1, 2, 3}.issubset(a_set))   # æ£€æŸ¥ {1, 2, 3} æ˜¯å¦æ˜¯ a_set çš„å­é›†ï¼Œè¾“å‡º: True
print(a_set.issuperset({1, 2, 3})) # æ£€æŸ¥ a_set æ˜¯å¦æ˜¯ {1, 2, 3} çš„è¶…é›†ï¼Œè¾“å‡º: True
```

## é›†åˆï¼šç›¸ç­‰æ€§

å¦‚æœå†…å®¹ç›¸ç­‰ï¼Œåˆ™é›†åˆç›¸ç­‰ï¼š

```{python}
print({1, 2, 3} == {3, 2, 1}) # è¾“å‡º: True
```

## å†…ç½®åºåˆ—å‡½æ•°ï¼šenumerate

`enumerate` åœ¨è¿­ä»£æœŸé—´è·Ÿè¸ªç´¢å¼•ï¼š

```{python}
collection = ['foo', 'bar', 'baz'] # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨

# ä¸ä½¿ç”¨ enumerate çš„å†™æ³•ï¼š
i = 0                             # åˆå§‹åŒ–ç´¢å¼•
for value in collection:         # éå†åˆ—è¡¨
    print(f"Index: {i}, Value: {value}") # æ‰“å°ç´¢å¼•å’Œå€¼
    i += 1                        # ç´¢å¼•é€’å¢

# ä½¿ç”¨ enumerateï¼š
for i, value in enumerate(collection): # åŒæ—¶è·å–ç´¢å¼•å’Œå€¼
    print(f"Index: {i}, Value: {value}") # æ‰“å°ç´¢å¼•å’Œå€¼
```

`enumerate` è¿”å› `(index, value)` å…ƒç»„ã€‚

## å†…ç½®åºåˆ—å‡½æ•°ï¼šsorted

`sorted` è¿”å›ä¸€ä¸ª*æ–°çš„*æ’åºåˆ—è¡¨ï¼š

```{python}
print(sorted([7, 1, 2, 6, 0, 3, 2]))  # å¯¹åˆ—è¡¨è¿›è¡Œæ’åºï¼Œè¾“å‡º: [0, 1, 2, 2, 3, 6, 7]
print(sorted('horse race'))          # å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼Œè¾“å‡º: [' ', 'a', 'c', 'e', 'e', 'h', 'o', 'r', 'r', 's']
```

::: {.callout-note}
`sorted()` è¿”å›ä¸€ä¸ª*æ–°*åˆ—è¡¨ã€‚`list.sort()` *å°±åœ°*æ’åºã€‚
:::

## å†…ç½®åºåˆ—å‡½æ•°ï¼šzip

`zip` å°†å…ƒç´ â€œé…å¯¹â€ï¼š

```{python}
seq1 = ['foo', 'bar', 'baz']   # åˆ›å»ºåˆ—è¡¨ seq1
seq2 = ['one', 'two', 'three'] # åˆ›å»ºåˆ—è¡¨ seq2
zipped = zip(seq1, seq2)       # å°† seq1 å’Œ seq2 é…å¯¹
print(list(zipped))           # è¾“å‡º: [('foo', 'one'), ('bar', 'two'), ('baz', 'three')]
```

`zip` å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„åºåˆ—ã€‚è¾“å‡ºé•¿åº¦ç”±*æœ€çŸ­*çš„åºåˆ—å†³å®šï¼š

```{python}
seq3 = [False, True]           # åˆ›å»ºåˆ—è¡¨ seq3
print(list(zip(seq1, seq2, seq3))) # è¾“å‡º: [('foo', 'one', False), ('bar', 'two', True)]
```

## å†…ç½®åºåˆ—å‡½æ•°ï¼šzip (ä¸ enumerate ç»“åˆ)

ä½¿ç”¨ `enumerate` è¿­ä»£å¤šä¸ªåºåˆ—ï¼š

```{python}
for i, (a, b) in enumerate(zip(seq1, seq2)): # åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—ï¼Œå¹¶è·å–ç´¢å¼•
    print(f'{i}: {a}, {b}')                  # è¾“å‡º: 0: foo, one \n 1: bar, two \n 2: baz, three
```

## å†…ç½®åºåˆ—å‡½æ•°ï¼šreversed

`reversed` ä»¥*ç›¸å*çš„é¡ºåºè¿­ä»£ï¼š

```{python}
print(list(reversed(range(10))))  # åå‘è¿­ä»£ range(10)ï¼Œè¾“å‡º: [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
```

::: {.callout-note}
`reversed` æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆåœ¨å®ä½“åŒ–ä¹‹å‰ä¸ä¼šåˆ›å»ºåå‘åºåˆ—ï¼‰ã€‚
:::

## åˆ—è¡¨ã€é›†åˆå’Œå­—å…¸æ¨å¯¼å¼

æ¨å¯¼å¼å¯ä»¥ç®€æ´åœ°åˆ›å»ºæ–°é›†åˆã€‚

## åˆ—è¡¨æ¨å¯¼å¼ï¼šåŸºæœ¬å½¢å¼

```{python}
#| eval: false

# é€šç”¨å½¢å¼ï¼š[expr for val in collection if condition]

# ç­‰æ•ˆçš„ for å¾ªç¯ï¼š
result = []                # åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨
for val in collection:     # éå†é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ 
    if condition:          # å¦‚æœæ¡ä»¶ä¸ºçœŸ
        result.append(expr) # å°†è¡¨è¾¾å¼çš„ç»“æœæ·»åŠ åˆ°åˆ—è¡¨ä¸­
```

ç¤ºä¾‹ï¼š

```{python}
strings = ['a', 'as', 'bat', 'car', 'dove', 'python'] # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
# ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼å°†é•¿åº¦å¤§äº 2 çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™
upper_case_long_strings = [x.upper() for x in strings if len(x) > 2]
print(upper_case_long_strings)  # è¾“å‡º: ['BAT', 'CAR', 'DOVE', 'PYTHON']
```

## é›†åˆæ¨å¯¼å¼

```{python}
# {expr for val in collection if condition}
strings = ['a', 'as', 'bat', 'car', 'dove', 'python'] # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
unique_lengths = {len(x) for x in strings}   # ä½¿ç”¨é›†åˆæ¨å¯¼å¼è·å–åˆ—è¡¨ä¸­å­—ç¬¦ä¸²çš„å”¯ä¸€é•¿åº¦
print(unique_lengths)                       # è¾“å‡º: {1, 2, 3, 4, 6}

# ä½¿ç”¨ map å‡½æ•°
print(set(map(len, strings))) # ä½¿ç”¨mapå‡½æ•°å’Œsetè¾¾åˆ°åŒæ ·æ•ˆæœ
```
ç±»ä¼¼äºåˆ—è¡¨æ¨å¯¼å¼ï¼Œä½†ä½¿ç”¨ `{}`ï¼ˆåˆ›å»ºä¸€ä¸ªé›†åˆï¼‰ã€‚

## å­—å…¸æ¨å¯¼å¼

```{python}
# {key_expr: value_expr for val in collection if condition}

strings = ['a', 'as', 'bat', 'car', 'dove', 'python']   # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
# ä½¿ç”¨å­—å…¸æ¨å¯¼å¼åˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­é”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼æ˜¯å­—ç¬¦ä¸²åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•
loc_mapping = {val: index for index, val in enumerate(strings)}
print(loc_mapping) # è¾“å‡º: {'a': 0, 'as': 1, 'bat': 2, 'car': 3, 'dove': 4, 'python': 5}
```

## åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼

```{python}
all_data = [['John', 'Emily', 'Michael', 'Mary', 'Steven'],
            ['Maria', 'Juan', 'Javier', 'Natalia', 'Pilar']]

# ä½¿ç”¨åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼æ‰¾å‡ºåå­—ä¸­åŒ…å«2ä¸ªä»¥ä¸Šaçš„åå­—ã€‚
names_of_interest = [name for names in all_data for name in names
                     if name.count('a') >= 2]
print(names_of_interest) # è¾“å‡º: ['Maria', 'Natalia']


some_tuples = [(1, 2, 3), (4, 5, 6), (7, 8, 9)] # åˆ›å»ºä¸€ä¸ªå…ƒç»„åˆ—è¡¨
flattened = [x for tup in some_tuples for x in tup] # ä½¿ç”¨åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼å±•å¼€å…ƒç»„
print(flattened) # è¾“å‡º: [1, 2, 3, 4, 5, 6, 7, 8, 9]

# åˆ—è¡¨æ¨å¯¼å¼ä¸­çš„åˆ—è¡¨æ¨å¯¼å¼
flattened = [[x for x in tup] for tup in some_tuples]  # ä¸¤å±‚åˆ—è¡¨æ¨å¯¼
print(flattened) # è¾“å‡ºï¼š [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
```

::: {.callout-note}
`for` çš„é¡ºåºä¸åµŒå¥— `for` å¾ªç¯ä¸­çš„é¡ºåºç›¸åŒã€‚
:::

## 3.2 å‡½æ•°

å‡½æ•°ç»„ç»‡å’Œé‡ç”¨ä»£ç ã€‚

## å‡½æ•°å£°æ˜ (def)

```{python}
def my_function(x, y):                      # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œåä¸º my_functionï¼Œæ¥å—ä¸¤ä¸ªå‚æ•° x å’Œ y
    """Docstring: è§£é‡Šå‡½æ•°çš„åŠŸèƒ½ã€‚"""   # å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²
    return x + y                            # è¿”å› x å’Œ y çš„å’Œ

result = my_function(1, 2)                  # è°ƒç”¨å‡½æ•°ï¼Œå¹¶å°†è¿”å›å€¼èµ‹ç»™ result
print(result)                              # è¾“å‡º: 3
print(my_function.__doc__) # è®¿é—®æ–‡æ¡£å­—ç¬¦ä¸², è¾“å‡º: Docstring: è§£é‡Šå‡½æ•°çš„åŠŸèƒ½ã€‚
```

-   `return` è¿”å›ä¸€ä¸ªå€¼ã€‚
-   å¦‚æœæ²¡æœ‰ `return` è¯­å¥ï¼Œåˆ™éšå¼è¿”å› `None`ã€‚

## å‡½æ•°å‚æ•°ï¼ˆä½ç½®å‚æ•°å’Œå…³é”®å­—å‚æ•°ï¼‰

```{python}
def my_function2(x, y, z=1.5):  # å®šä¹‰å‡½æ•°ï¼Œz æ˜¯å…³é”®å­—å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º 1.5
    if z > 1:                   # å¦‚æœ z å¤§äº 1
        return z * (x + y)      # è¿”å› z ä¹˜ä»¥ x å’Œ y çš„å’Œ
    else:                       # å¦åˆ™
        return z / (x + y)      # è¿”å› z é™¤ä»¥ x å’Œ y çš„å’Œ

print(my_function2(5, 6, z=0.7))  # ä½¿ç”¨å…³é”®å­—å‚æ•°è°ƒç”¨å‡½æ•°ï¼Œè¾“å‡º: 0.06363636363636363
print(my_function2(3.14, 7, 3.5)) # ä½¿ç”¨ä½ç½®å‚æ•°è°ƒç”¨å‡½æ•°ï¼Œè¾“å‡º: 35.49
print(my_function2(10, 20))       # ä½¿ç”¨é»˜è®¤å‚æ•°è°ƒç”¨å‡½æ•°ï¼Œè¾“å‡º: 45.0
```

-   *ä½ç½®å‚æ•°*ï¼šæŒ‰æ­£ç¡®çš„é¡ºåºä¼ é€’ã€‚
-   *å…³é”®å­—å‚æ•°*ï¼šå¯ä»¥æŒ‰ä»»æ„é¡ºåºä¼ é€’ï¼Œé€šå¸¸å¸¦æœ‰é»˜è®¤å€¼ã€‚
-   å…³é”®å­—å‚æ•°å¿…é¡»*è·Ÿåœ¨*ä½ç½®å‚æ•°ä¹‹åã€‚

## å‘½åç©ºé—´ã€ä½œç”¨åŸŸå’Œå±€éƒ¨å‡½æ•°

-   å‡½æ•°å†…çš„å˜é‡ä½äº*å±€éƒ¨å‘½åç©ºé—´*ä¸­ï¼ˆé»˜è®¤ï¼‰ã€‚
-   å±€éƒ¨å‘½åç©ºé—´ï¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶åˆ›å»ºï¼Œåœ¨å‡½æ•°ç»“æŸæ—¶é”€æ¯ã€‚

```{python}
def func():        # å®šä¹‰ä¸€ä¸ªå‡½æ•°
    a = []          # 'a' æ˜¯å±€éƒ¨å˜é‡
    for i in range(5): # å¾ªç¯ 5 æ¬¡
        a.append(i) # å°† i è¿½åŠ åˆ°åˆ—è¡¨ a ä¸­

func()             # è°ƒç”¨å‡½æ•°
# print(a)  # è¿™è¡Œä»£ç ä¼šå¼•å‘ NameError: name 'a' is not definedï¼Œå› ä¸º 'a' åœ¨å‡½æ•°å¤–éƒ¨ä¸å¯è§
```

-   å¯ä»¥è®¿é—®å°é—­ä½œç”¨åŸŸï¼Œä½†è¦*ä¿®æ”¹*å®ƒä»¬ï¼Œè¯·ä½¿ç”¨ `global` æˆ– `nonlocal`ã€‚

```{python}
a = []  # å…¨å±€å˜é‡

def func2():          # å®šä¹‰ä¸€ä¸ªå‡½æ•°
    for i in range(5): # å¾ªç¯ 5 æ¬¡
        a.append(i)  # ä¿®æ”¹å…¨å±€å˜é‡ 'a'

func2()            # è°ƒç”¨å‡½æ•°
print(a)            # è¾“å‡º: [0, 1, 2, 3, 4]

b = None # å…¨å±€å˜é‡
def bind_b_variable():  # å®šä¹‰ä¸€ä¸ªå‡½æ•°
    global b          # å£°æ˜ 'b' ä¸ºå…¨å±€å˜é‡
    b = []           # å°†ç©ºåˆ—è¡¨èµ‹å€¼ç»™å…¨å±€å˜é‡ 'b'
bind_b_variable()     # è°ƒç”¨å‡½æ•°
print(b)            # è¾“å‡º: []
```

::: {.callout-caution}
å°½é‡å‡å°‘ `global` çš„ä½¿ç”¨ã€‚æ›´å¥½çš„è®¾è®¡å¯ä»¥å‡å°‘å¯¹å…¨å±€çŠ¶æ€çš„ä¾èµ–ã€‚
:::

## è¿”å›å¤šä¸ªå€¼

```{python}
def f():             # å®šä¹‰ä¸€ä¸ªå‡½æ•°
    a = 5            # å±€éƒ¨å˜é‡
    b = 6            # å±€éƒ¨å˜é‡
    c = 7            # å±€éƒ¨å˜é‡
    return a, b, c  # è¿”å›ä¸€ä¸ªå…ƒç»„

x, y, z = f()        # è°ƒç”¨å‡½æ•°ï¼Œå¹¶å°†è¿”å›çš„å…ƒç»„è§£åŒ…åˆ°å˜é‡ x, y, z ä¸­
print(x, y, z)      # è¾“å‡º: 5 6 7

# æˆ–è€…è¿”å›ä¸€ä¸ªå­—å…¸
def f2():
  a = 5
  b = 6
  c = 7
  return {'a' : a, 'b' : b, 'c' : c} # è¿”å›å€¼æ”¹ä¸ºå­—å…¸

result = f2()
print(result) # è¾“å‡º: {'a': 5, 'b': 6, 'c': 7}
```

## å‡½æ•°æ˜¯å¯¹è±¡

å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼š

-   å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚
-   å¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚
-   å¯ä»¥ä»å…¶ä»–å‡½æ•°è¿”å›ã€‚

```{python}
import re  # å¯¼å…¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—

states = ['   Alabama ', 'Georgia!', 'Georgia', 'georgia', 'FlOrIda',
          'south   carolina##', 'West virginia?'] # åˆ—è¡¨

def clean_strings(strings):          # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ¸…ç†å­—ç¬¦ä¸²åˆ—è¡¨
    result = []                      # åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨
    for value in strings:            # éå†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²
        value = value.strip()         # å»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºæ ¼
        value = re.sub('[!#?]', '', value) # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å»é™¤æ ‡ç‚¹ç¬¦å·
        value = value.title()         # å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ ‡é¢˜æ ¼å¼
        result.append(value)          # å°†å¤„ç†åçš„å­—ç¬¦ä¸²æ·»åŠ åˆ°åˆ—è¡¨ä¸­
    return result                    # è¿”å›å¤„ç†åçš„åˆ—è¡¨

print(clean_strings(states)) #è¾“å‡º: ['Alabama', 'Georgia', 'Georgia', 'Georgia', 'Florida', 'South Carolina', 'West Virginia']

# æ›¿ä»£æ–¹æ¡ˆï¼šå‡½æ•°åˆ—è¡¨
def remove_punctuation(value):            # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå»é™¤æ ‡ç‚¹ç¬¦å·
    return re.sub('[!#?]', '', value)  # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å»é™¤æ ‡ç‚¹ç¬¦å·

clean_ops = [str.strip, remove_punctuation, str.title] # å®šä¹‰ä¸€ä¸ªå‡½æ•°åˆ—è¡¨

def clean_strings_functional(strings, ops): # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—å­—ç¬¦ä¸²åˆ—è¡¨å’Œæ“ä½œåˆ—è¡¨
    result = []                         # åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨
    for value in strings:               # éå†å­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²
        for function in ops:            # éå†æ“ä½œåˆ—è¡¨ä¸­çš„æ¯ä¸ªå‡½æ•°
            value = function(value)     # å¯¹å­—ç¬¦ä¸²åº”ç”¨å‡½æ•°
        result.append(value)           # å°†å¤„ç†åçš„å­—ç¬¦ä¸²æ·»åŠ åˆ°åˆ—è¡¨ä¸­
    return result                     # è¿”å›å¤„ç†åçš„åˆ—è¡¨

print(clean_strings_functional(states, clean_ops)) #è¾“å‡º: ['Alabama', 'Georgia', 'Georgia', 'Georgia', 'Florida', 'South Carolina', 'West Virginia']

# å°†å‡½æ•°ä¸ map ç»“åˆä½¿ç”¨ï¼š
for x in map(remove_punctuation, states): # ä½¿ç”¨ map å‡½æ•°å¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²åº”ç”¨ remove_punctuation å‡½æ•°
  print(x)
```

è¿™ç§æ–¹å¼å¾ˆçµæ´»ï¼Œè€Œä¸”å¯ä»¥é‡ç”¨ã€‚


# åŒ¿å (Lambda) å‡½æ•°

```{python}
# ä½¿ç”¨ `lambda` å®šä¹‰å°å‹åŒ¿åå‡½æ•°ï¼š

# ç­‰æ•ˆäºï¼š
# def short_function(x):
#     return x * 2

equiv_anon = lambda x: x * 2  # å®šä¹‰ä¸€ä¸ª lambda å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•° xï¼Œè¿”å› x * 2
print(equiv_anon(4))          # è¾“å‡º: 8
```

ç”¨äºä¼ é€’çŸ­å‡½æ•°å¾ˆæ–¹ä¾¿ï¼š

```{python}
def apply_to_list(some_list, f):      # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°
    return [f(x) for x in some_list] # å¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å‡½æ•° fï¼Œå¹¶è¿”å›ç»“æœåˆ—è¡¨

ints = [4, 0, 1, 5, 6]            # åˆ›å»ºä¸€ä¸ªæ•´æ•°åˆ—è¡¨
result = apply_to_list(ints, lambda x: x * 2) # å°† lambda å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’
print(result)                     # è¾“å‡º: [8, 0, 2, 10, 12]

strings = ['foo', 'card', 'bar', 'aaaa', 'abab'] # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
strings.sort(key=lambda x: len(set(x))) # ä½¿ç”¨ lambda å‡½æ•°ä½œä¸º keyï¼ŒæŒ‰ç…§å­—ç¬¦ä¸²ä¸­ä¸åŒå­—ç¬¦çš„æ•°é‡æ’åº
print(strings)                          # è¾“å‡º: ['aaaa', 'foo', 'abab', 'bar', 'card']
```

## ç”Ÿæˆå™¨

ç”Ÿæˆå™¨*æŒ‰éœ€*ç”Ÿæˆå€¼ï¼ˆèŠ‚çœå†…å­˜ï¼‰ã€‚

```{python}
def squares(n=10):                         # å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œç”Ÿæˆ 1 åˆ° n^2 çš„å¹³æ–¹æ•°
    print('Generating squares from 1 to %d' % n ** 2) # æ‰“å°ä¸€æ¡æ¶ˆæ¯
    for i in range(1, n + 1):             # å¾ªç¯ 1 åˆ° n
        yield i ** 2                      # ä½¿ç”¨ yield äº§ç”Ÿ i çš„å¹³æ–¹

gen = squares()                          # åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡
print(gen)                             # è¾“å‡º: <generator object squares at 0x...> ï¼ˆç”Ÿæˆå™¨å¯¹è±¡ï¼‰
for x in gen:                          # è¯·æ±‚å€¼
    print(x, end=' ')                   # è¾“å‡º: 1 4 9 16 25 36 49 64 81 100
```

-   ä½¿ç”¨ `yield` è€Œä¸æ˜¯ `return`ã€‚
-   ä¸ä¼šç«‹å³æ‰§è¡Œã€‚

## ç”Ÿæˆå™¨è¡¨è¾¾å¼

ç®€æ´çš„ç”Ÿæˆå™¨ï¼ˆç±»ä¼¼äºæ¨å¯¼å¼ï¼‰ï¼š

```{python}
# åˆ—è¡¨æ¨å¯¼å¼ï¼š[x ** 2 for x in range(100)]
gen = (x ** 2 for x in range(100)) # ä½¿ç”¨åœ†æ‹¬å·åˆ›å»ºç”Ÿæˆå™¨è¡¨è¾¾å¼
print(gen)                      # è¾“å‡º: <generator object <genexpr> at 0x...> ï¼ˆç”Ÿæˆå™¨å¯¹è±¡ï¼‰
print(sum(gen))                 # è¾“å‡º: 328350

# ä½œä¸ºå‡½æ•°å‚æ•°ï¼š
print(sum(x ** 2 for x in range(100)))   # å°†ç”Ÿæˆå™¨è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ sum å‡½æ•°ï¼Œè¾“å‡º: 328350
print(dict((i, i **2) for i in range(5))) # å°†ç”Ÿæˆå™¨è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ dict å‡½æ•°ï¼Œè¾“å‡º: {0: 0, 1: 1, 2: 4, 3: 9, 4: 16}
```

## itertools æ¨¡å—

`itertools` æä¾›äº†æœ‰ç”¨çš„ç”Ÿæˆå™¨ï¼š

```{python}
import itertools # å¯¼å…¥ itertools æ¨¡å—

def first_letter(x):   # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—æ¯
    return x[0]

names = ['Alan', 'Adam', 'Wes', 'Will', 'Albert', 'Steven'] # åˆ›å»ºä¸€ä¸ªåå­—åˆ—è¡¨

for letter, names_iter in itertools.groupby(names, first_letter): # ä½¿ç”¨ itertools.groupby æŒ‰é¦–å­—æ¯åˆ†ç»„
    print(letter, list(names_iter)) # è¾“å‡ºæ¯ç»„çš„é¦–å­—æ¯å’Œåå­—åˆ—è¡¨
```

`itertools.groupby` å¯¹è¿ç»­çš„å…ƒç´ è¿›è¡Œåˆ†ç»„ã€‚

## æœ‰ç”¨çš„ itertools å‡½æ•°

| å‡½æ•°                          | æè¿°                                                                                                                               |
| :-- | :--------------------------------------------------------------------------------------------------------------------------------- |
| `chain(*iterables)`               | é“¾æ¥è¿­ä»£å™¨ã€‚                                                                                                                       |
| `combinations(iterable, k)`      | ç”Ÿæˆé•¿åº¦ä¸º k çš„ç»„åˆï¼Œå¿½ç•¥é¡ºåºï¼Œä¸æ”¾å›ã€‚                                                                                                |
| `permutations(iterable, k)`      | ç”Ÿæˆé•¿åº¦ä¸º k çš„æ’åˆ—ï¼Œè€ƒè™‘é¡ºåºã€‚                                                                                                             |
| `groupby(iterable[, keyfunc])`    | ä¸ºæ¯ä¸ªå”¯ä¸€é”®ç”Ÿæˆ (key, sub-iterator)ã€‚                                                                                                 |
| `product(*iterables, repeat=1)`   | ç”Ÿæˆç¬›å¡å°”ç§¯ï¼ˆç±»ä¼¼äºåµŒå¥— for å¾ªç¯ï¼‰ã€‚                                                                                              |

::: {.callout-note}
æŸ¥çœ‹ `itertools` æ–‡æ¡£ï¼è¿™æ˜¯ä¸€ä¸ªå®åº“ï¼ğŸ’
:::

## é”™è¯¯å’Œå¼‚å¸¸å¤„ç†

å¤„ç†é”™è¯¯å¯¹äºå¥å£®çš„ä»£ç è‡³å…³é‡è¦ã€‚

## try-except å—

```{python}
def attempt_float(x):  # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°è¯•å°†è¾“å…¥è½¬æ¢ä¸ºæµ®ç‚¹æ•°
    try:               # å°è¯•æ‰§è¡Œä»¥ä¸‹ä»£ç å—
        return float(x) # å°† x è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶è¿”å›
    except:            # å¦‚æœå‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹ä»£ç å—
        return x       # è¿”å›åŸå§‹è¾“å…¥

print(attempt_float('1.2345'))    # è¾“å‡º: 1.2345
print(attempt_float('something')) # è¾“å‡º: something
```

-   `try`: å¯èƒ½å¼•å‘å¼‚å¸¸çš„ä»£ç ã€‚
-   `except`: å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œã€‚

## æ•è·ç‰¹å®šå¼‚å¸¸

```{python}
def attempt_float2(x):         # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°è¯•å°†è¾“å…¥è½¬æ¢ä¸ºæµ®ç‚¹æ•°
    try:                      # å°è¯•æ‰§è¡Œä»¥ä¸‹ä»£ç å—
        return float(x)        # å°† x è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶è¿”å›
    except ValueError:       # å¦‚æœå‘ç”Ÿ ValueError å¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹ä»£ç å—
        return x              # è¿”å›åŸå§‹è¾“å…¥

# print(attempt_float2((1, 2)))  # è¿™è¡Œä»£ç ä¼šå¼•å‘ TypeErrorï¼Œå› ä¸ºæ²¡æœ‰æ•è· TypeError å¼‚å¸¸
```

æŒ‡å®šå¼‚å¸¸ç±»å‹ï¼ˆé¦–é€‰ï¼‰ã€‚

## æ•è·å¤šä¸ªå¼‚å¸¸ç±»å‹

```{python}
def attempt_float3(x):                 # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°è¯•å°†è¾“å…¥è½¬æ¢ä¸ºæµ®ç‚¹æ•°
    try:                              # å°è¯•æ‰§è¡Œä»¥ä¸‹ä»£ç å—
        return float(x)                # å°† x è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶è¿”å›
    except (TypeError, ValueError):  # å¦‚æœå‘ç”Ÿ TypeError æˆ– ValueError å¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹ä»£ç å—
        return x                      # è¿”å›åŸå§‹è¾“å…¥
```

ä½¿ç”¨å…ƒç»„æ•è·å¤šç§ç±»å‹çš„å¼‚å¸¸ã€‚

## finally å’Œ else

-   `finally`: *å§‹ç»ˆ*æ‰§è¡Œï¼ˆæ¸…ç†ï¼‰ã€‚
-   `else`: å¦‚æœ `try` å—*æ²¡æœ‰*å¼•å‘å¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œã€‚

```{python}
f = open("tempfile.txt", mode = "w") # åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶
try:
    # write_to_file(f) # å‡è®¾ write_to_file æ˜¯ä¸€ä¸ªå¯èƒ½å‡ºé”™çš„å‡½æ•°
    f.write("example text")  # å†™å…¥
finally:
    f.close()  # æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½å…³é—­æ–‡ä»¶
    import os
    os.remove("tempfile.txt") # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
```

```{python}
f = open("tempfile.txt", mode = "w") # åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶
try:
    #write_to_file(f) # å‡è®¾ write_to_file æ˜¯ä¸€ä¸ªå¯èƒ½å‡ºé”™çš„å‡½æ•°
    f.write("example text") #å†™å…¥
except:
    print('Failed') # æ•è·å¼‚å¸¸æ—¶è¾“å‡º
else:
    print('Succeeded') # æ²¡æœ‰æ•è·åˆ°å¼‚å¸¸æ—¶è¾“å‡º
finally:
    f.close() # æ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œéƒ½å…³é—­æ–‡ä»¶
    import os
    os.remove("tempfile.txt") # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
```

## IPython ä¸­çš„å¼‚å¸¸

IPython æä¾›äº†æœ‰ç”¨çš„å›æº¯ä¿¡æ¯ã€‚ä½¿ç”¨ `%xmode` æ§åˆ¶è¯¦ç»†ç¨‹åº¦ï¼ˆPlainã€Contextã€Verboseï¼‰ã€‚

## 3.3 æ–‡ä»¶å’Œæ“ä½œç³»ç»Ÿ

## æ‰“å¼€æ–‡ä»¶ (open)

```{python}
path = 'examples/segismundo.txt' # è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼ˆè¯·ç¡®ä¿æ­¤æ–‡ä»¶å­˜åœ¨ï¼‰

# é»˜è®¤ç¼–ç å› å¹³å°è€Œå¼‚ï¼Œæœ€å¥½æ˜ç¡®æŒ‡å®šã€‚
f = open(path, encoding='utf-8')  # ä»¥è¯»å–æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼ˆ'r' æ˜¯é»˜è®¤æ¨¡å¼ï¼‰ï¼ŒæŒ‡å®šç¼–ç ä¸º utf-8
for line in f:                   # é€è¡Œè¯»å–æ–‡ä»¶
    print(line.rstrip())         # ç§»é™¤æ¯è¡Œæœ«å°¾çš„ç©ºç™½å­—ç¬¦å¹¶æ‰“å°

f.close()                        # å…³é—­æ–‡ä»¶
```

-   `open(path, mode='r', encoding=None)`
    -   `path`: æ–‡ä»¶è·¯å¾„ã€‚
    -   `mode`: 'r' (è¯»å–), 'w' (å†™å…¥), 'a' (è¿½åŠ ), 'x' (åˆ›å»º), 'rb', 'wb' ç­‰ã€‚
    -   `encoding`: æ–‡ä»¶ç¼–ç  (ä¾‹å¦‚, 'utf-8')ã€‚

-   *å…³é—­*æ–‡ä»¶ï¼š`f.close()`ã€‚

## ä»æ–‡ä»¶ä¸­è¯»å–

```{python}
# è¯»å–æ‰€æœ‰è¡Œ
f = open(path, encoding="utf-8")      # ä»¥è¯»å–æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼ŒæŒ‡å®šç¼–ç ä¸º utf-8
lines = [x.rstrip() for x in f]      # è¯»å–æ‰€æœ‰è¡Œï¼Œç§»é™¤æ¯è¡Œæœ«å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œå¹¶å­˜å‚¨åœ¨åˆ—è¡¨ä¸­
print(lines)                           # æ‰“å°æ‰€æœ‰è¡Œ
f.close()                            # å…³é—­æ–‡ä»¶
```

## ä½¿ç”¨ with è¯­å¥è‡ªåŠ¨å…³é—­æ–‡ä»¶

`with` è¯­å¥ä¼šè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼š

```{python}
with open(path, encoding="utf-8") as f: # ä½¿ç”¨ with è¯­å¥æ‰“å¼€æ–‡ä»¶ï¼ŒæŒ‡å®šç¼–ç ä¸º utf-8
    lines = [x.rstrip() for x in f]  # è¯»å–æ‰€æœ‰è¡Œï¼Œç§»é™¤æ¯è¡Œæœ«å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œå¹¶å­˜å‚¨åœ¨åˆ—è¡¨ä¸­
print(lines)                         # æ‰“å°æ‰€æœ‰è¡Œ
# 'f' åœ¨è¿™é‡Œè‡ªåŠ¨å…³é—­
```

::: {.callout-tip}
ä½¿ç”¨ `with`ï¼å³ä½¿å‡ºç°é”™è¯¯ï¼Œå®ƒä¹Ÿèƒ½ç¡®ä¿æ¸…ç†ã€‚
:::

## æ–‡ä»¶æ¨¡å¼

| æ¨¡å¼ | æè¿°                                                                           |
| :--- | :----------------------------------------------------------------------------- |
| r    | åªè¯»                                                                             |
| w    | åªå†™ï¼›åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆæ“¦é™¤ç°æœ‰æ–‡ä»¶ï¼‰                                             |
| x    | åªå†™ï¼›åˆ›å»ºæ–°æ–‡ä»¶                                           |
| a    | è¿½åŠ åˆ°ç°æœ‰æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ï¼‰                                                |
| r+   | è¯»å†™                                                                        |
| b    | äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆæ·»åŠ åˆ°æ¨¡å¼ï¼š'rb', 'wb'ï¼‰                                                |
| t    | æ–‡æœ¬æ¨¡å¼ï¼ˆè§£ç å­—èŠ‚ï¼‰ï¼›é»˜è®¤                                                    |

## read, seek å’Œ tell

```{python}
f1 = open(path, encoding = "utf-8")  # ä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼ŒæŒ‡å®šç¼–ç ä¸º utf-8
print(f1.read(10))                # è¯»å– 10 ä¸ª*å­—ç¬¦*

f2 = open(path, mode='rb')        # ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€æ–‡ä»¶
print(f2.read(10))                # è¯»å– 10 ä¸ª*å­—èŠ‚*

print(f1.tell())                  # è·å–å½“å‰ä½ç½®ï¼ˆå­—ç¬¦ï¼‰
print(f2.tell())                  # è·å–å½“å‰ä½ç½®ï¼ˆå­—èŠ‚ï¼‰

import sys
print(sys.getdefaultencoding())    # è·å–é»˜è®¤ç¼–ç 

f1.seek(3)                        # ç§»åŠ¨åˆ°ç¬¬ 3 ä¸ªå­—èŠ‚/å­—ç¬¦
print(f1.read(1))                 # è¯»å– 1 ä¸ªå­—ç¬¦

f1.close()                        # å…³é—­æ–‡ä»¶
f2.close()                        # å…³é—­æ–‡ä»¶
```

-   `read(n)`: è¯»å– `n` ä¸ªå­—ç¬¦/å­—èŠ‚ã€‚
-   `tell()`: å½“å‰ä½ç½®ã€‚
-   `seek(position)`: ç§»åŠ¨æŒ‡é’ˆã€‚
-   æ³¨æ„ `seek` å’Œ UTF-8ï¼ˆå¤šå­—èŠ‚å­—ç¬¦ï¼‰ã€‚

## å†™å…¥æ–‡ä»¶

```{python}
with open('tmp.txt', 'w', encoding = "utf-8") as handle:    # ä»¥å†™å…¥æ¨¡å¼æ‰“å¼€ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ŒæŒ‡å®šç¼–ç ä¸º utf-8
     # å°† segismundo.txt æ–‡ä»¶ä¸­é•¿åº¦å¤§äº 1 çš„è¡Œå†™å…¥ tmp.txt
    handle.writelines(x for x in open(path, encoding = "utf-8") if len(x) > 1)

with open('tmp.txt', encoding = "utf-8") as f:            # ä»¥è¯»å–æ¨¡å¼æ‰“å¼€ä¸´æ—¶æ–‡ä»¶ï¼ŒæŒ‡å®šç¼–ç ä¸º utf-8
    lines = f.readlines()                               # è¯»å–æ‰€æœ‰è¡Œ
print(lines)                                             # æ‰“å°æ‰€æœ‰è¡Œ

import os
os.remove("tmp.txt")                                       # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
```

-   `write(string)`: å†™å…¥å­—ç¬¦ä¸²ã€‚
-   `writelines(list_of_strings)`: å†™å…¥å­—ç¬¦ä¸²åˆ—è¡¨ã€‚

##é‡è¦çš„æ–‡ä»¶æ–¹æ³•/å±æ€§

| æ–¹æ³•/å±æ€§      | æè¿°                                                                  |
| :--- |:--------------------------------------------------------------------|
| `read([size])`        | è¿”å›æ•°æ®ï¼ˆå­—èŠ‚/å­—ç¬¦ä¸²ï¼‰ã€‚                                                 |
| `readable()`         | å¦‚æœå¯è¯»ï¼Œåˆ™è¿”å› `True`ã€‚                                                          |
| `readlines([size])`   | è¿”å›è¡Œçš„åˆ—è¡¨ã€‚                                                               |
| `write(string)`       | å†™å…¥å­—ç¬¦ä¸²ã€‚                                                               |
| `writable()`         | å¦‚æœå¯å†™ï¼Œåˆ™è¿”å› `True`ã€‚                                                         |
| `writelines(strings)` | å†™å…¥å­—ç¬¦ä¸²åºåˆ—ã€‚                                                 |
| `close()`             | å…³é—­æ–‡ä»¶ã€‚                                                            |
| `flush()`             | å°†ç¼“å†²åŒºåˆ·æ–°åˆ°ç£ç›˜ã€‚                                                      |
| `seek(pos)`           | ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚                                                           |
| `seekable()`          | å¦‚æœå¯å¯»å€ï¼Œåˆ™è¿”å› `True`ã€‚                                                          |
| `tell()`              | è¿”å›å½“å‰ä½ç½®ã€‚                                                            |
| `closed`              | å¦‚æœå·²å…³é—­ï¼Œåˆ™è¿”å› `True`ã€‚                                                            |
| `encoding`            | è¿”å›æ–‡ä»¶ç¼–ç  (ä¾‹å¦‚, UTF-8)ã€‚                                                      |

## å­—èŠ‚å’Œ Unicode ä¸æ–‡ä»¶

-   é»˜è®¤ï¼š*æ–‡æœ¬æ¨¡å¼*ï¼ˆå­—ç¬¦ä¸²/Unicodeï¼‰ã€‚
-   `mode='rb'`/`'wb'`: *äºŒè¿›åˆ¶æ¨¡å¼*ï¼ˆå­—èŠ‚ï¼‰ã€‚

```{python}
with open(path, encoding = "utf-8") as f: # ä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    chars = f.read(10) # è¯»å–å‰10ä¸ªå­—ç¬¦
print(len(chars)) #è¾“å‡ºå­—ç¬¦æ•°

with open(path, 'rb') as f: # ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    data = f.read(10) # è¯»å–å‰10ä¸ªå­—èŠ‚
print(data)

print(data.decode('utf-8'))  # å°†å­—èŠ‚è§£ç ä¸ºå­—ç¬¦ä¸²

# print(data[:4].decode('utf-8')) # è¿™è¡Œä»£ç å¯èƒ½ä¼šå¼•å‘ UnicodeDecodeErrorï¼ˆä¸å®Œæ•´çš„å¤šå­—èŠ‚å­—ç¬¦ï¼‰
```

-   UTF-8ï¼šå¯å˜é•¿åº¦ç¼–ç ã€‚`read(n)` ä¸ªå­—ç¬¦ â‰  `read(n)` ä¸ªå­—èŠ‚ã€‚
-   äºŒè¿›åˆ¶ï¼š`read` è¿”å›ç¡®åˆ‡çš„å­—èŠ‚ã€‚
-   è§£ç å®Œæ•´çš„å­—ç¬¦ã€‚

```{python}
sink_path = 'sink.txt' # è®¾ç½®ä¸€ä¸ªç”¨äºæ¼”ç¤ºçš„æ–‡ä»¶å
with open(path, encoding = "utf-8") as source: # ä»¥utf-8ç¼–ç è¯»å–
    with open(sink_path, 'x', encoding='iso-8859-1') as sink: # ä»¥iso-8859-1ç¼–ç å†™å…¥
        sink.write(source.read())

with open(sink_path, encoding='iso-8859-1') as f: # ä»¥iso-8859-1ç¼–ç è¯»å–
    print(f.read(10))

import os
os.remove(sink_path) # åˆ é™¤ä¸´æ—¶æ–‡ä»¶

# æ³¨æ„ï¼š
f = open(path, encoding = "utf-8") # ä»¥utf-8ç¼–ç è¯»å–
print(f.read(5))
f.seek(4)  # ç§»åŠ¨åˆ°ç¬¬4ä¸ªå­—èŠ‚ä½ç½®
# print(f.read(1)) # è¿™è¡Œä»£ç å¯èƒ½ä¼šå¼•å‘ UnicodeDecodeErrorï¼Œå› ä¸ºå¯èƒ½åœ¨å¤šå­—èŠ‚å­—ç¬¦çš„ä¸­é—´
f.close()
```

::: {.callout-caution}
åœ¨éäºŒè¿›åˆ¶æ¨¡å¼ä¸‹ä½¿ç”¨ `seek` æ—¶è¦*éå¸¸*å°å¿ƒã€‚
:::

## æ€»ç»“

æœ¬ç« æ¶µç›–äº†ï¼š

-   **æ•°æ®ç»“æ„**ï¼šå…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸ã€é›†åˆã€‚
-   **å†…ç½®å‡½æ•°**ï¼š`enumerate`ã€`sorted`ã€`zip`ã€`reversed`ã€‚
-   **æ¨å¯¼å¼**ï¼šç®€æ´çš„é›†åˆåˆ›å»ºã€‚
-   **å‡½æ•°**ï¼šå®šä¹‰ã€å‚æ•°ã€å‘½åç©ºé—´ã€è¿”å›å€¼ã€lambda å‡½æ•°ã€‚
-   **ç”Ÿæˆå™¨**ï¼šèŠ‚çœå†…å­˜çš„è¿­ä»£ã€‚
-   **`itertools`**ï¼šæœ‰ç”¨çš„è¿­ä»£å™¨å·¥å…·ã€‚
-   **é”™è¯¯å¤„ç†**ï¼š`try`ã€`except`ã€`finally`ã€`else`ã€‚
-   **æ–‡ä»¶å¤„ç†**ï¼šæ‰“å¼€ã€è¯»å–ã€å†™å…¥ã€æ¨¡å¼ã€ç¼–ç ã€‚

è¿™äº›æ˜¯ Python æ•°æ®åˆ†æçš„åŸºç¡€ï¼ğŸ§±

## æ€è€ƒå’Œè®¨è®º ğŸ¤”

1.  **å¤§å‹ CSV æ–‡ä»¶ï¼š** ä½ æœ‰ä¸€ä¸ªå¤§äº RAM çš„ CSV æ–‡ä»¶ã€‚ä½ å°†å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨å’Œæ–‡ä»¶å¤„ç†æ¥æœ‰æ•ˆåœ°å¤„ç†å®ƒï¼Ÿ
2.  **åˆ—è¡¨ä¸å…ƒç»„ï¼š** æƒè¡¡ï¼Ÿä½•æ—¶é€‰æ‹©ï¼Ÿç¤ºä¾‹ï¼Ÿ
3.  **åˆ—è¡¨æ¨å¯¼å¼ä¸ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼š** åŒºåˆ«ï¼Ÿä½•æ—¶æ›´å–œæ¬¢ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Ÿ
4.  **å¼‚å¸¸å¤„ç†ï¼š** ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿåœ¨æ•°æ®åˆ†æä¸Šä¸‹æ–‡ä¸­çš„ç¤ºä¾‹ï¼Ÿ
5.  **`with` è¯­å¥ï¼š** æ–‡ä»¶å¤„ç†çš„ä¼˜åŠ¿ï¼Ÿ
6.  **æ–‡æœ¬æ¨¡å¼ä¸äºŒè¿›åˆ¶æ¨¡å¼ï¼š** åŒºåˆ«ï¼Ÿç¼–ç çš„é‡è¦æ€§ï¼Ÿ
7. **å­—å…¸ vs é›†åˆ:** å¦‚ä½•å†³å®šä½¿ç”¨å“ªä¸ªï¼Ÿ


