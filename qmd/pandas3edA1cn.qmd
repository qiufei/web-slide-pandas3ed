å¥½çš„ï¼Œè¿™æ˜¯ç¿»è¯‘æˆä¸­æ–‡å¹¶æ·»åŠ äº†è¯¦ç»†æ³¨é‡Šçš„å¹»ç¯ç‰‡å†…å®¹ï¼š

---
title: Python æ•°æ®åˆ†æ
subtitle:  è¿›é˜¶ NumPy ğŸš€
---

<!-- å¯¼å…¥ NumPy åº“ï¼Œå¹¶è®¾ç½®éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ -->
```{python}
import numpy as np  # å¯¼å…¥ NumPy åº“ï¼Œå¹¶å°†å…¶åˆ«åè®¾ç½®ä¸º np
rng = np.random.default_rng(seed=12345)  # åˆ›å»ºä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¹¶è®¾ç½®ç§å­ä¸º 12345ï¼Œä»¥ç¡®ä¿ç»“æœå¯å¤ç°
```

## ç®€ä»‹

<!-- NumPy åŸºç¡€çŸ¥è¯†å›é¡¾åŠè¿›é˜¶å†…å®¹é¢„è§ˆ -->
æˆ‘ä»¬å·²ç»å­¦ä¹ äº† NumPy çš„åŸºç¡€çŸ¥è¯†ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ·±å…¥åœ°æ¢ç´¢ï¼ğŸ¤¿ æˆ‘ä»¬å°†å­¦ä¹ ï¼š

-   `ndarray` çš„å†…éƒ¨ç»“æ„ã€‚
-   é«˜çº§æ•°ç»„æ“ä½œæŠ€å·§ã€‚
-   ä»¥åŠä¸€äº›å¾ˆé…·çš„æŠ€å·§ï¼ğŸ˜

## ä¸»é¢˜å¤§çº²

<!-- æœ¬æ¬¡è¯¾ç¨‹å°†æ¶µç›–çš„ä¸»é¢˜åˆ—è¡¨ -->
-   `ndarray` å¯¹è±¡å†…éƒ¨ç»“æ„ ğŸ¤”
-   æ•°æ®ç±»å‹å±‚çº§ ğŸŒ³
-   æ•°ç»„æ“ä½œ ğŸ”„â•â—ğŸ”
-   å¹¿æ’­æœºåˆ¶ ğŸ“¡
-   `ufunc` é«˜çº§ç”¨æ³• ğŸš€
-   ç»“æ„åŒ–æ•°ç»„ ğŸ¢
-   æ’åº ï¸ï¸ï¸ï¸ï¸â¬†ï¸ğŸ”
-   ä½¿ç”¨ Numba ç¼–å†™å¿«é€Ÿ NumPy å‡½æ•° ğŸï¸

## `ndarray` å¯¹è±¡å†…éƒ¨ç»“æ„ ğŸ¤”

<!-- è§£é‡Š ndarray å¦‚ä½•å­˜å‚¨å’Œè§£é‡Šæ•°æ® -->
-   NumPy çš„ `ndarray` å°†ä¸€å—**åŒè´¨ç±»å‹æ•°æ®**ï¼ˆæ‰€æœ‰å…ƒç´ å…·æœ‰*ç›¸åŒ*æ•°æ®ç±»å‹ï¼‰çš„å†…å­˜å—è§£é‡Šä¸ºå¤šç»´æ•°ç»„ã€‚
-   å®ƒå¯ä»¥æ˜¯*è¿ç»­çš„*æˆ–*è·¨æ­¥çš„*ã€‚
-   **å…³é”®ç»„æˆéƒ¨åˆ†**ï¼š
    -   **æ•°æ®ç±»å‹ (`dtype`)**ï¼šæ•°æ®å¦‚ä½•è¢«è§£é‡Šï¼ˆæµ®ç‚¹æ•°ã€æ•´æ•°ã€å¸ƒå°”å€¼ç­‰ï¼‰ã€‚
    -   **è·¨æ­¥è§†å›¾**ï¼šå…è®¸åƒ `arr[::2, ::-1]` è¿™æ ·çš„æ“ä½œï¼Œè€Œ*æ— éœ€*å¤åˆ¶æ•°æ®ï¼âš¡ï¸

## `ndarray` å†…éƒ¨ç»“æ„

<!-- ndarray çš„å››ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ† -->
ä¸€ä¸ª `ndarray` åŒ…å«ï¼š

1.  **æ•°æ®æŒ‡é’ˆ**ï¼šRAM æˆ–å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­çš„ä¸€å—æ•°æ®ã€‚
2.  **æ•°æ®ç±»å‹ (`dtype`)**ï¼šæè¿°å›ºå®šå¤§å°çš„å€¼å•å…ƒæ ¼ï¼ˆä¾‹å¦‚ï¼Œfloat64ã€int32ï¼‰ã€‚
3.  **å½¢çŠ¶å…ƒç»„**ï¼šæ•°ç»„ç»´åº¦ï¼ˆä¾‹å¦‚ï¼Œ`(10, 5)` è¡¨ç¤º 10x5 çš„æ•°ç»„ï¼‰ã€‚
4.  **è·¨åº¦å…ƒç»„**ï¼šæ²¿ç»´åº¦å‰è¿›ä¸€ä¸ªå…ƒç´ æ‰€éœ€çš„â€œæ­¥é•¿â€å­—èŠ‚æ•°ã€‚

## `ndarray` å¯è§†åŒ– ğŸ–¼ï¸

<!-- ndarray ç»„æˆéƒ¨åˆ†çš„å¯è§†åŒ–è¡¨ç¤º -->
-   **æ•°æ®**ï¼šå®é™…çš„æ•°ç»„æ•°æ®ã€‚
-   **dtype**ï¼šæ•°æ®ç±»å‹ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œ`float64`ï¼‰ã€‚
-   **å½¢çŠ¶**ï¼šæ•°ç»„ç»´åº¦ï¼ˆä¾‹å¦‚ï¼Œ`(3, 4, 5)`ï¼‰ã€‚
-   **è·¨åº¦**ï¼šè·³è½¬åˆ°æ¯ä¸ªç»´åº¦ä¸­ä¸‹ä¸€ä¸ªå…ƒç´ æ‰€éœ€çš„å­—èŠ‚æ•°ã€‚

## å½¢çŠ¶å’Œè·¨åº¦ç¤ºä¾‹

<!-- é€šè¿‡å…·ä½“ç¤ºä¾‹è¯´æ˜å½¢çŠ¶å’Œè·¨åº¦çš„æ¦‚å¿µ -->
-   ä¸€ä¸ª 10 x 5 çš„æ•°ç»„å…·æœ‰å½¢çŠ¶ `(10, 5)`ï¼š

```{python}
arr_2d = np.ones((10, 5))  # åˆ›å»ºä¸€ä¸ª 10x5 çš„å…¨ 1 æ•°ç»„
arr_2d.shape  # æŸ¥çœ‹æ•°ç»„çš„å½¢çŠ¶
```

-   ä¸€ä¸ª 3 x 4 x 5 çš„ `float64`ï¼ˆ8 å­—èŠ‚ï¼‰æ•°ç»„é€šå¸¸å…·æœ‰è·¨åº¦ `(160, 40, 8)`ï¼ˆC é¡ºåºï¼‰ï¼š

```{python}
arr_3d = np.ones((3, 4, 5), dtype=np.float64)  # åˆ›å»ºä¸€ä¸ª 3x4x5 çš„ float64 ç±»å‹å…¨ 1 æ•°ç»„
arr_3d.strides  # æŸ¥çœ‹æ•°ç»„çš„è·¨åº¦
```

## ç†è§£è·¨åº¦ ğŸš¶

<!-- è¯¦ç»†è§£é‡Šè·¨åº¦çš„å«ä¹‰å’Œä½œç”¨ -->
-   **è·¨åº¦**ï¼šåœ¨å†…å­˜ä¸­ç§»åŠ¨ä»¥åˆ°è¾¾æ²¿æ¯ä¸ªç»´åº¦çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ‰€éœ€çš„å­—èŠ‚æ•°ã€‚
-   **ç¤ºä¾‹**ï¼š`arr_3d.strides = (160, 40, 8)`
    -   *ç¬¬ä¸€ç»´åº¦ï¼ˆè¡Œï¼‰*ï¼šç§»åŠ¨ 160 å­—èŠ‚ã€‚
    -   *ç¬¬äºŒç»´åº¦ï¼ˆåˆ—ï¼‰*ï¼šç§»åŠ¨ 40 å­—èŠ‚ã€‚
    -   *ç¬¬ä¸‰ç»´åº¦*ï¼šç§»åŠ¨ 8 å­—èŠ‚ï¼ˆ`float64` å¤§å°ï¼‰ã€‚
-   è½´ä¸Šè¾ƒå¤§çš„è·¨åº¦é€šå¸¸æ„å‘³ç€æ²¿è¯¥è½´çš„è®¡ç®—*æˆæœ¬æ›´é«˜*ã€‚
-   è·¨åº¦*å¯ä»¥*æ˜¯è´Ÿæ•°ï¼

## NumPy æ•°æ®ç±»å‹å±‚çº§ ğŸŒ³

<!-- ä»‹ç» NumPy ä¸­ä¸°å¯Œçš„æ•°æ®ç±»å‹å±‚çº§ -->
-   NumPy å…·æœ‰ä¸°å¯Œçš„æ•°æ®ç±»å‹å±‚çº§ã€‚
-   ä½¿ç”¨**è¶…ç±»**ï¼ˆä¾‹å¦‚ï¼Œ`np.integer`ã€`np.floating`ï¼‰å’Œ `np.issubdtype` æ¥æ£€æŸ¥æ•°ç»„ç±»å‹ï¼š

```{python}
ints = np.ones(10, dtype=np.uint16)  # åˆ›å»ºä¸€ä¸ª uint16 ç±»å‹çš„å…¨ 1 æ•°ç»„
floats = np.ones(10, dtype=np.float32)  # åˆ›å»ºä¸€ä¸ª float32 ç±»å‹çš„å…¨ 1 æ•°ç»„
print(np.issubdtype(ints.dtype, np.integer))  # æ£€æŸ¥ ints.dtype æ˜¯å¦æ˜¯ np.integer çš„å­ç±»å‹
print(np.issubdtype(floats.dtype, np.floating))  # æ£€æŸ¥ floats.dtype æ˜¯å¦æ˜¯ np.floating çš„å­ç±»å‹
```

## æ•°æ®ç±»å‹å±‚çº§ï¼ˆç»­ï¼‰

<!-- ä½¿ç”¨ .mro() æ–¹æ³•æŸ¥çœ‹çˆ¶ç±» -->
-   ä½¿ç”¨ `.mro()`ï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰æŸ¥çœ‹çˆ¶ç±»ï¼š

```{python}
np.float64.mro()  # æŸ¥çœ‹ np.float64 çš„æ–¹æ³•è§£æé¡ºåºï¼ˆç»§æ‰¿å…³ç³»ï¼‰
```

-   è¿™è¡¨æ˜ `np.float64` ç»§æ‰¿è‡ª `np.floating`ã€`np.inexact`ã€...ã€`object`ã€‚

## NumPy æ•°æ®ç±»å‹å±‚çº§å¯è§†åŒ– ğŸ“Š
<!-- æ•°æ®ç±»å‹å±‚çº§çš„å¯è§†åŒ–æè¿° -->
-  `generic` æ˜¯æ ¹
-   `number`, `bool_` ç­‰, æ˜¯ `generic` çš„å­ç±»

## é«˜çº§æ•°ç»„æ“ä½œï¼šé‡å¡‘ ğŸ”„

<!-- ä»‹ç» reshape() æ–¹æ³•åŠå…¶ä½œç”¨ -->
-   **é‡å¡‘**ï¼šæ”¹å˜æ•°ç»„çš„å½¢çŠ¶ï¼Œ*ä¸å¤åˆ¶æ•°æ®*ã€‚
-   ä½¿ç”¨ `reshape()` æ–¹æ³•å’Œä¸€ä¸ªå½¢çŠ¶å…ƒç»„ï¼š

```{python}
arr = np.arange(8)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 7 çš„ä¸€ç»´æ•°ç»„
arr.reshape((4, 2))  # å°†æ•°ç»„é‡å¡‘ä¸º 4x2 çš„äºŒç»´æ•°ç»„
```

## é‡å¡‘å¤šç»´æ•°ç»„

<!-- å¤šç»´æ•°ç»„çš„é‡å¡‘ç¤ºä¾‹ -->
```{python}
arr.reshape((4, 2)).reshape((2, 4))  # å°†æ•°ç»„å…ˆé‡å¡‘ä¸º 4x2ï¼Œå†é‡å¡‘ä¸º 2x4
```

-   å¯¹ä¸€ä¸ªç»´åº¦ä½¿ç”¨ `-1` æ¥æ¨æ–­å¤§å°ï¼š

```{python}
arr = np.arange(15)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 14 çš„ä¸€ç»´æ•°ç»„
arr.reshape((5, -1))  # å°†æ•°ç»„é‡å¡‘ä¸º 5 è¡Œï¼Œåˆ—æ•°è‡ªåŠ¨æ¨æ–­ï¼ˆè¿™é‡Œæ˜¯ 3ï¼‰
```

## ä½¿ç”¨å½¢çŠ¶å±æ€§é‡å¡‘

<!-- ä½¿ç”¨å…¶ä»–æ•°ç»„çš„å½¢çŠ¶è¿›è¡Œé‡å¡‘ -->
```{python}
other_arr = np.ones((3, 5))  # åˆ›å»ºä¸€ä¸ª 3x5 çš„å…¨ 1 æ•°ç»„
arr.reshape(other_arr.shape)  # ä½¿ç”¨ other_arr çš„å½¢çŠ¶é‡å¡‘ arr
```

## æ‰å¹³åŒ–æˆ–å±•å¼€ â¡ï¸

<!-- ä»‹ç» ravel() å’Œ flatten() æ–¹æ³• -->
-   **æ‰å¹³åŒ–/å±•å¼€**ï¼šå°†å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„ã€‚
-   `ravel()`ï¼šå¦‚æœå€¼æ˜¯è¿ç»­çš„ï¼Œåˆ™*ä¸*å¤åˆ¶ã€‚

```{python}
arr = np.arange(15).reshape((5, 3))  # åˆ›å»ºä¸€ä¸ª 5x3 çš„æ•°ç»„
arr.ravel()  # å°†æ•°ç»„å±•å¼€ä¸ºä¸€ç»´æ•°ç»„
```

-   `flatten()`ï¼šå§‹ç»ˆè¿”å›*å‰¯æœ¬*ã€‚

```{python}
arr.flatten()  # å°†æ•°ç»„å±•å¼€ä¸ºä¸€ç»´æ•°ç»„ï¼ˆè¿”å›å‰¯æœ¬ï¼‰
```

## C vs. FORTRAN é¡ºåº ğŸ”€

<!-- è§£é‡Š C é¡ºåºå’Œ FORTRAN é¡ºåº -->
-   **è¡Œä¸»åºï¼ˆCï¼‰**ï¼šè¿ç»­çš„è¡Œå…ƒç´ å­˜å‚¨åœ¨ä¸€èµ·ã€‚
-   **åˆ—ä¸»åºï¼ˆFORTRANï¼‰**ï¼šè¿ç»­çš„åˆ—å…ƒç´ å­˜å‚¨åœ¨ä¸€èµ·ã€‚
-   `reshape` å’Œ `ravel` æ¥å—ä¸€ä¸ª `order` å‚æ•°ï¼ˆ`'C'` æˆ– `'F'`ï¼‰ã€‚

```{python}
arr = np.arange(12).reshape((3, 4))  # åˆ›å»ºä¸€ä¸ª 3x4 çš„æ•°ç»„
print(arr.ravel())      # é»˜è®¤ï¼š'C' é¡ºåº
print(arr.ravel('F'))  # FORTRAN é¡ºåº
```

## C vs. FORTRAN é¡ºåºï¼ˆå¯è§†åŒ–ï¼‰

<!-- C é¡ºåºå’Œ FORTRAN é¡ºåºçš„å¯è§†åŒ–è§£é‡Š -->
-   **C/è¡Œä¸»åº**ï¼š*é¦–å…ˆ*éå†æ›´é«˜çš„ç»´åº¦ã€‚
-   **FORTRAN/åˆ—ä¸»åº**ï¼š*æœ€å*éå†æ›´é«˜çš„ç»´åº¦ã€‚

## è¿æ¥æ•°ç»„ â•

<!-- ä»‹ç» concatenate() å‡½æ•° -->
-   **`numpy.concatenate`**ï¼šæ²¿ç°æœ‰è½´è¿æ¥æ•°ç»„ã€‚

```{python}
arr1 = np.array([[1, 2, 3], [4, 5, 6]])  # åˆ›å»ºä¸€ä¸ª 2x3 çš„æ•°ç»„
arr2 = np.array([[7, 8, 9], [10, 11, 12]])  # åˆ›å»ºä¸€ä¸ª 2x3 çš„æ•°ç»„
print(np.concatenate([arr1, arr2], axis=0))  # æ²¿è¡Œï¼ˆaxis=0ï¼‰å †å ï¼ˆå‚ç›´å †å ï¼‰
print(np.concatenate([arr1, arr2], axis=1))  # æ²¿åˆ—ï¼ˆaxis=1ï¼‰å †å ï¼ˆæ°´å¹³å †å ï¼‰
```

## è¿æ¥è¾…åŠ©å‡½æ•°

<!-- ä»‹ç» vstackã€hstackã€column_stack å’Œ dstack -->
-   `vstack`, `row_stack`ï¼šæŒ‰è¡Œå †å ï¼ˆaxis 0ï¼‰ã€‚
-   `hstack`ï¼šæŒ‰åˆ—å †å ï¼ˆaxis 1ï¼‰ã€‚
-   `column_stack`ï¼šç±»ä¼¼äº `hstack`ï¼Œä½†é¦–å…ˆå°†ä¸€ç»´æ•°ç»„è½¬æ¢ä¸ºäºŒç»´åˆ—ã€‚
-   `dstack`ï¼šæŒ‰â€œæ·±åº¦â€å †å ï¼ˆaxis 2ï¼‰ã€‚

```{python}
print(np.vstack((arr1, arr2)))  # å‚ç›´å †å 
print(np.hstack((arr1, arr2)))  # æ°´å¹³å †å 
```

## æ‹†åˆ†æ•°ç»„ â—

<!-- ä»‹ç» split() å‡½æ•° -->
-   `split`ï¼šå°†æ•°ç»„æ²¿è½´æ‹†åˆ†ä¸ºå¤šä¸ªæ•°ç»„ã€‚

```{python}
arr = rng.standard_normal((5, 2))  # åˆ›å»ºä¸€ä¸ª 5x2 çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒæ•°ç»„
first, second, third = np.split(arr, [1, 3])  # å°†æ•°ç»„åœ¨ç´¢å¼• 1 å’Œ 3 å¤„æ‹†åˆ†
print(f"{first=}")  # æ‰“å°ç¬¬ä¸€ä¸ªæ‹†åˆ†ç»“æœ
print(f"{second=}")  # æ‰“å°ç¬¬äºŒä¸ªæ‹†åˆ†ç»“æœ
print(f"{third=}")  # æ‰“å°ç¬¬ä¸‰ä¸ªæ‹†åˆ†ç»“æœ
```
-   `hsplit`/`vsplit`ï¼šåˆ†åˆ«åœ¨è½´ 0 å’Œ 1 ä¸Šæ‹†åˆ†ã€‚

## æ•°ç»„è¿æ¥å‡½æ•°è¡¨

<!-- æ€»ç»“å„ç§æ•°ç»„è¿æ¥å‡½æ•°çš„è¡¨æ ¼ -->
| å‡½æ•°             | æè¿°                                                      |
| -------------------- | ---------------------------------------------------------------- |
| `concatenate`        | é€šç”¨å‡½æ•°ï¼Œæ²¿è½´è¿æ¥æ•°ç»„ã€‚                    |
| `vstack`, `row_stack` | æŒ‰è¡Œå †å æ•°ç»„ï¼ˆaxis 0ï¼‰ã€‚                                   |
| `hstack`             | æŒ‰åˆ—å †å æ•°ç»„ï¼ˆaxis 1ï¼‰ã€‚                                |
| `column_stack`       | ç±»ä¼¼äº `hstack`ï¼Œä½†å°†ä¸€ç»´æ•°ç»„è½¬æ¢ä¸ºäºŒç»´åˆ—ã€‚            |
| `dstack`             | æŒ‰â€œæ·±åº¦â€å †å æ•°ç»„ï¼ˆaxis 2ï¼‰ã€‚                                |
| `split`              | åœ¨æ²¿è½´çš„ä½ç½®æ‹†åˆ†æ•°ç»„ã€‚                           |
| `hsplit`/`vsplit`   | åˆ†åˆ«åœ¨è½´ 0 å’Œ 1 ä¸Šæ‹†åˆ†ã€‚                            |

## å †å è¾…åŠ©å¯¹è±¡ï¼š`r_` å’Œ `c_`

<!-- ä»‹ç» r_ å’Œ c_ å¯¹è±¡ -->
-   `r_` å’Œ `c_` ä½¿å †å æ›´ç®€æ´ï¼š

```{python}
arr = np.arange(6)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 5 çš„ä¸€ç»´æ•°ç»„
arr1 = arr.reshape((3, 2))  # å°†æ•°ç»„é‡å¡‘ä¸º 3x2
arr2 = rng.standard_normal((3, 2))  # åˆ›å»ºä¸€ä¸ª 3x2 çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒæ•°ç»„
print(np.r_[arr1, arr2])  # ç±»ä¼¼äº row_stack
print(np.c_[np.r_[arr1, arr2], arr])  # å°† arr ä½œä¸ºæ–°åˆ—è¿æ¥
```

## é‡å¤å…ƒç´ ï¼š`tile` å’Œ `repeat` ğŸ”

<!-- ä»‹ç» tile() å’Œ repeat() æ–¹æ³• -->
-   `repeat`ï¼šå¤åˆ¶æ¯ä¸ªå…ƒç´ ï¼š

```{python}
arr = np.arange(3)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 2 çš„ä¸€ç»´æ•°ç»„
print(arr.repeat(3))  # æ¯ä¸ªå…ƒç´ é‡å¤ 3 æ¬¡
print(arr.repeat([2, 3, 4]))  # æ¯ä¸ªå…ƒç´ åˆ†åˆ«é‡å¤ 2ã€3ã€4 æ¬¡
```

-   äºŒç»´æ•°ç»„ç¤ºä¾‹ï¼š

```{python}
arr = rng.standard_normal((2, 2))  # åˆ›å»ºä¸€ä¸ª 2x2 çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒæ•°ç»„
arr.repeat(2, axis=0) # æ²¿ç€è¡Œé‡å¤
```

## `tile`ï¼šå †å å‰¯æœ¬

<!-- ä»‹ç» tile() å‡½æ•° -->
- `tile`ï¼šæ²¿è½´å †å æ•°ç»„çš„å‰¯æœ¬ï¼š

```{python}
arr = rng.standard_normal((2, 2))  # åˆ›å»ºä¸€ä¸ª 2x2 çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒæ•°ç»„
print(np.tile(arr, 2))  # æ²¿è¡Œé‡å¤æ•°ç»„ä¸¤æ¬¡
print(np.tile(arr, (2, 1)))  # æ²¿è¡Œé‡å¤ 2 æ¬¡ï¼Œæ²¿åˆ—é‡å¤ 1 æ¬¡
print(np.tile(arr, (3, 2)))  # æ²¿è¡Œé‡å¤ 3 æ¬¡ï¼Œæ²¿åˆ—é‡å¤ 2 æ¬¡
```

## ä½¿ç”¨ `take` å’Œ `put` è¿›è¡ŒèŠ±å¼ç´¢å¼•

<!-- ä»‹ç» take() å’Œ put() æ–¹æ³• -->
-   `take`ï¼šé€šè¿‡æ•´æ•°ç´¢å¼•é€‰æ‹©å…ƒç´ ï¼š

```{python}
arr = np.arange(10) * 100  # åˆ›å»ºä¸€ä¸ª [0, 100, 200, ..., 900] çš„æ•°ç»„
inds = [7, 1, 2, 6]  # å®šä¹‰ç´¢å¼•åˆ—è¡¨
arr.take(inds)  # ç±»ä¼¼äº arr[inds]
```

-   `put`ï¼šå°†å€¼åˆ†é…ç»™ç´¢å¼•ï¼ˆåŸåœ°ï¼‰ã€‚*ä¸*æ¥å—è½´å‚æ•°ï¼š

```{python}
arr.put(inds, 42)  # å°†ç´¢å¼•ä½ç½®çš„å€¼è®¾ç½®ä¸º 42
print(arr)  # æ‰“å°ä¿®æ”¹åçš„æ•°ç»„
arr.put(inds, [40, 41, 42, 43])  # å°†ç´¢å¼•ä½ç½®çš„å€¼åˆ†åˆ«è®¾ç½®ä¸º 40ã€41ã€42ã€43
print(arr)  # æ‰“å°ä¿®æ”¹åçš„æ•°ç»„
```

## å¹¿æ’­æœºåˆ¶ ğŸ“¡

<!-- ä»‹ç»å¹¿æ’­æœºåˆ¶çš„æ¦‚å¿µ -->
-   **å¹¿æ’­æœºåˆ¶**ï¼š*ä¸åŒ*å½¢çŠ¶çš„æ•°ç»„ä¹‹é—´å¦‚ä½•è¿›è¡Œè¿ç®—ã€‚
-   æœ€ç®€å•çš„æƒ…å†µï¼šæ ‡é‡å’Œæ•°ç»„ï¼š

```{python}
arr = np.arange(5)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 4 çš„ä¸€ç»´æ•°ç»„
arr * 4  # 4 è¢«â€œå¹¿æ’­â€åˆ°æ‰€æœ‰å…ƒç´ 
```
- å‡å€¼æ¶ˆå‡ï¼š
```{python}
arr = rng.standard_normal((4, 3))   # åˆ›å»ºä¸€ä¸ª4x3çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ•°ç»„
demeaned = arr - arr.mean(0)  #  arr.mean(0)æ˜¯è®¡ç®—æ¯åˆ—çš„å‡å€¼
demeaned
```

## å¹¿æ’­è§„åˆ™ ğŸ“

<!-- è¯¦ç»†è§£é‡Šå¹¿æ’­è§„åˆ™ -->
-   å¦‚æœå¯¹äºæ¯ä¸ª*å°¾éšç»´åº¦*ï¼š
    1.  è½´é•¿åº¦åŒ¹é…ï¼Œ**æˆ–è€…**
    2.  å…¶ä¸­ä¸€ä¸ªé•¿åº¦ä¸º 1ã€‚
-   åˆ™æ•°ç»„æ˜¯å…¼å®¹çš„ã€‚
-   å¹¿æ’­å‘ç”Ÿåœ¨ç¼ºå¤±æˆ–é•¿åº¦ä¸º 1 çš„ç»´åº¦ä¸Šã€‚

## å¹¿æ’­è§„åˆ™ï¼ˆå¯è§†åŒ–ï¼‰

<!-- å¹¿æ’­è§„åˆ™çš„å¯è§†åŒ–è§£é‡Š -->
- è¿™æ˜¯ä¸€ä¸ªå°†å½¢çŠ¶ä¸º (3,) çš„ä¸€ç»´æ•°ç»„æ²¿ç€ 0 è½´å¹¿æ’­åˆ°å½¢çŠ¶ä¸º (4, 3) çš„äºŒç»´æ•°ç»„çš„ä¾‹å­

## å¹¿æ’­ç¤ºä¾‹ï¼šå‡å»è¡Œå‡å€¼

<!-- é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºå¹¿æ’­çš„åº”ç”¨ -->
```{python}
arr = rng.standard_normal((4, 3))  # åˆ›å»ºä¸€ä¸ª 4x3 çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒæ•°ç»„
row_means = arr.mean(1)  # è®¡ç®—æ¯è¡Œçš„å‡å€¼
print(row_means.shape)  # æ‰“å°è¡Œå‡å€¼çš„å½¢çŠ¶

# å°† row_means é‡å¡‘ä¸º (4, 1) ä»¥è¿›è¡Œå¹¿æ’­
demeaned = arr - row_means.reshape((4, 1))  # å‡å»è¡Œå‡å€¼
print(demeaned.mean(1))  # éªŒè¯æ¯è¡Œçš„å‡å€¼ç°åœ¨ä¸º 0ï¼ˆæˆ–æ¥è¿‘ 0ï¼‰
```

## åœ¨å…¶ä»–è½´ä¸Šå¹¿æ’­

<!-- ä»‹ç»å¦‚ä½•é€šè¿‡æ·»åŠ æ–°è½´åœ¨å…¶ä»–è½´ä¸Šè¿›è¡Œå¹¿æ’­ -->
-   é‡å¡‘ä»¥åœ¨è½´ 0 ä»¥å¤–çš„è½´ä¸Šè¿›è¡Œå¹¿æ’­ã€‚
-   ä½¿ç”¨ `np.newaxis` å’Œåˆ‡ç‰‡æ·»åŠ ä¸€ä¸ªé•¿åº¦ä¸º 1 çš„æ–°è½´ï¼š

```{python}
arr = np.zeros((4, 4))  # åˆ›å»ºä¸€ä¸ª 4x4 çš„å…¨ 0 æ•°ç»„
arr_3d = arr[:, np.newaxis, :]  # åœ¨ä¸­é—´æ·»åŠ ä¸€ä¸ªæ–°è½´
print(arr_3d.shape)  # æ‰“å°æ–°æ•°ç»„çš„å½¢çŠ¶

arr_1d = rng.standard_normal(3)  # åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 3 çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒæ•°ç»„
print(arr_1d[:, np.newaxis])  # è½¬æ¢ä¸ºåˆ—å‘é‡
print(arr_1d[np.newaxis, :])  # è½¬æ¢ä¸ºè¡Œå‘é‡
```

## é€šè¿‡å¹¿æ’­è®¾ç½®å€¼

<!-- æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å¹¿æ’­è®¾ç½®æ•°ç»„çš„å€¼ -->
-   å¹¿æ’­é€‚ç”¨äºè®¾ç½®å€¼ï¼š

```{python}
arr = np.zeros((4, 3))  # åˆ›å»ºä¸€ä¸ª 4x3 çš„å…¨ 0 æ•°ç»„
arr[:] = 5  # å°†æ‰€æœ‰å…ƒç´ è®¾ç½®ä¸º 5
print(arr)  # æ‰“å°ä¿®æ”¹åçš„æ•°ç»„

col = np.array([1.28, -0.42, 0.44, 1.6])  # åˆ›å»ºä¸€ä¸ªåŒ…å« 4 ä¸ªå…ƒç´ çš„ä¸€ç»´æ•°ç»„
arr[:] = col[:, np.newaxis]  # å°† col å¹¿æ’­åˆ° arr çš„æ¯ä¸€è¡Œ
print(arr)  # æ‰“å°ä¿®æ”¹åçš„æ•°ç»„
```

## `ufunc` é«˜çº§ç”¨æ³• ğŸš€

<!-- ä»‹ç» ufunc åŠå…¶æ–¹æ³• -->
-   **é€šç”¨å‡½æ•° (ufunc)** å…·æœ‰ç”¨äºå‘é‡åŒ–æ“ä½œçš„æ–¹æ³•ã€‚
-   `reduce`ï¼šé€šè¿‡äºŒå…ƒè¿ç®—è¿›è¡Œèšåˆï¼š

```{python}
arr = np.arange(10)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 9 çš„ä¸€ç»´æ•°ç»„
np.add.reduce(arr)  # ç±»ä¼¼äº arr.sum()ï¼Œå¯¹æ•°ç»„å…ƒç´ æ±‚å’Œ
```

## `ufunc` æ–¹æ³•ï¼š`accumulate` å’Œ `outer`

<!-- ä»‹ç» accumulate() å’Œ outer() æ–¹æ³• -->
-   `accumulate`ï¼šä¸­é—´â€œç´¯ç§¯â€å€¼ï¼š

```{python}
arr = np.arange(15).reshape((3, 5))  # åˆ›å»ºä¸€ä¸ª 3x5 çš„æ•°ç»„
np.add.accumulate(arr, axis=1)  # æ²¿è¡Œè®¡ç®—ç´¯ç§¯å’Œ
```

-   `outer`ï¼šæˆå¯¹çš„å‰ç§¯ï¼š

```{python}
arr = np.arange(3).repeat([1, 2, 2])  # åˆ›å»ºä¸€ä¸ª [0, 1, 1, 2, 2] çš„æ•°ç»„
np.multiply.outer(arr, np.arange(5))  # è®¡ç®— arr å’Œ [0, 1, 2, 3, 4] çš„å¤–ç§¯
```

## `ufunc` æ–¹æ³•ï¼š`reduceat`

<!-- ä»‹ç» reduceat() æ–¹æ³• -->
-   `reduceat`ï¼šâ€œå±€éƒ¨â€å½’çº¦ï¼ˆæ•°ç»„åˆ†ç»„ï¼‰ï¼š

```{python}
arr = np.arange(10)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 0 åˆ° 9 çš„ä¸€ç»´æ•°ç»„
np.add.reduceat(arr, [0, 5, 8])  # å½’çº¦ [0:5]ã€[5:8]ã€[8:]
```

```{python}
arr = np.multiply.outer(np.arange(4), np.arange(5))  # è®¡ç®—å¤–ç§¯
np.add.reduceat(arr, [0, 2, 4], axis=1) # æ²¿åˆ—å½’çº¦
```

## `ufunc` æ–¹æ³•è¡¨

<!-- æ€»ç»“å„ç§ ufunc æ–¹æ³•çš„è¡¨æ ¼ -->
| æ–¹æ³•             | æè¿°                                                                         |
| ------------------ | ----------------------------------------------------------------------------------- |
| `accumulate(x)`    | èšåˆï¼Œä¿ç•™éƒ¨åˆ†èšåˆã€‚                                            |
| `at(x, i, b=None)` | åœ¨ç´¢å¼• `i` å¤„å¯¹ `x` è¿›è¡ŒåŸåœ°æ“ä½œã€‚                                            |
| `reduce(x)`        | é€šè¿‡è¿ç»­æ“ä½œè¿›è¡Œèšåˆã€‚                                                   |
| `reduceat(x, bins)` | â€œå±€éƒ¨â€å½’çº¦/åˆ†ç»„ï¼›å½’çº¦åˆ‡ç‰‡ä»¥ç”Ÿæˆèšåˆæ•°ç»„ã€‚                   |
| `outer(x, y)`      | å°†æ“ä½œåº”ç”¨äºæ‰€æœ‰å¯¹ï¼›ç»“æœå…·æœ‰å½¢çŠ¶ `x.shape + y.shape`ã€‚                  |

## Numbaï¼šå¿«é€Ÿ NumPy å‡½æ•° ğŸï¸

<!-- ä»‹ç» Numba åŠå…¶ä½œç”¨ -->
-   **Numba**ï¼šä¸ºç±» NumPy æ•°æ®ï¼ˆCPUã€GPU ç­‰ï¼‰åˆ›å»ºå¿«é€Ÿå‡½æ•°ã€‚
-   ä½¿ç”¨ **LLVM** å°† Python è½¬æ¢ä¸ºæœºå™¨ç ã€‚
-   ç¤ºä¾‹ï¼šçº¯ Python å‡½æ•°ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy åº“

def mean_distance(x, y):  # å®šä¹‰ä¸€ä¸ªè®¡ç®—å¹³å‡è·ç¦»çš„å‡½æ•°
    nx = len(x)  # è·å– x çš„é•¿åº¦
    result = 0.0  # åˆå§‹åŒ–ç»“æœ
    count = 0  # åˆå§‹åŒ–è®¡æ•°å™¨
    for i in range(nx):  # éå† x
        result += x[i] - y[i]  # ç´¯åŠ å·®å€¼
        count += 1  # è®¡æ•°å™¨åŠ  1
    return result / count  # è¿”å›å¹³å‡å€¼
```

## Numba ç¼–è¯‘

<!-- ä½¿ç”¨ Numba ç¼–è¯‘ Python å‡½æ•° -->
-   è¿™å¾ˆ*æ…¢*ã€‚ä½¿ç”¨ `numba.jit` ç¼–è¯‘ï¼š

```{python}
import numba as nb  # å¯¼å…¥ Numba åº“

numba_mean_distance = nb.jit(mean_distance)  # ä½¿ç”¨ jit è£…é¥°å™¨ç¼–è¯‘ mean_distance å‡½æ•°

# æˆ–è€…ï¼Œä½¿ç”¨è£…é¥°å™¨ï¼š
@nb.jit  # ä½¿ç”¨ jit è£…é¥°å™¨
def numba_mean_distance(x, y):  # å®šä¹‰ä¸€ä¸ªè®¡ç®—å¹³å‡è·ç¦»çš„å‡½æ•°
    nx = len(x)  # è·å– x çš„é•¿åº¦
    result = 0.0  # åˆå§‹åŒ–ç»“æœ
    count = 0  # åˆå§‹åŒ–è®¡æ•°å™¨
    for i in range(nx):  # éå† x
        result += x[i] - y[i]  # ç´¯åŠ å·®å€¼
        count += 1  # è®¡æ•°å™¨åŠ  1
    return result / count  # è¿”å›å¹³å‡å€¼
```

-   `numba_mean_distance` é€Ÿåº¦*å¿«å¾—å¤š*ï¼ˆç”šè‡³å¯èƒ½æ¯” NumPy çš„ç‰ˆæœ¬è¿˜è¦å¿«ï¼ï¼‰ã€‚

## ä½¿ç”¨ Numba åˆ›å»ºè‡ªå®šä¹‰ `ufunc`

<!-- ä½¿ç”¨ Numba åˆ›å»ºè‡ªå®šä¹‰ ufunc -->
-   `numba.vectorize` åˆ›å»ºç¼–è¯‘çš„ NumPy `ufunc`ï¼š
```{python}
from numba import vectorize  # ä» Numba å¯¼å…¥ vectorize è£…é¥°å™¨

@vectorize  # ä½¿ç”¨ vectorize è£…é¥°å™¨
def nb_add(x, y):  # å®šä¹‰ä¸€ä¸ªåŠ æ³•å‡½æ•°
    return x + y  # è¿”å› x + y
```

-   ç°åœ¨ï¼Œ`nb_add` å……å½“ `ufunc`ã€‚

## ç»“æ„åŒ–æ•°ç»„ ğŸ¢

<!-- ä»‹ç»ç»“æ„åŒ–æ•°ç»„çš„æ¦‚å¿µ -->
-   `ndarray` é€šå¸¸æ˜¯åŒè´¨çš„ã€‚
-   **ç»“æ„åŒ–æ•°ç»„**ï¼šæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªâ€œç»“æ„â€ï¼ˆç±»ä¼¼äº C ä¸­çš„ç»“æ„ï¼‰æˆ– SQL è¡¨è¡Œã€‚

```{python}
dtype = [('x', np.float64), ('y', np.int32)]  # å­—æ®µåç§°å’Œç±»å‹
sarr = np.array([(1.5, 6), (np.pi, -2)], dtype=dtype)  # åˆ›å»ºç»“æ„åŒ–æ•°ç»„
print(sarr)  # æ‰“å°æ•°ç»„
print(sarr[0])  # æ‰“å°ç¬¬ä¸€ä¸ªå…ƒç´ 
print(sarr[0]['y'])  # è®¿é—®ç¬¬ä¸€ä¸ªå…ƒç´ çš„ 'y' å­—æ®µ
```

## åµŒå¥—æ•°æ®ç±»å‹å’Œå¤šç»´å­—æ®µ

<!-- ä»‹ç»åµŒå¥—æ•°æ®ç±»å‹å’Œå¤šç»´å­—æ®µ -->
```{python}
dtype = [('x', np.int64, 3), ('y', np.int32)]  # 'x' æ˜¯ä¸€ä¸ªåŒ…å« 3 ä¸ª int64 çš„æ•°ç»„
arr = np.zeros(4, dtype=dtype)  # åˆ›å»ºä¸€ä¸ªç»“æ„åŒ–æ•°ç»„
print(arr)  # æ‰“å°æ•°ç»„
print(arr[0]['x'])  # è®¿é—®ç¬¬ä¸€ä¸ªå…ƒç´ çš„ 'x' å­—æ®µ
```

## ä¸ºä»€ä¹ˆä½¿ç”¨ç»“æ„åŒ–æ•°ç»„ï¼Ÿ

<!-- ç»“æ„åŒ–æ•°ç»„çš„ç”¨é€” -->
-   å°†å†…å­˜è§£é‡Šä¸ºè¡¨æ ¼ç»“æ„ã€‚
-   å¯¹äºç£ç›˜ I/Oï¼ˆåŒ…æ‹¬å†…å­˜æ˜ å°„ï¼‰å¾ˆæœ‰æ•ˆã€‚
-   è¡¨ç¤ºæ¥è‡ª C/C++ ä»£ç çš„æ•°æ®ã€‚
-   æ¯” pandas DataFrame æ›´åº•å±‚ã€‚

## æ’åº ï¸ï¸ï¸ï¸ï¸â¬†ï¸

<!-- ä»‹ç» sort() æ–¹æ³•å’Œ np.sort() å‡½æ•° -->
-   `ndarray.sort()`ï¼šåŸåœ°æ’åºï¼š

```{python}
arr = rng.standard_normal(6)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 6 ä¸ªæ ‡å‡†æ­£æ€åˆ†å¸ƒå…ƒç´ çš„æ•°ç»„
arr.sort()  # å‡åºæ’åº
print(arr)  # æ‰“å°æ’åºåçš„æ•°ç»„
```
-   `numpy.sort()`ï¼šåˆ›å»ºä¸€ä¸ª*æ–°çš„*ã€æ’åºçš„å‰¯æœ¬ã€‚

```{python}
arr = rng.standard_normal(5)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 5 ä¸ªæ ‡å‡†æ­£æ€åˆ†å¸ƒå…ƒç´ çš„æ•°ç»„
print(np.sort(arr))  # æ’åºå‰¯æœ¬
```
- ä¸¤ç§æ–¹æ³•éƒ½æ¥å— `axis` å‚æ•°
```{python}
arr = rng.standard_normal((3, 5))   # åˆ›å»ºä¸€ä¸ª3x5çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ•°ç»„
arr.sort(axis=1)  # å¯¹æ¯ä¸€è¡Œè¿›è¡Œæ’åº
print(arr)  # æ‰“å°æ’åºåçš„æ•°ç»„
```
## é—´æ¥æ’åºï¼š`argsort` å’Œ `lexsort`

<!-- ä»‹ç» argsort() å’Œ lexsort() å‡½æ•° -->
-   **é—´æ¥æ’åº**ï¼šè¿”å›æ•´æ•°*ç´¢å¼•*ä»¥é‡æ–°æ’åºæ•°æ®ã€‚
-   `argsort()`ï¼šè¿”å›å°†å¯¹æ•°ç»„è¿›è¡Œæ’åºçš„ç´¢å¼•ï¼š

```{python}
values = np.array([5, 0, 1, 3, 2])  # åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„
indexer = values.argsort()  # è·å–æ’åºåçš„ç´¢å¼•
print(indexer)  # æ‰“å°ç´¢å¼•
print(values[indexer])  # ä½¿ç”¨ç´¢å¼•å¯¹æ•°ç»„è¿›è¡Œæ’åº
```

## `lexsort`ï¼šå¤šä¸ªé”®

<!-- ä»‹ç» lexsort() å‡½æ•° -->
-   `lexsort()`ï¼šå¯¹å¤šä¸ªé”®è¿›è¡Œå­—å…¸åºæ’åºï¼ˆ*æœ€å*ä¸€ä¸ªæ•°ç»„æ˜¯ä¸»é”®ï¼‰ï¼š

```{python}
first_name = np.array(['Bob', 'Jane', 'Steve', 'Bill', 'Barbara'])  # åˆ›å»ºä¸€ä¸ªåŒ…å«åå­—çš„æ•°ç»„
last_name = np.array(['Jones', 'Arnold', 'Arnold', 'Jones', 'Walters'])  # åˆ›å»ºä¸€ä¸ªåŒ…å«å§“æ°çš„æ•°ç»„
sorter = np.lexsort((first_name, last_name))  # å…ˆæŒ‰å§“æ°æ’åºï¼Œå†æŒ‰åå­—æ’åº
print(list(zip(last_name[sorter], first_name[sorter])))  # æ‰“å°æ’åºåçš„å§“å
```

## æ›¿ä»£æ’åºç®—æ³•

<!-- ä»‹ç»ä¸åŒçš„æ’åºç®—æ³• -->
-   ç®—æ³•ï¼š`quicksort`ï¼ˆé»˜è®¤ï¼‰ã€`mergesort`ã€`heapsort`ã€`timsort`ã€‚
-   **ç¨³å®š**æ’åºï¼šä¿ç•™ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹ä½ç½®ï¼ˆ`mergesort` æ˜¯ç¨³å®šçš„ï¼‰ã€‚

```{python}
values = np.array(['2:first', '2:second', '1:first', '1:second', '1:third'])  # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„
key = np.array([2, 2, 1, 1, 1])  # åˆ›å»ºä¸€ä¸ªé”®æ•°ç»„
indexer = key.argsort(kind='mergesort')  # ä½¿ç”¨ç¨³å®šçš„ mergesort è¿›è¡Œæ’åº
print(values.take(indexer))  # ä½¿ç”¨ç´¢å¼•å¯¹å€¼æ•°ç»„è¿›è¡Œæ’åº
```

## æ•°ç»„æ’åºæ–¹æ³•è¡¨

<!-- æ€»ç»“å„ç§æ’åºç®—æ³•çš„è¡¨æ ¼ -->
| ç§ç±»        | é€Ÿåº¦ | ç¨³å®šæ€§ | å·¥ä½œç©ºé—´ | æœ€åæƒ…å†µ  |
| ----------- | ----- | ------ | ---------- | ----------- |
| 'quicksort' | 1     | å¦     | 0          | O(n^2)      |
| 'mergesort' | 2     | æ˜¯    | ~n/2       | O(n log n) |
| 'heapsort'  | 3     | å¦     | 0          | O(n log n) |
| 'timsort'   | 4     | æ˜¯     | ~n/2       | O(n log n) |

- æ³¨æ„ï¼š`timsort` ä¹Ÿæ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”é€šå¸¸éå¸¸é«˜æ•ˆã€‚

## éƒ¨åˆ†æ’åºæ•°ç»„

<!-- ä»‹ç» partition() å’Œ argpartition() å‡½æ•° -->
-   `numpy.partition`, `np.argpartition`ï¼šå›´ç»•ç¬¬ k ä¸ªæœ€å°å…ƒç´ è¿›è¡Œåˆ†åŒºã€‚

```{python}
rng = np.random.default_rng(12345)  # åˆ›å»ºä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨
arr = rng.standard_normal(20)  # åˆ›å»ºä¸€ä¸ªåŒ…å« 20 ä¸ªæ ‡å‡†æ­£æ€åˆ†å¸ƒå…ƒç´ çš„æ•°ç»„
np.partition(arr, 3)  # å‰ 3 ä¸ªæ˜¯æœ€å°çš„ï¼ˆæœªæ’åºï¼‰
```
- `np.argpartition` è¿”å›ç´¢å¼•ï¼š
```{python}
indices = np.argpartition(arr, 3)  # è·å–éƒ¨åˆ†æ’åºçš„ç´¢å¼•
arr.take(indices)  # éƒ¨åˆ†æ’åº
```

## `numpy.searchsorted`ï¼šæŸ¥æ‰¾å…ƒç´  ğŸ”

<!-- ä»‹ç» searchsorted() å‡½æ•° -->
-   `searchsorted`ï¼šåœ¨æ’åºæ•°ç»„ä¸Šè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼›è¿”å›æ’å…¥ç´¢å¼•ã€‚

```{python}
arr = np.array([0, 1, 7, 12, 15])  # åˆ›å»ºä¸€ä¸ªæ’åºæ•°ç»„
print(arr.searchsorted(9))   # åœ¨å“ªé‡Œæ’å…¥ 9ï¼Ÿ
print(arr.searchsorted([0, 8, 11, 16]))  # æŸ¥æ‰¾å¤šä¸ªå€¼çš„æ’å…¥ä½ç½®
```

-   `side='right'` æ›´æ”¹ç›¸ç­‰å€¼çš„è¡Œä¸ºã€‚

## `searchsorted` ç¤ºä¾‹ï¼šåˆ†ç®±

<!-- ä½¿ç”¨ searchsorted() è¿›è¡Œåˆ†ç®±çš„ç¤ºä¾‹ -->
```{python}
data = np.floor(rng.uniform(0, 10000, size=50))  # ç”Ÿæˆ 50 ä¸ª 0 åˆ° 10000 ä¹‹é—´çš„éšæœºæ•´æ•°
bins = np.array([0, 100, 1000, 5000, 10000])  # å®šä¹‰åˆ†ç®±è¾¹ç•Œ
labels = bins.searchsorted(data)  # å¯¹æ¯ä¸ªæ•°æ®ç‚¹è¿›è¡Œåˆ†ç®±
print(labels)  # æ‰“å°æ¯ä¸ªæ•°æ®ç‚¹æ‰€å±çš„ç®±å­æ ‡ç­¾
```

-   ä¸ pandas çš„ `groupby` ç»“åˆä½¿ç”¨ä»¥è·å–ç®±å­ç»Ÿè®¡ä¿¡æ¯ã€‚

## å†…å­˜æ˜ å°„æ–‡ä»¶ ğŸ’¾

<!-- ä»‹ç»å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ¦‚å¿µ -->
-   **å†…å­˜æ˜ å°„æ–‡ä»¶**ï¼šä¸ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ•°æ®äº¤äº’ï¼Œå°±åƒå®ƒåœ¨å†…å­˜ä¸­ä¸€æ ·ã€‚
-   `memmap`ï¼šNumPy çš„ç±»ä¼¼ ndarray çš„å¯¹è±¡ã€‚è¯»å–/å†™å…¥æ®µï¼Œè€Œæ— éœ€åŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚
-   ä½¿ç”¨ `np.memmap` åˆ›å»ºï¼šæŒ‡å®šè·¯å¾„ã€dtypeã€å½¢çŠ¶ã€æ¨¡å¼ï¼š

```{python}
mmap = np.memmap('mymmap', dtype='float64', mode='w+',
                 shape=(10000, 10000))  # åˆ›å»ºä¸€ä¸ªå†…å­˜æ˜ å°„æ–‡ä»¶
print(mmap)  # æ‰“å°å†…å­˜æ˜ å°„å¯¹è±¡
```

## å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆç»­ï¼‰

<!-- å†…å­˜æ˜ å°„æ–‡ä»¶çš„åˆ‡ç‰‡å’Œå†™å…¥æ“ä½œ -->
-   åˆ‡ç‰‡è¿”å›ç£ç›˜ä¸Šçš„*è§†å›¾*ï¼š

```{python}
section = mmap[:5]  # å‰ 5 è¡Œ
```
- åˆ†é…ç¼“å†²åŒºåœ¨å†…å­˜ä¸­ï¼›ä½¿ç”¨ `flush()` å†™å…¥ï¼š
```{python}
section[:] = rng.standard_normal((5, 10000))  # å°†æ•°æ®å†™å…¥åˆ‡ç‰‡
mmap.flush()  # å°†æ›´æ”¹åˆ·æ–°åˆ°ç£ç›˜
```
- æ‰“å¼€ç°æœ‰æ˜ å°„ä»ç„¶éœ€è¦ dtype å’Œå½¢çŠ¶ï¼š
```{python}
mmap = np.memmap('mymmap', dtype='float64', shape=(10000, 10000))  # æ‰“å¼€ç°æœ‰çš„å†…å­˜æ˜ å°„æ–‡ä»¶
print(mmap)  # æ‰“å°å†…å­˜æ˜ å°„å¯¹è±¡
```

- `memmap` é€‚ç”¨äºç»“æ„åŒ–æ•°æ®ç±»å‹ã€‚

## æ€§èƒ½æç¤º ğŸš€

<!-- æé«˜ NumPy ä»£ç æ€§èƒ½çš„å»ºè®® -->
-   **å…³é”®**ï¼šç”¨ NumPy æ•°ç»„/å¸ƒå°”è¿ç®—æ›¿æ¢å¾ªç¯/æ¡ä»¶è¯­å¥ã€‚
-   ä½¿ç”¨å¹¿æ’­ã€‚
-   ä½¿ç”¨æ•°ç»„è§†å›¾ï¼ˆåˆ‡ç‰‡ï¼‰â€“ é¿å…å¤åˆ¶ã€‚
-   ä½¿ç”¨ ufunc å’Œ ufunc æ–¹æ³•ã€‚
-   å¦‚æœéœ€è¦ï¼Œè€ƒè™‘ Cã€FORTRAN æˆ– Cythonã€‚

## è¿ç»­å†…å­˜ ğŸ§ 

<!-- ä»‹ç»è¿ç»­å†…å­˜çš„æ¦‚å¿µåŠå…¶å¯¹æ€§èƒ½çš„å½±å“ -->
-   å†…å­˜å¸ƒå±€å½±å“æ€§èƒ½ã€‚
-   **è¿ç»­**ï¼šå…ƒç´ æŒ‰é¡ºåºå­˜å‚¨ï¼ˆC æˆ– FORTRANï¼‰ã€‚
-   è®¿é—®è¿ç»­å—æœ€å¿«ï¼ˆCPU ç¼“å­˜ï¼‰ã€‚
-   NumPy æ•°ç»„é»˜è®¤ä¸º C è¿ç»­ï¼›è½¬ç½®æ˜¯ Fortran è¿ç»­çš„ã€‚
-   ä½¿ç”¨ `flags` æ£€æŸ¥ï¼š

```{python}
arr_c = np.ones((100, 10000), order='C')  # åˆ›å»ºä¸€ä¸ª C è¿ç»­æ•°ç»„
arr_f = np.ones((100, 10000), order='F')  # åˆ›å»ºä¸€ä¸ª Fortran è¿ç»­æ•°ç»„
print(arr_c.flags)  # C_CONTIGUOUS: True, F_CONTIGUOUS: False
print(arr_f.flags)  # C_CONTIGUOUS: False, F_CONTIGUOUS: True
```

## è¿ç»­å†…å­˜ï¼ˆç»­ï¼‰

<!-- è¿ç»­å†…å­˜å¯¹æ€§èƒ½çš„å½±å“ä»¥åŠå¦‚ä½•åˆ›å»ºç‰¹å®šé¡ºåºçš„æ•°ç»„ -->
-   å¯¹ C è¿ç»­æ•°ç»„çš„è¡Œæ±‚å’Œ*é€šå¸¸*æ›´å¿«ã€‚
-   å¦‚æœéœ€è¦ï¼Œä½¿ç”¨ `copy()` å’Œ `'C'` æˆ– `'F'`ï¼š

```{python}
arr_f.copy('C').flags  # å°† Fortran è¿ç»­æ•°ç»„å¤åˆ¶ä¸º C è¿ç»­æ•°ç»„
```
-   *é‡è¦*ï¼šè§†å›¾*ä¸ä¿è¯*è¿ç»­ï¼›æ£€æŸ¥ `flags.contiguous`ã€‚

## æ€»ç»“ ğŸ“š


-   `ndarray` å†…éƒ¨ç»“æ„ï¼š`dtype`ã€å½¢çŠ¶ã€è·¨åº¦ã€‚
-   æ•°ç»„æ“ä½œï¼šé‡å¡‘ã€è¿æ¥ã€æ‹†åˆ†ã€é‡å¤ã€‚
-   å¹¿æ’­æœºåˆ¶ã€‚
-   é«˜çº§ `ufunc` æ–¹æ³•ã€‚
-   ç»“æ„åŒ–æ•°ç»„ã€‚
-   æ’åºï¼ˆé—´æ¥ã€éƒ¨åˆ†ï¼‰ã€‚
-   å†…å­˜æ˜ å°„æ–‡ä»¶ã€‚
-   æ€§èƒ½ï¼šè¿ç»­å†…å­˜ã€‚
-   Numbaï¼

## æ€è€ƒä¸è®¨è®º ğŸ’­


-   *æ‚¨*å¦‚ä½•åº”ç”¨è¿™äº›æŠ€æœ¯ï¼Ÿ
-   å†…å­˜æ˜ å°„æ–‡ä»¶åœ¨ä»€ä¹ˆæ—¶å€™æœ‰ç”¨ï¼Ÿ
-   ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Numbaï¼Ÿ
-   ç»“æ„åŒ–æ•°ç»„ vs. pandas DataFrameï¼Ÿ
-   æ’åºç®—æ³•é€‰æ‹©ï¼Ÿ
-   å‘é‡åŒ–æ“ä½œ vs. å¾ªç¯ï¼Ÿ
-   è¿›ä¸€æ­¥æ¢ç´¢ Numbaï¼
