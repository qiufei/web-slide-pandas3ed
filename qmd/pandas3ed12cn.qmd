---
title: "Python æ•°æ®åˆ†æ"  # å¹»ç¯ç‰‡æ ‡é¢˜
subtitle: "Python å»ºæ¨¡åº“å…¥é—¨"  # å‰¯æ ‡é¢˜
---

## ç®€ä»‹ ğŸ“Š

- æœ¬ç« å°†ä»‹ç»å¦‚ä½•å°†ä½¿ç”¨ pandas è¿›è¡Œæ•°æ®æ•´ç†ä¸ä½¿ç”¨ Python ä¸“ç”¨åº“è¿›è¡Œæ¨¡å‹æ„å»ºè”ç³»èµ·æ¥ã€‚
- æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å¦‚ä½•å°† pandas ä¸ statsmodels å’Œ scikit-learn ç­‰åº“è¿æ¥èµ·æ¥ã€‚
- è¿™æ˜¯æ•°æ®åˆ†æå·¥ä½œæµç¨‹ä¸­çš„å…³é”®ä¸€æ­¥ã€‚

## å…³é”®æ¦‚å¿µ ğŸ”‘

è®©æˆ‘ä»¬å®šä¹‰ä¸€äº›é‡è¦çš„æœ¯è¯­ï¼š

- **æ•°æ®æŒ–æ˜ï¼š** ä»å¤§å‹æ•°æ®é›†ä¸­å‘ç°æ¨¡å¼ã€å¼‚å¸¸å’Œæ´å¯ŸåŠ›ã€‚å®ƒé€šå¸¸æ¶‰åŠå„ç§æŠ€æœ¯ï¼ŒåŒ…æ‹¬æœºå™¨å­¦ä¹ ã€‚
- **æœºå™¨å­¦ä¹  (ML)ï¼š** äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é›†ï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿåœ¨æ²¡æœ‰æ˜ç¡®ç¼–ç¨‹çš„æƒ…å†µä¸‹ä»æ•°æ®ä¸­å­¦ä¹ ã€‚æœºå™¨å­¦ä¹ ç®—æ³•ä»â€œè®­ç»ƒæ•°æ®â€æ„å»ºæ¨¡å‹ä»¥è¿›è¡Œé¢„æµ‹ã€‚
- **ç»Ÿè®¡å­¦ä¹ ï¼š** ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•ç†è§£æ•°æ®çš„æ¡†æ¶ã€‚å®ƒä¸æœºå™¨å­¦ä¹ æœ‰é‡å ï¼Œä½†é€šå¸¸æ›´å¼ºè°ƒæ¨ç†å’Œå¯è§£é‡Šæ€§ã€‚
- **ç‰¹å¾å·¥ç¨‹ï¼š** åˆ©ç”¨é¢†åŸŸçŸ¥è¯†ä»åŸå§‹æ•°æ®ä¸­é€‰æ‹©ã€è½¬æ¢å’Œåˆ›å»ºç›¸å…³ç‰¹å¾ï¼ˆå˜é‡ï¼‰ã€‚è¿™å¯ä»¥æé«˜æ¨¡å‹æ€§èƒ½ï¼Œå¹¶ä¸”*è‡³å…³é‡è¦*ã€‚

## æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ çš„å…³ç³» ğŸ¤

æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ æ˜¯ç›¸å…³çš„ï¼š

```{mermaid}
graph LR
    A[æ•°æ®æŒ–æ˜] --> C(å…±åŒç‚¹)  # æ•°æ®æŒ–æ˜æŒ‡å‘å…±åŒç‚¹
    B[æœºå™¨å­¦ä¹ ] --> C(å…±åŒç‚¹)  # æœºå™¨å­¦ä¹ æŒ‡å‘å…±åŒç‚¹
    D[ç»Ÿè®¡å­¦ä¹ ] --> C(å…±åŒç‚¹)  # ç»Ÿè®¡å­¦ä¹ æŒ‡å‘å…±åŒç‚¹
    C --> E[æ´å¯Ÿä¸é¢„æµ‹]  # å…±åŒç‚¹æŒ‡å‘æ´å¯Ÿä¸é¢„æµ‹
```

 å®ƒä»¬éƒ½æ—¨åœ¨æå–æ´å¯Ÿå¹¶è¿›è¡Œé¢„æµ‹ã€‚æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ æä¾›äº†åœ¨æ›´å¹¿æ³›çš„æ•°æ®æŒ–æ˜ç¯å¢ƒä¸­ä½¿ç”¨çš„å·¥å…·ã€‚

## Python åœ¨æ•°æ®åˆ†æä¸­çš„ä½œç”¨ ğŸ

Python åœ¨æ•°æ®åˆ†æä¸­å æ®ä¸»å¯¼åœ°ä½ï¼ŒåŸå› å¦‚ä¸‹ï¼š

- **ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼š** pandasï¼ˆæ•°æ®å¤„ç†ï¼‰ã€NumPyï¼ˆæ•°å€¼è®¡ç®—ï¼‰ã€statsmodelsï¼ˆç»Ÿè®¡å»ºæ¨¡ï¼‰ã€scikit-learnï¼ˆæœºå™¨å­¦ä¹ ï¼‰ä»¥åŠ Matplotlib/Seabornï¼ˆå¯è§†åŒ–ï¼‰ç­‰åº“æä¾›äº†å®Œæ•´çš„å·¥å…·åŒ…ã€‚
- **æ˜“ç”¨æ€§ï¼š** Python æ¸…æ™°çš„è¯­æ³•å’Œäº¤äº’æ€§ï¼ˆä¾‹å¦‚ Jupyterï¼‰ä½¿å…¶æ˜“äºå­¦ä¹ ï¼Œå³ä½¿æ²¡æœ‰ç¼–ç¨‹èƒŒæ™¯ã€‚
- **ç¤¾åŒºæ”¯æŒï¼š** åºå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºå¼€å‘åº“ã€æä¾›æ”¯æŒå¹¶åˆ›å»ºæ–‡æ¡£ã€‚

## å¸¸è§å·¥ä½œæµç¨‹ ğŸ”„

å…¸å‹çš„æ¨¡å‹å¼€å‘å·¥ä½œæµç¨‹ï¼š

```{mermaid}
graph LR
    A[æ•°æ®åŠ è½½ (pandas)] --> B[æ•°æ®æ¸…æ´— (pandas)]  # æ•°æ®åŠ è½½æŒ‡å‘æ•°æ®æ¸…æ´—
    B --> C[ç‰¹å¾å·¥ç¨‹ (pandas, å…¶ä»–å·¥å…·)]  # æ•°æ®æ¸…æ´—æŒ‡å‘ç‰¹å¾å·¥ç¨‹
    C --> D[æ¨¡å‹æ„å»º (statsmodels, scikit-learn)]  # ç‰¹å¾å·¥ç¨‹æŒ‡å‘æ¨¡å‹æ„å»º
    D --> E[æ¨¡å‹è¯„ä¼° (statsmodels, scikit-learn)]  # æ¨¡å‹æ„å»ºæŒ‡å‘æ¨¡å‹è¯„ä¼°
    E --> F[é¢„æµ‹/æ¨ç†]  # æ¨¡å‹è¯„ä¼°æŒ‡å‘é¢„æµ‹/æ¨ç†
```

1. **æ•°æ®åŠ è½½ï¼š** pandas è¯»å–æ•°æ®ï¼ˆCSVã€Excelã€æ•°æ®åº“ç­‰ï¼‰ã€‚
2. **æ•°æ®æ¸…æ´—ï¼š** pandas å¤„ç†ç¼ºå¤±å€¼ã€é”™è¯¯å¹¶è½¬æ¢æ•°æ®ã€‚
3. **ç‰¹å¾å·¥ç¨‹ï¼š** åˆ›å»º/è½¬æ¢ç‰¹å¾ä»¥è·å¾—æ›´å¥½çš„æ¨¡å‹ã€‚
4. **æ¨¡å‹æ„å»ºï¼š** statsmodels/scikit-learn è®­ç»ƒæ¨¡å‹ã€‚
5. **æ¨¡å‹è¯„ä¼°ï¼š** è¯„ä¼°æ€§èƒ½ã€‚
6. **é¢„æµ‹/æ¨ç†ï¼š** è¿›è¡Œé¢„æµ‹æˆ–å¾—å‡ºæ¨è®ºã€‚

## pandas å’Œæ¨¡å‹ä¹‹é—´çš„æ¥å£ â†”ï¸

 ä¸»è¦çš„æ¥å£é€šå¸¸æ˜¯ NumPy æ•°ç»„ã€‚pandas DataFrame æ„å»ºåœ¨ NumPy ä¹‹ä¸Šï¼Œå› æ­¤è½¬æ¢å¾ˆå®¹æ˜“ã€‚

## DataFrame åˆ° NumPy æ•°ç»„ â¡ï¸

 ä½¿ç”¨ `.to_numpy()` å°† DataFrame è½¬æ¢ä¸º NumPy æ•°ç»„ï¼š

::: {style="color: blue;"}
 **é‡è¦æç¤ºï¼š** `.to_numpy()` ä¼˜äº `.values`ã€‚
:::

# ç¤ºä¾‹ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas åº“
import numpy as np  # å¯¼å…¥ numpy åº“

# åˆ›å»ºä¸€ä¸ª DataFrame
data = pd.DataFrame({
    'x0': [1, 2, 3, 4, 5],  # åˆ— 'x0'
    'x1': [0.01, -0.01, 0.25, -4.1, 0.],  # åˆ— 'x1'
    'y': [-1.5, 0., 3.6, 1.3, -2.]  # åˆ— 'y'
})

print(data)  # æ‰“å° DataFrame
```

```{python}
#| echo: true
data_array = data.to_numpy()  # å°† DataFrame è½¬æ¢ä¸º NumPy æ•°ç»„
print("\nNumPy æ•°ç»„:")  # æ‰“å°æç¤ºä¿¡æ¯
print(data_array)  # æ‰“å° NumPy æ•°ç»„
```

## NumPy æ•°ç»„åˆ° DataFrame â¬…ï¸

 ä» NumPy æ•°ç»„åˆ›å»º DataFrameï¼š

```{python}
#| echo: true
# ä½¿ç”¨ NumPy æ•°ç»„å’Œåˆ—ååˆ›å»º DataFrame
df2 = pd.DataFrame(data_array, columns=['one', 'two', 'three'])
print(df2)  # æ‰“å° DataFrame
```

::: {style="color: green;"}
 æˆ‘ä»¬åœ¨åˆ›å»º DataFrame æ—¶æä¾›äº†åˆ—åã€‚
:::

## åŒæ„æ•°æ®ä¸å¼‚æ„æ•°æ® ğŸ¤”

- **åŒæ„æ•°æ®ï¼š** ç›¸åŒç±»å‹ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰æ•°å­—ï¼‰-> å…·æœ‰è¯¥ç±»å‹çš„ NumPy æ•°ç»„ã€‚
- **å¼‚æ„æ•°æ®ï¼š** æ··åˆç±»å‹ï¼ˆæ•°å­—å’Œå­—ç¬¦ä¸²ï¼‰-> `dtype=object` æ•°ç»„ï¼ˆå¯¹äºæ•°å€¼è®¡ç®—æ•ˆç‡è¾ƒä½ï¼‰ã€‚

**ç¤ºä¾‹**ï¼š

```{python}
#| echo: true
df3 = data.copy()  # å¤åˆ¶ DataFrame
df3['strings'] = ['a', 'b', 'c', 'd', 'e']  # æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—
print(df3)  # æ‰“å° DataFrame

print("\nå¼‚æ„æ•°ç»„:")  # æ‰“å°æç¤ºä¿¡æ¯
print(df3.to_numpy())  # æ‰“å°å¼‚æ„ NumPy æ•°ç»„ (æ•°æ®ç±»å‹æ˜¯object)
```

## é€‰æ‹©åˆ—å­é›† ğŸ¤

å¯¹äºå»ºæ¨¡ï¼Œåœ¨è½¬æ¢ä¹‹å‰ä½¿ç”¨ `.loc` é€‰æ‹©åˆ—ï¼š

```{python}
#| echo: true
model_cols = ['x0', 'x1']  # å®šä¹‰è¦é€‰æ‹©çš„åˆ—
print(data.loc[:, model_cols].to_numpy())  # é€‰æ‹©åˆ—å¹¶è½¬æ¢ä¸º NumPy æ•°ç»„
```

## åˆ†ç±»æ•°æ®å’Œè™šæ‹Ÿå˜é‡ ğŸ·ï¸

åˆ†ç±»å˜é‡ï¼ˆä¾‹å¦‚ï¼Œâ€œmaleâ€ã€â€œfemaleâ€ï¼‰éœ€è¦æ•°å€¼è¡¨ç¤ºã€‚ä½¿ç”¨*è™šæ‹Ÿå˜é‡*ï¼ˆæˆ–*ç‹¬çƒ­ç¼–ç *ï¼‰ã€‚

## pandas `get_dummies()` ğŸ¼

`pd.get_dummies()` ç®€åŒ–äº†æ­¤æ“ä½œï¼š

```{python}
#| echo: true
# åˆ›å»ºä¸€ä¸ªåˆ†ç±»åˆ—
data['category'] = pd.Categorical(['a', 'b', 'a', 'a', 'b'], categories=['a', 'b'])
print(data)  # æ‰“å° DataFrame

# ä½¿ç”¨ get_dummies() åˆ›å»ºè™šæ‹Ÿå˜é‡
dummies = pd.get_dummies(data.category, prefix='category')
print("\nè™šæ‹Ÿå˜é‡:")  # æ‰“å°æç¤ºä¿¡æ¯
print(dummies)  # æ‰“å°è™šæ‹Ÿå˜é‡
```
```{python}
#| echo: true
# åˆ é™¤åŸå§‹åˆ†ç±»åˆ—ï¼Œå¹¶è¿æ¥è™šæ‹Ÿå˜é‡
data_with_dummies = data.drop('category', axis=1).join(dummies)
print("\nåŒ…å«è™šæ‹Ÿå˜é‡çš„ DataFrame:")  # æ‰“å°æç¤ºä¿¡æ¯
print(data_with_dummies)  # æ‰“å°åŒ…å«è™šæ‹Ÿå˜é‡çš„ DataFrame
```

::: {style="color: blue;"}
 `prefix` æ·»åŠ ä¸€ä¸ªå‰ç¼€ï¼ˆä¾‹å¦‚ï¼Œ`category_a`ï¼‰ã€‚
:::

## Patsyï¼šæ¨¡å‹æè¿° ğŸ“

 - Patsy ä½¿ç”¨å…¬å¼è¯­æ³•ï¼ˆç±»ä¼¼äº Rï¼‰æ¥æŒ‡å®šæ¨¡å‹ï¼Œå°¤å…¶æ˜¯çº¿æ€§æ¨¡å‹ã€‚
 
 - å®ƒéš statsmodels ä¸€èµ·å®‰è£…ï¼š
 `conda install statsmodels`

## Patsy å…¬å¼ â•

 ç¤ºä¾‹å…¬å¼ï¼š

```
# y ~ x0 + x1
```

-   `y`ï¼šå› å˜é‡ï¼ˆå“åº”å˜é‡ï¼‰ã€‚
-   `x0`, `x1`ï¼šè‡ªå˜é‡ï¼ˆé¢„æµ‹å˜é‡ï¼‰ã€‚
-   `~`ï¼šåˆ†éš”å·¦ä¾§ï¼ˆå“åº”å˜é‡ï¼‰å’Œå³ä¾§ï¼ˆé¢„æµ‹å˜é‡ï¼‰ã€‚
-   `+`ï¼šåŒ…å«é¡¹ï¼ˆä¸æ˜¯æ•°å­¦åŠ æ³•ï¼ï¼‰ã€‚

## `patsy.dmatrices()` ğŸ§®

`dmatrices()` æ¥å—ä¸€ä¸ªå…¬å¼å’Œæ•°æ®ï¼Œè¿”å›è®¾è®¡çŸ©é˜µï¼š

```{python}
#| echo: true
import patsy  # å¯¼å…¥ patsy åº“

# ä½¿ç”¨ dmatrices() åˆ›å»ºè®¾è®¡çŸ©é˜µ
y, X = patsy.dmatrices('y ~ x0 + x1', data)

print("y (å“åº”å˜é‡çš„è®¾è®¡çŸ©é˜µ):")  # æ‰“å°æç¤ºä¿¡æ¯
print(y)  # æ‰“å°å“åº”å˜é‡çš„è®¾è®¡çŸ©é˜µ
print("\nX (é¢„æµ‹å˜é‡çš„è®¾è®¡çŸ©é˜µ):")  # æ‰“å°æç¤ºä¿¡æ¯
print(X)  # æ‰“å°é¢„æµ‹å˜é‡çš„è®¾è®¡çŸ©é˜µ
```

::: {style="color: DarkRed;"}
Patsy é»˜è®¤åŒ…å«ä¸€ä¸ªæˆªè·ï¼ˆä¸€åˆ— 1ï¼‰â€”â€”å½“é¢„æµ‹å˜é‡ä¸ºé›¶æ—¶çš„åŸºçº¿å“åº”ã€‚
:::

## æŠ‘åˆ¶æˆªè· â–

ä½¿ç”¨ `+ 0` åˆ é™¤æˆªè·ï¼š

```{python}
#| echo: true
# åˆ›å»ºä¸åŒ…å«æˆªè·çš„è®¾è®¡çŸ©é˜µ
X_no_intercept = patsy.dmatrices('y ~ x0 + x1 + 0', data)[1]  # [1] ä»…è·å– X
print(X_no_intercept)  # æ‰“å°ä¸åŒ…å«æˆªè·çš„ X
```

## Patsyã€NumPy å’Œ statsmodels ğŸ¤

Patsy ä¸­çš„è®¾è®¡çŸ©é˜µå¯ä¸ NumPyï¼ˆä¾‹å¦‚ `np.linalg.lstsq`ï¼‰æˆ– statsmodels ä¸€èµ·ä½¿ç”¨ï¼š

```{python}
#| echo: true
import numpy as np  # å¯¼å…¥ numpy åº“

# ä½¿ç”¨ NumPy çš„æœ€å°äºŒä¹˜æ³•æ‹Ÿåˆçº¿æ€§æ¨¡å‹
coef, resid, _, _ = np.linalg.lstsq(X, y, rcond=None) # æ·»åŠ  rcond=None ä»¥å…¼å®¹
print(coef)  # æ‰“å°ç³»æ•°

# å°†ç³»æ•°è½¬æ¢ä¸º pandas Series
coef = pd.Series(coef.squeeze(), index=X.design_info.column_names)
print(coef)  # æ‰“å°å¸¦æœ‰ç´¢å¼•çš„ç³»æ•°
```

## Patsyï¼šæ•°æ®è½¬æ¢ âœ¨

åœ¨å…¬å¼ä¸­åŒ…å« Python ä»£ç ä»¥è¿›è¡Œè½¬æ¢ï¼š

```{python}
#| echo: true
# åœ¨å…¬å¼ä¸­ä½¿ç”¨ Python å‡½æ•°è¿›è¡Œæ•°æ®è½¬æ¢
y, X = patsy.dmatrices('y ~ x0 + np.log(np.abs(x1) + 1)', data)
print(X)  # æ‰“å°è½¬æ¢åçš„ X
```

Patsy åœ¨ä½œç”¨åŸŸä¸­æŸ¥æ‰¾ `np.log` ç­‰å‡½æ•°ã€‚

## å†…ç½®å‡½æ•°ï¼š`standardize`ã€`center` ğŸ› ï¸

Patsy å…·æœ‰å†…ç½®å‡½æ•°ï¼š

-   `standardize(x)`ï¼šæ ‡å‡†åŒ– `x`ï¼ˆå‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1ï¼‰ã€‚
-   `center(x)`ï¼šå‡å»å‡å€¼ã€‚

```{python}
#| echo: true
# ä½¿ç”¨ Patsy çš„å†…ç½®å‡½æ•°è¿›è¡Œæ•°æ®è½¬æ¢
y, X = patsy.dmatrices('y ~ standardize(x0) + center(x1)', data)
print(X)  # æ‰“å°è½¬æ¢åçš„ X
```

## æœ‰çŠ¶æ€è½¬æ¢å’Œ `build_design_matrices` ğŸ’¾

 å½“åº”ç”¨åƒ`center`å’Œ`standardize`è¿™æ ·çš„è½¬æ¢æ—¶ï¼Œåœ¨è½¬æ¢æ–°æ•°æ®æ—¶ä½¿ç”¨åŸå§‹æ•°æ®é›†çš„ç»Ÿè®¡æ•°æ®ã€‚ `patsy.build_design_matrices` å¯ä»¥æä¾›å¸®åŠ©ï¼š


```{python}
#| echo: true
# åˆ›å»ºæ–°æ•°æ®
new_data = pd.DataFrame({
    'x0': [6, 7, 8, 9],
    'x1': [3.1, -0.5, 0, 2.3],
    'y' : [1, 2, 3, 4]
})

# ä½¿ç”¨åŸå§‹ X çš„ design_info æ„å»ºæ–°æ•°æ®çš„è®¾è®¡çŸ©é˜µ
new_X = patsy.build_design_matrices([X.design_info], new_data)
print(new_X)  # æ‰“å°æ–°æ•°æ®çš„è®¾è®¡çŸ©é˜µ
```

## æŒ‰åç§°æ·»åŠ åˆ— â•

 è¦æ·»åŠ åˆ—ï¼Œè¯·å°†å®ƒä»¬åŒ…è£…åœ¨ `I()` ä¸­ï¼š

```{python}
#| echo: true
# ä½¿ç”¨ I() æ·»åŠ åˆ—
y, X = patsy.dmatrices('y ~ I(x0 + x1)', data)
print(X) # æ‰“å°è®¾è®¡çŸ©é˜µ, I(x0 + x1)å°†x0 + x1ä½œä¸ºä¸€ä¸ªæ•´ä½“åŠ å…¥
```

## åˆ†ç±»æ•°æ®å’Œ Patsy ğŸ·ï¸

Patsy è‡ªåŠ¨å¤„ç†åˆ†ç±»å˜é‡ï¼š

```{python}
#| echo: true
# åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ†ç±»å˜é‡çš„ DataFrame
data = pd.DataFrame({
    'key1': ['a', 'a', 'b', 'b', 'a', 'b', 'a', 'b'],
    'key2': [0, 1, 0, 1, 0, 1, 0, 0],
    'v1': [1, 2, 3, 4, 5, 6, 7, 8],
    'v2': [-1, 0, 2.5, -0.5, 4.0, -1.2, 0.2, -1.7]
    })

# ä½¿ç”¨ Patsy å¤„ç†åˆ†ç±»å˜é‡
y, X = patsy.dmatrices('v2 ~ key1', data)
print(X)  # æ‰“å°è®¾è®¡çŸ©é˜µ
```

::: {style="color: blue;"}
Patsy çœç•¥äº†ä¸€ä¸ªçº§åˆ«ä»¥é¿å…å…±çº¿æ€§ï¼ˆä¸æˆªè·ï¼‰ã€‚
:::

## æ— æˆªè·ï¼Œåˆ†ç±»å˜é‡ â–ğŸ·ï¸

æ²¡æœ‰æˆªè·æ—¶ï¼Œå°†åŒ…å«æ‰€æœ‰ç±»åˆ«åˆ—ï¼š

```{python}
#| echo: true
# åœ¨æ²¡æœ‰æˆªè·çš„æƒ…å†µä¸‹å¤„ç†åˆ†ç±»å˜é‡
y, X = patsy.dmatrices('v2 ~ key1 + 0', data)
print(X)  # æ‰“å°è®¾è®¡çŸ©é˜µ
```

## å°†æ•°å€¼è§†ä¸ºåˆ†ç±»å˜é‡ ğŸ”¢â¡ï¸ğŸ·ï¸

ä½¿ç”¨ `C()` å°†æ•°å­—è§†ä¸ºåˆ†ç±»å˜é‡ï¼š

```{python}
#| echo: true
# ä½¿ç”¨ C() å°†æ•°å€¼è§†ä¸ºåˆ†ç±»å˜é‡
y, X = patsy.dmatrices('v2 ~ C(key2)', data)
print(X) # æ‰“å°è®¾è®¡çŸ©é˜µ
```

## äº¤äº’é¡¹ ğŸ¤

äº¤äº’é¡¹å¯¹ç»„åˆæ•ˆåº”è¿›è¡Œå»ºæ¨¡ã€‚ä½¿ç”¨ `:`ï¼š

```{python}
#| echo: true
# å°† key2 æ˜ å°„ä¸ºå­—ç¬¦ä¸²
data['key2'] = data['key2'].map({0: 'zero', 1: 'one'})
print(data)  # æ‰“å° DataFrame

# åˆ›å»ºåŒ…å«äº¤äº’é¡¹çš„è®¾è®¡çŸ©é˜µ
y, X = patsy.dmatrices('v2 ~ key1 + key2 + key1:key2', data)
print(X)  # æ‰“å°è®¾è®¡çŸ©é˜µ
```

## statsmodels ç®€ä»‹ ğŸ“ˆ

`statsmodels` ç”¨äºç»Ÿè®¡å»ºæ¨¡ã€å‡è®¾æ£€éªŒå’Œæ•°æ®æ¢ç´¢ã€‚å®ƒä¾§é‡äº*ç»Ÿè®¡æ¨æ–­*ï¼Œä¸ scikit-learn äº’è¡¥ã€‚

## statsmodels ä¸­çš„æ¨¡å‹ ğŸ§®

 `statsmodels` åŒ…æ‹¬ï¼š

-   **çº¿æ€§æ¨¡å‹ï¼š** OLSã€GLS ç­‰ã€‚
-   **å¹¿ä¹‰çº¿æ€§æ¨¡å‹ (GLM)ï¼š** é€‚ç”¨äºå„ç§å“åº”ç±»å‹ï¼ˆäºŒå…ƒã€è®¡æ•°ï¼‰ã€‚
-   **æ—¶é—´åºåˆ—åˆ†æï¼š** ARIMAã€VAR ç­‰ã€‚
-   **ä»¥åŠæ›´å¤š...**

## ä½¿ç”¨ statsmodels çš„çº¿æ€§æ¨¡å‹ ğŸ“

ä½¿ç”¨æ•°ç»„å’Œå…¬å¼ API æ‹Ÿåˆçº¿æ€§æ¨¡å‹ã€‚

**åˆ›å»ºç¤ºä¾‹æ•°æ®**ï¼š

```{python}
import statsmodels.api as sm  # å¯¼å…¥ statsmodels.api æ¨¡å—
import statsmodels.formula.api as smf  # å¯¼å…¥ statsmodels.formula.api æ¨¡å—

# å¯é‡ç°çš„ç¤ºä¾‹
rng = np.random.default_rng(seed=12345)  # è®¾ç½®éšæœºæ•°ç§å­ä»¥å®ç°å¯é‡å¤æ€§

# å®šä¹‰ä¸€ä¸ªç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•°çš„å‡½æ•°
def dnorm(mean, variance, size=1):
    if isinstance(size, int):  # å¦‚æœ size æ˜¯æ•´æ•°
        size = size,  # å°†å…¶è½¬æ¢ä¸ºå…ƒç»„
    return mean + np.sqrt(variance) * rng.standard_normal(*size)  # ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•°

N = 100  # æ ·æœ¬æ•°é‡
# ç”Ÿæˆè‡ªå˜é‡ X
X = np.c_[dnorm(0, 0.4, size=N),
          dnorm(0, 0.6, size=N),
          dnorm(0, 0.2, size=N)]
eps = dnorm(0, 0.1, size=N)  # ç”Ÿæˆéšæœºè¯¯å·®é¡¹
beta = [0.1, 0.3, 0.5]  # ç³»æ•°
y = np.dot(X, beta) + eps  # ç”Ÿæˆå› å˜é‡ y
```

## åŸºäºæ•°ç»„çš„ API â•

```{python}
#| echo: true
X_model = sm.add_constant(X)  # æ·»åŠ æˆªè·é¡¹
model = sm.OLS(y, X_model)  # åˆ›å»ºæ™®é€šæœ€å°äºŒä¹˜ (OLS) æ¨¡å‹
results = model.fit()  # æ‹Ÿåˆæ¨¡å‹
print(results.params)  # æ‰“å°æ¨¡å‹å‚æ•°
print(results.summary())  # æ‰“å°æ¨¡å‹æ‘˜è¦
```

::: {style="color: blue;"}
`sm.add_constant(X)` æ·»åŠ ä¸€åˆ— 1 ä»¥è¡¨ç¤ºæˆªè·ã€‚
:::

## åŸºäºå…¬å¼çš„ API

```{python}
#| echo: true
# åˆ›å»ºåŒ…å«è‡ªå˜é‡å’Œå› å˜é‡çš„ DataFrame
data = pd.DataFrame(X, columns=['col0', 'col1', 'col2'])
data['y'] = y

# ä½¿ç”¨å…¬å¼ API æ‹Ÿåˆ OLS æ¨¡å‹
results = smf.ols('y ~ col0 + col1 + col2', data=data).fit()
print(results.params)  # æ‰“å°æ¨¡å‹å‚æ•°
print(results.tvalues)  # æ‰“å° t å€¼
print(results.predict(data[:5]))  # å¯¹å‰ 5 ä¸ªæ ·æœ¬è¿›è¡Œé¢„æµ‹
```

::: {style="color: green;"}
å…¬å¼ API å¤„ç†æˆªè·å¹¶ä¸ DataFrame ä¸€èµ·ä½¿ç”¨ã€‚
:::

## ä½¿ç”¨ statsmodels è¿›è¡Œæ—¶é—´åºåˆ—åˆ†æ âŒš

`statsmodels` å…·æœ‰æ—¶é—´åºåˆ—å·¥å…·ã€‚ç¤ºä¾‹ï¼šè‡ªå›å½’ (AR) æ¨¡å‹ï¼š

```{python}
#| echo: true
from statsmodels.tsa.ar_model import AutoReg  # å¯¼å…¥ AutoReg ç±»

init_x = 4  # åˆå§‹å€¼
values = [init_x, init_x]  # åˆå§‹å€¼åˆ—è¡¨
N = 1000  # æ—¶é—´åºåˆ—é•¿åº¦
b0 = 0.8  # AR(1) ç³»æ•°
b1 = -0.4  # AR(2) ç³»æ•°
noise = dnorm(0, 0.1, N)  # ç”Ÿæˆå™ªå£°

# ç”Ÿæˆ AR(2) æ—¶é—´åºåˆ—
for i in range(N):
    new_x = values[-1] * b0 + values[-2] * b1 + noise[i]
    values.append(new_x)

MAXLAGS = 5  # æœ€å¤§æ»åé˜¶æ•°
model = AutoReg(values, MAXLAGS)  # åˆ›å»º AutoReg æ¨¡å‹
results = model.fit()  # æ‹Ÿåˆæ¨¡å‹
print(results.params)  # æ‰“å°æ¨¡å‹å‚æ•°
```

## scikit-learn ç®€ä»‹ ğŸ¤–

`scikit-learn` æ˜¯ä¸€ä¸ªå¼ºå¤§ã€å¹¿æ³›ä½¿ç”¨çš„æœºå™¨å­¦ä¹ åº“ã€‚å®ƒå…·æœ‰ç”¨äºåˆ†ç±»ã€å›å½’ã€èšç±»ç­‰çš„ç®—æ³•ã€‚

## scikit-learn ç‰¹æ€§ âœ¨

-   **ç®€å•ã€ä¸€è‡´çš„ APIï¼š** ç”¨æˆ·å‹å¥½ä¸”ä¸€è‡´ã€‚
-   **è®¸å¤šç®—æ³•ï¼š** æ¶µç›–å¸¸è§çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚
-   **æ¨¡å‹é€‰æ‹©/è¯„ä¼°ï¼š** äº¤å‰éªŒè¯ã€è¶…å‚æ•°è°ƒæ•´ã€æ€§èƒ½æŒ‡æ ‡ã€‚
-   **æ•°æ®é¢„å¤„ç†ï¼š** ç¼©æ”¾ã€ç‰¹å¾é€‰æ‹©ç­‰ã€‚

## æ³°å¦å°¼å…‹å·ç¤ºä¾‹ ğŸš¢

ä½¿ç”¨æ³°å¦å°¼å…‹å·æ•°æ®é›†å±•ç¤º `scikit-learn` å·¥ä½œæµç¨‹ã€‚

```{python}
#| echo: true
# è¯»å–è®­ç»ƒé›†å’Œæµ‹è¯•é›†
train = pd.read_csv('datasets/titanic/train.csv')
test = pd.read_csv('datasets/titanic/test.csv')
```

```{python}
#| echo: true
train.head(4)  # æ˜¾ç¤ºè®­ç»ƒé›†çš„å‰ 4 è¡Œ
```

## æ•°æ®é¢„å¤„ç† ğŸ§¹

```{python}
#| echo: true
# æ£€æŸ¥è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„ç¼ºå¤±å€¼æ•°é‡
print(train.isna().sum())
print(test.isna().sum())
```

# æˆ‘ä»¬æœ‰ç¼ºå¤±æ•°æ®ï¼š

```{python}
#| echo: true
impute_value = train['Age'].median()  # è®¡ç®— 'Age' åˆ—çš„ä¸­ä½æ•°
train['Age'] = train['Age'].fillna(impute_value)  # ä½¿ç”¨ä¸­ä½æ•°å¡«å…… 'Age' åˆ—ä¸­çš„ç¼ºå¤±å€¼
test['Age'] = test['Age'].fillna(impute_value)  # ä½¿ç”¨ä¸­ä½æ•°å¡«å…… 'Age' åˆ—ä¸­çš„ç¼ºå¤±å€¼

# åˆ›å»ºä¸€ä¸ªæ–°ç‰¹å¾ 'IsFemale'
train['IsFemale'] = (train['Sex'] == 'female').astype(int)
test['IsFemale'] = (test['Sex'] == 'female').astype(int)

# å®šä¹‰é¢„æµ‹å˜é‡
predictors = ['Pclass', 'IsFemale', 'Age']
X_train = train[predictors].to_numpy()  # è·å–è®­ç»ƒé›†çš„ç‰¹å¾
X_test = test[predictors].to_numpy()  # è·å–æµ‹è¯•é›†çš„ç‰¹å¾
y_train = train['Survived'].to_numpy()  # è·å–è®­ç»ƒé›†çš„æ ‡ç­¾
print(X_train[:5])  # æ‰“å°å‰ 5 ä¸ªè®­ç»ƒæ ·æœ¬çš„ç‰¹å¾
print(y_train[:5])  # æ‰“å°å‰ 5 ä¸ªè®­ç»ƒæ ·æœ¬çš„æ ‡ç­¾
```

## æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹ ğŸ‹ï¸â€â™€ï¸

```{python}
#| echo: true
from sklearn.linear_model import LogisticRegression  # å¯¼å…¥ LogisticRegression ç±»

model = LogisticRegression()  # åˆ›å»º LogisticRegression æ¨¡å‹
model.fit(X_train, y_train)  # ä½¿ç”¨è®­ç»ƒæ•°æ®è®­ç»ƒæ¨¡å‹
y_predict = model.predict(X_test)  # ä½¿ç”¨æµ‹è¯•æ•°æ®è¿›è¡Œé¢„æµ‹
print(y_predict[:10])  # æ‰“å°å‰ 10 ä¸ªé¢„æµ‹ç»“æœ
```

## äº¤å‰éªŒè¯ ğŸ”„

```{python}
#| echo: true
from sklearn.linear_model import LogisticRegressionCV  # å¯¼å…¥ LogisticRegressionCV ç±»
from sklearn.model_selection import cross_val_score  # å¯¼å…¥ cross_val_score å‡½æ•°

# ä½¿ç”¨äº¤å‰éªŒè¯åˆ›å»º LogisticRegression æ¨¡å‹
model_cv = LogisticRegressionCV(Cs=10)
model_cv.fit(X_train, y_train)  # ä½¿ç”¨è®­ç»ƒæ•°æ®è®­ç»ƒæ¨¡å‹

# ä½¿ç”¨äº¤å‰éªŒè¯è¯„ä¼°æ¨¡å‹
model = LogisticRegression(C=10)
scores = cross_val_score(model, X_train, y_train, cv=4)  # è¿›è¡Œ 4 æŠ˜äº¤å‰éªŒè¯
print(scores)  # æ‰“å°äº¤å‰éªŒè¯åˆ†æ•°
```

äº¤å‰éªŒè¯æœ‰åŠ©äºé¿å…è¿‡æ‹Ÿåˆï¼Œå¹¶æä¾›æ›´ç¨³å¥çš„æ¨¡å‹ã€‚

## æ€»ç»“ ğŸ“

-   æˆ‘ä»¬ä½¿ç”¨ `statsmodels` å’Œ `scikit-learn` å°† pandas æ•°æ®æ•´ç†å’Œæ¨¡å‹æ„å»ºè”ç³»èµ·æ¥ã€‚
-   ä½¿ç”¨ `.to_numpy()` å°† DataFrame è½¬æ¢ä¸º NumPy æ•°ç»„ã€‚
-   Patsy ä¸ºæ¨¡å‹æä¾›äº†ä¸€ç§å…¬å¼è¯­æ³•ã€‚
-   `statsmodels` æ“…é•¿ç»Ÿè®¡æ¨æ–­ã€‚
-   `scikit-learn` å¯¹äºè®¸å¤šæœºå™¨å­¦ä¹ ä»»åŠ¡å…·æœ‰é€šç”¨æ€§ã€‚

## æ€è€ƒä¸è®¨è®º ğŸ—£ï¸

-   å¦‚ä½•åœ¨ `statsmodels` å’Œ `scikit-learn` ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼Ÿè€ƒè™‘æ¨æ–­ä¸é¢„æµ‹ã€‚
-   å¦‚ä½•åœ¨æ³°å¦å°¼å…‹å·ç¤ºä¾‹ä¸­æ”¹è¿›ç‰¹å¾ï¼Ÿ
-   å…¶ä»– Python å»ºæ¨¡åº“ï¼ˆTensorFlowã€PyTorchã€XGBoostï¼‰ï¼Ÿ
-   è¿™ä¸æ‚¨çš„é¡¹ç›®æœ‰ä½•å…³ç³»ï¼Ÿ
-   æ•°æ®åˆ†æå°†å¦‚ä½•å‘å±•ï¼Ÿ

