<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pythonæ•°æ®åˆ†æ ğŸ</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../https://assets.qiufei.site/personal/profile.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-681fbf911679f9b3dbf9743eb275ba49.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-7e49aeac8059a213a463aa1a739e8272.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="https://assets.qiufei.site/setup/styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io"> 
<span class="menu-text">é¦–é¡µ</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io/web-slide"> 
<span class="menu-text">è¯¾ä»¶</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">ç®€ä»‹</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">pythonæ•°æ®åˆ†æ ğŸ</h1>
<p class="subtitle lead">æ•°æ®åˆ†æç¤ºä¾‹</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="ç¬¬-13-ç« ---æ•°æ®åˆ†æç¤ºä¾‹" class="level2">
<h2 class="anchored" data-anchor-id="ç¬¬-13-ç« ---æ•°æ®åˆ†æç¤ºä¾‹">ç¬¬ 13 ç«  - æ•°æ®åˆ†æç¤ºä¾‹</h2>
<ul>
<li>æˆ‘ä»¬å·²ç»åˆ°è¾¾æœ€åä¸€ç« äº†ï¼ğŸ¥³</li>
<li>é‡ç‚¹ï¼šå°†æ•°æ®åˆ†ææŠ€æœ¯åº”ç”¨äºçœŸå®ä¸–ç•Œçš„æ•°æ®é›†ã€‚</li>
<li>ç›®æ ‡ï¼šä»åŸå§‹æ•°æ®ä¸­æå–æœ‰æ„ä¹‰çš„è§è§£ã€‚</li>
<li>æ¼”ç¤ºçš„æŠ€æœ¯å…·æœ‰å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚</li>
<li>æ•°æ®é›†å¯åœ¨æœ¬ä¹¦çš„ GitHub/Gitee å­˜å‚¨åº“ä¸­æ‰¾åˆ°ã€‚</li>
</ul>
<p><img src="chapter13_introduction.png" class="img-fluid"></p>
</section>
<section id="æ•°æ®æŒ–æ˜æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ " class="level2">
<h2 class="anchored" data-anchor-id="æ•°æ®æŒ–æ˜æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ ">æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ </h2>
<ul>
<li>æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦ä¹ æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ï¼šä»æ•°æ®ä¸­æå–æœ‰ä»·å€¼çš„è§è§£å¹¶åšå‡ºé¢„æµ‹ã€‚</li>
<li>æ ¸å¿ƒåŒºåˆ«åœ¨äºå®ƒä»¬å®ç°è¿™ä¸€ç›®æ ‡çš„<em>æ–¹å¼</em>ã€‚</li>
</ul>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
    A[æ•°æ®æŒ–æ˜] --&gt; C(å…±åŒç‚¹: æ´å¯Ÿä¸é¢„æµ‹)
    B[æœºå™¨å­¦ä¹ ] --&gt; C
    D[ç»Ÿè®¡å­¦ä¹ ] --&gt; C
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="æ•°æ®æŒ–æ˜" class="level2">
<h2 class="anchored" data-anchor-id="æ•°æ®æŒ–æ˜">æ•°æ®æŒ–æ˜ â›ï¸</h2>
<ul>
<li><strong>å®šä¹‰ï¼š</strong> åœ¨å¤§å‹æ•°æ®é›†ä¸­å‘ç°æ¨¡å¼ã€å¼‚å¸¸å’Œå…³ç³»ï¼Œä»¥é¢„æµ‹ç»“æœã€‚</li>
<li><strong>é‡ç‚¹ï¼š</strong> å‘ç°ä»¥å‰<em>æœªçŸ¥</em>çš„æ¨¡å¼ã€‚æ¢ç´¢å’Œå‘ç°ï¼</li>
<li><strong>æŠ€æœ¯ï¼š</strong> ç»“åˆäº†æœºå™¨å­¦ä¹ ã€ç»Ÿè®¡å­¦å’Œæ•°æ®åº“ç³»ç»Ÿçš„æ–¹æ³•ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> ä¸€å®¶è¶…å¸‚å‘ç°è´­ä¹°å°¿å¸ƒ ğŸ§· çš„é¡¾å®¢é€šå¸¸ä¹Ÿä¼šè´­ä¹°å•¤é…’ ğŸºã€‚ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„å…³è”ï¼</li>
</ul>
<p><img src="datamining.png" class="img-fluid"></p>
</section>
<section id="æœºå™¨å­¦ä¹ " class="level2">
<h2 class="anchored" data-anchor-id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹  ğŸ¤–</h2>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šç®—æ³•é€šè¿‡ç»éªŒï¼ˆæ•°æ®ï¼‰è‡ªåŠ¨æ”¹è¿›ã€‚ä¾§é‡äºé¢„æµ‹å’Œå†³ç­–ã€‚</li>
<li><strong>é‡ç‚¹</strong>ï¼šç³»ç»Ÿæ ¹æ®æ•°æ®<em>å­¦ä¹ å’Œåšå‡ºå†³ç­–</em>ï¼Œæ— éœ€æ˜ç¡®çš„è§„åˆ™ã€‚</li>
<li><strong>ç±»å‹</strong>ï¼š
<ul>
<li><strong>ç›‘ç£å­¦ä¹ </strong>ï¼šåœ¨æ ‡è®°æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼ˆä¾‹å¦‚ï¼Œåƒåœ¾é‚®ä»¶/éåƒåœ¾é‚®ä»¶åˆ†ç±» ğŸ“§ï¼‰ã€‚</li>
<li><strong>æ— ç›‘ç£å­¦ä¹ </strong>ï¼šåœ¨æœªæ ‡è®°æ•°æ®ä¸­å‘ç°éšè—ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œå®¢æˆ·ç»†åˆ† ğŸ‘¥ï¼‰ã€‚</li>
<li><strong>å¼ºåŒ–å­¦ä¹ </strong>ï¼šæ™ºèƒ½ä½“é€šè¿‡ä¸ç¯å¢ƒäº¤äº’æ¥åšå‡ºå†³ç­–ï¼ˆä¾‹å¦‚ï¼Œæœºå™¨äººå­¦ä¹ è¡Œèµ° ğŸš¶ï¼‰ã€‚</li>
</ul></li>
<li><strong>ç¤ºä¾‹</strong>ï¼šæ ¹æ®å¤§å°ã€ä½ç½®å’Œå§å®¤ç­‰ç‰¹å¾é¢„æµ‹æˆ¿ä»· ğŸ ã€‚ç®—æ³•å­¦ä¹ è¿™ç§å…³ç³»ã€‚</li>
</ul>
<p><img src="machinelearning.png" class="img-fluid"></p>
</section>
<section id="ç»Ÿè®¡å­¦ä¹ " class="level2">
<h2 class="anchored" data-anchor-id="ç»Ÿè®¡å­¦ä¹ ">ç»Ÿè®¡å­¦ä¹  ğŸ“Š</h2>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šç”¨äºå»ºæ¨¡å’Œç†è§£å¤æ‚æ•°æ®é›†çš„å·¥å…·ã€‚ä¸€ä¸ªå°†ç»Ÿè®¡æ–¹æ³•åº”ç”¨äºä»æ•°æ®ä¸­å­¦ä¹ çš„æ¡†æ¶ã€‚</li>
<li><strong>é‡ç‚¹</strong>ï¼šå¼ºè°ƒ<em>æ¨¡å‹åŠå…¶å¯è§£é‡Šæ€§</em>ã€ç²¾ç¡®æ€§å’Œä¸ç¡®å®šæ€§ã€‚è¿æ¥ç»Ÿè®¡å­¦å’Œæœºå™¨å­¦ä¹ ã€‚</li>
<li><strong>å…³é”®æ¦‚å¿µ</strong>ï¼š
<ul>
<li><strong>åå·®-æ–¹å·®æƒè¡¡</strong>ï¼šå¹³è¡¡è¿‘ä¼¼è¯¯å·®ï¼ˆåå·®ï¼‰å’Œå¯¹è®­ç»ƒæ•°æ®çš„æ•æ„Ÿæ€§ï¼ˆæ–¹å·®ï¼‰ã€‚</li>
<li><strong>æ¨¡å‹é€‰æ‹©</strong>ï¼šé€‰æ‹©æœ€ä½³æ¨¡å‹ã€‚</li>
<li><strong>æ­£åˆ™åŒ–</strong>ï¼šé€šè¿‡æƒ©ç½šå¤æ‚æ€§æ¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</li>
</ul></li>
<li><strong>ç¤ºä¾‹</strong>ï¼šä½¿ç”¨çº¿æ€§å›å½’æ¥ç†è§£å¹¿å‘Šæ”¯å‡º ğŸ“ˆ å’Œé”€å”®é¢ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶å¸¦æœ‰ç½®ä¿¡åŒºé—´ã€‚</li>
</ul>
<p><img src="statisticallearning.png" class="img-fluid"></p>
</section>
<section id="æ¥è‡ª-1.usa.gov-çš„-bitly-æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="æ¥è‡ª-1.usa.gov-çš„-bitly-æ•°æ®">13.1 æ¥è‡ª 1.USA.gov çš„ Bitly æ•°æ®</h2>
<ul>
<li><strong>èƒŒæ™¯ï¼š</strong>
<ul>
<li>Bitlyï¼ˆURL ç¼©çŸ­æœåŠ¡ï¼‰å’Œ USA.gov äº 2011 å¹´åˆä½œã€‚</li>
<li>æ¥è‡ªç¼©çŸ­ .gov æˆ– .mil é“¾æ¥çš„ç”¨æˆ·çš„åŒ¿åæ•°æ®ã€‚</li>
<li>æ¯å°æ—¶å¿«ç…§ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰ã€‚</li>
<li>æœåŠ¡å·²åœæ­¢ï¼Œä½†æ•°æ®å·²ä¿ç•™ã€‚</li>
</ul></li>
<li><strong>æ•°æ®æ ¼å¼ï¼š</strong>
<ul>
<li>æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ª JSONï¼ˆJavaScript å¯¹è±¡è¡¨ç¤ºæ³•ï¼‰å¯¹è±¡ã€‚</li>
<li>JSON æ˜¯äººç±»å¯è¯»çš„ã€‚</li>
</ul></li>
</ul>
<p><img src="bitly_data_intro.png" class="img-fluid"></p>
</section>
<section id="json-æ•°æ®ç¤ºä¾‹" class="level2">
<h2 class="anchored" data-anchor-id="json-æ•°æ®ç¤ºä¾‹">JSON æ•°æ®ç¤ºä¾‹</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"a"</span><span class="fu">:</span> <span class="st">"Mozilla</span><span class="ch">\/</span><span class="st">5.0 (Windows NT 6.1; WOW64) AppleWebKit</span><span class="ch">\/</span><span class="st">535.11 (KHTML, like Gecko) Chrome</span><span class="ch">\/</span><span class="st">17.0.963.78 Safari</span><span class="ch">\/</span><span class="st">535.11"</span><span class="fu">,</span> <span class="dt">"c"</span><span class="fu">:</span> <span class="st">"US"</span><span class="fu">,</span> <span class="dt">"nk"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span> <span class="dt">"tz"</span><span class="fu">:</span> <span class="st">"America</span><span class="ch">\/</span><span class="st">New_York"</span><span class="fu">,</span> <span class="dt">"gr"</span><span class="fu">:</span> <span class="st">"MA"</span><span class="fu">,</span> <span class="dt">"g"</span><span class="fu">:</span> <span class="st">"A6q0VH"</span><span class="fu">,</span> <span class="dt">"h"</span><span class="fu">:</span> <span class="st">"wfLQtf"</span><span class="fu">,</span> <span class="dt">"l"</span><span class="fu">:</span> <span class="st">"orofrog"</span><span class="fu">,</span> <span class="dt">"al"</span><span class="fu">:</span> <span class="st">"en-US,en;q=0.8"</span><span class="fu">,</span> <span class="dt">"hh"</span><span class="fu">:</span> <span class="st">"1.usa.gov"</span><span class="fu">,</span> <span class="dt">"r"</span><span class="fu">:</span> <span class="st">"http:</span><span class="ch">\/\/</span><span class="st">www.facebook.com</span><span class="ch">\/</span><span class="st">l</span><span class="ch">\/</span><span class="st">7AQEFzjSi</span><span class="ch">\/</span><span class="st">1.usa.gov</span><span class="ch">\/</span><span class="st">wfLQtf"</span><span class="fu">,</span> <span class="dt">"u"</span><span class="fu">:</span> <span class="st">"http:</span><span class="ch">\/\/</span><span class="st">www.ncbi.nlm.nih.gov</span><span class="ch">\/</span><span class="st">pubmed</span><span class="ch">\/</span><span class="st">22415991"</span><span class="fu">,</span> <span class="dt">"t"</span><span class="fu">:</span> <span class="dv">1331923247</span><span class="fu">,</span> <span class="dt">"hc"</span><span class="fu">:</span> <span class="dv">1331822918</span><span class="fu">,</span> <span class="dt">"cy"</span><span class="fu">:</span> <span class="st">"Danvers"</span><span class="fu">,</span> <span class="dt">"ll"</span><span class="fu">:</span> <span class="ot">[</span> <span class="fl">42.576698</span><span class="ot">,</span> <span class="fl">-70.954903</span> <span class="ot">]</span> <span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>ç»“æ„ï¼š</strong> JSON å¯¹è±¡ä½äºå¤§æ‹¬å· <code>{}</code> ä¸­ã€‚</li>
<li><strong>é”®å€¼å¯¹ï¼š</strong> æ•°æ®ä»¥é”®å€¼å¯¹å½¢å¼å­˜åœ¨ï¼ˆä¾‹å¦‚ï¼Œ<code>"a": "Mozilla/..."</code>ï¼‰ã€‚</li>
<li><strong>æ•°æ®ç±»å‹ï¼š</strong> å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ï¼ˆå¦‚ <code>"ll"</code>ï¼‰æˆ–å…¶ä»– JSON å¯¹è±¡ã€‚</li>
<li>**<code>{python} å’Œ JSON**:</code>{python} çš„ <code>json</code> åº“å¯ä»¥è½»æ¾åœ°å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º ```{python} å­—å…¸ã€‚</li>
</ul>
</section>
<section id="åœ¨-python-ä¸­è¯»å–-json-æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="åœ¨-python-ä¸­è¯»å–-json-æ•°æ®">åœ¨ ```{python} ä¸­è¯»å– JSON æ•°æ®</h2>
<p>import json # å¯¼å…¥ json åº“</p>
<p>path = â€œdatasets/bitly_usagov/example.txtâ€ # æ–‡ä»¶è·¯å¾„</p>
<p>with open(path) as f: # æ‰“å¼€æ–‡ä»¶ records = [json.loads(line) for line in f] # åˆ—è¡¨æ¨å¯¼å¼ï¼šé€è¡Œè¯»å–å¹¶è§£æ JSON</p>
<p>print(records[0]) # æ‰“å°ç¬¬ä¸€æ¡è®°å½•ï¼ˆä¸€ä¸ªå­—å…¸ï¼‰</p>
<pre><code>
-   **`import json`**: å¯¼å…¥ JSON åº“ã€‚
-   **`open(path)`**: æ‰“å¼€æ–‡ä»¶ã€‚
-   **`json.loads(line)`**: å°† JSON è¡Œè§£æä¸º ```{python} å­—å…¸ã€‚
-   **åˆ—è¡¨æ¨å¯¼å¼**: `[... for line in f]` åˆ›å»ºä¸€ä¸ªå­—å…¸åˆ—è¡¨ã€‚
-   **`records`**: ç°åœ¨æ˜¯ä¸€ä¸ª ```{python} å­—å…¸çš„åˆ—è¡¨ã€‚

## è®¿é—®å­—å…¸ä¸­çš„æ•°æ®

print(records[0]['tz'])  # è®¿é—® 'tz'ï¼ˆæ—¶åŒºï¼‰å­—æ®µ</code></pre>
<ul>
<li>ä½¿ç”¨å­—å…¸é”®è®¿é—®ï¼ˆæ–¹æ‹¬å·ï¼‰æ¥è·å–å€¼ã€‚</li>
<li><code>records[0]</code> è·å–ç¬¬ä¸€ä¸ªå­—å…¸ã€‚</li>
<li><code>['tz']</code> è®¿é—®é”® â€œtzâ€ å¯¹åº”çš„å€¼ã€‚</li>
</ul>
</section>
<section id="ç»Ÿè®¡æ—¶åŒºçº¯-python" class="level2">
<h2 class="anchored" data-anchor-id="ç»Ÿè®¡æ—¶åŒºçº¯-python">ç»Ÿè®¡æ—¶åŒºï¼ˆçº¯ ```{python}ï¼‰</h2>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> æ‰¾åˆ°æœ€å¸¸è§çš„æ—¶åŒºï¼ˆ<code>tz</code> å­—æ®µï¼‰ã€‚</li>
<li><strong>æ–¹æ³• 1ï¼šå­—å…¸å’Œå¾ªç¯</strong>ï¼ˆåŸºæœ¬ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼‰</li>
</ul>
</section>
<section id="åŸå§‹å¹»ç¯ç‰‡ä¸­æœªæ˜¾ç¤ºä½†è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¯”è¾ƒ" class="level1">
<h1>åŸå§‹å¹»ç¯ç‰‡ä¸­æœªæ˜¾ç¤ºï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¯”è¾ƒ</h1>
<p>def get_counts(sequence): counts = {} # åˆå§‹åŒ–ä¸€ä¸ªç©ºå­—å…¸æ¥å­˜å‚¨è®¡æ•° for x in sequence: # éå†åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´  if x in counts: # å¦‚æœå…ƒç´ å·²å­˜åœ¨äºå­—å…¸ä¸­ counts[x] += 1 # è®¡æ•°åŠ  1 else: # å¦‚æœå…ƒç´ ä¸å­˜åœ¨äºå­—å…¸ä¸­ counts[x] = 1 # å°†å…ƒç´ æ·»åŠ åˆ°å­—å…¸ï¼Œå¹¶å°†è®¡æ•°è®¾ç½®ä¸º 1 return counts # è¿”å›è®¡æ•°ç»“æœ</p>
<pre><code>
- **æ–¹æ³• 2ï¼š`defaultdict`**ï¼ˆæ›´é«˜æ•ˆä¸”æ›´ ```{python}icï¼‰

``````{python}
from collections import defaultdict  # å¯¼å…¥ defaultdict

def get_counts2(sequence):
    counts = defaultdict(int)  # ä½¿ç”¨ defaultdictï¼Œé»˜è®¤å€¼ä¸º 0
    for x in sequence:  # éå†åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ 
        counts[x] += 1  # è‡ªåŠ¨å¤„ç†é”®ä¸å­˜åœ¨çš„æƒ…å†µï¼Œç›´æ¥åŠ  1
    return counts  #è¿”å›è®¡æ•°ç»“æœ</code></pre>
<ul>
<li><strong><code>defaultdict(int)</code></strong>: å¦‚æœæ‰¾ä¸åˆ°é”®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ 0 æ·»åŠ å®ƒã€‚é¿å…äº† <code>if x in counts</code> æ£€æŸ¥ã€‚</li>
</ul>
<section id="ç»Ÿè®¡æ—¶åŒºçº¯-python--å¤„ç†ç¼ºå¤±çš„é”®" class="level2">
<h2 class="anchored" data-anchor-id="ç»Ÿè®¡æ—¶åŒºçº¯-python--å¤„ç†ç¼ºå¤±çš„é”®">ç»Ÿè®¡æ—¶åŒºï¼ˆçº¯ ```{python}ï¼‰- å¤„ç†ç¼ºå¤±çš„é”®</h2>
<p>``````goylqeae #åŸå§‹ä»£ç  (ä¼šå¯¼è‡´ KeyError) # time_zones = [rec[â€œtzâ€] for rec in records]</p>
<p>#ä½¿ç”¨ if æ¡ä»¶è¿›è¡Œæ›´æ­£ time_zones = [rec[â€œtzâ€] for rec in records if â€œtzâ€ in rec] # åˆ—è¡¨æ¨å¯¼å¼,å¦‚æœå­—å…¸ä¸­æœ‰â€™tzâ€™é”®ï¼Œåˆ™æ·»åŠ åˆ°åˆ—è¡¨ä¸­ print(time_zones[:10]) #æ‰“å°å‰10ä¸ªæ—¶åŒº</p>
<pre><code>
-   **`KeyError` è§£é‡Š**: å¦‚æœè®°å½•*æ²¡æœ‰* 'tz' é”®ï¼Œåˆ™è®¿é—® `rec["tz"]` ä¼šå¼•å‘ `KeyError`ã€‚
-   **è§£å†³æ–¹æ¡ˆ**:  `if "tz" in rec` åœ¨è®¿é—®ä¹‹å‰æ£€æŸ¥é”®æ˜¯å¦*å­˜åœ¨*ã€‚è¿™å¯ä»¥é˜²æ­¢é”™è¯¯ã€‚

## ç»Ÿè®¡æ—¶åŒºï¼ˆçº¯ ```{python}ï¼‰- è·å– Top è®¡æ•°

``````{python}
def top_counts(count_dict, n=10):
    #å°†å­—å…¸è½¬æ¢ä¸º(å€¼ï¼Œé”®)å¯¹çš„åˆ—è¡¨
    value_key_pairs = [(count, tz) for tz, count in count_dict.items()]
    value_key_pairs.sort() #å¯¹åˆ—è¡¨è¿›è¡Œæ’åº
    return value_key_pairs[-n:]  # è¿”å›æœ€å n ä¸ªå…ƒç´ ï¼ˆå³æœ€å¤§çš„ n ä¸ªï¼‰

# ä½¿ç”¨ Counter ç±»ï¼ˆæœ€é«˜æ•ˆä¸”æœ€ ```{python}icï¼‰
from collections import Counter  # å¯¼å…¥ Counter ç±»
counts = Counter(time_zones)  # ä½¿ç”¨ Counter ç»Ÿè®¡æ—¶åŒº
print(counts.most_common(10))  # ç›´æ¥è·å–å‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰ 10 ä¸ªæ—¶åŒº</code></pre>
<ul>
<li><strong><code>top_counts</code> å‡½æ•°:</strong> è·å–å‡ºç°æ¬¡æ•°æœ€å¤šçš„ <em>n</em> ä¸ªé¡¹ç›®ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰ã€‚</li>
<li><strong><code>Counter</code> ç±»:</strong> ç»Ÿè®¡é¡¹ç›®å‡ºç°æ¬¡æ•°çš„<em>æœ€ä½³</em>æ–¹å¼ã€‚<code>most_common(10)</code> ç›´æ¥è¿”å›å‰ 10 ä¸ªã€‚</li>
</ul>
</section>
<section id="ç»Ÿè®¡æ—¶åŒº-pandas" class="level2">
<h2 class="anchored" data-anchor-id="ç»Ÿè®¡æ—¶åŒº-pandas">ç»Ÿè®¡æ—¶åŒº (pandas) ğŸ¼</h2>
<ul>
<li><strong>pandas DataFrame:</strong> ä¸€ç§æ›´å¼ºå¤§ã€æ›´æ–¹ä¾¿çš„å¤„ç†è¡¨æ ¼æ•°æ®çš„æ–¹å¼ã€‚</li>
</ul>
<p>``````goylqeae import pandas as pd # å¯¼å…¥ pandas</p>
<p>frame = pd.DataFrame(records) # ä»å­—å…¸åˆ—è¡¨åˆ›å»º DataFrame print(frame.info()) # æ˜¾ç¤º DataFrame çš„æ‘˜è¦ä¿¡æ¯</p>
<pre><code>
-   **`pd.DataFrame(records)`**:  å°†å­—å…¸åˆ—è¡¨è½¬æ¢ä¸º DataFrameã€‚pandas ä¼šè‡ªåŠ¨æ¨æ–­åˆ—åå’Œç±»å‹ã€‚
-   **`frame.info()`**:  æä¾›ï¼š
    -   è¡Œæ•°å’Œåˆ—æ•°ã€‚
    -   åˆ—åå’Œæ•°æ®ç±»å‹ã€‚
    -   éç©ºå€¼è®¡æ•°ï¼ˆæ˜¾ç¤ºç¼ºå¤±æ•°æ®ï¼‰ã€‚
    -   å†…å­˜ä½¿ç”¨æƒ…å†µã€‚

## `frame.info()` è¾“å‡ºè§£é‡Š
</code></pre>
<p>&lt;class â€˜pandas.core.frame.DataFrameâ€™&gt; RangeIndex: 3560 entries, 0 to 3559 Data columns (total 18 columns): # Column Non-Null Count Dtype â€” â€”â€” â€”â€”â€”â€”â€“ â€”â€“ 0 a 3440 non-null object 1 c 2919 non-null object â€¦ 16 <em>heartbeat</em> 120 non-null float64 17 kw 93 non-null object dtypes: float64(4), object(14) memory usage: 500.8+ KB</p>
<pre><code>
-   **`RangeIndex`**:  æ€»è¡Œæ•° (3560) å’Œç´¢å¼•èŒƒå›´ (0 to 3559)ã€‚
-   **`Data columns`**:  æ¯åˆ—ã€éç©ºè®¡æ•°å’Œæ•°æ®ç±»å‹ã€‚
    -   `object`: é€šå¸¸æ˜¯æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚
    -   `float64`: æµ®ç‚¹æ•°ã€‚
    -   `int64`: æ•´æ•°ã€‚
-   **`Non-Null Count`**:  çªå‡ºæ˜¾ç¤ºç¼ºå¤±å€¼ï¼ˆä¾‹å¦‚ï¼Œ`c` æœ‰ 641 ä¸ªç¼ºå¤±å€¼ï¼‰ã€‚
- `dtypes` and `memory usage`: æ±‡æ€»ä¿¡æ¯.

## ä½¿ç”¨ pandas å¤„ç†æ—¶åŒº

``````{python}
print(frame['tz'].head())  # æ˜¾ç¤ºå‰å‡ ä¸ªæ—¶åŒº

tz_counts = frame['tz'].value_counts()  # ç»Ÿè®¡æ¯ä¸ªæ—¶åŒºå‡ºç°çš„æ¬¡æ•°
print(tz_counts.head())  # æ˜¾ç¤ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰å‡ ä¸ªæ—¶åŒº</code></pre>
<ul>
<li><strong><code>frame['tz']</code></strong>: é€‰æ‹© â€˜tzâ€™ åˆ—ï¼ˆä¸€ä¸ª pandas Seriesï¼‰ã€‚</li>
<li><strong><code>.head()</code></strong>: æ˜¾ç¤ºå‰ 5 è¡Œã€‚</li>
<li><strong><code>.value_counts()</code></strong>: ç»Ÿè®¡æ¯ä¸ªå”¯ä¸€å€¼å‡ºç°çš„æ¬¡æ•°ã€‚æ¯”çº¯ ```{python} <em>ç®€å•å¾—å¤š</em>ï¼</li>
</ul>
</section>
<section id="åœ¨-pandas-ä¸­å¤„ç†ç¼ºå¤±æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="åœ¨-pandas-ä¸­å¤„ç†ç¼ºå¤±æ•°æ®">åœ¨ pandas ä¸­å¤„ç†ç¼ºå¤±æ•°æ®</h2>
<p>```<code>goylqeae clean_tz = frame['tz'].fillna('Missing')  # å°† NaN æ›¿æ¢ä¸º "Missing" clean_tz[clean_tz == ''] = 'Unknown'      # å°†ç©ºå­—ç¬¦ä¸²æ›¿æ¢ä¸º "Unknown" tz_counts = clean_tz.value_counts()  # é‡æ–°ç»Ÿè®¡æ—¶åŒº print(tz_counts.head())  # æ˜¾ç¤ºå¤„ç†åçš„ç»“æœ</code></p>
<ul>
<li><strong><code>.fillna('Missing')</code></strong>: å°†ç¼ºå¤±å€¼ï¼ˆpandas ä¸­çš„ <code>NaN</code>ï¼‰æ›¿æ¢ä¸º â€œMissingâ€ã€‚</li>
<li><strong><code>clean_tz[clean_tz == ''] = 'Unknown'</code></strong>: å°†ç©ºå­—ç¬¦ä¸²æ›¿æ¢ä¸º â€œUnknownâ€ï¼ˆå¸ƒå°”ç´¢å¼•ï¼‰ã€‚</li>
</ul>
</section>
<section id="ä½¿ç”¨-seaborn-è¿›è¡Œå¯è§†åŒ–" class="level2">
<h2 class="anchored" data-anchor-id="ä½¿ç”¨-seaborn-è¿›è¡Œå¯è§†åŒ–">ä½¿ç”¨ seaborn è¿›è¡Œå¯è§†åŒ– ğŸ“Š</h2>
<p>``````goylqeae import seaborn as sns # å¯¼å…¥ seaborn import matplotlib.pyplot as plt #å¯¼å…¥matplotlib</p>
<p>subset = tz_counts.head() # è·å–å‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰å‡ ä¸ªæ—¶åŒº sns.barplot(y=subset.index, x=subset.to_numpy()) # åˆ›å»ºæ°´å¹³æ¡å½¢å›¾ plt.show() # æ˜¾ç¤ºå›¾å½¢</p>
<pre><code>
-   **`import seaborn as sns`**: å¯¼å…¥ seabornï¼ˆåŸºäº matplotlib æ„å»ºï¼‰ã€‚
-   **`subset = tz_counts.head()`**: ä½¿ç”¨å‰å‡ ä¸ªæ—¶åŒºä»¥è·å¾—æ›´æ¸…æ™°çš„å¯è§†åŒ–æ•ˆæœ.
-   **`sns.barplot(...)`**:  åˆ›å»ºæ°´å¹³æ¡å½¢å›¾ã€‚
    -   `y=subset.index`: y è½´ä¸Šæ˜¯æ—¶åŒºåç§°ã€‚
    -   `x=subset.to_numpy()`: x è½´ä¸Šæ˜¯è®¡æ•°ã€‚å°† Series è½¬æ¢ä¸º numpy æ•°ç»„ã€‚
- **`plt.show()`**: æ˜¾ç¤ºç»˜å›¾ã€‚

!['1.usa.gov æ ·æœ¬æ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ—¶åŒº'](time_zone_barplot.png)

## åˆ†ææµè§ˆå™¨/ä»£ç†ä¿¡æ¯ ğŸŒ

``````{python}
print(frame['a'][1])  # æ‰“å°ç¬¬ 2 æ¡è®°å½•çš„ 'a' å­—æ®µ
print(frame['a'][50])  # æ‰“å°ç¬¬ 51 æ¡è®°å½•çš„ 'a' å­—æ®µ
print(frame['a'][51][:50])  # æ‰“å°ç¬¬ 52 æ¡è®°å½•çš„ 'a' å­—æ®µçš„å‰ 50 ä¸ªå­—ç¬¦

results = pd.Series([x.split()[0] for x in frame['a'].dropna()])  # è·å–ä¸»è¦æµè§ˆå™¨ä¿¡æ¯
print(results.head())  # æ˜¾ç¤ºå‰å‡ æ¡ç»“æœ
print(results.value_counts().head(8))  # ç»Ÿè®¡å¹¶æ˜¾ç¤ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰ 8 ä¸ªæµè§ˆå™¨</code></pre>
<ul>
<li><code>a</code> å­—æ®µåŒ…å«æµè§ˆå™¨/è®¾å¤‡/åº”ç”¨ç¨‹åºä¿¡æ¯ã€‚</li>
<li><strong><code>frame['a'][1]</code> ,etc.</strong>: è®¿é—®ç‰¹å®šçš„ä»£ç†å­—ç¬¦ä¸²ã€‚</li>
<li><strong><code>.dropna()</code></strong>: åœ¨æ‹†åˆ†ä¹‹å‰åˆ é™¤ç¼ºå°‘ â€˜aâ€™ å€¼çš„è¡Œã€‚</li>
<li><strong><code>x.split()[0]</code></strong>: æŒ‰ç©ºæ ¼æ‹†åˆ†ï¼Œå–<em>ç¬¬ä¸€ä¸ª</em>å…ƒç´ ï¼ˆä¸»è¦æµè§ˆå™¨ IDï¼‰ã€‚</li>
<li><strong><code>pd.Series(...)</code></strong>: ä»æ‹†åˆ†åçš„å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ª Seriesã€‚</li>
<li><strong><code>results.value_counts().head(8)</code></strong>: ç»Ÿè®¡å¹¶æ˜¾ç¤ºå‰ 8 ä¸ªã€‚</li>
</ul>
</section>
<section id="windows-ä¸é-windows-ç”¨æˆ·" class="level2">
<h2 class="anchored" data-anchor-id="windows-ä¸é-windows-ç”¨æˆ·">Windows ä¸é Windows ç”¨æˆ· ğŸ’»</h2>
<p>``````goylqeae import numpy as np # å¯¼å…¥ numpy</p>
<p>cframe = frame[frame[â€˜aâ€™].notna()].copy() # åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶æ’é™¤â€™aâ€™åˆ—ä¸ºç©ºçš„è¡Œ cframe[â€˜osâ€™] = np.where(cframe[â€˜aâ€™].str.contains(â€˜Windowsâ€™), # åˆ›å»ºæ–°åˆ— â€˜osâ€™ â€˜Windowsâ€™, â€˜Not Windowsâ€™) # å¦‚æœ â€˜aâ€™ åŒ…å« â€˜Windowsâ€™ï¼Œåˆ™ä¸º â€˜Windowsâ€™ï¼Œå¦åˆ™ä¸º â€˜Not Windowsâ€™ print(cframe[â€˜osâ€™].head()) # æ˜¾ç¤ºå‰å‡ è¡Œ â€˜osâ€™ åˆ—</p>
<pre><code>
-   **ç›®æ ‡ï¼š** åˆ†åˆ«åˆ†æ Windows/é Windows ç”¨æˆ·çš„æ—¶åŒºã€‚
-   **`cframe = frame[frame['a'].notna()].copy()`**:  åˆ›å»ºä¸€ä¸ª*å‰¯æœ¬*ï¼Œè¿‡æ»¤æ‰ç¼ºå¤±çš„ 'a' å€¼ã€‚`.copy()` å¯é¿å…è­¦å‘Šã€‚
-   **`cframe['a'].str.contains('Windows')`**:  æ£€æŸ¥ä»£ç†å­—ç¬¦ä¸²æ˜¯å¦åŒ…å« "Windows"ã€‚
-   **`np.where(...)`**: åˆ›å»ºä¸€ä¸ªæ–°çš„ 'os' åˆ—ï¼šå¦‚æœå­—ç¬¦ä¸²åŒ…å« "Windows"ï¼Œåˆ™ä¸º "Windows"ï¼Œå¦åˆ™ä¸º "Not Windows"ã€‚

## æŒ‰æ—¶åŒºå’Œæ“ä½œç³»ç»Ÿåˆ†ç»„

``````{python}
by_tz_os = cframe.groupby(['tz', 'os'])  # æŒ‰æ—¶åŒºå’Œæ“ä½œç³»ç»Ÿåˆ†ç»„
agg_counts = by_tz_os.size().unstack().fillna(0)  # åˆ†ç»„è®¡æ•°ï¼Œé‡å¡‘ï¼Œå¹¶å¡«å……ç¼ºå¤±å€¼ä¸º 0
print(agg_counts.head())  # æ˜¾ç¤ºåˆ†ç»„è®¡æ•°ç»“æœ</code></pre>
<ul>
<li><strong><code>cframe.groupby(['tz', 'os'])</code></strong>: æŒ‰æ—¶åŒº<em>å’Œ</em>æ“ä½œç³»ç»Ÿåˆ†ç»„ã€‚</li>
<li><strong><code>.size()</code></strong>: è®¡ç®—æ¯ä¸ªç»„ä¸­çš„è®°å½•æ•°ï¼ˆç±»ä¼¼äº <code>value_counts()</code>ï¼Œä½†ç”¨äºåˆ†ç»„ï¼‰ã€‚</li>
<li><strong><code>.unstack()</code></strong>: é‡å¡‘ã€‚å°† â€˜osâ€™ é€è§†ä¸ºåˆ—ï¼ˆæ›´æ˜“äºæ¯”è¾ƒï¼‰ã€‚</li>
<li><strong><code>.fillna(0)</code></strong>: å°†ç¼ºå¤±å€¼ï¼ˆåªæœ‰ä¸€ç§æ“ä½œç³»ç»Ÿçš„æ—¶åŒºï¼‰æ›¿æ¢ä¸º 0ã€‚</li>
</ul>
</section>
<section id="æ‰¾åˆ°æœ€å—æ¬¢è¿çš„æ—¶åŒº" class="level2">
<h2 class="anchored" data-anchor-id="æ‰¾åˆ°æœ€å—æ¬¢è¿çš„æ—¶åŒº">æ‰¾åˆ°æœ€å—æ¬¢è¿çš„æ—¶åŒº</h2>
<p>``````goylqeae # æ–¹æ³• 1: ä½¿ç”¨ argsort indexer = agg_counts.sum(axis=â€œcolumnsâ€).argsort() # è·å–æŒ‰æ€»æ•°æ’åºçš„ç´¢å¼• print(indexer.values[:10]) # æ˜¾ç¤ºæ’åºåçš„å‰ 10 ä¸ªç´¢å¼• count_subset = agg_counts.take(indexer[-10:]) # è·å–è®¡æ•°æœ€å¤šçš„æœ€å 10 è¡Œ print(count_subset) #æ‰“å°</p>
</section>
</section>
<section id="æ–¹æ³•-2-ä½¿ç”¨-nlargest-æ›´æ–¹ä¾¿" class="level1">
<h1>æ–¹æ³• 2: ä½¿ç”¨ nlargest (æ›´æ–¹ä¾¿)</h1>
<p>print(agg_counts.sum(axis=â€œcolumnsâ€).nlargest(10)) # ç›´æ¥è·å–æ€»æ•°æœ€å¤§çš„å‰ 10 è¡Œ</p>
<pre><code>
-   **ç›®æ ‡**ï¼šæ‰¾åˆ°æ€»æ•°*æœ€å¤š*çš„æ—¶åŒºã€‚

-   **`agg_counts.sum(axis="columns")`**: è®¡ç®—æ¯ä¸ªæ—¶åŒºçš„æ€»è®¡æ•°ã€‚

-   **`argsort()`**:  è¿”å›å°†å¯¹æ•°ç»„è¿›è¡Œæ’åºçš„*ç´¢å¼•*ï¼ˆä»æœ€å°‘åˆ°æœ€é¢‘ç¹ï¼‰ã€‚

-   **`.take(indexer[-10:])`**:  é€‰æ‹©å‰ 10 ä¸ªæ—¶åŒºçš„è¡Œã€‚

-   **`nlargest(10)`**:  è·å–å‰ 10 åçš„*æ›´ç›´æ¥*çš„æ–¹å¼ã€‚

## å¯è§†åŒ– Windows å’Œé Windows ç”¨æˆ·ï¼ˆåˆ†ç»„æ¡å½¢å›¾ï¼‰

``````{python}
# å‡†å¤‡æ•°æ®
count_subset = count_subset.stack()  # å°† 'os' åˆ—å †å å›ç´¢å¼•
count_subset.name = 'total'  # å°† Series å‘½åä¸º 'total'
count_subset = count_subset.reset_index()  # å°†ç´¢å¼•é‡ç½®ä¸ºæ™®é€šåˆ—
print(count_subset.head())  # æ˜¾ç¤ºå‡†å¤‡å¥½çš„æ•°æ®
sns.barplot(x='total', y='tz', hue='os', data=count_subset)  # åˆ›å»ºåˆ†ç»„æ¡å½¢å›¾
plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></pre>
<ul>
<li><strong><code>count_subset.stack()</code></strong>: å°† â€˜osâ€™ é‡æ–°é€è§†å›ç´¢å¼•ï¼ˆä¸ <code>unstack()</code> ç›¸åï¼‰ã€‚é€šå¸¸ç”¨äº seabornã€‚</li>
<li><strong><code>count_subset.name = 'total'</code></strong>: å°† Series å€¼å‘½åä¸º â€œtotalâ€ã€‚</li>
<li><strong><code>count_subset.reset_index()</code></strong>: å°†ç´¢å¼•è½¬æ¢ä¸ºå¸¸è§„åˆ—ï¼ˆç”¨äº seabornï¼‰ã€‚</li>
<li><strong><code>sns.barplot(...)</code></strong>: åˆ†ç»„æ¡å½¢å›¾ã€‚
<ul>
<li><code>x='total'</code>: x è½´ä¸Šæ˜¯è®¡æ•°ã€‚</li>
<li><code>y='tz'</code>: y è½´ä¸Šæ˜¯æ—¶åŒºã€‚</li>
<li><code>hue='os'</code>: ä¸º Windows/é Windows ç”¨æˆ·åˆ†åˆ«ç»˜åˆ¶æ¡å½¢ã€‚</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="windows_vs_notwindows.png" class="img-fluid figure-img"></p>
<figcaption>â€˜æŒ‰ Windows å’Œé Windows ç”¨æˆ·åˆ’åˆ†çš„çƒ­é—¨æ—¶åŒºâ€™</figcaption>
</figure>
</div>
<section id="æ ‡å‡†åŒ–è®¡æ•°æ¯”ä¾‹" class="level2">
<h2 class="anchored" data-anchor-id="æ ‡å‡†åŒ–è®¡æ•°æ¯”ä¾‹">æ ‡å‡†åŒ–è®¡æ•°ï¼ˆæ¯”ä¾‹ï¼‰</h2>
<p>``````goylqeae def norm_total(group): group[â€˜normed_totalâ€™] = group[â€˜totalâ€™] / group[â€˜totalâ€™].sum() # è®¡ç®—æ¯ä¸ªåˆ†ç»„å†…çš„æ¯”ä¾‹ return group</p>
<p>results = count_subset.groupby(â€˜tzâ€™).apply(norm_total) # æŒ‰æ—¶åŒºåº”ç”¨å‡½æ•° sns.barplot(x=â€˜normed_totalâ€™, y=â€˜tzâ€™, hue=â€˜osâ€™, data=results) # ä½¿ç”¨æ¯”ä¾‹åˆ›å»ºæ¡å½¢å›¾ plt.show() #æ˜¾ç¤ºç»˜å›¾</p>
<pre><code>
-   **ç›®æ ‡ï¼š** æ¯”è¾ƒæ¯ä¸ªæ—¶åŒºå†… Windows/é Windows ç”¨æˆ·çš„*æ¯”ä¾‹*ã€‚
-   **`norm_total(group)` å‡½æ•°ï¼š**
    -   è®¡ç®— `normed_total`ï¼šæ¯ä¸ªæ“ä½œç³»ç»Ÿçš„è®¡æ•°é™¤ä»¥è¯¥æ—¶åŒºçš„*æ€»*è®¡æ•°ï¼ˆæ¯”ä¾‹ï¼‰ã€‚
    -   è¿”å›ä¿®æ”¹åçš„åˆ†ç»„ã€‚
-   **`count_subset.groupby('tz').apply(norm_total)`**:  å°†å‡½æ•°åº”ç”¨äºæ¯ä¸ªæ—¶åŒºåˆ†ç»„ã€‚
-   **`sns.barplot(...)`**: ä½¿ç”¨ 'normed_total'ï¼ˆæ¯”ä¾‹ï¼‰çš„æ¡å½¢å›¾ - æ›´å®¹æ˜“æ¯”è¾ƒã€‚

!['çƒ­é—¨æ—¶åŒºä¸­ Windows å’Œé Windows ç”¨æˆ·çš„ç™¾åˆ†æ¯”'](normalized_plot.png)

## 13.2 MovieLens 1M æ•°æ®é›† ğŸ¬

-   **æ•°æ®é›†ï¼š** MovieLens 1M (GroupLens Research)ã€‚
-   **å†…å®¹ï¼š**
    -   100 ä¸‡æ¡è¯„åˆ†ã€‚
    -   çº¦ 6,000 åç”¨æˆ·ã€‚
    -   çº¦ 4,000 éƒ¨ç”µå½±ã€‚
-   **æ•°æ®æ ¼å¼ï¼š** ä¸‰ä¸ªè¡¨æ ¼ï¼š
    -   `users`: äººå£ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€èŒä¸šã€é‚®æ”¿ç¼–ç ï¼‰ã€‚
    -   `ratings`: ç”¨æˆ· IDã€ç”µå½± IDã€è¯„åˆ†ã€æ—¶é—´æˆ³ã€‚
    -   `movies`: ç”µå½±åç§°ã€ç±»å‹ã€‚
-   **ç›®æ ‡ï¼š** æ¢ç´¢è¯„åˆ†ã€äººå£ç»Ÿè®¡ä¿¡æ¯å’Œç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚

![](movielens_data_intro.png)

## åŠ è½½ MovieLens æ•°æ®

``````{python}
import pandas as pd

# å®šä¹‰åˆ—å
unames = ['user_id', 'gender', 'age', 'occupation', 'zip']
# è¯»å– users.dat æ–‡ä»¶
users = pd.read_table('datasets/movielens/users.dat', sep='::',
                      header=None, names=unames, engine='```{python}')

# å®šä¹‰åˆ—å
rnames = ['user_id', 'movie_id', 'rating', 'timestamp']
# è¯»å– ratings.dat æ–‡ä»¶
ratings = pd.read_table('datasets/movielens/ratings.dat', sep='::',
                        header=None, names=rnames, engine='```{python}')

# å®šä¹‰åˆ—å
mnames = ['movie_id', 'title', 'genres']
# è¯»å– movies.dat æ–‡ä»¶
movies = pd.read_table('datasets/movielens/movies.dat', sep='::',
                       header=None, names=mnames, engine='```{python}')</code></pre>
<ul>
<li><strong><code>pd.read_table</code> çš„å…³é”®å‚æ•°ï¼š</strong>
<ul>
<li><code>sep='::'</code>: åˆ†éš”ç¬¦æ˜¯ä¸¤ä¸ªå†’å·ã€‚</li>
<li><code>header=None</code>: æ²¡æœ‰æ ‡é¢˜è¡Œã€‚</li>
<li><code>names=unames</code> (etc.): æä¾›åˆ—åã€‚</li>
<li><code>engine='```{python}'</code>: ä½¿ç”¨ ```{python} å¼•æ“ï¼ˆæ”¯æŒå¤šå­—ç¬¦åˆ†éš”ç¬¦ï¼‰ã€‚</li>
</ul></li>
</ul>
</section>
<section id="åˆå¹¶-movielens-æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="åˆå¹¶-movielens-æ•°æ®">åˆå¹¶ MovieLens æ•°æ®</h2>
<p>```<code>goylqeae data = pd.merge(pd.merge(ratings, users), movies)  # åˆå¹¶ä¸‰ä¸ª DataFrame print(data.head())  # æ˜¾ç¤ºåˆå¹¶åçš„æ•°æ®çš„å‰å‡ è¡Œ print(data.iloc[0])  # è®¿é—®ç¬¬ä¸€è¡Œæ•°æ®</code></p>
<ul>
<li><strong><code>pd.merge()</code></strong>: åŸºäºå…¬å…±åˆ—åˆå¹¶ DataFrameã€‚pandas ä¼šè‡ªåŠ¨æ‰¾åˆ°å®ƒä»¬ã€‚</li>
<li><strong>ä¸¤æ¬¡åˆå¹¶ï¼š</strong>
<ol type="1">
<li><code>pd.merge(ratings, users)</code>: åŸºäº <code>user_id</code> åˆå¹¶ã€‚</li>
<li><code>pd.merge(..., movies)</code>: å°†ç»“æœä¸ <code>movies</code> åŸºäº <code>movie_id</code> åˆå¹¶ã€‚</li>
</ol></li>
<li><strong><code>data</code></strong>: å°†æ‰€æœ‰ä¿¡æ¯åŒ…å«åœ¨ä¸€ä¸ª DataFrame ä¸­ã€‚</li>
</ul>
</section>
<section id="æŒ‰æ€§åˆ«åˆ†æè¯„åˆ†" class="level2">
<h2 class="anchored" data-anchor-id="æŒ‰æ€§åˆ«åˆ†æè¯„åˆ†">æŒ‰æ€§åˆ«åˆ†æè¯„åˆ†</h2>
<p>```<code>goylqeae mean_ratings = data.pivot_table('rating', index='title',  # ä»¥ 'title' ä¸ºç´¢å¼•                                 columns='gender', aggfunc='mean')  # ä»¥ 'gender' ä¸ºåˆ—ï¼Œè®¡ç®—å¹³å‡ 'rating' print(mean_ratings.head())  # æ˜¾ç¤ºç»“æœ</code></p>
<ul>
<li><strong><code>data.pivot_table(...)</code></strong>: é‡å¡‘å’Œèšåˆã€‚
<ul>
<li><code>'rating'</code>: è¦èšåˆçš„å€¼ï¼ˆå¹³å‡è¯„åˆ†ï¼‰ã€‚</li>
<li><code>index='title'</code>: ç”µå½±åç§°æ˜¯è¡Œç´¢å¼•ã€‚</li>
<li><code>columns='gender'</code>: æ€§åˆ« (â€˜Mâ€™, â€˜Fâ€™) æˆä¸ºåˆ—ã€‚</li>
<li><code>aggfunc='mean'</code> (é»˜è®¤): è®¡ç®—å¹³å‡å€¼ã€‚</li>
</ul></li>
</ul>
</section>
<section id="æŒ‰è¯„åˆ†æ•°é‡è¿‡æ»¤" class="level2">
<h2 class="anchored" data-anchor-id="æŒ‰è¯„åˆ†æ•°é‡è¿‡æ»¤">æŒ‰è¯„åˆ†æ•°é‡è¿‡æ»¤</h2>
<p>``````goylqeae ratings_by_title = data.groupby(â€˜titleâ€™).size() # ç»Ÿè®¡æ¯éƒ¨ç”µå½±çš„è¯„åˆ†æ•°é‡ print(ratings_by_title.head()) # æ˜¾ç¤ºå‰å‡ è¡Œ active_titles = ratings_by_title.index[ratings_by_title &gt;= 250] # ç­›é€‰å‡ºè¯„åˆ†æ•°é‡å¤§äºç­‰äº 250 çš„ç”µå½± print(active_titles) # æ˜¾ç¤ºç­›é€‰ç»“æœ</p>
<p>mean_ratings = mean_ratings.loc[active_titles] # æ ¹æ®ç­›é€‰ç»“æœè¿‡æ»¤ mean_ratings print(mean_ratings) # æ˜¾ç¤ºè¿‡æ»¤åçš„ mean_ratings</p>
<pre><code>
-   **ç›®æ ‡**ï¼šå…³æ³¨è¯„åˆ†è¶³å¤Ÿçš„ç”µå½±ã€‚
-   **`data.groupby('title').size()`**:  ç»Ÿè®¡æ¯éƒ¨ç”µå½±çš„è¯„åˆ†æ•°ã€‚
-   **`active_titles = ...`**:  è‡³å°‘æœ‰ 250 æ¡è¯„åˆ†çš„ç”µå½±åç§°ã€‚
-   **`mean_ratings.loc[active_titles]`**:  è¿‡æ»¤ `mean_ratings` ä»¥ä»…åŒ…å«è¿™äº›ç”µå½±ã€‚

## æ’åºå’ŒæŸ¥æ‰¾çƒ­é—¨ç”µå½±

``````{python}
top_female_ratings = mean_ratings.sort_values("F", ascending=False)  # æŒ‰å¥³æ€§è¯„åˆ†é™åºæ’åˆ—
print(top_female_ratings.head())  # æ˜¾ç¤ºå¥³æ€§è¯„åˆ†æœ€é«˜çš„å‡ éƒ¨ç”µå½±</code></pre>
<ul>
<li><strong><code>mean_ratings.sort_values("F", ascending=False)</code></strong>: æŒ‰ â€˜Fâ€™ï¼ˆå¥³æ€§ï¼‰åˆ—æ’åºï¼Œé™åºï¼ˆæœ€é«˜è¯„åˆ†ä¼˜å…ˆï¼‰ã€‚</li>
</ul>
</section>
<section id="è¡¡é‡è¯„åˆ†å·®å¼‚" class="level2">
<h2 class="anchored" data-anchor-id="è¡¡é‡è¯„åˆ†å·®å¼‚">è¡¡é‡è¯„åˆ†å·®å¼‚</h2>
<p>``````goylqeae mean_ratings[â€˜diffâ€™] = mean_ratings[â€˜Mâ€™] - mean_ratings[â€˜Fâ€™] # è®¡ç®—ç”·æ€§å’Œå¥³æ€§è¯„åˆ†çš„å·®å¼‚ sorted_by_diff = mean_ratings.sort_values(â€˜diffâ€™) # æŒ‰å·®å¼‚æ’åº print(sorted_by_diff.head()) # æ˜¾ç¤ºå¥³æ€§è¯„åˆ†è¾ƒé«˜çš„ç”µå½±ï¼ˆå·®å¼‚ä¸ºè´Ÿï¼‰ print(sorted_by_diff[::-1].head()) # æ˜¾ç¤ºç”·æ€§è¯„åˆ†è¾ƒé«˜çš„ç”µå½±ï¼ˆå·®å¼‚ä¸ºæ­£ï¼‰</p>
</section>
</section>
<section id="æ ‡å‡†å·®å¦ä¸€ç§è¡¡é‡å·®å¼‚çš„æ–¹æ³•" class="level1">
<h1>æ ‡å‡†å·®ï¼ˆå¦ä¸€ç§è¡¡é‡å·®å¼‚çš„æ–¹æ³•ï¼‰</h1>
<p>rating_std_by_title = data.groupby(â€˜titleâ€™)[â€˜ratingâ€™].std() # è®¡ç®—æ¯éƒ¨ç”µå½±è¯„åˆ†çš„æ ‡å‡†å·® rating_std_by_title = rating_std_by_title.loc[active_titles] # è¿‡æ»¤ print(rating_std_by_title.sort_values(ascending=False)[:10]) # æ˜¾ç¤ºæ ‡å‡†å·®æœ€é«˜çš„ 10 éƒ¨ç”µå½±</p>
<pre><code>
-   **`mean_ratings['diff'] = ...`**:  æ–°åˆ—ï¼šç”·æ€§å’Œå¥³æ€§å¹³å‡è¯„åˆ†ä¹‹é—´çš„å·®å¼‚ã€‚
-   **`sorted_by_diff = ...`**: æŒ‰ 'diff' æ’åºã€‚
    -   `.head()`: å¥³æ€§è¯„åˆ†è¾ƒé«˜ã€‚
    -   `[::-1].head()`: ç”·æ€§è¯„åˆ†è¾ƒé«˜ï¼ˆåè½¬é¡ºåºï¼‰ã€‚
-   æ ‡å‡†å·®æ˜¾ç¤ºäº†åˆ†æ­§ã€‚

## å¤„ç†ç”µå½±ç±»å‹ï¼ˆæ­£ç¡®çš„æ–¹æ³•ï¼ï¼‰

``````{python}
# åŸå§‹: "Animation|Children's|Comedy"
movies['genre'] = movies.pop('genres').str.split('|')  # å°† 'genres' åˆ—æ‹†åˆ†ä¸ºåˆ—è¡¨ï¼Œå¹¶èµ‹å€¼ç»™æ–°çš„'genre'åˆ—
print(movies.head())  # æ˜¾ç¤ºç»“æœ
movies_exploded = movies.explode('genre')  # å±•å¼€ 'genre' åˆ—ï¼Œæ¯ä¸ªç±»å‹å ä¸€è¡Œ
print(movies_exploded[:10])  # æ˜¾ç¤ºå±•å¼€åçš„ç»“æœ</code></pre>
<ul>
<li><strong>é—®é¢˜</strong>ï¼šç±»å‹æ˜¯ç®¡é“åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚éš¾ä»¥åˆ†æã€‚</li>
<li><strong><code>movies['genres'].str.split('|')</code></strong>: æ‹†åˆ†ä¸ºç±»å‹çš„<em>åˆ—è¡¨</em>ã€‚</li>
<li><strong><code>.pop('genres')</code></strong>: åˆ é™¤å¹¶è¿”å›åŸå§‹åˆ—ã€‚</li>
<li><strong><code>movies.explode('genre')</code></strong>: <em>æ¯ä¸ª</em>ç”µå½±-ç±»å‹ç»„åˆéƒ½æœ‰è‡ªå·±çš„è¡Œã€‚å¯¹äºç±»å‹åˆ†æè‡³å…³é‡è¦ï¼</li>
</ul>
<section id="åˆå¹¶æ‰€æœ‰æ•°æ®å¹¶æŒ‰ç±»å‹åˆ†ç»„" class="level2">
<h2 class="anchored" data-anchor-id="åˆå¹¶æ‰€æœ‰æ•°æ®å¹¶æŒ‰ç±»å‹åˆ†ç»„">åˆå¹¶æ‰€æœ‰æ•°æ®å¹¶æŒ‰ç±»å‹åˆ†ç»„</h2>
<p>``````goylqeae ratings_with_genre = pd.merge(pd.merge(movies_exploded, ratings), users) # åˆå¹¶æ‰€æœ‰æ•°æ® print(ratings_with_genre.iloc[0]) # æ˜¾ç¤ºåˆå¹¶åç¬¬ä¸€è¡Œ</p>
<p>genre_ratings = (ratings_with_genre.groupby([â€˜genreâ€™, â€˜ageâ€™]) # æŒ‰ â€˜genreâ€™ å’Œ â€˜ageâ€™ åˆ†ç»„ [â€˜ratingâ€™].mean() # è®¡ç®—å¹³å‡ â€˜ratingâ€™ .unstack(â€˜ageâ€™)) # å°† â€˜ageâ€™ é€è§†ä¸ºåˆ— print(genre_ratings[:10]) # æ˜¾ç¤ºç»“æœ</p>
<pre><code>
-   **`ratings_with_genre = ...`**: åˆå¹¶ `movies_exploded`ã€`ratings` å’Œ `users`ã€‚æ¯ä¸€è¡Œï¼šè¯„åˆ† + ç”¨æˆ·ä¿¡æ¯ + *å•ä¸ª*ç±»å‹ã€‚
-   **`ratings_with_genre.iloc[0]`**: æ˜¾ç¤ºç¬¬ä¸€è¡Œã€‚
-   **`genre_ratings = ...`**: æ¯ä¸ªç±»å‹/å¹´é¾„ç»„çš„å¹³å‡è¯„åˆ†ã€‚
    -   `groupby(['genre', 'age'])`: æŒ‰ç±»å‹å’Œå¹´é¾„åˆ†ç»„ã€‚
    -   `['rating'].mean()`: å¹³å‡è¯„åˆ†ã€‚
    -   `.unstack('age')`: å¹´é¾„å˜æˆåˆ—ã€‚

## 13.3 1880-2010 å¹´ç¾å›½å©´å„¿å§“å ğŸ‘¶

-   **æ•°æ®é›†ï¼š** ç¾å›½ç¤¾ä¼šä¿éšœç®¡ç†å±€ (SSA) å©´å„¿å§“åã€‚
-   **æ—¶é—´æ®µï¼š** 1880-2010ã€‚
-   **æ•°æ®æ ¼å¼ï¼š** æ¯å¹´ä¸€ä¸ªæ–‡ä»¶ï¼š
    -   å§“å
    -   æ€§åˆ«
    -   å‡ºç”Ÿäººæ•°
-   **ç¤ºä¾‹ (yob1880.txt):**
    ```
    Mary,F,7065
    Anna,F,2604
    ...
    ```
-   **æ½œåœ¨åˆ†æï¼š**
    -   å§“åæµè¡Œè¶‹åŠ¿ã€‚
    -   ç›¸å¯¹æ’åã€‚
    -   å‘½åå¤šæ ·æ€§ã€‚
    -   å­—æ¯/å…ƒéŸ³/è¾…éŸ³åˆ†æã€‚

![](usbabynames_intro.png)

## åŠ è½½å’Œç»„åˆå©´å„¿å§“åæ•°æ®

``````{python}
import pandas as pd

# åŠ è½½å•å¹´æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
names1880 = pd.read_csv('datasets/babynames/yob1880.txt',
                        names=['name', 'sex', 'births'])  # æŒ‡å®šåˆ—å
print(names1880)  # æ˜¾ç¤º 1880 å¹´çš„æ•°æ®
print(names1880.groupby('sex')['births'].sum())  # æŒ‰æ€§åˆ«ç»Ÿè®¡ 1880 å¹´çš„æ€»å‡ºç”Ÿäººæ•°

# åŠ è½½æ‰€æœ‰å¹´ä»½çš„æ•°æ®å¹¶åˆå¹¶
years = range(1880, 2011)  # å¹´ä»½èŒƒå›´
pieces = []  # ç”¨äºå­˜å‚¨æ¯ä¸ªå¹´ä»½çš„æ•°æ®
for year in years:  # éå†å¹´ä»½
    path = f'datasets/babynames/yob{year}.txt'  # æ„å»ºæ–‡ä»¶è·¯å¾„
    frame = pd.read_csv(path, names=['name', 'sex', 'births'])  # è¯»å–æ•°æ®
    frame['year'] = year  # æ·»åŠ  'year' åˆ—
    pieces.append(frame)  # å°†å½“å‰å¹´ä»½çš„æ•°æ®æ·»åŠ åˆ°åˆ—è¡¨

names = pd.concat(pieces, ignore_index=True)  # åˆå¹¶æ‰€æœ‰å¹´ä»½çš„æ•°æ®
print(names)  # æ˜¾ç¤ºåˆå¹¶åçš„æ•°æ®</code></pre>
<ul>
<li><strong><code>names1880 = pd.read_csv(...)</code></strong>: åŠ è½½ä¸€å¹´ã€‚<code>names</code> æŒ‡å®šåˆ—ã€‚</li>
<li><strong><code>names1880.groupby('sex')['births'].sum()</code></strong>: 1880 å¹´æ¯ä¸ªæ€§åˆ«çš„æ€»å‡ºç”Ÿäººæ•°ã€‚</li>
<li><strong>å¾ªç¯éå†å¹´ä»½ï¼š</strong>
<ul>
<li><code>range(1880, 2011)</code>: è¿­ä»£ã€‚</li>
<li><code>f'datasets/babynames/yob{year}.txt'</code>: æ–‡ä»¶è·¯å¾„ï¼ˆf-stringï¼‰ã€‚</li>
<li><code>frame['year'] = year</code>: æ·»åŠ  â€˜yearâ€™ åˆ—ã€‚</li>
<li><code>pieces.append(frame)</code>: æ·»åŠ åˆ°åˆ—è¡¨ã€‚</li>
</ul></li>
<li><strong><code>names = pd.concat(pieces, ignore_index=True)</code></strong>: åˆå¹¶æ‰€æœ‰ DataFrameã€‚<code>ignore_index=True</code> é¿å…é‡å¤ç´¢å¼•ã€‚</li>
</ul>
</section>
<section id="æŒ‰å¹´ä»½å’Œæ€§åˆ«èšåˆ" class="level2">
<h2 class="anchored" data-anchor-id="æŒ‰å¹´ä»½å’Œæ€§åˆ«èšåˆ">æŒ‰å¹´ä»½å’Œæ€§åˆ«èšåˆ</h2>
<p>```<code>goylqeae total_births = names.pivot_table('births', index='year',  # ä»¥ 'year' ä¸ºç´¢å¼•                                  columns='sex', aggfunc=sum)  # ä»¥ 'sex' ä¸ºåˆ—ï¼Œè®¡ç®— 'births' çš„æ€»å’Œ print(total_births.tail())  # æ˜¾ç¤ºæœ€åå‡ è¡Œ total_births.plot(title='Total births by sex and year')  # ç»˜åˆ¶æŒ‰æ€§åˆ«å’Œå¹´ä»½åˆ’åˆ†çš„æ€»å‡ºç”Ÿäººæ•° plt.show() #æ˜¾ç¤ºç»˜å›¾</code></p>
<ul>
<li><strong><code>names.pivot_table(...)</code></strong>: æ¯å¹´/æ¯æ€§åˆ«çš„æ€»å‡ºç”Ÿäººæ•°ã€‚
<ul>
<li><code>'births'</code>: è¦èšåˆçš„å€¼ã€‚</li>
<li><code>index='year'</code>: å¹´ä»½æ˜¯è¡Œç´¢å¼•ã€‚</li>
<li><code>columns='sex'</code>: æ€§åˆ«æˆä¸ºåˆ—ã€‚</li>
<li><code>aggfunc=sum</code>: å‡ºç”Ÿäººæ•°æ€»å’Œã€‚</li>
</ul></li>
<li><strong><code>total_births.tail()</code></strong>: æœ€åå‡ è¡Œã€‚</li>
<li><strong><code>total_births.plot(...)</code></strong>: è¶‹åŠ¿æŠ˜çº¿å›¾ã€‚</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="birth_by_sex_year.png" class="img-fluid figure-img"></p>
<figcaption>â€˜æŒ‰æ€§åˆ«å’Œå¹´ä»½åˆ’åˆ†çš„æ€»å‡ºç”Ÿäººæ•°â€™</figcaption>
</figure>
</div>
</section>
<section id="è®¡ç®—æ¯ä¸ªåå­—çš„æ¯”ä¾‹" class="level2">
<h2 class="anchored" data-anchor-id="è®¡ç®—æ¯ä¸ªåå­—çš„æ¯”ä¾‹">è®¡ç®—æ¯ä¸ªåå­—çš„æ¯”ä¾‹</h2>
<p>``````goylqeae def add_prop(group): group[â€˜propâ€™] = group[â€˜birthsâ€™] / group[â€˜birthsâ€™].sum() # è®¡ç®—æ¯ä¸ªåˆ†ç»„å†…çš„æ¯”ä¾‹ return group</p>
<p>names = names.groupby([â€˜yearâ€™, â€˜sexâ€™]).apply(add_prop) # æŒ‰å¹´ä»½å’Œæ€§åˆ«åˆ†ç»„ï¼Œå¹¶åº”ç”¨å‡½æ•° print(names) # æ˜¾ç¤ºæ·»åŠ äº† â€˜propâ€™ åˆ—çš„æ•°æ®</p>
<pre><code>
-   **ç›®æ ‡ï¼š** æ¯ä¸ªåå­—åœ¨*æ¯ä¸ªå¹´ä»½å’Œæ€§åˆ«*ä¸­å å©´å„¿çš„æ¯”ä¾‹ã€‚æ ¹æ®æ€»å‡ºç”Ÿäººæ•°è¿›è¡Œæ ‡å‡†åŒ–ã€‚
-   **`add_prop(group)` å‡½æ•°ï¼š**
    -   æ¥æ”¶ä¸€ä¸ªåˆ†ç»„ï¼ˆå¹´ä»½/æ€§åˆ«ï¼‰ã€‚
    -   `group['births'] / group['births'].sum()`: æ¯”ä¾‹ï¼ˆå‡ºç”Ÿäººæ•°é™¤ä»¥è¯¥å¹´ä»½/æ€§åˆ«çš„æ€»æ•°ï¼‰ã€‚
    -   è¿”å›ä¿®æ”¹åçš„åˆ†ç»„ã€‚
-   **`names.groupby(['year', 'sex']).apply(add_prop)`**:  åº”ç”¨äºæ¯ä¸ªåˆ†ç»„ã€‚æ·»åŠ  'prop' åˆ—ã€‚

## éªŒè¯æ¯”ä¾‹ï¼ˆå¥å…¨æ€§æ£€æŸ¥ï¼ï¼‰

``````{python}
print(names.groupby(['year', 'sex'])['prop'].sum())  # éªŒè¯æ¯ä¸ªå¹´ä»½å’Œæ€§åˆ«åˆ†ç»„çš„ 'prop' æ€»å’Œæ˜¯å¦ä¸º 1</code></pre>
<ul>
<li><strong>é‡è¦</strong>ï¼šå§‹ç»ˆæ£€æŸ¥æ‚¨çš„è®¡ç®—ï¼</li>
<li>æŒ‰å¹´ä»½/æ€§åˆ«åˆ†ç»„ï¼Œå¯¹ â€˜propâ€™ æ±‚å’Œã€‚å¯¹äºæ¯ä¸ªåˆ†ç»„ï¼Œç»“æœåº”ä¸º 1.0ï¼ˆæ¯”ä¾‹åŠ èµ·æ¥ä¸º 100%ï¼‰ã€‚</li>
</ul>
</section>
<section id="æå–å‰-1000-ä¸ªåå­—" class="level2">
<h2 class="anchored" data-anchor-id="æå–å‰-1000-ä¸ªåå­—">æå–å‰ 1000 ä¸ªåå­—</h2>
<p>``````goylqeae def get_top1000(group): return group.sort_values(â€˜birthsâ€™, ascending=False)[:1000] # æŒ‰ â€˜birthsâ€™ é™åºæ’åˆ—ï¼Œå¹¶å–å‰ 1000 è¡Œ</p>
<p>grouped = names.groupby([â€˜yearâ€™, â€˜sexâ€™]) # æŒ‰å¹´ä»½å’Œæ€§åˆ«åˆ†ç»„ top1000 = grouped.apply(get_top1000) # åº”ç”¨å‡½æ•° top1000 = top1000.reset_index(drop=True) # åˆ é™¤å¤šçº§ç´¢å¼• print(top1000) # æ˜¾ç¤ºå‰ 1000 ä¸ªåå­—çš„æ•°æ®</p>
<pre><code>
-   **ç›®æ ‡ï¼š** æ¯ä¸ªå¹´ä»½/æ€§åˆ«çš„å‰ 1000 ä¸ªåå­—ï¼ˆç”¨äºè¿›ä¸€æ­¥åˆ†æï¼‰ã€‚
-   **`get_top1000(group)` å‡½æ•°ï¼š**
    -   æ¥æ”¶ä¸€ä¸ªåˆ†ç»„ï¼ˆå¹´ä»½/æ€§åˆ«ï¼‰ã€‚
    -   `group.sort_values('births', ascending=False)`: æŒ‰å‡ºç”Ÿäººæ•°æ’åºï¼ˆé™åºï¼‰ã€‚
    -   `[:1000]`: å‰ 1000 è¡Œã€‚
-   **`names.groupby(['year', 'sex']).apply(get_top1000)`**: åº”ç”¨äºæ¯ä¸ªåˆ†ç»„ã€‚
-   **`top1000.reset_index(drop=True)`:** åˆ é™¤å¤šçº§ç´¢å¼•.

## åˆ†æå‘½åè¶‹åŠ¿

``````{python}
boys = top1000[top1000['sex'] == 'M']  # ç­›é€‰å‡ºç”·å­©çš„æ•°æ®
girls = top1000[top1000['sex'] == 'F']  # ç­›é€‰å‡ºå¥³å­©çš„æ•°æ®

total_births = top1000.pivot_table('births', index='year',  # ä»¥ 'year' ä¸ºç´¢å¼•
                                    columns='name', aggfunc=sum)  # ä»¥ 'name' ä¸ºåˆ—ï¼Œè®¡ç®— 'births' çš„æ€»å’Œ
print(total_births.info())  # æ˜¾ç¤ºä¿¡æ¯

subset = total_births[['John', 'Harry', 'Mary', 'Marilyn']]  # é€‰å–å‡ ä¸ªåå­—
subset.plot(subplots=True, figsize=(12, 10),  # ç»˜åˆ¶å­å›¾
            title="Number of births per year")  # è®¾ç½®æ ‡é¢˜
plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></pre>
<ul>
<li><strong><code>boys = ...</code></strong> å’Œ <strong><code>girls = ...</code></strong>: ç”·å­©/å¥³å­©çš„å•ç‹¬ DataFrameã€‚</li>
<li><strong><code>total_births = top1000.pivot_table(...)</code></strong>: ç‰¹å®šåå­—çš„è¶‹åŠ¿ã€‚
<ul>
<li><code>'births'</code>: è¦èšåˆçš„å€¼ã€‚</li>
<li><code>index='year'</code>: å¹´ä»½æ˜¯è¡Œç´¢å¼•ã€‚</li>
<li><code>columns='name'</code>: æ¯ä¸ªåå­—æ˜¯ä¸€åˆ—ã€‚</li>
<li><code>aggfunc=sum</code>: æ±‚å’Œã€‚</li>
</ul></li>
<li><strong><code>subset.plot(...)</code></strong>: ç»˜åˆ¶è¶‹åŠ¿å›¾ã€‚
<ul>
<li><code>subplots=True</code>: æ¯ä¸ªåå­—ä¸€ä¸ªå•ç‹¬çš„å›¾ã€‚</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="boyandgirlnames.png" class="img-fluid figure-img"></p>
<figcaption>â€˜å‡ ä¸ªç”·å­©å’Œå¥³å­©åå­—éšæ—¶é—´çš„å˜åŒ–â€™</figcaption>
</figure>
</div>
</section>
<section id="è¡¡é‡å‘½åå¤šæ ·æ€§çš„å¢åŠ " class="level2">
<h2 class="anchored" data-anchor-id="è¡¡é‡å‘½åå¤šæ ·æ€§çš„å¢åŠ ">è¡¡é‡å‘½åå¤šæ ·æ€§çš„å¢åŠ </h2>
<p>``````goylqeae table = top1000.pivot_table(â€˜propâ€™, index=â€˜yearâ€™, # ä»¥ â€˜yearâ€™ ä¸ºç´¢å¼• columns=â€˜sexâ€™, aggfunc=sum) # ä»¥ â€˜sexâ€™ ä¸ºåˆ—ï¼Œè®¡ç®— â€˜propâ€™ çš„æ€»å’Œ table.plot(title=â€˜Sum of table1000.prop by year and sexâ€™, # ç»˜åˆ¶æŒ‰å¹´ä»½å’Œæ€§åˆ«åˆ’åˆ†çš„ â€˜propâ€™ æ€»å’Œ yticks=np.linspace(0, 1.2, 13)) # è®¾ç½® y è½´åˆ»åº¦ plt.show() #æ˜¾ç¤ºç»˜å›¾</p>
<p>df = boys[boys[â€˜yearâ€™] == 2010] # ç­›é€‰å‡º 2010 å¹´çš„ç”·å­©æ•°æ® prop_cumsum = df[â€˜propâ€™].sort_values(ascending=False).cumsum() # è®¡ç®— 2010 å¹´ç”·å­©åå­— â€˜propâ€™ çš„ç´¯ç§¯å’Œ print(prop_cumsum[:10]) # æ˜¾ç¤ºå‰ 10 ä¸ªç´¯ç§¯å’Œ print(prop_cumsum.searchsorted(0.5)) # æ‰¾åˆ°ç´¯ç§¯å’Œè¾¾åˆ° 0.5 çš„ç´¢å¼•, ç»“æœä¸º116, åŠ ä¸Š1, ç»“æœä¸º117.</p>
<p>df = boys[boys.year == 1900] # ç­›é€‰å‡º 1900 å¹´çš„ç”·å­©æ•°æ® in1900 = df.sort_values(â€˜propâ€™, ascending=False).prop.cumsum() # è®¡ç®— 1900 å¹´ç”·å­©åå­— â€˜propâ€™ çš„ç´¯ç§¯å’Œ print(in1900.searchsorted(0.5) + 1) # æ‰¾åˆ°ç´¯ç§¯å’Œè¾¾åˆ° 0.5 çš„ç´¢å¼•+1, ç»“æœä¸º25</p>
<pre><code>
-   **ç›®æ ‡ï¼š** å‘½åæ˜¯å¦å˜å¾—æ›´åŠ å¤šæ ·åŒ–ï¼Ÿï¼ˆçˆ¶æ¯æ˜¯å¦ä»æ›´å¤šåå­—ä¸­é€‰æ‹©ï¼Ÿï¼‰
-   **`table = top1000.pivot_table(...)`**: æ¯ä¸ªå¹´ä»½/æ€§åˆ«çš„ 'prop' *æ€»å’Œ*ã€‚æ¯”ä¾‹ä¸‹é™ = å¤šæ ·æ€§å¢åŠ ã€‚
-   **`prop_cumsum = ... .cumsum()`**: 2010 å¹´ç”·å­© 'prop' çš„*ç´¯ç§¯å’Œ*ï¼ˆå·²æ’åºï¼‰ã€‚æ‰¾å‡ºå¤šå°‘ä¸ªåå­—è¾¾åˆ° 50% çš„å‡ºç”Ÿäººæ•°ã€‚
-   **`prop_cumsum.searchsorted(0.5)`**:  ç´¯ç§¯å’Œè¾¾åˆ° 0.5 (50%) çš„ç´¢å¼•ã€‚å› ä¸ºæ•°ç»„çš„ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥ç»“æœéœ€è¦åŠ 1.
-   å¯¹ 1900 å¹´æ‰§è¡Œç±»ä¼¼æ­¥éª¤ã€‚

!['æŒ‰æ€§åˆ«åˆ’åˆ†ï¼Œå‰ 1000 ä¸ªåå­—æ‰€ä»£è¡¨çš„å‡ºç”Ÿæ¯”ä¾‹'](prop_top1000.png)

## è¡¡é‡å‘½åå¤šæ ·æ€§çš„å¢åŠ ï¼ˆç»­ï¼‰- æ³›åŒ–

``````{python}
def get_quantile_count(group, q=0.5):
    group = group.sort_values('prop', ascending=False)  # æŒ‰ 'prop' é™åºæ’åˆ—
    return group.prop.cumsum().searchsorted(q) + 1  # è®¡ç®—ç´¯ç§¯å’Œï¼Œæ‰¾åˆ°è¾¾åˆ°åˆ†ä½æ•° q çš„ç´¢å¼•+1

diversity = top1000.groupby(['year', 'sex']).apply(get_quantile_count)  # æŒ‰å¹´ä»½å’Œæ€§åˆ«åˆ†ç»„ï¼Œå¹¶åº”ç”¨å‡½æ•°
diversity = diversity.unstack()  # å°†ç»“æœé‡å¡‘

fig = plt.figure()  # åˆ›å»ºå›¾å½¢
diversity.plot(title="Number of popular names in top 50%")  # ç»˜åˆ¶å¤šæ ·æ€§æŒ‡æ ‡
plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></pre>
<ul>
<li><strong><code>get_quantile_count(group, q=0.5)</code> å‡½æ•°ï¼š</strong>
<ul>
<li>æ¥æ”¶ä¸€ä¸ªåˆ†ç»„ï¼ˆå¹´ä»½/æ€§åˆ«ï¼‰å’Œåˆ†ä½æ•°ï¼ˆé»˜è®¤ä¸º 0.5ï¼‰ã€‚</li>
<li>æŒ‰ â€˜propâ€™ æ’åºï¼ˆé™åºï¼‰ã€‚</li>
<li>â€˜propâ€™ çš„ç´¯ç§¯å’Œã€‚</li>
<li><code>searchsorted(q)</code>: æ€»å’Œè¾¾åˆ°åˆ†ä½æ•°çš„ç´¢å¼•ã€‚åŠ  1ã€‚</li>
</ul></li>
<li><strong><code>top1000.groupby(['year', 'sex']).apply(get_quantile_count)</code></strong>: åº”ç”¨äºæ¯ä¸ªåˆ†ç»„ã€‚</li>
<li><strong><code>diversity.unstack()</code></strong>: é‡å¡‘ä»¥è¿›è¡Œç»˜å›¾ã€‚</li>
<li>å›¾è¡¨æ˜¾ç¤ºäº†è¾¾åˆ° 50% å‡ºç”Ÿäººæ•°æ‰€éœ€çš„å§“åæ•°é‡ï¼Œéšæ—¶é—´å˜åŒ–ï¼ŒæŒ‰æ€§åˆ«åˆ’åˆ†ã€‚</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="diversity.png" class="img-fluid figure-img"></p>
<figcaption>â€˜æŒ‰å¹´ä»½åˆ’åˆ†çš„å¤šæ ·æ€§æŒ‡æ ‡å›¾â€™</figcaption>
</figure>
</div>
</section>
<section id="æœ€åä¸€ä¸ªå­—æ¯é©å‘½" class="level2">
<h2 class="anchored" data-anchor-id="æœ€åä¸€ä¸ªå­—æ¯é©å‘½">â€œæœ€åä¸€ä¸ªå­—æ¯â€é©å‘½ ğŸ”¤</h2>
<p>``````goylqeae def get_last_letter(x): return x[-1] # è·å–å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—æ¯</p>
<p>last_letters = names[â€˜nameâ€™].map(get_last_letter) # å°†å‡½æ•°åº”ç”¨äº â€˜nameâ€™ åˆ—ï¼Œè·å–æœ€åä¸€ä¸ªå­—æ¯ last_letters.name = â€˜last_letterâ€™ # å°† Series å‘½åä¸º â€˜last_letterâ€™</p>
<p>table = names.pivot_table(â€˜birthsâ€™, index=last_letters, # ä»¥ â€˜last_letterâ€™ ä¸ºç´¢å¼• columns=[â€˜sexâ€™, â€˜yearâ€™], aggfunc=sum) # ä»¥ â€˜sexâ€™ å’Œ â€˜yearâ€™ ä¸ºåˆ—ï¼Œè®¡ç®— â€˜birthsâ€™ çš„æ€»å’Œ subtable = table.reindex(columns=[1910, 1960, 2010], level=â€˜yearâ€™) # é€‰å–ç‰¹å®šå¹´ä»½ print(subtable.head()) # æ˜¾ç¤ºå‰å‡ è¡Œ print(subtable.sum()) # è®¡ç®—æ¯ä¸ªå¹´ä»½å’Œæ€§åˆ«çš„æ€»å’Œ</p>
<p>letter_prop = subtable / subtable.sum() # è®¡ç®—æ¯ä¸ªå¹´ä»½å’Œæ€§åˆ«ä¸­ï¼Œæ¯ä¸ªå­—æ¯çš„æ¯”ä¾‹ print(letter_prop.head()) # æ˜¾ç¤ºå‰å‡ è¡Œ</p>
<pre><code>
-   **æƒ³æ³•ï¼š** åˆ†ææœ€åä¸€ä¸ªå­—æ¯éšæ—¶é—´çš„åˆ†å¸ƒã€‚
-   **`get_last_letter(x)` å‡½æ•°ï¼š**  è¿”å›æœ€åä¸€ä¸ªå­—ç¬¦ã€‚
-   **`names['name'].map(get_last_letter)`**: åº”ç”¨äº 'name'ï¼Œåˆ›å»º `last_letters` Seriesã€‚
-   **`table = names.pivot_table(...)`**: æŒ‰æœ€åä¸€ä¸ªå­—æ¯ã€æ€§åˆ«å’Œå¹´ä»½ç»Ÿè®¡å‡ºç”Ÿäººæ•°ã€‚
-   **`subtable = ...`**: é€‰æ‹©ç‰¹å®šå¹´ä»½ (1910, 1960, 2010)ã€‚
-   **`letter_prop = subtable / subtable.sum()`**:  æ¯ä¸ªå­—æ¯ç»“å°¾çš„åå­—çš„*æ¯”ä¾‹*ï¼ˆæ ‡å‡†åŒ–ï¼‰ã€‚

``````{python}
import matplotlib.pyplot as plt

fig, axes = plt.subplots(2, 1, figsize=(10, 8))  # åˆ›å»º 2x1 çš„å­å›¾
letter_prop['M'].plot(kind='bar', rot=0, ax=axes[0], title='Male')  # ç»˜åˆ¶ç”·æ€§æœ€åä¸€ä¸ªå­—æ¯çš„æ¡å½¢å›¾
letter_prop['F'].plot(kind='bar', rot=0, ax=axes[1], title='Female',  # ç»˜åˆ¶å¥³æ€§æœ€åä¸€ä¸ªå­—æ¯çš„æ¡å½¢å›¾
                      legend=False)  # ä¸æ˜¾ç¤ºå›¾ä¾‹
plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></pre>
<ul>
<li><strong><code>plt.subplots(2, 1, ...)</code></strong>: ä¸¤ä¸ªå­å›¾ï¼ˆç”·æ€§/å¥³æ€§ï¼‰ã€‚</li>
<li><strong><code>letter_prop['M'].plot(...)</code></strong> å’Œ <strong><code>letter_prop['F'].plot(...)</code></strong>: æœ€åä¸€ä¸ªå­—æ¯åˆ†å¸ƒçš„æ¡å½¢å›¾ã€‚</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="letter_prop.png" class="img-fluid figure-img"></p>
<figcaption>â€˜ç”·å­©å’Œå¥³å­©åå­—ä»¥æ¯ä¸ªå­—æ¯ç»“å°¾çš„æ¯”ä¾‹â€™</figcaption>
</figure>
</div>
</section>
<section id="æœ€åä¸€ä¸ªå­—æ¯é©å‘½ç»­--å…³æ³¨ç‰¹å®šå­—æ¯" class="level2">
<h2 class="anchored" data-anchor-id="æœ€åä¸€ä¸ªå­—æ¯é©å‘½ç»­--å…³æ³¨ç‰¹å®šå­—æ¯">â€œæœ€åä¸€ä¸ªå­—æ¯â€é©å‘½ï¼ˆç»­ï¼‰- å…³æ³¨ç‰¹å®šå­—æ¯</h2>
<p>```<code>goylqeae letter_prop = table / table.sum()  # è®¡ç®—æ‰€æœ‰å¹´ä»½çš„æ¯”ä¾‹ dny_ts = letter_prop.loc[['d', 'n', 'y'], 'M'].T  # é€‰å–ç”·æ€§åå­—ä¸­ä»¥ 'd', 'n', 'y' ç»“å°¾çš„æ¯”ä¾‹ï¼Œå¹¶è½¬ç½® print(dny_ts.head())  # æ˜¾ç¤ºå‰å‡ è¡Œ dny_ts.plot()  # ç»˜åˆ¶è¶‹åŠ¿å›¾ plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></p>
<ul>
<li><strong><code>letter_prop = table / table.sum()</code></strong>: æ¯”ä¾‹ï¼ˆæ‰€æœ‰å¹´ä»½ï¼‰ã€‚</li>
<li><strong><code>dny_ts = letter_prop.loc[['d', 'n', 'y'], 'M'].T</code></strong>: é€‰æ‹©ç”·æ€§çš„ â€˜dâ€™ã€â€˜nâ€™ã€â€˜yâ€™ï¼Œè½¬ç½® (.T) ä»¥è·å¾—æ—¶é—´åºåˆ—ã€‚</li>
<li><strong><code>dny_ts.plot()</code></strong>: ç»˜åˆ¶è¿™äº›å­—æ¯çš„è¶‹åŠ¿ã€‚</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="boy_dny.png" class="img-fluid figure-img"></p>
<figcaption>â€˜éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä»¥ d/n/y ç»“å°¾çš„ç”·å­©åå­—çš„æ¯”ä¾‹â€™</figcaption>
</figure>
</div>
</section>
<section id="å˜æˆå¥³å­©åå­—çš„ç”·å­©åå­—åä¹‹äº¦ç„¶" class="level2">
<h2 class="anchored" data-anchor-id="å˜æˆå¥³å­©åå­—çš„ç”·å­©åå­—åä¹‹äº¦ç„¶">å˜æˆå¥³å­©åå­—çš„ç”·å­©åå­—ï¼ˆåä¹‹äº¦ç„¶ï¼‰ğŸ”„</h2>
<p>``````goylqeae all_names = pd.Series(top1000[â€˜nameâ€™].unique()) # è·å–æ‰€æœ‰å”¯ä¸€çš„åå­— lesley_like = all_names[all_names.str.contains(â€˜Leslâ€™)] # ç­›é€‰å‡ºåŒ…å« â€˜Leslâ€™ çš„åå­— print(lesley_like) # æ˜¾ç¤ºç­›é€‰ç»“æœ</p>
<p>filtered = top1000[top1000[â€˜nameâ€™].isin(lesley_like)] # ç­›é€‰å‡º top1000 ä¸­åŒ…å«è¿™äº›åå­—çš„æ•°æ® print(filtered.groupby(â€˜nameâ€™)[â€˜birthsâ€™].sum()) # æŒ‰åå­—ç»Ÿè®¡å‡ºç”Ÿäººæ•°</p>
<p>table = filtered.pivot_table(â€˜birthsâ€™, index=â€˜yearâ€™, # ä»¥ â€˜yearâ€™ ä¸ºç´¢å¼• columns=â€˜sexâ€™, aggfunc=sum) # ä»¥ â€˜sexâ€™ ä¸ºåˆ—ï¼Œè®¡ç®— â€˜birthsâ€™ çš„æ€»å’Œ table = table.div(table.sum(axis=â€œcolumnsâ€), axis=â€œindexâ€) # è®¡ç®—æ¯ä¸ªå¹´ä»½ä¸­ï¼Œæ¯ä¸ªæ€§åˆ«çš„æ¯”ä¾‹ print(table.tail()) # æ˜¾ç¤ºæœ€åå‡ è¡Œ table.plot(style={â€˜Mâ€™: â€˜k-â€™, â€˜Fâ€™: â€˜kâ€“â€™}) # ç»˜åˆ¶è¶‹åŠ¿å›¾ plt.show() #æ˜¾ç¤ºç»˜å›¾</p>
<pre><code>
-   **ç›®æ ‡ï¼š** æ‰¾åˆ°æ”¹å˜äº†æ€§åˆ«åå¥½çš„åå­—ã€‚
-   **`all_names = ...`**:  `top1000` ä¸­æ‰€æœ‰*å”¯ä¸€*çš„åå­—ã€‚
-   **`lesley_like = ...`**: åŒ…å« "Lesl" çš„åå­—ã€‚
-   **`filtered = ...`**: `top1000` ä¸­åŒ…å«è¿™äº›åå­—çš„è¡Œã€‚
-   **`filtered.groupby('name')['births'].sum()`**:  æ¯ä¸ªåå­—çš„æ€»å‡ºç”Ÿäººæ•°ã€‚
-   **`table = filtered.pivot_table(...)`**: æ¯å¹´ã€æ¯æ€§åˆ«çš„å‡ºç”Ÿäººæ•°ã€‚
-   **`table = table.div(..., axis="index")`**:  æ¯å¹´æ¯æ€§åˆ«çš„*æ¯”ä¾‹*ï¼ˆæ ‡å‡†åŒ–ï¼‰ã€‚
-   **`table.plot(...)`**:  ç”·æ€§/å¥³æ€§æ¯”ä¾‹çš„è¶‹åŠ¿ã€‚

!['éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç±»ä¼¼ Lesley çš„åå­—çš„ç”·æ€§/å¥³æ€§æ¯”ä¾‹'](lesleylike_names.png)

## 13.4 USDA é£Ÿå“æ•°æ®åº“ ğŸ

-   **æ•°æ®é›†ï¼š** USDA é£Ÿå“è¥å…»æ•°æ®åº“ã€‚
-   **æ•°æ®æ ¼å¼ï¼š** JSONã€‚
-   **ç¤ºä¾‹è®°å½•ï¼š**

```json
{
  "id": 21441,
  "description": "KENTUCKY FRIED CHICKEN, Fried Chicken, EXTRA CRISPY, Wing, meat and skin with breading",
  "tags": ["KFC"],
  "manufacturer": "Kentucky Fried Chicken",
  "group": "Fast Foods",
  "portions": [
    {
      "amount": 1,
      "unit": "wing, with skin",
      "grams": 68.0
    }
  ],
  "nutrients": [
    {
      "value": 20.8,
      "units": "g",
      "description": "Protein",
      "group": "Composition"
    }
  ]
}</code></pre>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> åˆ†æè¥å…»ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="usda_food_intro.png" class="img-fluid"></p>
</section>
<section id="åŠ è½½å’Œæ¢ç´¢-usda-æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="åŠ è½½å’Œæ¢ç´¢-usda-æ•°æ®">åŠ è½½å’Œæ¢ç´¢ USDA æ•°æ®</h2>
<p>``````goylqeae import json # å¯¼å…¥ json åº“ import pandas as pd</p>
<p>db = json.load(open(â€˜datasets/usda_food/database.jsonâ€™)) # åŠ è½½ JSON æ•°æ® print(len(db)) # æ˜¾ç¤ºè®°å½•æ•°é‡ print(db[0].keys()) # æ˜¾ç¤ºç¬¬ä¸€æ¡è®°å½•çš„é”® print(db[0][â€˜nutrientsâ€™][0]) # æ˜¾ç¤ºç¬¬ä¸€æ¡è®°å½•çš„ç¬¬ä¸€ä¸ªè¥å…»ç´ </p>
<p>nutrients = pd.DataFrame(db[0][â€˜nutrientsâ€™]) # åˆ›å»ºç¬¬ä¸€ä¸ªé£Ÿç‰©çš„è¥å…»ç´  DataFrame print(nutrients.head(7)) # æ˜¾ç¤ºå‰ 7 è¡Œ</p>
<pre><code>
-   **`import json`**: å¯¼å…¥ `json` åº“ã€‚
-   **`db = json.load(...)`**:  å°† JSON åŠ è½½åˆ° ```{python} å¯¹è±¡ï¼ˆ`db` - å­—å…¸åˆ—è¡¨ï¼‰ä¸­ã€‚
-   **`len(db)`**:  é£Ÿç‰©è®°å½•çš„æ•°é‡ã€‚
-   **`db[0].keys()`**: ç¬¬ä¸€æ¡è®°å½•ä¸­çš„é”®ã€‚
-   **`db[0]['nutrients'][0]`**:  ç¬¬ä¸€ä¸ªé£Ÿç‰©çš„ç¬¬ä¸€ä¸ªè¥å…»ç´ ã€‚
-   **`nutrients = pd.DataFrame(...)`**: *ç¬¬ä¸€ä¸ª*é£Ÿç‰©çš„è¥å…»ç´ çš„ DataFrameã€‚

## æå–é£Ÿç‰©ä¿¡æ¯

``````{python}
info_keys = ['description', 'group', 'id', 'manufacturer']  # è¦æå–çš„é”®
info = pd.DataFrame(db, columns=info_keys)  # åˆ›å»ºåŒ…å«é£Ÿç‰©ä¿¡æ¯çš„ DataFrame
print(info.head())  # æ˜¾ç¤ºå‰å‡ è¡Œ
print(info.info())  # æ˜¾ç¤º DataFrame çš„ä¿¡æ¯
print(pd.value_counts(info['group'])[:10])  # ç»Ÿè®¡å¹¶æ˜¾ç¤ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰ 10 ä¸ªé£Ÿç‰©ç»„</code></pre>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> åŒ…å«åŸºæœ¬é£Ÿç‰©ä¿¡æ¯çš„ DataFrame (<code>info</code>)ã€‚</li>
<li><strong><code>info_keys = [...]</code></strong>: è¦æå–çš„é”®ã€‚</li>
<li><strong><code>info = pd.DataFrame(db, columns=info_keys)</code></strong>: åˆ›å»º DataFrameã€‚</li>
<li><strong><code>info.head()</code></strong>: å‰å‡ è¡Œã€‚</li>
<li><strong><code>info.info()</code></strong>: æ‘˜è¦ã€‚</li>
<li><strong><code>pd.value_counts(info['group'])[:10]</code></strong>: å‰ 10 ä¸ªé£Ÿç‰©ç»„ã€‚</li>
</ul>
</section>
<section id="å¤„ç†è¥å…»æ•°æ®æ‰€æœ‰é£Ÿç‰©" class="level2">
<h2 class="anchored" data-anchor-id="å¤„ç†è¥å…»æ•°æ®æ‰€æœ‰é£Ÿç‰©">å¤„ç†è¥å…»æ•°æ®ï¼ˆæ‰€æœ‰é£Ÿç‰©ï¼‰</h2>
<p>``````goylqeae nutrients = [] # ç”¨äºå­˜å‚¨æ‰€æœ‰é£Ÿç‰©çš„è¥å…»ç´ </p>
<p>for rec in db: # éå†é£Ÿç‰©è®°å½• fnuts = pd.DataFrame(rec[â€˜nutrientsâ€™]) # åˆ›å»ºå½“å‰é£Ÿç‰©çš„è¥å…»ç´  DataFrame fnuts[â€˜idâ€™] = rec[â€˜idâ€™] # æ·»åŠ é£Ÿç‰© ID nutrients.append(fnuts) # å°†å½“å‰é£Ÿç‰©çš„è¥å…»ç´  DataFrame æ·»åŠ åˆ°åˆ—è¡¨</p>
<p>nutrients = pd.concat(nutrients, ignore_index=True) # åˆå¹¶æ‰€æœ‰è¥å…»ç´  DataFrame print(nutrients) # æ˜¾ç¤ºåˆå¹¶åçš„ DataFrame</p>
<pre><code>
-   **ç›®æ ‡**ï¼šåŒ…å«*æ‰€æœ‰*è¥å…»ä¿¡æ¯çš„å•ä¸ª DataFrame (`nutrients`)ã€‚
-   **å¾ªç¯ï¼š**
    -   `for rec in db:`: éå†é£Ÿç‰©è®°å½•ã€‚
    -   `fnuts = pd.DataFrame(rec['nutrients'])`: å½“å‰é£Ÿç‰©è¥å…»ç´ çš„ DataFrameã€‚
    -   `fnuts['id'] = rec['id']`: æ·»åŠ é£Ÿç‰© IDï¼ˆç”¨äºé“¾æ¥ï¼‰ã€‚
    -   `nutrients.append(fnuts)`: è¿½åŠ åˆ°åˆ—è¡¨ã€‚
-   **`nutrients = pd.concat(nutrients, ignore_index=True)`**:  åˆå¹¶æ‰€æœ‰è¥å…»ç´  DataFrameã€‚

## å¤„ç†é‡å¤é¡¹å’Œé‡å‘½å

``````{python}
nutrients.duplicated().sum()  # æ£€æŸ¥é‡å¤çš„è¡Œæ•°
nutrients = nutrients.drop_duplicates()  # åˆ é™¤é‡å¤çš„è¡Œ

col_mapping = {'description' : 'food',  # åˆ—åæ˜ å°„å­—å…¸
               'group'       : 'fgroup'}
info = info.rename(columns=col_mapping, copy=False)  # é‡å‘½å info DataFrame çš„åˆ—
print(info.info())  # æ˜¾ç¤ºé‡å‘½ååçš„ info DataFrame çš„ä¿¡æ¯

col_mapping = {'description' : 'nutrient',  # åˆ—åæ˜ å°„å­—å…¸
               'group' : 'nutgroup'}
nutrients = nutrients.rename(columns=col_mapping, copy=False)  # é‡å‘½å nutrients DataFrame çš„åˆ—
print(nutrients)  # æ˜¾ç¤ºé‡å‘½ååçš„ nutrients DataFrame</code></pre>
<ul>
<li><strong>é‡å¤é¡¹æ£€æŸ¥å’Œåˆ é™¤</strong>ï¼š
<ul>
<li>æŸäº›è¥å…»ç´ è¡Œæ˜¯é‡å¤çš„ã€‚è¯·åœ¨ç»§ç»­ä¹‹å‰åˆ é™¤ã€‚</li>
<li><code>nutrients.duplicated().sum()</code>: ç»Ÿè®¡é‡å¤çš„è¡Œæ•°ã€‚</li>
<li><code>nutrients = nutrients.drop_duplicates()</code>: åˆ é™¤é‡å¤è¡Œã€‚</li>
</ul></li>
<li><strong>é‡å‘½ååˆ—ï¼š</strong>
<ul>
<li><code>col_mapping = ...</code>: å°†æ—§åç§°æ˜ å°„åˆ°æ–°åç§°ï¼ˆæ›´æ¸…æ™°ï¼‰ã€‚</li>
<li><code>info = info.rename(..., copy=False)</code>: é‡å‘½å <code>info</code> åˆ—ï¼ˆåŸåœ°ï¼‰ã€‚</li>
<li><code>nutrients = nutrients.rename(...)</code>: é‡å‘½å <code>nutrients</code> åˆ—ã€‚</li>
</ul></li>
</ul>
</section>
<section id="åˆå¹¶é£Ÿç‰©å’Œè¥å…»æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="åˆå¹¶é£Ÿç‰©å’Œè¥å…»æ•°æ®">åˆå¹¶é£Ÿç‰©å’Œè¥å…»æ•°æ®</h2>
<p>```<code>goylqeae ndata = pd.merge(nutrients, info, on='id')  # åŸºäº 'id' åˆ—åˆå¹¶ nutrients å’Œ info DataFrame print(ndata.info())  # æ˜¾ç¤ºåˆå¹¶åçš„ DataFrame çš„ä¿¡æ¯ print(ndata.iloc[30000])  # æ˜¾ç¤ºç¬¬ 30001 è¡Œæ•°æ®</code></p>
<ul>
<li><strong><code>ndata = pd.merge(nutrients, info, on='id')</code></strong>: åŸºäº â€˜idâ€™ åˆå¹¶ã€‚åŒ…å«æ‰€æœ‰ä¿¡æ¯çš„å•ä¸ª DataFrameã€‚</li>
<li><strong><code>ndata.info()</code></strong>: æ‘˜è¦ã€‚</li>
<li><strong><code>ndata.iloc[30000]</code></strong>: ç¤ºä¾‹è¡Œã€‚</li>
</ul>
</section>
<section id="ç»˜åˆ¶ä¸­ä½æ•°è¥å…»å€¼" class="level2">
<h2 class="anchored" data-anchor-id="ç»˜åˆ¶ä¸­ä½æ•°è¥å…»å€¼">ç»˜åˆ¶ä¸­ä½æ•°è¥å…»å€¼</h2>
<p>```<code>goylqeae result = ndata.groupby(['nutrient', 'fgroup'])['value'].quantile(0.5)  # æŒ‰ 'nutrient' å’Œ 'fgroup' åˆ†ç»„ï¼Œè®¡ç®— 'value' çš„ä¸­ä½æ•° result['Zinc, Zn'].sort_values().plot(kind='barh')  # ç»˜åˆ¶é”Œçš„ä¸­ä½æ•°ï¼ŒæŒ‰å€¼æ’åºï¼Œæ°´å¹³æ¡å½¢å›¾ plt.show() # æ˜¾ç¤ºç»˜å›¾</code></p>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> å¯è§†åŒ–æ¯ä¸ªé£Ÿç‰©ç»„çš„ä¸­ä½æ•°è¥å…»å€¼ã€‚</li>
<li><strong><code>result = ndata.groupby(['nutrient', 'fgroup'])['value'].quantile(0.5)</code></strong>:
<ul>
<li>æŒ‰è¥å…»ç´ å’Œé£Ÿç‰©ç»„åˆ†ç»„ã€‚</li>
<li>è®¡ç®— â€˜valueâ€™ çš„ä¸­ä½æ•°ï¼ˆ0.5 åˆ†ä½æ•°ï¼‰ã€‚</li>
</ul></li>
<li><strong><code>result['Zinc, Zn']...plot(kind='barh')</code></strong>:
<ul>
<li>é€‰æ‹©é”Œã€‚</li>
<li>å¯¹å€¼è¿›è¡Œæ’åºã€‚</li>
<li>æ°´å¹³æ¡å½¢å›¾ã€‚</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="zinc_values_foodgroup.png" class="img-fluid figure-img"></p>
<figcaption>â€˜æŒ‰é£Ÿç‰©ç»„åˆ’åˆ†çš„é”Œä¸­ä½æ•°å€¼â€™</figcaption>
</figure>
</div>
</section>
<section id="æŸ¥æ‰¾å…·æœ‰æœ€å¤§è¥å…»å€¼çš„é£Ÿç‰©" class="level2">
<h2 class="anchored" data-anchor-id="æŸ¥æ‰¾å…·æœ‰æœ€å¤§è¥å…»å€¼çš„é£Ÿç‰©">æŸ¥æ‰¾å…·æœ‰æœ€å¤§è¥å…»å€¼çš„é£Ÿç‰©</h2>
<p>``````goylqeae by_nutrient = ndata.groupby([â€˜nutgroupâ€™, â€˜nutrientâ€™]) # æŒ‰ â€˜nutgroupâ€™ å’Œ â€˜nutrientâ€™ åˆ†ç»„</p>
<p>def get_maximum(x): return x.loc[x.value.idxmax()] # è·å–æ¯ä¸ªåˆ†ç»„ä¸­ â€˜valueâ€™ æœ€å¤§çš„è¡Œ</p>
<p>max_foods = by_nutrient.apply(get_maximum)[[â€˜valueâ€™, â€˜foodâ€™]] # åº”ç”¨å‡½æ•°ï¼Œå¹¶é€‰æ‹© â€˜valueâ€™ å’Œ â€˜foodâ€™ åˆ— max_foods[â€˜foodâ€™] = max_foods[â€˜foodâ€™].str[:50] # æˆªæ–­ â€˜foodâ€™ åˆ—çš„é•¿åº¦ print(max_foods.loc[â€˜Amino Acidsâ€™][â€˜foodâ€™]) # æ˜¾ç¤ºæ°¨åŸºé…¸ç»„ä¸­ï¼Œå„ç§è¥å…»ç´ å«é‡æœ€é«˜çš„é£Ÿç‰©</p>
<pre><code>
-   **ç›®æ ‡ï¼š** æ¯ç§è¥å…»ç´ *å«é‡æœ€é«˜*çš„é£Ÿç‰©ã€‚
-   **`by_nutrient = ndata.groupby(['nutgroup', 'nutrient'])`**: æŒ‰è¥å…»ç´ ç»„å’Œåç§°åˆ†ç»„ã€‚
-   **`get_maximum(x)` å‡½æ•°ï¼š**
    -   æ¥æ”¶ä¸€ä¸ªåˆ†ç»„ã€‚
    -   `x.value.idxmax()`:  'value' æœ€å¤§çš„è¡Œçš„*ç´¢å¼•*ã€‚
    -   `x.loc[...]`:  é€‰æ‹©è¯¥è¡Œã€‚
-   **`max_foods = ...`**: åº”ç”¨ `get_maximum`ï¼Œé€‰æ‹© 'value' å’Œ 'food'ã€‚
-   **`max_foods['food'] = ...str[:50]`**: ç¼©çŸ­é£Ÿç‰©åç§°ã€‚

## 13.5 2012 å¹´è”é‚¦é€‰ä¸¾å§”å‘˜ä¼šæ•°æ®åº“ ğŸ—³ï¸

-   **æ•°æ®é›†ï¼š** 2012 å¹´ç¾å›½ FEC ç«é€‰ææ¬¾æ•°æ®ã€‚
-   **å†…å®¹ï¼š**
    -   ææ¬¾äººå§“åã€‚
    -   èŒä¸š/é›‡ä¸»ã€‚
    -   åœ°å€ã€‚
    -   ææ¬¾é‡‘é¢ã€‚
-   **æ•°æ®æ ¼å¼ï¼š** CSVã€‚
-   **æ–‡ä»¶ï¼š**  `P00000001-ALL.csv`ã€‚
-   **ç›®æ ‡ï¼š** åˆ†æææ¬¾æ¨¡å¼ã€‚

``````{python}
import pandas as pd
fec = pd.read_csv('datasets/fec/P00000001-ALL.csv', low_memory=False)  # è¯»å– CSV æ–‡ä»¶
print(fec.info())  # æ˜¾ç¤º DataFrame çš„ä¿¡æ¯
print(fec.iloc[123456])  # æ˜¾ç¤ºç¬¬ 123457 è¡Œæ•°æ®</code></pre>
<ul>
<li><strong><code>fec = pd.read_csv(...)</code></strong>: åŠ è½½ CSVã€‚</li>
<li><strong><code>low_memory=False</code></strong>: <em>é‡è¦</em>ã€‚å¤§æ–‡ä»¶ï¼›ä½¿ç”¨ <code>False</code> ä»¥è¿›è¡Œå‡†ç¡®çš„ç±»å‹æ¨æ–­ã€‚</li>
<li><strong><code>fec.info()</code></strong>: æ‘˜è¦ã€‚</li>
<li><strong><code>fec.iloc[123456]</code></strong>: ç¤ºä¾‹è®°å½•ã€‚</li>
</ul>
<p><img src="fec_intro.png" class="img-fluid"></p>
</section>
<section id="æ·»åŠ æ”¿å…šå½’å±" class="level2">
<h2 class="anchored" data-anchor-id="æ·»åŠ æ”¿å…šå½’å±">æ·»åŠ æ”¿å…šå½’å±</h2>
<p>``````goylqeae unique_cands = fec[â€˜cand_nmâ€™].unique() # è·å–å”¯ä¸€çš„å€™é€‰äººå§“å print(unique_cands) # æ˜¾ç¤ºå”¯ä¸€çš„å€™é€‰äººå§“å</p>
<p>parties = {â€˜Bachmann, Michelleâ€™: â€˜Republicanâ€™, # å€™é€‰äººå§“åä¸æ”¿å…šçš„æ˜ å°„å­—å…¸ â€˜Cain, Hermanâ€™: â€˜Republicanâ€™, â€˜Gingrich, Newtâ€™: â€˜Republicanâ€™, â€˜Huntsman, Jonâ€™: â€˜Republicanâ€™, â€˜Johnson, Gary Earlâ€™: â€˜Republicanâ€™, â€˜McCotter, Thaddeus Gâ€™: â€˜Republicanâ€™, â€˜Obama, Barackâ€™: â€˜Democratâ€™, â€˜Paul, Ronâ€™: â€˜Republicanâ€™, â€˜Pawlenty, Timothyâ€™: â€˜Republicanâ€™, â€˜Perry, Rickâ€™: â€˜Republicanâ€™, â€œRoemer, Charles E. â€˜Buddyâ€™ IIIâ€: â€˜Republicanâ€™, â€˜Romney, Mittâ€™: â€˜Republicanâ€™, â€˜Santorum, Rickâ€™: â€˜Republicanâ€™}</p>
<p>print(fec[â€˜cand_nmâ€™][123456:123461]) # æ˜¾ç¤ºä¸€éƒ¨åˆ†å€™é€‰äººå§“å print(fec[â€˜cand_nmâ€™][123456:123461].map(parties)) # å°†è¿™äº›å€™é€‰äººå§“åæ˜ å°„åˆ°æ”¿å…š</p>
<p>fec[â€˜partyâ€™] = fec[â€˜cand_nmâ€™].map(parties) # åŸºäºæ˜ å°„å­—å…¸ï¼Œåˆ›å»º â€˜partyâ€™ åˆ— print(fec[â€˜partyâ€™].value_counts()) # ç»Ÿè®¡æ¯ä¸ªæ”¿å…šçš„ææ¬¾æ•°é‡</p>
<pre><code>
-   **`unique_cands = fec['cand_nm'].unique()`**: å”¯ä¸€å€™é€‰äººå§“åã€‚
-   **`parties = {...}`**:  å­—å…¸ï¼šå€™é€‰äººå§“å -&gt; æ”¿å…šã€‚
-   **`fec['cand_nm'][...].map(parties)`**:  å±•ç¤º `map` çš„å·¥ä½œåŸç†ã€‚
-   **`fec['party'] = fec['cand_nm'].map(parties)`**: åˆ›å»º 'party' åˆ—ã€‚
-   **`fec['party'].value_counts()`**:  æ¯ä¸ªæ”¿å…šçš„è®¡æ•°ã€‚

## è¿‡æ»¤ææ¬¾ï¼ˆä»…é™æ­£é‡‘é¢ï¼‰

``````{python}
print((fec['contb_receipt_amt'] &gt; 0).value_counts())  # ç»Ÿè®¡ææ¬¾é‡‘é¢å¤§äº 0 å’Œå°äºç­‰äº 0 çš„æ•°é‡

fec = fec[fec['contb_receipt_amt'] &gt; 0]  # ä»…ä¿ç•™ææ¬¾é‡‘é¢å¤§äº 0 çš„æ•°æ®</code></pre>
<ul>
<li><strong>é—®é¢˜</strong>ï¼šåŒ…æ‹¬ææ¬¾ï¼ˆæ­£ï¼‰å’Œé€€æ¬¾ï¼ˆè´Ÿï¼‰ã€‚</li>
<li><strong><code>(... &gt; 0).value_counts()</code></strong>: æ£€æŸ¥æ­£/è´Ÿè®¡æ•°ã€‚</li>
<li><strong><code>fec = fec[... &gt; 0]</code></strong>: è¿‡æ»¤ä»¥ä»…ä¿ç•™æ­£ææ¬¾ã€‚</li>
</ul>
</section>
<section id="æŒ‰å€™é€‰äººè¿‡æ»¤å¥¥å·´é©¬å’Œç½—å§†å°¼" class="level2">
<h2 class="anchored" data-anchor-id="æŒ‰å€™é€‰äººè¿‡æ»¤å¥¥å·´é©¬å’Œç½—å§†å°¼">æŒ‰å€™é€‰äººè¿‡æ»¤ï¼ˆå¥¥å·´é©¬å’Œç½—å§†å°¼ï¼‰</h2>
<p>```<code>goylqeae fec_mrbo = fec[fec['cand_nm'].isin(['Obama, Barack', 'Romney, Mitt'])]  # ä»…ä¿ç•™å¥¥å·´é©¬å’Œç½—å§†å°¼çš„ææ¬¾æ•°æ®</code></p>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> å…³æ³¨ä¸¤ä½ä¸»è¦å€™é€‰äººã€‚</li>
<li><strong><code>fec_mrbo = fec[fec['cand_nm'].isin([...])]</code></strong>: è¿‡æ»¤å¥¥å·´é©¬/ç½—å§†å°¼ã€‚</li>
</ul>
</section>
<section id="æŒ‰èŒä¸šå’Œé›‡ä¸»åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡" class="level2">
<h2 class="anchored" data-anchor-id="æŒ‰èŒä¸šå’Œé›‡ä¸»åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡">æŒ‰èŒä¸šå’Œé›‡ä¸»åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡</h2>
<p>``````goylqeae print(fec[â€˜contbr_occupationâ€™].value_counts()[:10]) # ç»Ÿè®¡å¹¶æ˜¾ç¤ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å‰ 10 ä¸ªèŒä¸š</p>
<p>occ_mapping = { # èŒä¸šæ˜ å°„å­—å…¸ï¼Œå°†ç›¸ä¼¼çš„èŒä¸šåç§°ç»Ÿä¸€ â€˜INFORMATION REQUESTED PER BEST EFFORTSâ€™ : â€˜NOT PROVIDEDâ€™, â€˜INFORMATION REQUESTEDâ€™ : â€˜NOT PROVIDEDâ€™, â€˜INFORMATION REQUESTED (BEST EFFORTS)â€™ : â€˜NOT PROVIDEDâ€™, â€˜C.E.O.â€™: â€˜CEOâ€™ }</p>
<p>def get_occ(x): # å¦‚æœæ²¡æœ‰æä¾›æ˜ å°„ï¼Œåˆ™è¿”å› x return occ_mapping.get(x, x) # è·å–æ˜ å°„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›åŸå€¼</p>
<p>fec[â€˜contbr_occupationâ€™] = fec[â€˜contbr_occupationâ€™].map(get_occ) # åº”ç”¨èŒä¸šæ˜ å°„</p>
<pre><code>
-   **`fec['contbr_occupation'].value_counts()[:10]`**: å‰ 10 ä¸ªèŒä¸šã€‚
-   **é—®é¢˜ï¼š** ç›¸ä¼¼èŒä¸šçš„å˜ä½“ ("INFORMATION REQUESTED")ã€‚
-   **`occ_mapping = {...}`**: å°†å˜ä½“æ˜ å°„åˆ°æ ‡å‡†å½¢å¼ã€‚
-   **`get_occ(x)` å‡½æ•°ï¼š**
    -   ä½¿ç”¨ `occ_mapping.get(x, x)`ã€‚å¦‚æœ `x` åœ¨å­—å…¸ä¸­ï¼Œåˆ™è¿”å›æ˜ å°„çš„å€¼ï¼›å¦åˆ™ï¼Œè¿”å› `x`ã€‚
-   **`fec['contbr_occupation'] = ...map(get_occ)`**: æ ‡å‡†åŒ–èŒä¸šã€‚

## æŒ‰èŒä¸šå’Œé›‡ä¸»åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡ï¼ˆç»­ï¼‰- é›‡ä¸» + æ•°æ®é€è§†è¡¨

``````{python}
emp_mapping = {  # é›‡ä¸»æ˜ å°„å­—å…¸ï¼Œå°†ç›¸ä¼¼çš„é›‡ä¸»åç§°ç»Ÿä¸€
    'INFORMATION REQUESTED PER BEST EFFORTS' : 'NOT PROVIDED',
    'INFORMATION REQUESTED' : 'NOT PROVIDED',
    'SELF' : 'SELF-EMPLOYED',
    'SELF EMPLOYED' : 'SELF-EMPLOYED',
}

def get_emp(x):
    # å¦‚æœæ²¡æœ‰æä¾›æ˜ å°„ï¼Œåˆ™è¿”å› x
    return emp_mapping.get(x, x)  # è·å–æ˜ å°„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›åŸå€¼

fec['contbr_employer'] = fec['contbr_employer'].map(get_emp)  # åº”ç”¨é›‡ä¸»æ˜ å°„

by_occupation = fec.pivot_table('contb_receipt_amt',  # åˆ›å»ºæ•°æ®é€è§†è¡¨
                                index='contbr_occupation',  # ä»¥ 'contbr_occupation' ä¸ºç´¢å¼•
                                columns='party', aggfunc='sum')  # ä»¥ 'party' ä¸ºåˆ—ï¼Œè®¡ç®— 'contb_receipt_amt' çš„æ€»å’Œ

over_2mm = by_occupation[by_occupation.sum(axis="columns") &gt; 2000000]  # ç­›é€‰å‡ºæ€»ææ¬¾é‡‘é¢å¤§äº 200 ä¸‡çš„èŒä¸š
print(over_2mm)  # æ˜¾ç¤ºç­›é€‰ç»“æœ</code></pre>
<ul>
<li><p>é›‡ä¸»ï¼šä¸èŒä¸šç›¸åŒçš„è¿‡ç¨‹ã€‚</p></li>
<li><p><strong><code>by_occupation = fec.pivot_table(...)</code></strong>: æŒ‰èŒä¸š/æ”¿å…šçš„ææ¬¾ã€‚</p>
<ul>
<li><code>'contb_receipt_amt'</code>: è¦èšåˆçš„å€¼ã€‚</li>
<li><code>index='contbr_occupation'</code>: èŒä¸šæ˜¯è¡Œç´¢å¼•ã€‚</li>
<li><code>columns='party'</code>: æ”¿å…šæˆä¸ºåˆ—ã€‚</li>
<li><code>aggfunc='sum'</code>: æ€»ææ¬¾ã€‚</li>
</ul></li>
<li><p><strong><code>over_2mm = ...</code></strong>: æ€»ææ¬¾ &gt; 200 ä¸‡ç¾å…ƒçš„èŒä¸šã€‚</p></li>
</ul>
<p>```<code>goylqeae over_2mm.plot(kind='barh')  # ç»˜åˆ¶æ°´å¹³æ¡å½¢å›¾ plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="donations_by_occupation.png" class="img-fluid figure-img"></p>
<figcaption>â€˜æŒ‰çƒ­é—¨èŒä¸šåˆ’åˆ†çš„å„æ”¿å…šæ€»ææ¬¾é¢â€™</figcaption>
</figure>
</div>
</section>
<section id="çƒ­é—¨ææ¬¾äººèŒä¸šå’Œé›‡ä¸»é’ˆå¯¹å¥¥å·´é©¬å’Œç½—å§†å°¼" class="level2">
<h2 class="anchored" data-anchor-id="çƒ­é—¨ææ¬¾äººèŒä¸šå’Œé›‡ä¸»é’ˆå¯¹å¥¥å·´é©¬å’Œç½—å§†å°¼">çƒ­é—¨ææ¬¾äººèŒä¸šå’Œé›‡ä¸»ï¼ˆé’ˆå¯¹å¥¥å·´é©¬å’Œç½—å§†å°¼ï¼‰</h2>
<p>``````goylqeae def get_top_amounts(group, key, n=5): totals = group.groupby(key)[â€˜contb_receipt_amtâ€™].sum() # æŒ‰ key åˆ†ç»„ï¼Œè®¡ç®— â€˜contb_receipt_amtâ€™ çš„æ€»å’Œ return totals.nlargest(n) # è¿”å›æ€»å’Œæœ€å¤§çš„å‰ n ä¸ª</p>
<p>grouped = fec_mrbo.groupby(â€˜cand_nmâ€™) # æŒ‰å€™é€‰äººå§“ååˆ†ç»„ print(grouped.apply(get_top_amounts, â€˜contbr_occupationâ€™, n=7)) # è·å–æ¯ä¸ªå€™é€‰äººææ¬¾é‡‘é¢æœ€å¤šçš„å‰ 7 ä¸ªèŒä¸š print(grouped.apply(get_top_amounts, â€˜contbr_employerâ€™, n=10)) # è·å–æ¯ä¸ªå€™é€‰äººææ¬¾é‡‘é¢æœ€å¤šçš„å‰ 10 ä¸ªé›‡ä¸»</p>
<pre><code>
-   **`get_top_amounts(group, key, n=5)` å‡½æ•°ï¼š**
    -   `group`: DataFrame åˆ†ç»„ï¼ˆä¾‹å¦‚ï¼Œä¸€ä½å€™é€‰äººçš„ææ¬¾ï¼‰ã€‚
    -   `key`: è¦åˆ†ç»„çš„åˆ—ï¼ˆèŒä¸š/é›‡ä¸»ï¼‰ã€‚
    -   `n`: çƒ­é—¨é¡¹ç›®çš„æ•°é‡ã€‚
    -   è®¡ç®—æ¯ä¸ªèŒä¸š/é›‡ä¸»çš„æ€»ææ¬¾ï¼Œè¿”å›å‰ `n` ä¸ªã€‚
-   **`grouped = fec_mrbo.groupby('cand_nm')`**: æŒ‰å€™é€‰äººåˆ†ç»„ã€‚
-   **`grouped.apply(...)`**:  æŸ¥æ‰¾*æ¯ä¸ªå€™é€‰äºº*çš„çƒ­é—¨èŒä¸š/é›‡ä¸»ã€‚

## å¯¹ææ¬¾é‡‘é¢è¿›è¡Œåˆ†æ¡¶

``````{python}
import numpy as np

bins = np.array([0, 1, 10, 100, 1000, 10000, 100_000, 1_000_000, 10_000_000])  # å®šä¹‰åˆ†æ¡¶è¾¹ç•Œ
labels = pd.cut(fec_mrbo['contb_receipt_amt'], bins)  # å°†ææ¬¾é‡‘é¢åˆ†é…åˆ°å„ä¸ªæ¡¶ä¸­
print(labels)  # æ˜¾ç¤ºåˆ†æ¡¶ç»“æœ

grouped = fec_mrbo.groupby(['cand_nm', labels])  # æŒ‰å€™é€‰äººå§“åå’Œåˆ†æ¡¶æ ‡ç­¾åˆ†ç»„
print(grouped.size().unstack(level=0))  # ç»Ÿè®¡æ¯ä¸ªå€™é€‰äººåœ¨æ¯ä¸ªæ¡¶ä¸­çš„ææ¬¾æ•°é‡

bucket_sums = grouped['contb_receipt_amt'].sum().unstack(level=0)  # è®¡ç®—æ¯ä¸ªå€™é€‰äººåœ¨æ¯ä¸ªæ¡¶ä¸­çš„æ€»ææ¬¾é‡‘é¢
normed_sums = bucket_sums.div(bucket_sums.sum(axis="columns"),  # è®¡ç®—æ¯ä¸ªæ¡¶ä¸­ï¼Œæ¯ä¸ªå€™é€‰äººææ¬¾é‡‘é¢çš„æ¯”ä¾‹
                              axis="index")
print(normed_sums)  # æ˜¾ç¤ºæ¯”ä¾‹
normed_sums[:-2].plot(kind='barh')  # ç»˜åˆ¶æ°´å¹³æ¡å½¢å›¾ï¼Œä¸åŒ…æ‹¬æœ€å¤§çš„ä¸¤ä¸ªæ¡¶
plt.show()  #æ˜¾ç¤ºç»˜å›¾</code></pre>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> æŒ‰ææ¬¾è§„æ¨¡åˆ†æ¡£åˆ†æã€‚</li>
<li><strong><code>bins = np.array([...])</code></strong>: å®šä¹‰æ¡¶è¾¹ç•Œã€‚</li>
<li><strong><code>labels = pd.cut(..., bins)</code></strong>: å°†æ¯ä¸ªææ¬¾åˆ†é…åˆ°ä¸€ä¸ªæ¡¶ã€‚</li>
<li><strong><code>grouped = ...groupby(['cand_nm', labels])</code></strong>: æŒ‰å€™é€‰äºº<em>å’Œ</em>æ¡¶åˆ†ç»„ã€‚</li>
<li><strong><code>grouped.size().unstack(...)</code></strong>: æ¯ä¸ªæ¡¶/å€™é€‰äººçš„è®¡æ•°ã€‚</li>
<li><strong><code>bucket_sums = ...</code></strong>: æ¯ä¸ªæ¡¶/å€™é€‰äººçš„<em>æ€»</em>é‡‘é¢ã€‚</li>
<li><strong><code>normed_sums = ...</code></strong>: æ¯ä¸ªæ¡¶/å€™é€‰äººçš„<em>ç™¾åˆ†æ¯”</em>ï¼ˆæ ‡å‡†åŒ–ï¼‰ã€‚</li>
<li><strong><code>normed_sums[:-2].plot(kind='barh')</code></strong>: æ¡å½¢å›¾ï¼ˆä¸åŒ…æ‹¬æœ€å¤§çš„æ¡¶ï¼‰ã€‚</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="donation_size.png" class="img-fluid figure-img"></p>
<figcaption>â€˜å€™é€‰äººæ”¶åˆ°çš„å„ç§è§„æ¨¡ææ¬¾å æ€»ææ¬¾çš„ç™¾åˆ†æ¯”â€™</figcaption>
</figure>
</div>
</section>
<section id="æŒ‰å·åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡" class="level2">
<h2 class="anchored" data-anchor-id="æŒ‰å·åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡">æŒ‰å·åˆ’åˆ†çš„ææ¬¾ç»Ÿè®¡</h2>
<p>``````goylqeae grouped = fec_mrbo.groupby([â€˜cand_nmâ€™, â€˜contbr_stâ€™]) # æŒ‰å€™é€‰äººå§“åå’Œå·åˆ†ç»„ totals = grouped[â€˜contb_receipt_amtâ€™].sum().unstack(level=0).fillna(0) # è®¡ç®—æ¯ä¸ªå€™é€‰äººåœ¨æ¯ä¸ªå·çš„æ€»ææ¬¾é‡‘é¢ï¼Œå¹¶å¡«å……ç¼ºå¤±å€¼ totals = totals[totals.sum(axis=â€œcolumnsâ€) &gt; 100000] # ç­›é€‰å‡ºæ€»ææ¬¾é‡‘é¢å¤§äº 10 ä¸‡çš„å· print(totals.head(10)) # æ˜¾ç¤ºå‰ 10 è¡Œ</p>
<p>percent = totals.div(totals.sum(axis=â€œcolumnsâ€), axis=â€œindexâ€) # è®¡ç®—æ¯ä¸ªå·ä¸­ï¼Œæ¯ä¸ªå€™é€‰äººææ¬¾é‡‘é¢çš„æ¯”ä¾‹ print(percent.head(10)) # æ˜¾ç¤ºå‰ 10 è¡Œ ```</p>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> æŒ‰ææ¬¾äººæ‰€åœ¨å·è¿›è¡Œåˆ†æã€‚</li>
<li><strong><code>grouped = ...groupby(['cand_nm', 'contbr_st'])</code></strong>: æŒ‰å€™é€‰äºº/å·åˆ†ç»„ã€‚</li>
<li><strong><code>totals = ...sum().unstack(...).fillna(0)</code></strong>: æ¯ä¸ªå·/å€™é€‰äººçš„æ€»æ•°ã€‚<code>unstack</code> å°†å€™é€‰äººä½œä¸ºåˆ—ï¼Œ<code>fillna(0)</code> å¤„ç†ç¼ºå¤±æ•°æ®ã€‚</li>
<li><strong><code>totals = totals[...]</code></strong>: è¿‡æ»¤æ€»æ•° &gt; 100,000 ç¾å…ƒçš„å·ã€‚</li>
<li><strong><code>percent = totals.div(...)</code></strong>: æ¯ä¸ªå·/å€™é€‰äººçš„<em>ç™¾åˆ†æ¯”</em>ã€‚</li>
</ul>
</section>
<section id="æ€»ç»“" class="level2">
<h2 class="anchored" data-anchor-id="æ€»ç»“">æ€»ç»“</h2>
<ul>
<li>æ¼”ç¤ºäº†ä½¿ç”¨ ```{python} è¿›è¡ŒçœŸå®ä¸–ç•Œæ•°æ®åˆ†æã€‚</li>
<li>æ•°æ®é›†ï¼šBitly/USA.govã€MovieLensã€å©´å„¿å§“åã€USDA é£Ÿå“ã€FECã€‚</li>
<li><strong>å…³é”®æŠ€æœ¯ï¼š</strong>
<ul>
<li>åŠ è½½ï¼ˆæ–‡æœ¬ã€JSONã€CSVï¼‰ã€‚</li>
<li>æ¸…ç†/è½¬æ¢ï¼ˆç¼ºå¤±æ•°æ®ã€å­—ç¬¦ä¸²ã€ç±»å‹ï¼‰ã€‚</li>
<li>èšåˆ/åˆ†ç»„ (<code>groupby</code>ã€<code>pivot_table</code>ã€<code>apply</code>)ã€‚</li>
<li>åˆå¹¶/é‡å¡‘ (<code>merge</code>ã€<code>concat</code>ã€<code>unstack</code>ã€<code>stack</code>ã€<code>explode</code>)ã€‚</li>
<li>å¯è§†åŒ– (matplotlib, seaborn)ã€‚</li>
<li>æ—¶é—´åºåˆ—ã€‚</li>
</ul></li>
<li>è¿­ä»£æ¢ç´¢ï¼šä»åŸå§‹æ•°æ®å¼€å§‹ï¼Œæ¸…ç†ï¼Œå¹¶æ„å»ºåˆ†æã€‚</li>
</ul>
</section>
<section id="æ€è€ƒå’Œè®¨è®º" class="level2">
<h2 class="anchored" data-anchor-id="æ€è€ƒå’Œè®¨è®º">æ€è€ƒå’Œè®¨è®º</h2>
<ul>
<li>å¦‚ä½•æ‰©å±•/æ”¹è¿›è¿™äº›åˆ†æï¼Ÿå…¶ä»–é—®é¢˜ï¼Ÿ</li>
<li>å±€é™æ€§å’Œå‡è®¾ï¼Ÿåå·®ï¼Ÿ</li>
<li>å°†æŠ€æœ¯åº”ç”¨äºå…¶ä»–æ•°æ®é›†ï¼Ÿ</li>
<li>çœŸå®ä¸–ç•Œæ•°æ®ï¼ˆå°¤å…¶æ˜¯å…³äºäººçš„æ•°æ®ï¼‰çš„ä¼¦ç†è€ƒè™‘ï¼Ÿ</li>
<li>æƒè¡¡ï¼šçº¯ ``<code>{python}ã€</code>collections`ã€pandasã€‚ä»€ä¹ˆæ—¶å€™æœ€å¥½ï¼Ÿ</li>
<li>å¯è§†åŒ–é€‰æ‹©å¦‚ä½•å½±å“è§è§£ï¼Ÿ</li>
<li>æ¢ç´¢å®˜æ–¹æ–‡æ¡£ä»¥åŠ æ·±ç†è§£ã€‚</li>
<li>å•†ç§‘ä¸“ä¸šï¼šè¿™äº›æŠ€èƒ½å¯¹èŒä¸šæœ‰ä½•ç”¨å¤„ï¼Ÿæä¾›ç«äº‰ä¼˜åŠ¿ã€‚</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/qiufei\.github\.io\/web-slide-pandas3ed");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>ğŸ”‹<a href="https://posit.co"><img src="https://posit.co/wp-content/themes/Posit/assets/images/posit-logo-2024.svg" class="img-fluid" alt="Posit" width="65"></a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 é‚±é£ Â© 2025
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://beian.miit.gov.cn">
<p>æµ™ICPå¤‡ 2024072710å·-1</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33021202002511">
<p>æµ™å…¬ç½‘å®‰å¤‡ 33021202002511å·</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:hfutqiufei@163.com">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>