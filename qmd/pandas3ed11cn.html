<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python 数据分析</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../https://assets.qiufei.site/personal/profile.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-681fbf911679f9b3dbf9743eb275ba49.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-7e49aeac8059a213a463aa1a739e8272.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="https://assets.qiufei.site/setup/styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io"> 
<span class="menu-text">首页</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io/web-slide"> 
<span class="menu-text">课件</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Python 数据分析</h1>
<p class="subtitle lead">第 11 章 时间序列</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="c77793ad" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SETUP (提供的代码 - 需要放在 notebook 的顶部)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy 库，用于数值计算，并简写为 np</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas 库，用于数据分析，并简写为 pd</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta  <span class="co"># 从 datetime 模块导入 datetime 和 timedelta 类</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz  <span class="co"># 导入 pytz 库，用于处理时区</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.offsets <span class="im">import</span> Hour, Minute, Day, MonthEnd  <span class="co"># 从 pandas 导入时间偏移对象</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 为了演示，在此特定 notebook 中抑制 FutureWarnings</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings  <span class="co"># 导入 warnings 模块</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)  <span class="co"># 忽略 FutureWarnings</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 用于绘图</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt  <span class="co"># 导入 matplotlib.pyplot 模块，用于绘图，并简写为 plt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="时间序列数据简介" class="level2">
<h2 class="anchored" data-anchor-id="时间序列数据简介">时间序列数据简介</h2>
<p>时间序列数据是按时间间隔收集的一系列数据点。⏱️ 它在各个领域都是至关重要的数据类型：</p>
<ul>
<li><strong>金融:</strong> 股票价格、交易量、利率 💰</li>
<li><strong>经济:</strong> GDP、通货膨胀率、失业率 📈</li>
<li><strong>生态:</strong> 种群规模、温度变化 🌡️</li>
<li><strong>神经科学:</strong> 脑电波活动、神经信号 🧠</li>
<li><strong>物理:</strong> 运动、速度、加速度 🚀</li>
</ul>
<p>本质上，任何随时间重复记录的内容都构成时间序列。</p>
</section>
<section id="时间序列数据的类型" class="level2">
<h2 class="anchored" data-anchor-id="时间序列数据的类型">时间序列数据的类型</h2>
<p>时间序列数据可以根据数据点相对于时间的度量方式进行分类：</p>
<ol type="1">
<li><strong>时间戳 (Timestamps):</strong> 时间上的特定时刻 (例如，2024-10-27 09:30:00)。</li>
<li><strong>固定周期 (Fixed Periods):</strong> 表示整个持续时间 (例如，2017 年 1 月，2020 年)。</li>
<li><strong>时间间隔 (Intervals of Time):</strong> 由开始和结束时间戳指示 (例如，从下午 2:00 到 2:30 的用户会话)。</li>
<li><strong>实验或经过时间 (Experiment or Elapsed Time):</strong> 相对于起始点的时间 (例如，饼干放入烤箱后的秒数)。</li>
</ol>
<p>本章主要关注前三种类型 (时间戳、固定周期和时间间隔)。</p>
</section>
<section id="时间序列规则与不规则" class="level2">
<h2 class="anchored" data-anchor-id="时间序列规则与不规则">时间序列：规则与不规则</h2>
<p>时间序列也可以是：</p>
<ul>
<li><strong>固定频率 (规则):</strong> 数据点以固定的时间间隔出现 (例如，每 15 秒、每 5 分钟、每月)。🗓️</li>
<li><strong>不规则:</strong> 数据点不遵循固定的时间单位 (例如，网站访问的时间戳)。🚶</li>
</ul>
<p>表示方式的选择取决于具体的应用。</p>
</section>
<section id="pandas-中的时间序列" class="level2">
<h2 class="anchored" data-anchor-id="pandas-中的时间序列">pandas 中的时间序列</h2>
<p><code>pandas</code> 是一个强大的 Python 库，为时间序列分析提供了广泛的工具。它允许你：</p>
<ul>
<li>高效处理大型时间序列。🗂️</li>
<li>切片、切块和聚合数据。🔪</li>
<li>对不规则和固定频率的时间序列进行重采样。🔄</li>
<li>处理缺失数据。❓</li>
</ul>
<p>这些功能对于金融和经济应用至关重要，但它们同样适用于分析各种数据集，如服务器日志。</p>
</section>
<section id="导入必要的库" class="level2">
<h2 class="anchored" data-anchor-id="导入必要的库">导入必要的库</h2>
<p>在深入研究时间序列操作之前，让我们导入必要的库：用于数值运算的 <code>NumPy</code> 和用于数据分析的 <code>pandas</code>。</p>
<div id="1cfc5ea2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy 库，用于数值计算</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas 库，用于数据分析</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="日期和时间数据类型及工具" class="level2">
<h2 class="anchored" data-anchor-id="日期和时间数据类型及工具">日期和时间数据类型及工具</h2>
<p>Python 的标准库提供了用于处理日期和时间的模块：</p>
<ul>
<li><code>datetime</code>: 提供用于操作日期和时间的类 (例如，<code>datetime</code>、<code>date</code>、<code>time</code>、<code>timedelta</code>)。</li>
<li><code>time</code>: 提供与时间相关的函数。</li>
<li><code>calendar</code>: 与日历相关的函数。</li>
</ul>
<p><code>datetime.datetime</code> 类型 (或简称为 <code>datetime</code>) 是常用的。</p>
</section>
<section id="datetime-对象" class="level2">
<h2 class="anchored" data-anchor-id="datetime-对象"><code>datetime</code> 对象</h2>
<p>让我们创建一个 <code>datetime</code> 对象来表示当前时间：</p>
<div id="85966232" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 从 datetime 模块导入 datetime 类</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>now <span class="op">=</span> datetime.now()  <span class="co"># 获取当前日期和时间</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(now)  <span class="co"># 打印当前日期和时间</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-02-19 14:22:41.543917</code></pre>
</div>
</div>
<p>此代码片段检索当前日期和时间。</p>
</section>
<section id="datetime-对象-续" class="level2">
<h2 class="anchored" data-anchor-id="datetime-对象-续"><code>datetime</code> 对象 (续)</h2>
<p>我们也可以手动构建一个 datetime 对象：</p>
<div id="50fb1f6e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 确保导入了 datetime 类</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>my_date <span class="op">=</span> datetime(<span class="dv">2024</span>, <span class="dv">10</span>, <span class="dv">27</span>, <span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">0</span>)  <span class="co"># 年、月、日、时、分、秒</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_date)  <span class="co"># 打印手动创建的 datetime 对象</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2024-10-27 10:30:00</code></pre>
</div>
</div>
<p>访问各个组成部分：</p>
<div id="88f6f9cc" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime <span class="co"># 确保导入了datetime</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>now <span class="op">=</span> datetime.now()  <span class="co"># 获取当前日期和时间</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Year: </span><span class="sc">{</span>now<span class="sc">.</span>year<span class="sc">}</span><span class="ss">, Month: </span><span class="sc">{</span>now<span class="sc">.</span>month<span class="sc">}</span><span class="ss">, Day: </span><span class="sc">{</span>now<span class="sc">.</span>day<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># 打印年、月、日</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Year: 2025, Month: 2, Day: 19</code></pre>
</div>
</div>
</section>
<section id="timedelta-对象" class="level2">
<h2 class="anchored" data-anchor-id="timedelta-对象"><code>timedelta</code> 对象</h2>
<p><code>timedelta</code> 对象表示两个 <code>datetime</code> 对象之间的差：</p>
<div id="fe6b32a8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 确保导入了 datetime</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>delta <span class="op">=</span> datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>) <span class="op">-</span> datetime(<span class="dv">2008</span>, <span class="dv">6</span>, <span class="dv">24</span>, <span class="dv">8</span>, <span class="dv">15</span>)  <span class="co"># 计算两个 datetime 对象之间的差</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delta)  <span class="co"># 打印时间差</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Days: </span><span class="sc">{</span>delta<span class="sc">.</span>days<span class="sc">}</span><span class="ss">, Seconds: </span><span class="sc">{</span>delta<span class="sc">.</span>seconds<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># 打印天数和秒数</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>926 days, 15:45:00
Days: 926, Seconds: 56700</code></pre>
</div>
</div>
</section>
<section id="timedelta-对象-续" class="level2">
<h2 class="anchored" data-anchor-id="timedelta-对象-续"><code>timedelta</code> 对象 (续)</h2>
<ul>
<li><code>delta.days</code>: 返回相差的天数。</li>
<li><code>delta.seconds</code>: 返回相差的秒数 (在最后一天内)。它<em>不</em>包括包含在 <code>days</code> 差异中的秒数。</li>
</ul>
</section>
<section id="timedelta-对象-续-1" class="level2">
<h2 class="anchored" data-anchor-id="timedelta-对象-续-1"><code>timedelta</code> 对象 (续)</h2>
<p>您可以将 <code>timedelta</code> 对象与 <code>datetime</code> 对象相加或相减：</p>
<div id="81f11bae" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta  <span class="co"># 确保导入了 datetime 和 timedelta</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>)  <span class="co"># 创建一个 datetime 对象</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(start <span class="op">+</span> timedelta(<span class="dv">12</span>))  <span class="co"># 加上 12 天</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(start <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> timedelta(<span class="dv">12</span>))  <span class="co"># 减去 24 天</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-19 00:00:00
2010-12-14 00:00:00</code></pre>
</div>
</div>
</section>
<section id="datetime-模块中的类型" class="level2">
<h2 class="anchored" data-anchor-id="datetime-模块中的类型"><code>datetime</code> 模块中的类型</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">类型</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>date</code></td>
<td style="text-align: left;">存储日历日期 (年、月、日)。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>time</code></td>
<td style="text-align: left;">存储一天中的时间 (小时、分钟、秒、微秒)。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>datetime</code></td>
<td style="text-align: left;">同时存储日期和时间。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>timedelta</code></td>
<td style="text-align: left;">表示两个 <code>datetime</code> 值之间的差。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>tzinfo</code></td>
<td style="text-align: left;">用于存储时区信息的基类型。</td>
</tr>
</tbody>
</table>
</section>
<section id="字符串和-datetime-之间的转换" class="level2">
<h2 class="anchored" data-anchor-id="字符串和-datetime-之间的转换">字符串和 Datetime 之间的转换</h2>
<ul>
<li><strong><code>strftime()</code>:</strong> 将 <code>datetime</code> 对象格式化<em>为</em>字符串。</li>
<li><strong><code>strptime()</code>:</strong> 将字符串解析<em>为</em> <code>datetime</code> 对象。</li>
<li><strong><code>pd.to_datetime()</code>:</strong> 在 pandas 中将字符串转换为 DatetimeIndex。</li>
</ul>
<div id="f38736d4" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 确保导入了 datetime</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>stamp <span class="op">=</span> datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">3</span>)  <span class="co"># 创建一个 datetime 对象</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># datetime to string</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">str</span>(stamp))  <span class="co"># 将 datetime 对象转换为字符串 (使用默认格式)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stamp.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>))  <span class="co"># 使用 strftime() 格式化日期 (年-月-日)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-03 00:00:00
2011-01-03</code></pre>
</div>
</div>
</section>
<section id="字符串和-datetime-之间的转换-续" class="level2">
<h2 class="anchored" data-anchor-id="字符串和-datetime-之间的转换-续">字符串和 Datetime 之间的转换 (续)</h2>
<div id="5dbfa2f4" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 确保导入了 datetime</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># string to datetime</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> <span class="st">'2011-01-03'</span>  <span class="co"># 定义一个日期字符串</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.strptime(value, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>))  <span class="co"># 使用 strptime() 将字符串解析为 datetime 对象</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>datestrs <span class="op">=</span> [<span class="st">'7/6/2011'</span>, <span class="st">'8/6/2011'</span>]  <span class="co"># 定义一个日期字符串列表</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>dt_list <span class="op">=</span> [datetime.strptime(x, <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%Y'</span>) <span class="cf">for</span> x <span class="kw">in</span> datestrs]  <span class="co"># 列表推导式，将字符串列表转换为 datetime 对象列表</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt_list)  <span class="co"># 打印 datetime 对象列表</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-03 00:00:00
[datetime.datetime(2011, 7, 6, 0, 0), datetime.datetime(2011, 8, 6, 0, 0)]</code></pre>
</div>
</div>
</section>
<section id="常用-strftime-和-strptime-格式代码" class="level2">
<h2 class="anchored" data-anchor-id="常用-strftime-和-strptime-格式代码">常用 <code>strftime</code> 和 <code>strptime</code> 格式代码</h2>
<div class="line-block">代码 | 描述 |<br>
: | :- |<br>
<code>%Y</code> | 4 位数的年份 |<br>
<code>%y</code> | 2 位数的年份 |<br>
<code>%m</code> | 2 位数的月份 [01, 12] |<br>
<code>%d</code> | 2 位数的日期 [01, 31] |<br>
<code>%H</code> | 小时 (24 小时制) [00, 23] |<br>
<code>%I</code> | 小时 (12 小时制) [01, 12] |<br>
<code>%M</code> | 2 位数的分钟 [00, 59] |<br>
<code>%S</code> | 秒 [00, 61] (60 和 61 用于闰秒) |<br>
<code>%f</code> | 微秒，整数，零填充 (从 000000 到 999999) |<br>
<code>%j</code> | 一年中的第几天，零填充整数 (从 001 到 366) |</div>
</section>
<section id="更多-strftime-和-strptime-格式代码" class="level2">
<h2 class="anchored" data-anchor-id="更多-strftime-和-strptime-格式代码">更多 <code>strftime</code> 和 <code>strptime</code> 格式代码</h2>
<div class="line-block">代码 | 描述 |<br>
:- | : |<br>
<code>%w</code> | 星期几，整数 [0 (星期日), 6] |<br>
<code>%u</code> | 星期几，从 1 开始的整数，1 代表星期一。 |<br>
<code>%U</code> | 一年中的周数 [00, 53]; 星期日是第一天，第一个星期日之前的日子是 “第 0 周” |<br>
<code>%W</code> | 一年中的周数 [00, 53]; 星期一被认为是每周的第一天，一年中第一个星期一之前的日子是 “第 0 周” |<br>
<code>%z</code> | UTC 时区偏移量，+HHMM 或 -HHMM; 如果是 naive 则为空 |</div>
<p>|<code>%Z</code> |时区名称作为字符串，如果没有时区，则为空字符串 | | <code>%F</code> | <code>%Y-%m-%d</code> 的快捷方式 (例如，2012-4-18) | | <code>%D</code> | <code>%m/%d/%y</code> 的快捷方式 (例如，04/18/12) |</p>
</section>
<section id="pandas-中的-pd.to_datetime" class="level2">
<h2 class="anchored" data-anchor-id="pandas-中的-pd.to_datetime">pandas 中的 <code>pd.to_datetime()</code></h2>
<p><code>pandas</code> 专为处理日期数组而设计。<code>pd.to_datetime()</code> 方法非常通用：</p>
<div id="437773c7" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 确保导入了 pandas</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>datestrs <span class="op">=</span> [<span class="st">'2011-07-06 12:00:00'</span>, <span class="st">'2011-08-06 00:00:00'</span>]  <span class="co"># 定义一个日期字符串列表</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>dt_index <span class="op">=</span> pd.to_datetime(datestrs)  <span class="co"># 使用 pd.to_datetime() 将字符串列表转换为 DatetimeIndex</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt_index)  <span class="co"># 打印 DatetimeIndex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2011-07-06 12:00:00', '2011-08-06 00:00:00'], dtype='datetime64[ns]', freq=None)</code></pre>
</div>
</div>
</section>
<section id="pandas-中的-pd.to_datetime-续" class="level2">
<h2 class="anchored" data-anchor-id="pandas-中的-pd.to_datetime-续">pandas 中的 <code>pd.to_datetime()</code> (续)</h2>
<p>它会自动处理各种日期格式，还可以识别缺失值：</p>
<div id="5e0b2461" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 确保导入了 pandas</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> pd.to_datetime(datestrs <span class="op">+</span> [<span class="va">None</span>])  <span class="co"># 将包含 None 的列表转换为 DatetimeIndex</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(idx)  <span class="co"># 打印 DatetimeIndex</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(idx[<span class="dv">2</span>])  <span class="co"># NaT (Not a Time)  # 打印第三个元素 (NaT)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.isna(idx))  <span class="co"># 检查 DatetimeIndex 中的缺失值 (NaT)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2011-07-06 12:00:00', '2011-08-06 00:00:00', 'NaT'], dtype='datetime64[ns]', freq=None)
NaT
[False False  True]</code></pre>
</div>
</div>
<p><code>NaT</code> 是 pandas 中表示空时间戳的方式。</p>
</section>
<section id="特定于区域设置的日期格式" class="level2">
<h2 class="anchored" data-anchor-id="特定于区域设置的日期格式">特定于区域设置的日期格式</h2>
<p><code>datetime</code> 对象具有特定于区域设置的格式化选项。</p>
<div class="line-block">类型 | 描述 |<br>
: | :- |<br>
<code>%a</code> | 缩写的星期几名称。 |<br>
<code>%A</code> | 完整的星期几名称。 |<br>
<code>%b</code> | 缩写的月份名称。 |<br>
<code>%B</code> | 完整的月份名称。 |<br>
<code>%c</code> | 完整的日期和时间 (例如，‘Tue 01 May 2012 04:20:57 PM’)。 |<br>
<code>%p</code> | 区域设置中相当于 AM 或 PM 的值。 |<br>
<code>%x</code> | 区域设置的格式化日期 (例如，在美国，2012 年 5 月 1 日会产生 ‘05/01/2012’)。 |<br>
<code>%X</code> | 区域设置的时间 (例如，‘04:24:12 PM’)。 |</div>
</section>
<section id="pandas-中的时间序列基础" class="level2">
<h2 class="anchored" data-anchor-id="pandas-中的时间序列基础">pandas 中的时间序列基础</h2>
<p><code>pandas</code> 中一个基本的时间序列对象是一个以时间戳为索引的 <code>Series</code>：</p>
<div id="a49e1f31" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">2</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">10</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">12</span>)]  <span class="co"># 创建一个 datetime 对象列表</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个 Series，以 datetime 对象列表作为索引</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印时间序列</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(ts))  <span class="co"># 打印 ts 的类型</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-02    2.248023
2011-01-05   -0.834554
2011-01-07    1.952121
2011-01-08   -0.192165
2011-01-10    0.235019
2011-01-12   -0.756355
dtype: float64
&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
</div>
<ul>
<li>索引是一个 <code>DatetimeIndex</code>。</li>
</ul>
</section>
<section id="pandas-中的时间序列基础-续" class="level2">
<h2 class="anchored" data-anchor-id="pandas-中的时间序列基础-续">pandas 中的时间序列基础 (续)</h2>
<p>不同索引的时间序列之间的算术运算会自动按日期对齐。</p>
<div id="734408d5" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">2</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">10</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">12</span>)]  <span class="co"># 创建一个 datetime 对象列表</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个 Series，以 datetime 对象列表作为索引</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.index) <span class="co">#打印时间序列的索引</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts <span class="op">+</span> ts[::<span class="dv">2</span>])  <span class="co"># [::2] 选择每第二个元素。注意 NaN 值。</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2011-01-02', '2011-01-05', '2011-01-07', '2011-01-08',
               '2011-01-10', '2011-01-12'],
              dtype='datetime64[ns]', freq=None)
2011-01-02   -1.870274
2011-01-05         NaN
2011-01-07   -3.656685
2011-01-08         NaN
2011-01-10   -2.589724
2011-01-12         NaN
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="时间戳对象" class="level2">
<h2 class="anchored" data-anchor-id="时间戳对象">时间戳对象</h2>
<p>DatetimeIndex 中的标量值是 pandas Timestamp 对象：</p>
<div id="e09a0512" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">2</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">10</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">12</span>)]  <span class="co"># 创建一个 datetime 对象列表</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个 Series，以 datetime 对象列表作为索引</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>stamp <span class="op">=</span> ts.index[<span class="dv">0</span>] <span class="co">#获取时间序列索引的第一个值</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stamp) <span class="co">#打印这个值</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(stamp)) <span class="co">#打印值的类型</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-02 00:00:00
&lt;class 'pandas._libs.tslibs.timestamps.Timestamp'&gt;</code></pre>
</div>
</div>
<p>pandas.Timestamp 可以在大多数使用 datetime 对象的地方使用。</p>
</section>
<section id="索引选择和子集" class="level2">
<h2 class="anchored" data-anchor-id="索引选择和子集">索引、选择和子集</h2>
<p>您可以使用各种方式使用标签 (日期) 对时间序列进行索引：</p>
<div id="d9edeb7b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">2</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">10</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">12</span>)]  <span class="co"># 创建一个 datetime 对象列表</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个 Series，以 datetime 对象列表作为索引</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>stamp <span class="op">=</span> ts.index[<span class="dv">2</span>]  <span class="co"># 获取时间序列索引的第三个元素</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts[stamp])  <span class="co"># 使用时间戳索引</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts[<span class="st">'2011-01-10'</span>])  <span class="co"># 使用日期字符串索引</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.208828437989877
-0.12618985641649783</code></pre>
</div>
</div>
</section>
<section id="索引选择和子集-续" class="level2">
<h2 class="anchored" data-anchor-id="索引选择和子集-续">索引、选择和子集 (续)</h2>
<p>对于较长的时间序列，您可以使用年份或年月来选择切片：</p>
<div id="782b7f73" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>longer_ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">1000</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                      index<span class="op">=</span>pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">1000</span>))  <span class="co"># 创建一个较长的时间序列</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(longer_ts[<span class="st">'2001'</span>])  <span class="co"># 选择 2001 年的所有数据</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(longer_ts[<span class="st">'2001-05'</span>])  <span class="co"># 选择 2001 年 5 月的所有数据</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2001-01-01    0.778277
2001-01-02   -1.746666
2001-01-03    0.488165
2001-01-04   -0.970844
2001-01-05   -0.362200
                ...   
2001-12-27   -0.888858
2001-12-28   -0.984452
2001-12-29    1.273428
2001-12-30   -1.143759
2001-12-31   -0.016393
Freq: D, Length: 365, dtype: float64
2001-05-01   -1.534476
2001-05-02    1.717477
2001-05-03   -1.068018
2001-05-04   -1.154015
2001-05-05   -0.201790
2001-05-06    0.118378
2001-05-07   -0.688098
2001-05-08   -0.164069
2001-05-09   -0.261402
2001-05-10   -0.617958
2001-05-11   -0.312088
2001-05-12    0.169424
2001-05-13   -0.635458
2001-05-14    1.361047
2001-05-15   -1.737481
2001-05-16   -1.996880
2001-05-17   -0.490516
2001-05-18   -0.328491
2001-05-19   -0.425433
2001-05-20   -0.096868
2001-05-21   -0.624496
2001-05-22   -0.619592
2001-05-23    1.015465
2001-05-24    0.908434
2001-05-25   -1.122352
2001-05-26    1.939164
2001-05-27    1.221890
2001-05-28   -0.054268
2001-05-29    1.045968
2001-05-30    0.413487
2001-05-31    0.893980
Freq: D, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="索引选择和子集-续-1" class="level2">
<h2 class="anchored" data-anchor-id="索引选择和子集-续-1">索引、选择和子集 (续)</h2>
<p>使用 <code>datetime</code> 对象进行切片也有效，包括范围查询：</p>
<div id="982b25a0" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">2</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">10</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">12</span>)]  <span class="co"># 创建一个 datetime 对象列表</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts[datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>):])  <span class="co"># 使用 datetime 对象进行切片 (范围查询)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts[<span class="st">'2011-01-06'</span>:<span class="st">'2011-01-11'</span>])  <span class="co"># 使用日期字符串进行切片 (范围查询)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-07    0.962757
2011-01-08    0.009201
2011-01-10   -0.578818
2011-01-12   -1.134133
dtype: float64
2011-01-07    0.962757
2011-01-08    0.009201
2011-01-10   -0.578818
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="索引选择和子集-续-2" class="level2">
<h2 class="anchored" data-anchor-id="索引选择和子集-续-2">索引、选择和子集 (续)</h2>
<p><code>truncate()</code> 方法在两个日期之间对 <code>Series</code> 进行切片：</p>
<div id="313834df" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">2</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">7</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>         datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">10</span>), datetime(<span class="dv">2011</span>, <span class="dv">1</span>, <span class="dv">12</span>)]  <span class="co"># 创建一个 datetime 对象列表</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.truncate(after<span class="op">=</span><span class="st">'2011-01-09'</span>))  <span class="co"># 在 2011-01-09 之后截断</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01-02    1.080734
2011-01-05   -1.287651
2011-01-07    1.747145
2011-01-08    0.015727
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="索引选择和子集-续-3" class="level2">
<h2 class="anchored" data-anchor-id="索引选择和子集-续-3">索引、选择和子集 (续)</h2>
<p>所有这些切片操作都适用于 <code>DataFrame</code>，在行上进行索引：</p>
<div id="2e69fef5" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">100</span>, freq<span class="op">=</span><span class="st">'W-WED'</span>)  <span class="co"># 创建一个日期范围 (每周三)</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>long_df <span class="op">=</span> pd.DataFrame(np.random.randn(<span class="dv">100</span>, <span class="dv">4</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                       index<span class="op">=</span>dates,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                       columns<span class="op">=</span>[<span class="st">'Colorado'</span>, <span class="st">'Texas'</span>, <span class="st">'New York'</span>, <span class="st">'Ohio'</span>])  <span class="co"># 创建一个 DataFrame</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(long_df.loc[<span class="st">'2001-05'</span>])  <span class="co"># 使用 .loc 按标签选择 2001 年 5 月的所有行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Colorado     Texas  New York      Ohio
2001-05-02 -1.639200 -1.360790  1.252533  1.779938
2001-05-09  1.048367  0.669613  0.097629  0.400700
2001-05-16 -0.935691  0.946895  0.766187  1.614594
2001-05-23 -1.598397  0.484545  0.847627 -0.585456
2001-05-30  0.965721 -0.938391 -0.426365  0.957039</code></pre>
</div>
</div>
</section>
<section id="具有重复索引的时间序列" class="level2">
<h2 class="anchored" data-anchor-id="具有重复索引的时间序列">具有重复索引的时间序列</h2>
<p>对于同一时间戳，可能存在多个数据观察值：</p>
<div id="87467966" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.DatetimeIndex([<span class="st">'1/1/2000'</span>, <span class="st">'1/2/2000'</span>, <span class="st">'1/2/2000'</span>, <span class="st">'1/2/2000'</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'1/3/2000'</span>])  <span class="co"># 创建一个具有重复日期的 DatetimeIndex</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>dup_ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">5</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个具有重复索引的 Series</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dup_ts)  <span class="co"># 打印 Series</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dup_ts.index.is_unique)  <span class="co"># 检查索引是否唯一</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-01    0
2000-01-02    1
2000-01-02    2
2000-01-02    3
2000-01-03    4
dtype: int64
False</code></pre>
</div>
</div>
</section>
<section id="具有重复索引的时间序列-续" class="level2">
<h2 class="anchored" data-anchor-id="具有重复索引的时间序列-续">具有重复索引的时间序列 (续)</h2>
<p>索引现在将产生标量值或切片：</p>
<div id="7306c166" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.DatetimeIndex([<span class="st">'1/1/2000'</span>, <span class="st">'1/2/2000'</span>, <span class="st">'1/2/2000'</span>, <span class="st">'1/2/2000'</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'1/3/2000'</span>])  <span class="co"># 创建一个具有重复日期的 DatetimeIndex</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>dup_ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">5</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个具有重复索引的 Series</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dup_ts[<span class="st">'1/3/2000'</span>])  <span class="co"># 未重复的日期，返回标量值</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dup_ts[<span class="st">'1/2/2000'</span>])  <span class="co"># 重复的日期，返回切片</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4
2000-01-02    1
2000-01-02    2
2000-01-02    3
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="具有重复索引的时间序列-续-1" class="level2">
<h2 class="anchored" data-anchor-id="具有重复索引的时间序列-续-1">具有重复索引的时间序列 (续)</h2>
<p>要聚合具有非唯一时间戳的数据，请使用 <code>groupby</code> 和 <code>level=0</code>：</p>
<div id="b842bb5f" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.DatetimeIndex([<span class="st">'1/1/2000'</span>, <span class="st">'1/2/2000'</span>, <span class="st">'1/2/2000'</span>, <span class="st">'1/2/2000'</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'1/3/2000'</span>])  <span class="co"># 创建一个具有重复日期的 DatetimeIndex</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>dup_ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">5</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个具有重复索引的 Series</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> dup_ts.groupby(level<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 按索引级别 0 (日期) 分组</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grouped.mean())  <span class="co"># 计算每个日期的平均值</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grouped.count())  <span class="co"># 计算每个日期的计数</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-01    0.0
2000-01-02    2.0
2000-01-03    4.0
dtype: float64
2000-01-01    1
2000-01-02    3
2000-01-03    1
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="日期范围频率和移位" class="level2">
<h2 class="anchored" data-anchor-id="日期范围频率和移位">日期范围、频率和移位</h2>
<section id="生成日期范围" class="level3">
<h3 class="anchored" data-anchor-id="生成日期范围">生成日期范围</h3>
<p><code>pandas.date_range()</code> 用于生成具有特定长度和频率的 <code>DatetimeIndex</code>：</p>
<div id="42f8fb5c" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> pd.date_range(<span class="st">'2012-04-01'</span>, <span class="st">'2012-06-01'</span>)  <span class="co"># 创建一个从 2012-04-01 到 2012-06-01 的每日日期范围</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(index)  <span class="co"># 打印 DatetimeIndex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
               '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
               '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
               '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
               '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20',
               '2012-04-21', '2012-04-22', '2012-04-23', '2012-04-24',
               '2012-04-25', '2012-04-26', '2012-04-27', '2012-04-28',
               '2012-04-29', '2012-04-30', '2012-05-01', '2012-05-02',
               '2012-05-03', '2012-05-04', '2012-05-05', '2012-05-06',
               '2012-05-07', '2012-05-08', '2012-05-09', '2012-05-10',
               '2012-05-11', '2012-05-12', '2012-05-13', '2012-05-14',
               '2012-05-15', '2012-05-16', '2012-05-17', '2012-05-18',
               '2012-05-19', '2012-05-20', '2012-05-21', '2012-05-22',
               '2012-05-23', '2012-05-24', '2012-05-25', '2012-05-26',
               '2012-05-27', '2012-05-28', '2012-05-29', '2012-05-30',
               '2012-05-31', '2012-06-01'],
              dtype='datetime64[ns]', freq='D')</code></pre>
</div>
</div>
</section>
</section>
<section id="生成日期范围续" class="level2">
<h2 class="anchored" data-anchor-id="生成日期范围续">生成日期范围(续)</h2>
<p>默认情况下，<code>date_range</code> 生成每日时间戳。您可以指定开始或结束日期以及周期数：</p>
<div id="6c2dc805" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(start<span class="op">=</span><span class="st">'2012-04-01'</span>, periods<span class="op">=</span><span class="dv">20</span>))  <span class="co"># 从 2012-04-01 开始，生成 20 个每日日期</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(end<span class="op">=</span><span class="st">'2012-06-01'</span>, periods<span class="op">=</span><span class="dv">20</span>))  <span class="co"># 到 2012-06-01 结束，生成 20 个每日日期</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04',
               '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08',
               '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12',
               '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16',
               '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20'],
              dtype='datetime64[ns]', freq='D')
DatetimeIndex(['2012-05-13', '2012-05-14', '2012-05-15', '2012-05-16',
               '2012-05-17', '2012-05-18', '2012-05-19', '2012-05-20',
               '2012-05-21', '2012-05-22', '2012-05-23', '2012-05-24',
               '2012-05-25', '2012-05-26', '2012-05-27', '2012-05-28',
               '2012-05-29', '2012-05-30', '2012-05-31', '2012-06-01'],
              dtype='datetime64[ns]', freq='D')</code></pre>
</div>
</div>
</section>
<section id="生成日期范围续-1" class="level2">
<h2 class="anchored" data-anchor-id="生成日期范围续-1">生成日期范围(续)</h2>
<p>您还可以指定频率。例如，获取每个月的最后一个工作日：</p>
<div id="e13a0230" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(<span class="st">'2000-01-01'</span>, <span class="st">'2000-12-01'</span>, freq<span class="op">=</span><span class="st">'BM'</span>))  <span class="co"># 'BM' = Business Month end (每月最后一个工作日)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2000-01-31', '2000-02-29', '2000-03-31', '2000-04-28',
               '2000-05-31', '2000-06-30', '2000-07-31', '2000-08-31',
               '2000-09-29', '2000-10-31', '2000-11-30'],
              dtype='datetime64[ns]', freq='BME')</code></pre>
</div>
</div>
<section id="频率和日期偏移" class="level3">
<h3 class="anchored" data-anchor-id="频率和日期偏移">频率和日期偏移</h3>
<p><code>pandas</code> 中的频率由<em>基本频率</em>和<em>乘数</em>组成。基本频率通常是字符串别名 (例如，‘M’ 表示每月，‘H’ 表示每小时)。</p>
<table class="caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 25%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">别名</th>
<th style="text-align: left;">偏移类型</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>D</code></td>
<td style="text-align: left;"><code>Day</code></td>
<td style="text-align: left;">日历日</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: left;"><code>BusinessDay</code></td>
<td style="text-align: left;">工作日</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>H</code></td>
<td style="text-align: left;"><code>Hour</code></td>
<td style="text-align: left;">每小时</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>T</code> 或 <code>min</code></td>
<td style="text-align: left;"><code>Minute</code></td>
<td style="text-align: left;">每分钟</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>S</code></td>
<td style="text-align: left;"><code>Second</code></td>
<td style="text-align: left;">每秒</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>L</code> 或 <code>ms</code></td>
<td style="text-align: left;"><code>Milli</code></td>
<td style="text-align: left;">毫秒 (1/1,000 秒)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>U</code></td>
<td style="text-align: left;"><code>Micro</code></td>
<td style="text-align: left;">微秒 (1/1,000,000 秒)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>M</code></td>
<td style="text-align: left;"><code>MonthEnd</code></td>
<td style="text-align: left;">每月最后一个日历日</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="频率和日期偏移续" class="level2">
<h2 class="anchored" data-anchor-id="频率和日期偏移续">频率和日期偏移(续)</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 25%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">别名</th>
<th style="text-align: left;">偏移类型</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>BM</code></td>
<td style="text-align: left;"><code>BusinessMonthEnd</code></td>
<td style="text-align: left;">每月最后一个工作日</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>MS</code></td>
<td style="text-align: left;"><code>MonthBegin</code></td>
<td style="text-align: left;">每月第一个日历日</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>BMS</code></td>
<td style="text-align: left;"><code>BusinessMonthBegin</code></td>
<td style="text-align: left;">每月第一个工作日</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>W-MON</code>, <code>W-TUE</code>, …</td>
<td style="text-align: left;"><code>Week</code></td>
<td style="text-align: left;">每周的指定星期几 (MON, TUE, WED, THU,FRI, SAT, or SUN)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>WOM-1MON</code>, <code>WOM-2MON</code>, …</td>
<td style="text-align: left;"><code>WeekOfMonth</code></td>
<td style="text-align: left;">生成每月第一、第二、第三或第四周的每周日期 (例如，WOM-3FRI 表示每月第三个星期五)</td>
</tr>
</tbody>
</table>
</section>
<section id="频率和日期偏移续-1" class="level2">
<h2 class="anchored" data-anchor-id="频率和日期偏移续-1">频率和日期偏移(续)</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 25%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">别名</th>
<th style="text-align: left;">偏移类型</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Q-JAN</code>, <code>Q-FEB</code>, …</td>
<td style="text-align: left;"><code>QuarterEnd</code></td>
<td style="text-align: left;">季度日期锚定在每个月的最后一个日历日，年份以指定月份结束 (JAN, FEB,MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV, or DEC)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>BQ-JAN</code>, <code>BQ-FEB</code>, …</td>
<td style="text-align: left;"><code>BusinessQuarterEnd</code></td>
<td style="text-align: left;">季度日期锚定在每个月的最后一个工作日，年份以指定月份结束</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>QS-JAN</code>, <code>QS-FEB</code>, …</td>
<td style="text-align: left;"><code>QuarterBegin</code></td>
<td style="text-align: left;">季度日期锚定在每个月的第一个日历日，年份以指定月份结束</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>BQS-JAN</code>, <code>BQS-FEB</code>, …</td>
<td style="text-align: left;"><code>BusinessQuarterBegin</code></td>
<td style="text-align: left;">季度日期锚定在每个月的第一个工作日，年份以指定月份结束</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>A-JAN</code>, <code>A-FEB</code>, …</td>
<td style="text-align: left;"><code>YearEnd</code></td>
<td style="text-align: left;">年度日期锚定在给定月份的最后一个日历日 (JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP,OCT, NOV, or DEC)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>BA-JAN</code>, <code>BA-FEB</code>, …</td>
<td style="text-align: left;"><code>BusinessYearEnd</code></td>
<td style="text-align: left;">年度日期锚定在给定月份的最后一个工作日</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>AS-JAN</code>, <code>AS-FEB</code>, …</td>
<td style="text-align: left;"><code>YearBegin</code></td>
<td style="text-align: left;">年度日期锚定在给定月份的第一天</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>BAS-JAN</code>, <code>BAS-FEB</code>, …</td>
<td style="text-align: left;"><code>BusinessYearBegin</code></td>
<td style="text-align: left;">年度日期锚定在给定月份的第一个工作日</td>
</tr>
</tbody>
</table>
</section>
<section id="频率和日期偏移---示例" class="level2">
<h2 class="anchored" data-anchor-id="频率和日期偏移---示例">频率和日期偏移 - 示例</h2>
<div id="99239b08" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.offsets <span class="im">import</span> Hour, Minute  <span class="co"># 导入 Hour 和 Minute 偏移</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Hour())  <span class="co"># 默认 1 小时</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Hour(<span class="dv">4</span>))  <span class="co"># 4 小时</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(<span class="st">'2000-01-01'</span>, <span class="st">'2000-01-03 23:59'</span>, freq<span class="op">=</span><span class="st">'4H'</span>))  <span class="co"># 每 4 小时</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Hour&gt;
&lt;4 * Hours&gt;
DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 04:00:00',
               '2000-01-01 08:00:00', '2000-01-01 12:00:00',
               '2000-01-01 16:00:00', '2000-01-01 20:00:00',
               '2000-01-02 00:00:00', '2000-01-02 04:00:00',
               '2000-01-02 08:00:00', '2000-01-02 12:00:00',
               '2000-01-02 16:00:00', '2000-01-02 20:00:00',
               '2000-01-03 00:00:00', '2000-01-03 04:00:00',
               '2000-01-03 08:00:00', '2000-01-03 12:00:00',
               '2000-01-03 16:00:00', '2000-01-03 20:00:00'],
              dtype='datetime64[ns]', freq='4h')</code></pre>
</div>
</div>
</section>
<section id="频率和日期偏移---示例续" class="level2">
<h2 class="anchored" data-anchor-id="频率和日期偏移---示例续">频率和日期偏移 - 示例(续)</h2>
<div id="f630ac8b" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.offsets <span class="im">import</span> Hour, Minute  <span class="co"># 导入 Hour 和 Minute</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Hour(<span class="dv">2</span>) <span class="op">+</span> Minute(<span class="dv">30</span>))  <span class="co"># 2 小时 30 分钟</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(<span class="st">'2000-01-01'</span>, periods<span class="op">=</span><span class="dv">10</span>, freq<span class="op">=</span><span class="st">'1h30min'</span>))  <span class="co"># 每 1 小时 30 分钟</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;150 * Minutes&gt;
DatetimeIndex(['2000-01-01 00:00:00', '2000-01-01 01:30:00',
               '2000-01-01 03:00:00', '2000-01-01 04:30:00',
               '2000-01-01 06:00:00', '2000-01-01 07:30:00',
               '2000-01-01 09:00:00', '2000-01-01 10:30:00',
               '2000-01-01 12:00:00', '2000-01-01 13:30:00'],
              dtype='datetime64[ns]', freq='90min')</code></pre>
</div>
</div>
</section>
<section id="频率和日期偏移---week-of-month" class="level2">
<h2 class="anchored" data-anchor-id="频率和日期偏移---week-of-month">频率和日期偏移 - “Week of Month”</h2>
<div id="9c3c25f7" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> pd.date_range(<span class="st">'2012-01-01'</span>, <span class="st">'2012-09-01'</span>, freq<span class="op">=</span><span class="st">'WOM-3FRI'</span>)  <span class="co"># 每月第三个星期五</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(rng))  <span class="co"># 打印日期列表</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Timestamp('2012-01-20 00:00:00'), Timestamp('2012-02-17 00:00:00'), Timestamp('2012-03-16 00:00:00'), Timestamp('2012-04-20 00:00:00'), Timestamp('2012-05-18 00:00:00'), Timestamp('2012-06-15 00:00:00'), Timestamp('2012-07-20 00:00:00'), Timestamp('2012-08-17 00:00:00')]</code></pre>
</div>
</div>
<section id="移位-超前和滞后-数据" class="level3">
<h3 class="anchored" data-anchor-id="移位-超前和滞后-数据">移位 (超前和滞后) 数据</h3>
<p><em>移位</em>将数据在时间上向后或向前移动。使用 <code>shift()</code> 方法：</p>
<div id="8406dfc9" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">4</span>),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>               index<span class="op">=</span>pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">4</span>, freq<span class="op">=</span><span class="st">'M'</span>))  <span class="co"># 创建一个时间序列 (每月)</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印原始时间序列</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.shift(<span class="dv">2</span>))  <span class="co"># 向后移动 2 个周期 (滞后)</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.shift(<span class="op">-</span><span class="dv">2</span>))  <span class="co"># 向前移动 2 个周期 (超前)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-31   -1.775190
2000-02-29    1.644746
2000-03-31   -0.828214
2000-04-30   -0.799291
Freq: ME, dtype: float64
2000-01-31         NaN
2000-02-29         NaN
2000-03-31   -1.775190
2000-04-30    1.644746
Freq: ME, dtype: float64
2000-01-31   -0.828214
2000-02-29   -0.799291
2000-03-31         NaN
2000-04-30         NaN
Freq: ME, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="移位-超前和滞后-数据-续" class="level2">
<h2 class="anchored" data-anchor-id="移位-超前和滞后-数据-续">移位 (超前和滞后) 数据 (续)</h2>
<p>一个常见的用途是计算百分比变化：</p>
<div id="f1ccff9f" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">4</span>),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>               index<span class="op">=</span>pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">4</span>, freq<span class="op">=</span><span class="st">'M'</span>))  <span class="co"># 创建一个时间序列 (每月)</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts <span class="op">/</span> ts.shift(<span class="dv">1</span>) <span class="op">-</span> <span class="dv">1</span>)  <span class="co"># 计算百分比变化</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-31         NaN
2000-02-29    3.472842
2000-03-31   -2.084910
2000-04-30   -0.520555
Freq: ME, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="移位-超前和滞后-数据-续-1" class="level2">
<h2 class="anchored" data-anchor-id="移位-超前和滞后-数据-续-1">移位 (超前和滞后) 数据 (续)</h2>
<p>您还可以移动<em>时间戳</em>，保持数据不变：</p>
<div id="5a266625" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">4</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>               index<span class="op">=</span>pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">4</span>, freq<span class="op">=</span><span class="st">'M'</span>))  <span class="co"># 创建一个时间序列 (每月)</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.shift(<span class="dv">2</span>, freq<span class="op">=</span><span class="st">'M'</span>))  <span class="co"># 将时间戳向后移动 2 个月</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.shift(<span class="dv">3</span>, freq<span class="op">=</span><span class="st">'D'</span>))  <span class="co"># 将时间戳向后移动 3 天</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.shift(<span class="dv">1</span>, freq<span class="op">=</span><span class="st">'90T'</span>))  <span class="co"># 将时间戳向后移动 90 分钟 ('T' 表示分钟)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-03-31    1.545804
2000-04-30   -0.087442
2000-05-31   -0.070348
2000-06-30   -2.808519
Freq: ME, dtype: float64
2000-02-03    1.545804
2000-03-03   -0.087442
2000-04-03   -0.070348
2000-05-03   -2.808519
dtype: float64
2000-01-31 01:30:00    1.545804
2000-02-29 01:30:00   -0.087442
2000-03-31 01:30:00   -0.070348
2000-04-30 01:30:00   -2.808519
dtype: float64</code></pre>
</div>
</div>
<section id="使用偏移量移动日期" class="level3">
<h3 class="anchored" data-anchor-id="使用偏移量移动日期">使用偏移量移动日期</h3>
<p><code>pandas</code> 日期偏移量可以与 <code>datetime</code> 或 <code>Timestamp</code> 对象一起使用：</p>
<div id="37e5e003" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.offsets <span class="im">import</span> Day, MonthEnd  <span class="co"># 导入 Day 和 MonthEnd 偏移</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>now <span class="op">=</span> datetime(<span class="dv">2011</span>, <span class="dv">11</span>, <span class="dv">17</span>)  <span class="co"># 创建一个 datetime 对象</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(now <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> Day())  <span class="co"># 加上 3 天</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(now <span class="op">+</span> MonthEnd())  <span class="co"># 滚动到月底</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(now <span class="op">+</span> MonthEnd(<span class="dv">2</span>))  <span class="co"># 滚动到下个月底</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-11-20 00:00:00
2011-11-30 00:00:00
2011-12-31 00:00:00</code></pre>
</div>
</div>
</section>
</section>
<section id="使用偏移量移动日期续" class="level2">
<h2 class="anchored" data-anchor-id="使用偏移量移动日期续">使用偏移量移动日期(续)</h2>
<div id="244cf8c5" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime  <span class="co"># 导入 datetime</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.offsets <span class="im">import</span>  MonthEnd  <span class="co"># 导入 MonthEnd 偏移</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>now <span class="op">=</span> datetime(<span class="dv">2011</span>, <span class="dv">11</span>, <span class="dv">17</span>)  <span class="co"># 创建一个 datetime 对象</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>offset <span class="op">=</span> MonthEnd()  <span class="co"># 创建 MonthEnd 偏移对象</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(offset.rollforward(now))  <span class="co"># 显式向前滚动</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(offset.rollback(now))  <span class="co"># 显式向后滚动</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-11-30 00:00:00
2011-10-31 00:00:00</code></pre>
</div>
</div>
</section>
<section id="使用偏移量移动日期续-1" class="level2">
<h2 class="anchored" data-anchor-id="使用偏移量移动日期续-1">使用偏移量移动日期(续)</h2>
<p>将日期偏移量与 <code>groupby</code> 结合使用的一种巧妙方法是 “滚动” 日期：</p>
<div id="32e12f59" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.offsets <span class="im">import</span> MonthEnd  <span class="co"># 导入 MonthEnd</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">20</span>),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                index<span class="op">=</span>pd.date_range(<span class="st">'1/15/2000'</span>, periods<span class="op">=</span><span class="dv">20</span>, freq<span class="op">=</span><span class="st">'4D'</span>))  <span class="co"># 创建一个时间序列 (每 4 天)</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.groupby(MonthEnd().rollforward).mean())  <span class="co"># 按月底分组并计算平均值</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'M'</span>).mean())  <span class="co"># 等效，且速度更快 (按月重采样)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-31    0.397156
2000-02-29    0.184932
2000-03-31   -0.481613
dtype: float64
2000-01-31    0.397156
2000-02-29    0.184932
2000-03-31   -0.481613
Freq: ME, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="时区处理" class="level2">
<h2 class="anchored" data-anchor-id="时区处理">时区处理</h2>
<p>处理时区可能很复杂。<code>pandas</code> 使用 <code>pytz</code> 库。默认情况下，pandas 中的时间序列是时区朴素的(没有时区信息)。</p>
<div id="599abb3a" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz  <span class="co"># 导入 pytz</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pytz.common_timezones[<span class="op">-</span><span class="dv">5</span>:])  <span class="co"># 打印最后 5 个常见时区</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>tz <span class="op">=</span> pytz.timezone(<span class="st">'America/New_York'</span>)  <span class="co"># 获取纽约时区</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tz)  <span class="co"># 打印时区对象</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['US/Eastern', 'US/Hawaii', 'US/Mountain', 'US/Pacific', 'UTC']
America/New_York</code></pre>
</div>
</div>
<section id="时区本地化和转换" class="level3">
<h3 class="anchored" data-anchor-id="时区本地化和转换">时区本地化和转换</h3>
<div id="980eab23" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'3/9/2012 9:30'</span>, periods<span class="op">=</span><span class="dv">6</span>, freq<span class="op">=</span><span class="st">'D'</span>)  <span class="co"># 创建一个日期范围 (每日)</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="bu">len</span>(dates)), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印时间序列</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.index.tz)  <span class="co"># 时区朴素 (None)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2012-03-09 09:30:00   -0.146057
2012-03-10 09:30:00   -0.814732
2012-03-11 09:30:00   -0.179495
2012-03-12 09:30:00   -0.628043
2012-03-13 09:30:00   -1.259515
2012-03-14 09:30:00   -0.067669
Freq: D, dtype: float64
None</code></pre>
</div>
</div>
</section>
<section id="时区本地化和转换续" class="level3">
<h3 class="anchored" data-anchor-id="时区本地化和转换续">时区本地化和转换(续)</h3>
<div id="1089802e" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成一个带有时区的时间范围</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>date_rng <span class="op">=</span> pd.date_range(<span class="st">'3/9/2012 9:30'</span>, periods<span class="op">=</span><span class="dv">10</span>, freq<span class="op">=</span><span class="st">'D'</span>, tz<span class="op">=</span><span class="st">'UTC'</span>)  <span class="co"># 创建一个带有时区 (UTC) 的日期范围</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(date_rng.tz)  <span class="co"># 打印时区</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 本地化到时区。</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>ts_utc <span class="op">=</span> ts.tz_localize(<span class="st">'UTC'</span>)  <span class="co"># 将时间序列本地化到 UTC</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts_utc)  <span class="co"># 打印本地化后的时间序列</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts_utc.index)  <span class="co"># 打印带有时区的索引</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>UTC
2012-03-09 09:30:00+00:00   -0.146057
2012-03-10 09:30:00+00:00   -0.814732
2012-03-11 09:30:00+00:00   -0.179495
2012-03-12 09:30:00+00:00   -0.628043
2012-03-13 09:30:00+00:00   -1.259515
2012-03-14 09:30:00+00:00   -0.067669
Freq: D, dtype: float64
DatetimeIndex(['2012-03-09 09:30:00+00:00', '2012-03-10 09:30:00+00:00',
               '2012-03-11 09:30:00+00:00', '2012-03-12 09:30:00+00:00',
               '2012-03-13 09:30:00+00:00', '2012-03-14 09:30:00+00:00'],
              dtype='datetime64[ns, UTC]', freq='D')</code></pre>
</div>
</div>
</section>
<section id="时区本地化和转换续-1" class="level3">
<h3 class="anchored" data-anchor-id="时区本地化和转换续-1">时区本地化和转换(续)</h3>
<div id="72017f5e" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'3/9/2012 9:30'</span>, periods<span class="op">=</span><span class="dv">6</span>, freq<span class="op">=</span><span class="st">'D'</span>)  <span class="co"># 创建一个日期范围 (每日)</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="bu">len</span>(dates)), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>ts_utc <span class="op">=</span> ts.tz_localize(<span class="st">'UTC'</span>)  <span class="co"># 将时间序列本地化到 UTC</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 转换为另一个时区。</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>ts_eastern <span class="op">=</span> ts_utc.tz_convert(<span class="st">'America/New_York'</span>)  <span class="co"># 将时间序列转换为纽约时区</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts_eastern)  <span class="co"># 打印转换后的时间序列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2012-03-09 04:30:00-05:00   -0.730074
2012-03-10 04:30:00-05:00   -0.393134
2012-03-11 05:30:00-04:00    0.661329
2012-03-12 05:30:00-04:00    0.566687
2012-03-13 05:30:00-04:00    1.084561
2012-03-14 05:30:00-04:00   -1.141792
Freq: D, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="使用带有时区意识的-timestamp-对象进行操作" class="level3">
<h3 class="anchored" data-anchor-id="使用带有时区意识的-timestamp-对象进行操作">使用带有时区意识的 Timestamp 对象进行操作</h3>
<p><code>Timestamp</code> 对象也支持时区本地化和转换：</p>
<div id="118d1de2" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>stamp <span class="op">=</span> pd.Timestamp(<span class="st">'2011-03-12 04:00'</span>)  <span class="co"># 创建一个 Timestamp 对象</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>stamp_utc <span class="op">=</span> stamp.tz_localize(<span class="st">'utc'</span>)  <span class="co"># 本地化到 UTC</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stamp_utc.tz_convert(<span class="st">'America/New_York'</span>))  <span class="co"># 转换为纽约时区</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-03-11 23:00:00-05:00</code></pre>
</div>
</div>
</section>
<section id="使用带有时区意识的-timestamp-对象进行操作续" class="level3">
<h3 class="anchored" data-anchor-id="使用带有时区意识的-timestamp-对象进行操作续">使用带有时区意识的 Timestamp 对象进行操作(续)</h3>
<p>在不同时区之间执行操作时，结果将采用 UTC。</p>
<div id="70a06dab" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'3/7/2012 9:30'</span>, periods<span class="op">=</span><span class="dv">10</span>, freq<span class="op">=</span><span class="st">'B'</span>)  <span class="co"># 创建一个日期范围 (工作日)</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="bu">len</span>(dates)), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>ts1 <span class="op">=</span> ts[:<span class="dv">7</span>].tz_localize(<span class="st">'Europe/London'</span>)  <span class="co"># 本地化到伦敦时区</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>ts2 <span class="op">=</span> ts1[<span class="dv">2</span>:].tz_convert(<span class="st">'Europe/Moscow'</span>)  <span class="co"># 转换为莫斯科时区</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> ts1 <span class="op">+</span> ts2  <span class="co"># 不同时区的时间序列相加</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.index)  <span class="co"># 结果的索引将是 UTC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2012-03-07 09:30:00+00:00', '2012-03-08 09:30:00+00:00',
               '2012-03-09 09:30:00+00:00', '2012-03-12 09:30:00+00:00',
               '2012-03-13 09:30:00+00:00', '2012-03-14 09:30:00+00:00',
               '2012-03-15 09:30:00+00:00'],
              dtype='datetime64[ns, UTC]', freq=None)</code></pre>
</div>
</div>
</section>
</section>
<section id="周期和周期算术" class="level2">
<h2 class="anchored" data-anchor-id="周期和周期算术">周期和周期算术</h2>
<p><em>周期 (Periods)</em> 表示时间跨度 (例如，天、月、季度、年)。<code>Period</code> 类：</p>
<div id="83e23ee4" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pd.Period(<span class="dv">2011</span>, freq<span class="op">=</span><span class="st">'A-DEC'</span>)  <span class="co"># 创建一个年度周期 (以 12 月结束)</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p)  <span class="co"># 打印周期</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p <span class="op">+</span> <span class="dv">5</span>)  <span class="co"># 加上 5 年</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p <span class="op">-</span> <span class="dv">2</span>)  <span class="co"># 减去 2 年</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Period(<span class="st">'2014'</span>, freq<span class="op">=</span><span class="st">'A-DEC'</span>) <span class="op">-</span> p)  <span class="co"># 计算两个周期之间的差 (年数)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011
2016
2009
&lt;3 * YearEnds: month=12&gt;</code></pre>
</div>
</div>
</section>
<section id="周期和周期算术-续" class="level2">
<h2 class="anchored" data-anchor-id="周期和周期算术-续">周期和周期算术 (续)</h2>
<p><code>period_range</code> 创建周期的规则范围：</p>
<div id="952a1d9a" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> pd.period_range(<span class="st">'2000-01-01'</span>, <span class="st">'2000-06-30'</span>, freq<span class="op">=</span><span class="st">'M'</span>)  <span class="co"># 创建一个每月周期范围</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rng)  <span class="co"># 打印 PeriodIndex</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>rng))  <span class="co"># 创建一个以 PeriodIndex 为索引的 Series</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PeriodIndex(['2000-01', '2000-02', '2000-03', '2000-04', '2000-05', '2000-06'], dtype='period[M]')
2000-01    1.779866
2000-02    1.738569
2000-03   -0.819227
2000-04    0.886658
2000-05    0.271296
2000-06    0.240180
Freq: M, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="周期和周期算术-续-1" class="level2">
<h2 class="anchored" data-anchor-id="周期和周期算术-续-1">周期和周期算术 (续)</h2>
<div id="4820716f" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">'2001Q3'</span>, <span class="st">'2002Q2'</span>, <span class="st">'2003Q1'</span>]  <span class="co"># 定义一个季度字符串列表</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> pd.PeriodIndex(values, freq<span class="op">=</span><span class="st">'Q-DEC'</span>)  <span class="co"># 从字符串列表创建一个 PeriodIndex (以 12 月结束的季度)</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(index)  <span class="co"># 打印 PeriodIndex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PeriodIndex(['2001Q3', '2002Q2', '2003Q1'], dtype='period[Q-DEC]')</code></pre>
</div>
</div>
<section id="周期频率转换" class="level3">
<h3 class="anchored" data-anchor-id="周期频率转换">周期频率转换</h3>
<p>可以使用 <code>asfreq</code> 转换周期和 <code>PeriodIndex</code> 对象：</p>
<div id="72fd9263" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pd.Period(<span class="st">'2011'</span>, freq<span class="op">=</span><span class="st">'A-DEC'</span>)  <span class="co"># 创建一个年度周期 (以 12 月结束)</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p.asfreq(<span class="st">'M'</span>, how<span class="op">=</span><span class="st">'start'</span>))  <span class="co"># 转换为每月周期 (开始)</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p.asfreq(<span class="st">'M'</span>, how<span class="op">=</span><span class="st">'end'</span>))  <span class="co"># 转换为每月周期 (结束)</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pd.Period(<span class="st">'Aug-2011'</span>, <span class="st">'M'</span>) <span class="co"># 创建一个月的周期</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p.asfreq(<span class="st">'A-JUN'</span>)) <span class="co"># 转换为以六月结束的年度周期</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011-01
2011-12
2012</code></pre>
</div>
</div>
</section>
<section id="周期频率转换续" class="level3">
<h3 class="anchored" data-anchor-id="周期频率转换续">周期频率转换(续)</h3>
<div id="0d05841b" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>periods <span class="op">=</span> pd.period_range(<span class="st">'2006'</span>, <span class="st">'2009'</span>, freq<span class="op">=</span><span class="st">'A-DEC'</span>)  <span class="co"># 创建一个年度周期范围 (以 12 月结束)</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="bu">len</span>(periods)), index<span class="op">=</span>periods)  <span class="co"># 创建一个以 PeriodIndex 为索引的 Series</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.asfreq(<span class="st">'M'</span>, how<span class="op">=</span><span class="st">'start'</span>))   <span class="co"># 转换为每月周期 (开始)</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.asfreq(<span class="st">'B'</span>, how<span class="op">=</span><span class="st">'end'</span>))  <span class="co"># 转换为工作日周期 (结束)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2006-01    1.681827
2007-01   -0.195829
2008-01    0.273490
2009-01   -0.028402
Freq: M, dtype: float64
2006-12-29    1.681827
2007-12-31   -0.195829
2008-12-31    0.273490
2009-12-31   -0.028402
Freq: B, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="季度周期频率" class="level3">
<h3 class="anchored" data-anchor-id="季度周期频率">季度周期频率</h3>
<p>季度数据在财务中很常见。<code>pandas</code> 支持季度频率 (Q-JAN 到 Q-DEC)：</p>
<div id="f3e10412" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co">#在财政年度于 1 月结束的情况下，2012Q4 的时间范围是从 2011 年 11 月到 2012 年 1 月</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pd.Period(<span class="st">'2012Q4'</span>, freq<span class="op">=</span><span class="st">'Q-JAN'</span>)  <span class="co"># 创建一个季度周期 (以 1 月结束)</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p)  <span class="co"># 打印周期</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p.asfreq(<span class="st">'D'</span>, how<span class="op">=</span><span class="st">'start'</span>))  <span class="co"># 转换为每日周期 (开始)</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p.asfreq(<span class="st">'D'</span>, how<span class="op">=</span><span class="st">'end'</span>))  <span class="co"># 转换为每日周期 (结束)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2012Q4
2011-11-01
2012-01-31</code></pre>
</div>
</div>
</section>
<section id="季度周期频率续" class="level3">
<h3 class="anchored" data-anchor-id="季度周期频率续">季度周期频率(续)</h3>
<p>获取季度倒数第二个工作日下午 4 点的时间戳</p>
<div id="e19832ba" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pd.Period(<span class="st">'2012Q4'</span>, freq<span class="op">=</span><span class="st">'Q-JAN'</span>)  <span class="co"># 创建一个季度周期 (以 1 月结束)</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>p4pm <span class="op">=</span> (p.asfreq(<span class="st">'B'</span>, <span class="st">'e'</span>) <span class="op">-</span> <span class="dv">1</span>).asfreq(<span class="st">'T'</span>, <span class="st">'s'</span>) <span class="op">+</span> <span class="dv">16</span> <span class="op">*</span> <span class="dv">60</span> <span class="co">#转换为交易日，取前一天。转换为分钟，取当天的开始时间。然后再加上16*60分钟</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p4pm)  <span class="co"># 打印周期</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p4pm.to_timestamp())  <span class="co"># 转换为 Timestamp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2012-01-30 16:00
2012-01-30 16:00:00</code></pre>
</div>
</div>
</section>
<section id="季度周期频率续-1" class="level3">
<h3 class="anchored" data-anchor-id="季度周期频率续-1">季度周期频率(续)</h3>
<p>使用 pandas.period_range 生成季度范围</p>
<div id="54a427a4" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>periods <span class="op">=</span> pd.period_range(<span class="st">'2011Q3'</span>, <span class="st">'2012Q4'</span>, freq<span class="op">=</span><span class="st">'Q-JAN'</span>)  <span class="co"># 创建一个季度周期范围 (以 1 月结束)</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.arange(<span class="bu">len</span>(periods)), index<span class="op">=</span>periods)  <span class="co"># 创建一个以 PeriodIndex 为索引的 Series</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印时间序列</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>new_periods <span class="op">=</span> (periods.asfreq(<span class="st">'B'</span>, <span class="st">'e'</span>) <span class="op">-</span> <span class="dv">1</span>).asfreq(<span class="st">'H'</span>, <span class="st">'s'</span>) <span class="op">+</span> <span class="dv">16</span>  <span class="co"># 计算下午 4 点的时间戳</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>ts.index <span class="op">=</span> new_periods.to_timestamp()  <span class="co"># 将索引转换为 Timestamp</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印转换后的时间序列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2011Q3    0
2011Q4    1
2012Q1    2
2012Q2    3
2012Q3    4
2012Q4    5
Freq: Q-JAN, dtype: int64
2010-10-28 16:00:00    0
2011-01-28 16:00:00    1
2011-04-28 16:00:00    2
2011-07-28 16:00:00    3
2011-10-28 16:00:00    4
2012-01-30 16:00:00    5
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="将时间戳转换为周期-及返回" class="level3">
<h3 class="anchored" data-anchor-id="将时间戳转换为周期-及返回">将时间戳转换为周期 (及返回)</h3>
<p><code>to_period()</code> 将时间戳转换为周期：</p>
<div id="c487ce8f" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">3</span>, freq<span class="op">=</span><span class="st">'M'</span>)  <span class="co"># 创建一个日期范围 (每月)</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">3</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个以 DatetimeIndex 为索引的 Series</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>pts <span class="op">=</span> ts.to_period()  <span class="co"># 转换为 PeriodIndex</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印原始时间序列</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pts)  <span class="co"># 打印转换为周期的时间序列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-31   -1.938277
2000-02-29    0.065547
2000-03-31   -0.557196
Freq: ME, dtype: float64
2000-01   -1.938277
2000-02    0.065547
2000-03   -0.557196
Freq: M, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="将时间戳转换为周期-及返回续" class="level3">
<h3 class="anchored" data-anchor-id="将时间戳转换为周期-及返回续">将时间戳转换为周期 (及返回)(续)</h3>
<div id="04cedb96" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/29/2000'</span>, periods<span class="op">=</span><span class="dv">6</span>, freq<span class="op">=</span><span class="st">'D'</span>)   <span class="co"># 创建一个日期范围 (每日)</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>ts2 <span class="op">=</span> pd.Series(np.random.randn(<span class="dv">6</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个以 DatetimeIndex 为索引的 Series</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts2.to_period(<span class="st">'M'</span>))  <span class="co"># 转换为每月周期</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts2.to_period(<span class="st">'M'</span>).to_timestamp(how<span class="op">=</span><span class="st">'end'</span>))  <span class="co"># 转换回 Timestamp (月末)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01   -0.747664
2000-01   -0.073217
2000-01    0.699958
2000-02   -1.798177
2000-02    0.226364
2000-02    0.115551
Freq: M, dtype: float64
2000-01-31 23:59:59.999999999   -0.747664
2000-01-31 23:59:59.999999999   -0.073217
2000-01-31 23:59:59.999999999    0.699958
2000-02-29 23:59:59.999999999   -1.798177
2000-02-29 23:59:59.999999999    0.226364
2000-02-29 23:59:59.999999999    0.115551
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="从数组创建-periodindex" class="level3">
<h3 class="anchored" data-anchor-id="从数组创建-periodindex">从数组创建 PeriodIndex</h3>
<p>您可以组合年份和季度列来创建 <code>PeriodIndex</code>：</p>
<div id="48c2503a" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'examples/macrodata.csv'</span>)  <span class="co"># 读取 CSV 文件</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.head(<span class="dv">5</span>))  <span class="co"># 打印前 5 行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year  quarter   realgdp  realcons  realinv  realgovt  realdpi    cpi  \
0  1959        1  2710.349    1707.4  286.898   470.045   1886.9  28.98   
1  1959        2  2778.801    1733.7  310.859   481.301   1919.7  29.15   
2  1959        3  2775.488    1751.8  289.226   491.260   1916.4  29.35   
3  1959        4  2785.204    1753.7  299.356   484.052   1931.3  29.37   
4  1960        1  2847.699    1770.5  331.722   462.199   1955.5  29.54   

      m1  tbilrate  unemp      pop  infl  realint  
0  139.7      2.82    5.8  177.146  0.00     0.00  
1  141.7      3.08    5.1  177.830  2.34     0.74  
2  140.5      3.82    5.3  178.657  2.74     1.09  
3  140.0      4.33    5.6  179.386  0.27     4.06  
4  139.6      3.50    5.2  180.007  2.31     1.19  </code></pre>
</div>
</div>
</section>
<section id="从数组创建-periodindex-续" class="level3">
<h3 class="anchored" data-anchor-id="从数组创建-periodindex-续">从数组创建 PeriodIndex (续)</h3>
<div id="b64872bd" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'examples/macrodata.csv'</span>)  <span class="co"># 读取 CSV 文件</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> pd.PeriodIndex(year<span class="op">=</span>data[<span class="st">'year'</span>], quarter<span class="op">=</span>data[<span class="st">'quarter'</span>],freq<span class="op">=</span><span class="st">'Q-DEC'</span>)  <span class="co"># 从 year 和 quarter 列创建 PeriodIndex</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>data.index <span class="op">=</span> index  <span class="co"># 设置 DataFrame 的索引</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data[<span class="st">'infl'</span>].head())  <span class="co"># 打印 'infl' 列的前几行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1959Q1    0.00
1959Q2    2.34
1959Q3    2.74
1959Q4    0.27
1960Q1    2.31
Freq: Q-DEC, Name: infl, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="重采样和频率转换" class="level2">
<h2 class="anchored" data-anchor-id="重采样和频率转换">重采样和频率转换</h2>
<p><em>重采样</em>将时间序列从一个频率转换为另一个频率。</p>
<ul>
<li><strong>降采样:</strong> 将较高频率的数据聚合到较低频率 (例如，每日到每月)。</li>
<li><strong>升采样:</strong> 将较低频率的数据转换为较高频率 (例如，每日到每小时)。</li>
</ul>
<p>使用 <code>resample()</code> 方法。它类似于 <code>groupby</code>。</p>
<div id="4beffd7b" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">100</span>, freq<span class="op">=</span><span class="st">'D'</span>)  <span class="co"># 创建一个日期范围 (每日)</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.random.randn(<span class="bu">len</span>(dates)), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'M'</span>).mean())  <span class="co"># 每月平均值 (降采样)</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'M'</span>, kind<span class="op">=</span><span class="st">'period'</span>).mean())  <span class="co"># 每月平均值 (降采样，使用周期)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-31   -0.258972
2000-02-29    0.387736
2000-03-31   -0.116505
2000-04-30    0.097491
Freq: ME, dtype: float64
2000-01   -0.258972
2000-02    0.387736
2000-03   -0.116505
2000-04    0.097491
Freq: M, dtype: float64</code></pre>
</div>
</div>
<section id="resample-方法参数" class="level3">
<h3 class="anchored" data-anchor-id="resample-方法参数">Resample 方法参数</h3>
<div class="line-block">参数 | 描述 |<br>
: | :– |<br>
<code>rule</code> | 字符串、DateOffset 或 timedelta，指示所需的重采样频率 (例如，‘M’、‘5min’ 或 Second(15)) |<br>
<code>axis</code> | 要重采样的轴；默认 axis=0 |</div>
<p>|<code>fill_method</code>|升采样时如何插值，如 “ffill” 或 “bfill”；默认不插值| |<code>closed</code>|在降采样中，每个间隔的哪一端是闭合的 (包含的)，“right” 或 “left”|</p>
</section>
<section id="resample-方法参数续" class="level3">
<h3 class="anchored" data-anchor-id="resample-方法参数续">Resample 方法参数(续)</h3>
<div class="line-block">参数 | 描述 |<br>
: | :– |</div>
<p>|<code>label</code>|在降采样中，如何标记聚合结果，使用 “right” 或 “left” 箱边 (例如，9:30 到 9:35 的五分钟间隔可以标记为 9:30 或 9:35)| |<code>limit</code>|向前或向后填充时，要填充的最大周期数| |<code>kind</code>|聚合到周期 (“period”) 或时间戳 (“timestamp”)；默认为时间序列的索引类型| |<code>convention</code>|重采样周期时，将低频周期转换为高频周期的约定 (“start” 或 “end”)；默认为 “start”| |<code>origin</code>|用于确定重采样箱边缘的“基准”时间戳；也可以是“epoch”、“start”、“start_day”、“end”或“end_day”之一；有关完整详细信息，请参阅重采样文档字符串| |<code>offset</code>|添加到原点的偏移 timedelta；默认为 None|</p>
</section>
<section id="降采样" class="level3">
<h3 class="anchored" data-anchor-id="降采样">降采样</h3>
<div id="46cfd5a8" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">12</span>, freq<span class="op">=</span><span class="st">'T'</span>)  <span class="co"># 创建一个日期范围 (每分钟)</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">12</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts)  <span class="co"># 打印原始时间序列</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'5min'</span>).<span class="bu">sum</span>())  <span class="co"># 每 5 分钟求和 (降采样)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-01 00:00:00     0
2000-01-01 00:01:00     1
2000-01-01 00:02:00     2
2000-01-01 00:03:00     3
2000-01-01 00:04:00     4
2000-01-01 00:05:00     5
2000-01-01 00:06:00     6
2000-01-01 00:07:00     7
2000-01-01 00:08:00     8
2000-01-01 00:09:00     9
2000-01-01 00:10:00    10
2000-01-01 00:11:00    11
Freq: min, dtype: int64
2000-01-01 00:00:00    10
2000-01-01 00:05:00    35
2000-01-01 00:10:00    21
Freq: 5min, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="降采样续" class="level2">
<h2 class="anchored" data-anchor-id="降采样续">降采样(续)</h2>
<div id="70fa70f0" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">12</span>, freq<span class="op">=</span><span class="st">'T'</span>)  <span class="co"># 创建一个日期范围 (每分钟)</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">12</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="co"># closed='right', label='left'</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'5min'</span>, closed<span class="op">=</span><span class="st">'right'</span>).<span class="bu">sum</span>())  <span class="co"># 每 5 分钟求和 (右闭合，左标签)</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co"># closed='right', label='right'</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'5min'</span>, closed<span class="op">=</span><span class="st">'right'</span>, label<span class="op">=</span><span class="st">'right'</span>).<span class="bu">sum</span>())  <span class="co"># 每 5 分钟求和 (右闭合，右标签)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1999-12-31 23:55:00     0
2000-01-01 00:00:00    15
2000-01-01 00:05:00    40
2000-01-01 00:10:00    11
Freq: 5min, dtype: int64
2000-01-01 00:00:00     0
2000-01-01 00:05:00    15
2000-01-01 00:10:00    40
2000-01-01 00:15:00    11
Freq: 5min, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="降采样续-1" class="level2">
<h2 class="anchored" data-anchor-id="降采样续-1">降采样(续)</h2>
<div id="27bfbc4c" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.tseries.frequencies <span class="im">import</span> to_offset</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">12</span>, freq<span class="op">=</span><span class="st">'T'</span>)  <span class="co"># 创建一个日期范围 (每分钟)</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">12</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 移动结果索引</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> ts.resample(<span class="st">'5min'</span>, closed<span class="op">=</span><span class="st">'right'</span>, label<span class="op">=</span><span class="st">'right'</span>).<span class="bu">sum</span>()  <span class="co"># 每 5 分钟求和 (右闭合，右标签)</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>result.index <span class="op">=</span> result.index <span class="op">+</span> to_offset(<span class="st">"-1s"</span>)   <span class="co"># 将索引减去 1 秒</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)  <span class="co"># 打印修改后的时间序列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1999-12-31 23:59:59     0
2000-01-01 00:04:59    15
2000-01-01 00:09:59    40
2000-01-01 00:14:59    11
Freq: 5min, dtype: int64</code></pre>
</div>
</div>
<section id="开盘-最高-最低-收盘-ohlc-重采样" class="level4">
<h4 class="anchored" data-anchor-id="开盘-最高-最低-收盘-ohlc-重采样">开盘-最高-最低-收盘 (OHLC) 重采样</h4>
<p>金融数据重采样</p>
<div id="d326339f" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">12</span>, freq<span class="op">=</span><span class="st">'T'</span>)  <span class="co"># 创建一个日期范围 (每分钟)</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(np.arange(<span class="dv">12</span>), index<span class="op">=</span>dates)  <span class="co"># 创建一个时间序列</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts.resample(<span class="st">'5min'</span>).ohlc())  <span class="co"># 每 5 分钟的 OHLC (开盘、最高、最低、收盘)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     open  high  low  close
2000-01-01 00:00:00     0     4    0      4
2000-01-01 00:05:00     5     9    5      9
2000-01-01 00:10:00    10    11   10     11</code></pre>
</div>
</div>
</section>
<section id="升采样和插值" class="level3">
<h3 class="anchored" data-anchor-id="升采样和插值">升采样和插值</h3>
<div id="783afaaf" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>frame <span class="op">=</span> pd.DataFrame(np.random.randn(<span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                    index<span class="op">=</span>pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">2</span>, freq<span class="op">=</span><span class="st">'W-WED'</span>),  <span class="co"># 每周三</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                    columns<span class="op">=</span>[<span class="st">'Colorado'</span>, <span class="st">'Texas'</span>, <span class="st">'New York'</span>, <span class="st">'Ohio'</span>])  <span class="co"># 创建一个 DataFrame</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(frame)  <span class="co"># 打印 DataFrame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Colorado     Texas  New York      Ohio
2000-01-05 -1.163635  0.984639  0.453824 -1.478240
2000-01-12 -0.847976 -0.770445 -0.731393 -0.645453</code></pre>
</div>
</div>
</section>
</section>
<section id="升采样和插值续" class="level2">
<h2 class="anchored" data-anchor-id="升采样和插值续">升采样和插值(续)</h2>
<div id="281025bb" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>frame <span class="op">=</span> pd.DataFrame(np.random.randn(<span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                    index<span class="op">=</span>pd.date_range(<span class="st">'1/1/2000'</span>, periods<span class="op">=</span><span class="dv">2</span>, freq<span class="op">=</span><span class="st">'W-WED'</span>),  <span class="co"># 每周三</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>                    columns<span class="op">=</span>[<span class="st">'Colorado'</span>, <span class="st">'Texas'</span>, <span class="st">'New York'</span>, <span class="st">'Ohio'</span>])  <span class="co"># 创建一个 DataFrame</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>df_daily <span class="op">=</span> frame.resample(<span class="st">'D'</span>).asfreq()  <span class="co"># 升采样到每日 (用 NaN 填充)</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_daily)  <span class="co"># 打印升采样后的 DataFrame</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(frame.resample(<span class="st">'D'</span>).ffill())  <span class="co"># 升采样到每日 (向前填充)</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(frame.resample(<span class="st">'D'</span>).ffill(limit<span class="op">=</span><span class="dv">2</span>))  <span class="co"># 升采样到每日 (向前填充，限制为 2 个周期)</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(frame.resample(<span class="st">'W-THU'</span>).ffill())   <span class="co"># 升采样到每周四 (向前填充)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Colorado     Texas  New York      Ohio
2000-01-05  1.267983 -0.557187 -0.937678  0.403461
2000-01-06       NaN       NaN       NaN       NaN
2000-01-07       NaN       NaN       NaN       NaN
2000-01-08       NaN       NaN       NaN       NaN
2000-01-09       NaN       NaN       NaN       NaN
2000-01-10       NaN       NaN       NaN       NaN
2000-01-11       NaN       NaN       NaN       NaN
2000-01-12  0.128901 -0.086334 -0.973667  0.845069
            Colorado     Texas  New York      Ohio
2000-01-05  1.267983 -0.557187 -0.937678  0.403461
2000-01-06  1.267983 -0.557187 -0.937678  0.403461
2000-01-07  1.267983 -0.557187 -0.937678  0.403461
2000-01-08  1.267983 -0.557187 -0.937678  0.403461
2000-01-09  1.267983 -0.557187 -0.937678  0.403461
2000-01-10  1.267983 -0.557187 -0.937678  0.403461
2000-01-11  1.267983 -0.557187 -0.937678  0.403461
2000-01-12  0.128901 -0.086334 -0.973667  0.845069
            Colorado     Texas  New York      Ohio
2000-01-05  1.267983 -0.557187 -0.937678  0.403461
2000-01-06  1.267983 -0.557187 -0.937678  0.403461
2000-01-07  1.267983 -0.557187 -0.937678  0.403461
2000-01-08       NaN       NaN       NaN       NaN
2000-01-09       NaN       NaN       NaN       NaN
2000-01-10       NaN       NaN       NaN       NaN
2000-01-11       NaN       NaN       NaN       NaN
2000-01-12  0.128901 -0.086334 -0.973667  0.845069
            Colorado     Texas  New York      Ohio
2000-01-06  1.267983 -0.557187 -0.937678  0.403461
2000-01-13  0.128901 -0.086334 -0.973667  0.845069</code></pre>
</div>
</div>
<section id="使用周期进行重采样" class="level3">
<h3 class="anchored" data-anchor-id="使用周期进行重采样">使用周期进行重采样</h3>
<p>重采样以周期为索引的数据类似：</p>
<div id="5ef2e421" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>frame <span class="op">=</span> pd.DataFrame(np.random.randn(<span class="dv">24</span>, <span class="dv">4</span>),</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                     index<span class="op">=</span>pd.period_range(<span class="st">'1-2000'</span>, <span class="st">'12-2001'</span>, freq<span class="op">=</span><span class="st">'M'</span>),  <span class="co"># 每月周期</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>                     columns<span class="op">=</span>[<span class="st">'Colorado'</span>, <span class="st">'Texas'</span>, <span class="st">'New York'</span>, <span class="st">'Ohio'</span>])  <span class="co"># 创建一个 DataFrame</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(frame.head())  <span class="co"># 打印 DataFrame 的前几行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Colorado     Texas  New York      Ohio
2000-01 -0.368723 -0.765435 -1.499382  0.768872
2000-02 -0.817508  0.088998  0.146404 -0.688862
2000-03  0.857336 -0.316786 -0.001938  0.457846
2000-04  0.693818  1.206817  0.934642  2.477505
2000-05 -0.453236  0.591688  0.450695  0.297406</code></pre>
</div>
</div>
</section>
</section>
<section id="使用周期进行重采样续" class="level2">
<h2 class="anchored" data-anchor-id="使用周期进行重采样续">使用周期进行重采样(续)</h2>
<div id="3dcff5d5" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>frame <span class="op">=</span> pd.DataFrame(np.random.randn(<span class="dv">24</span>, <span class="dv">4</span>),</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>                     index<span class="op">=</span>pd.period_range(<span class="st">'1-2000'</span>, <span class="st">'12-2001'</span>, freq<span class="op">=</span><span class="st">'M'</span>),  <span class="co"># 每月周期</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>                     columns<span class="op">=</span>[<span class="st">'Colorado'</span>, <span class="st">'Texas'</span>, <span class="st">'New York'</span>, <span class="st">'Ohio'</span>])  <span class="co"># 创建一个 DataFrame</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>annual_frame <span class="op">=</span> frame.resample(<span class="st">'A-DEC'</span>).mean()  <span class="co"># 降采样到年度 (以 12 月结束)</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(annual_frame)  <span class="co"># 打印降采样后的 DataFrame</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-DEC: 季度，年份以 12 月结束</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(annual_frame.resample(<span class="st">'Q-DEC'</span>, convention<span class="op">=</span><span class="st">'end'</span>).asfreq())  <span class="co"># 降采样到季度 (年底，转换为频率)</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(annual_frame.resample(<span class="st">'Q-MAR'</span>).ffill())  <span class="co"># 降采样到季度(以三月结尾，并向前填充)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Colorado     Texas  New York      Ohio
2000  0.031645  0.057826  0.035487  0.240862
2001  0.277345  0.033634  0.158828  0.381369
        Colorado     Texas  New York      Ohio
2000Q4  0.031645  0.057826  0.035487  0.240862
2001Q1       NaN       NaN       NaN       NaN
2001Q2       NaN       NaN       NaN       NaN
2001Q3       NaN       NaN       NaN       NaN
2001Q4  0.277345  0.033634  0.158828  0.381369
        Colorado     Texas  New York      Ohio
2000Q4  0.031645  0.057826  0.035487  0.240862
2001Q1  0.031645  0.057826  0.035487  0.240862
2001Q2  0.031645  0.057826  0.035487  0.240862
2001Q3  0.031645  0.057826  0.035487  0.240862
2001Q4  0.277345  0.033634  0.158828  0.381369
2002Q1  0.277345  0.033634  0.158828  0.381369
2002Q2  0.277345  0.033634  0.158828  0.381369
2002Q3  0.277345  0.033634  0.158828  0.381369</code></pre>
</div>
</div>
</section>
<section id="分组时间重采样" class="level2">
<h2 class="anchored" data-anchor-id="分组时间重采样">分组时间重采样</h2>
<div id="f72cbf0c" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">15</span>  <span class="co"># 定义时间序列的长度</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> pd.date_range(<span class="st">'2017-05-20 00:00'</span>, freq<span class="op">=</span><span class="st">'1min'</span>, periods<span class="op">=</span>N)  <span class="co"># 创建一个时间范围 (每分钟)</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'time'</span>: times, <span class="st">'value'</span>: np.arange(N)})  <span class="co"># 创建一个 DataFrame</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)  <span class="co"># 打印 DataFrame</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.set_index(<span class="st">'time'</span>).resample(<span class="st">'5min'</span>).count())  <span class="co"># 按时间分组，每 5 分钟计数</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  time  value
0  2017-05-20 00:00:00      0
1  2017-05-20 00:01:00      1
2  2017-05-20 00:02:00      2
3  2017-05-20 00:03:00      3
4  2017-05-20 00:04:00      4
5  2017-05-20 00:05:00      5
6  2017-05-20 00:06:00      6
7  2017-05-20 00:07:00      7
8  2017-05-20 00:08:00      8
9  2017-05-20 00:09:00      9
10 2017-05-20 00:10:00     10
11 2017-05-20 00:11:00     11
12 2017-05-20 00:12:00     12
13 2017-05-20 00:13:00     13
14 2017-05-20 00:14:00     14
                     value
time                      
2017-05-20 00:00:00      5
2017-05-20 00:05:00      5
2017-05-20 00:10:00      5</code></pre>
</div>
</div>
</section>
<section id="分组时间重采样续" class="level2">
<h2 class="anchored" data-anchor-id="分组时间重采样续">分组时间重采样(续)</h2>
<div id="95f82f0d" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> pd.date_range(<span class="st">'2017-05-20 00:00'</span>, freq<span class="op">=</span><span class="st">'1min'</span>, periods<span class="op">=</span>N)  <span class="co"># 创建一个日期范围 (每分钟)</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({<span class="st">'time'</span>: times.repeat(<span class="dv">3</span>),  <span class="co"># time 列重复 3 次</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'key'</span>: np.tile([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], N),  <span class="co"># 创建 key 列 (a, b, c 重复)</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'value'</span>: np.arange(N <span class="op">*</span> <span class="fl">3.</span>)})  <span class="co"># 创建 value 列</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df2.head(<span class="dv">7</span>))  <span class="co"># 打印 DataFrame 的前几行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 time key  value
0 2017-05-20 00:00:00   a    0.0
1 2017-05-20 00:00:00   b    1.0
2 2017-05-20 00:00:00   c    2.0
3 2017-05-20 00:01:00   a    3.0
4 2017-05-20 00:01:00   b    4.0
5 2017-05-20 00:01:00   c    5.0
6 2017-05-20 00:02:00   a    6.0</code></pre>
</div>
</div>
</section>
<section id="分组时间重采样续-1" class="level2">
<h2 class="anchored" data-anchor-id="分组时间重采样续-1">分组时间重采样(续)</h2>
<div id="2e34eecf" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> pd.date_range(<span class="st">'2017-05-20 00:00'</span>, freq<span class="op">=</span><span class="st">'1min'</span>, periods<span class="op">=</span>N)  <span class="co"># 创建一个日期范围 (每分钟)</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({<span class="st">'time'</span>: times.repeat(<span class="dv">3</span>),</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'key'</span>: np.tile([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], N),</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'value'</span>: np.arange(N <span class="op">*</span> <span class="fl">3.</span>)})  <span class="co"># 创建 DataFrame</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>time_key <span class="op">=</span> pd.Grouper(freq<span class="op">=</span><span class="st">'5min'</span>)  <span class="co"># 创建一个时间分组器 (每 5 分钟)</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>resampled <span class="op">=</span> (df2.set_index(<span class="st">'time'</span>)  <span class="co"># 设置 time 列为索引</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>             .groupby([<span class="st">'key'</span>, time_key])  <span class="co"># 按 key 和 time_key 分组</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>             .<span class="bu">sum</span>())  <span class="co"># 求和</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(resampled)  <span class="co"># 打印重采样后的 DataFrame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         value
key time                      
a   2017-05-20 00:00:00   30.0
    2017-05-20 00:05:00  105.0
    2017-05-20 00:10:00  180.0
b   2017-05-20 00:00:00   35.0
    2017-05-20 00:05:00  110.0
    2017-05-20 00:10:00  185.0
c   2017-05-20 00:00:00   40.0
    2017-05-20 00:05:00  115.0
    2017-05-20 00:10:00  190.0</code></pre>
</div>
</div>
</section>
<section id="移动窗口函数" class="level2">
<h2 class="anchored" data-anchor-id="移动窗口函数">移动窗口函数</h2>
<p><em>移动窗口函数</em> (也称为<em>滚动窗口函数</em>) 对数据的滑动窗口进行操作。它们通常用于平滑嘈杂的时间序列。</p>
<div id="b018a6e1" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np   <span class="co"># 导入 NumPy</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="移动窗口函数续" class="level2">
<h2 class="anchored" data-anchor-id="移动窗口函数续">移动窗口函数(续)</h2>
<div id="a6402d27" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co">#导入绘图模块</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>close_px[<span class="st">'AAPL'</span>].plot()  <span class="co"># 绘制 AAPL 的收盘价</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>close_px[<span class="st">'AAPL'</span>].rolling(<span class="dv">250</span>).mean().plot()  <span class="co"># 绘制 AAPL 的 250 天移动平均线</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-67-output-1.png" width="575" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="移动窗口函数续-1" class="level2">
<h2 class="anchored" data-anchor-id="移动窗口函数续-1">移动窗口函数(续)</h2>
<div id="42c9eb07" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co">#导入绘图模块</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>std250 <span class="op">=</span> close_px[<span class="st">'AAPL'</span>].pct_change().rolling(<span class="dv">250</span>, min_periods<span class="op">=</span><span class="dv">10</span>).std()  <span class="co"># 计算 250 天滚动标准差 (至少 10 个周期)</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(std250[<span class="dv">5</span>:<span class="dv">12</span>])  <span class="co"># 打印一部分标准差</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>std250.plot()  <span class="co"># 绘制标准差</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2003-01-09         NaN
2003-01-10         NaN
2003-01-13         NaN
2003-01-14         NaN
2003-01-15         NaN
2003-01-16    0.009628
2003-01-17    0.013818
Freq: B, Name: AAPL, dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-68-output-2.png" width="587" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="移动窗口函数续-2" class="level2">
<h2 class="anchored" data-anchor-id="移动窗口函数续-2">移动窗口函数(续)</h2>
<div id="67ff40f0" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># 导入 NumPy</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co">#导入绘图模块</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>std250 <span class="op">=</span> close_px[<span class="st">'AAPL'</span>].pct_change().rolling(<span class="dv">250</span>, min_periods<span class="op">=</span><span class="dv">10</span>).std()  <span class="co"># 计算 250 天滚动标准差 (至少 10 个周期)</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>expanding_mean <span class="op">=</span> std250.expanding().mean()  <span class="co"># 计算扩展平均值</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="移动窗口函数续-3" class="level2">
<h2 class="anchored" data-anchor-id="移动窗口函数续-3">移动窗口函数(续)</h2>
<div id="3792e3fc" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt  <span class="co"># 导入 matplotlib.pyplot</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'grayscale'</span>)  <span class="co"># 使用灰度样式</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>close_px.rolling(<span class="dv">60</span>).mean().plot(logy<span class="op">=</span><span class="va">True</span>)  <span class="co"># 绘制 60 天滚动平均线 (对数 y 轴)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-70-output-1.png" width="572" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="移动窗口函数续-4" class="level2">
<h2 class="anchored" data-anchor-id="移动窗口函数续-4">移动窗口函数(续)</h2>
<div id="ed5f91f5" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(close_px.rolling(<span class="st">'20D'</span>).mean())  <span class="co"># 计算 20 天滚动平均线</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  AAPL       MSFT        XOM
2003-01-02    7.400000  21.110000  29.220000
2003-01-03    7.425000  21.125000  29.230000
2003-01-06    7.433333  21.256667  29.473333
2003-01-07    7.432500  21.425000  29.342500
2003-01-08    7.402000  21.402000  29.240000
...                ...        ...        ...
2011-10-10  389.351429  25.602143  72.527857
2011-10-11  388.505000  25.674286  72.835000
2011-10-12  388.531429  25.810000  73.400714
2011-10-13  388.826429  25.961429  73.905000
2011-10-14  391.038000  26.048667  74.185333

[2292 rows x 3 columns]</code></pre>
</div>
</div>
<section id="指数加权函数" class="level3">
<h3 class="anchored" data-anchor-id="指数加权函数">指数加权函数</h3>
<div id="9915aadf" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt  <span class="co"># 导入 matplotlib.pyplot</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>aapl_px <span class="op">=</span> close_px[<span class="st">'AAPL'</span>][<span class="st">'2006'</span>:<span class="st">'2007'</span>]  <span class="co"># 选择 2006 年和 2007 年的 AAPL 数据</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>ma30 <span class="op">=</span> aapl_px.rolling(<span class="dv">30</span>, min_periods<span class="op">=</span><span class="dv">20</span>).mean()  <span class="co"># 30 天简单移动平均线 (至少 20 个周期)</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>ewma30 <span class="op">=</span> aapl_px.ewm(span<span class="op">=</span><span class="dv">30</span>).mean()  <span class="co"># 30 天指数加权移动平均线</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>aapl_px.plot(style<span class="op">=</span><span class="st">'k-'</span>, label<span class="op">=</span><span class="st">'Price'</span>)  <span class="co"># 绘制 AAPL 价格</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>ma30.plot(style<span class="op">=</span><span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Simple Moving Avg'</span>)  <span class="co"># 绘制简单移动平均线</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>ewma30.plot(style<span class="op">=</span><span class="st">'k-'</span>, label<span class="op">=</span><span class="st">'EW MA'</span>)  <span class="co"># 绘制指数加权移动平均线</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>plt.legend()  <span class="co"># 显示图例</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-72-output-1.png" width="575" height="426" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="二元移动窗口函数" class="level3">
<h3 class="anchored" data-anchor-id="二元移动窗口函数">二元移动窗口函数</h3>
<div id="c649919a" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt  <span class="co"># 导入 matplotlib.pyplot</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>spx_px <span class="op">=</span> close_px_all[<span class="st">'SPX'</span>]  <span class="co"># 获取 S&amp;P 500 指数</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>spx_rets <span class="op">=</span> spx_px.pct_change()  <span class="co"># 计算 S&amp;P 500 指数的收益率</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> close_px.pct_change()  <span class="co"># 计算所有股票的收益率</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="co"># AAPL 收益率与 S&amp;P 500 收益率的相关性</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> returns[<span class="st">'AAPL'</span>].rolling(<span class="dv">125</span>, min_periods<span class="op">=</span><span class="dv">100</span>).corr(spx_rets)  <span class="co"># 计算 125 天滚动相关性 (至少 100 个周期)</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>corr.plot()  <span class="co"># 绘制相关性</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-73-output-1.png" width="571" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="二元移动窗口函数-续" class="level3">
<h3 class="anchored" data-anchor-id="二元移动窗口函数-续">二元移动窗口函数 (续)</h3>
<div id="675a860b" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt  <span class="co"># 导入 matplotlib.pyplot</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>spx_px <span class="op">=</span> close_px_all[<span class="st">'SPX'</span>]  <span class="co"># 获取 S&amp;P 500 指数</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>spx_rets <span class="op">=</span> spx_px.pct_change()  <span class="co"># 计算 S&amp;P 500 指数的收益率</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> close_px.pct_change()  <span class="co"># 计算所有股票的收益率</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 所有股票收益率与 S&amp;P 500 的相关性</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> returns.rolling(<span class="dv">125</span>, min_periods<span class="op">=</span><span class="dv">100</span>).corr(spx_rets)  <span class="co"># 计算 125 天滚动相关性 (至少 100 个周期)</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>corr.plot()  <span class="co"># 绘制相关性</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-74-output-1.png" width="571" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="用户定义的移动窗口函数" class="level3">
<h3 class="anchored" data-anchor-id="用户定义的移动窗口函数">用户定义的移动窗口函数</h3>
<p><code>apply</code> 方法允许您应用自定义函数：</p>
<div id="3d23b262" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt  <span class="co"># 导入 matplotlib.pyplot</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># 导入 pandas</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> percentileofscore  <span class="co"># 导入 percentileofscore</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>close_px_all <span class="op">=</span> pd.read_csv(<span class="st">'examples/stock_px.csv'</span>,parse_dates<span class="op">=</span><span class="va">True</span>, index_col<span class="op">=</span><span class="dv">0</span>)  <span class="co"># 读取 CSV 文件，解析日期，设置第一列为索引</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px_all[[<span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>, <span class="st">'XOM'</span>]]  <span class="co"># 选择 AAPL, MSFT, XOM 列</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>close_px <span class="op">=</span> close_px.resample(<span class="st">'B'</span>).ffill()  <span class="co"># 按工作日重采样 (向前填充)</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> close_px.pct_change()  <span class="co"># 计算所有股票的收益率</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_at_2percent(x):</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""计算 0.02 在数组 x 中的百分位数"""</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> percentileofscore(x, <span class="fl">0.02</span>)</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> returns[<span class="st">'AAPL'</span>].rolling(<span class="dv">250</span>).<span class="bu">apply</span>(score_at_2percent)  <span class="co"># 计算 250 天滚动百分位数</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>result.plot()  <span class="co"># 绘制百分位数</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas3ed11cn_files/figure-html/cell-75-output-1.png" width="579" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="总结" class="level2">
<h2 class="anchored" data-anchor-id="总结">总结</h2>
<p>本章介绍了在 <code>pandas</code> 中处理时间序列数据的基本技术，包括：</p>
<ul>
<li>日期和时间数据类型。</li>
<li>时间序列索引、选择和子集化。</li>
<li>生成日期范围和频率。</li>
<li>移动数据。</li>
<li>时区处理。</li>
<li>周期和周期算术。</li>
<li>重采样 (降采样和升采样)。</li>
<li>移动窗口函数。</li>
</ul>
<p>这些工具是分析基于时间的数据的基础。</p>
</section>
<section id="小结" class="level2">
<h2 class="anchored" data-anchor-id="小结">小结</h2>
<ul>
<li><strong>时间序列数据:</strong> 按时间顺序索引的数据点序列。</li>
<li><strong>pandas 功能:</strong> <code>pandas</code> 提供了强大的工具来操作时间序列数据。</li>
<li><strong>关键操作:</strong> 学习了处理日期/时间类型、重采样、移位和应用滚动函数。</li>
<li><strong>应用:</strong> 这些技术适用于金融、经济、生态等领域。</li>
<li><strong>构建块:</strong> 高级时间序列建模的基础。</li>
</ul>
</section>
<section id="思考与讨论" class="level2">
<h2 class="anchored" data-anchor-id="思考与讨论">思考与讨论</h2>
<ol type="1">
<li><strong>数据频率选择:</strong> 频率选择如何影响洞察力？</li>
<li><strong>缺失数据策略:</strong> 讨论处理缺失数据的策略。</li>
<li><strong>移动窗口函数选择:</strong> 不同类型移动平均线之间的权衡。</li>
<li><strong>时区意识:</strong> 为什么时区意识至关重要？</li>
<li><strong>重采样应用:</strong> 重采样的其他应用。</li>
<li><strong>周期与时间戳:</strong> 何时使用周期与时间戳？</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/qiufei\.github\.io\/web-slide-pandas3ed");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>🔋<a href="https://posit.co"><img src="https://posit.co/wp-content/themes/Posit/assets/images/posit-logo-2024.svg" class="img-fluid" alt="Posit" width="65"></a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 邱飞 © 2025
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://beian.miit.gov.cn">
<p>浙ICP备 2024072710号-1</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33021202002511">
<p>浙公网安备 33021202002511号</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:hfutqiufei@163.com">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>