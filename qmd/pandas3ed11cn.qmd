---
title: "Python æ•°æ®åˆ†æ"  # å¹»ç¯ç‰‡æ ‡é¢˜
subtitle: "ç¬¬ 11 ç«  æ—¶é—´åºåˆ—"  # å‰¯æ ‡é¢˜
---

```{python}
# SETUP (æä¾›çš„ä»£ç  - éœ€è¦æ”¾åœ¨ notebook çš„é¡¶éƒ¨)
import numpy as np  # å¯¼å…¥ NumPy åº“ï¼Œç”¨äºæ•°å€¼è®¡ç®—ï¼Œå¹¶ç®€å†™ä¸º np
import pandas as pd  # å¯¼å…¥ pandas åº“ï¼Œç”¨äºæ•°æ®åˆ†æï¼Œå¹¶ç®€å†™ä¸º pd
from datetime import datetime, timedelta  # ä» datetime æ¨¡å—å¯¼å…¥ datetime å’Œ timedelta ç±»
import pytz  # å¯¼å…¥ pytz åº“ï¼Œç”¨äºå¤„ç†æ—¶åŒº
from pandas.tseries.offsets import Hour, Minute, Day, MonthEnd  # ä» pandas å¯¼å…¥æ—¶é—´åç§»å¯¹è±¡

# ä¸ºäº†æ¼”ç¤ºï¼Œåœ¨æ­¤ç‰¹å®š notebook ä¸­æŠ‘åˆ¶ FutureWarnings
import warnings  # å¯¼å…¥ warnings æ¨¡å—
warnings.simplefilter(action='ignore', category=FutureWarning)  # å¿½ç•¥ FutureWarnings

# ç”¨äºç»˜å›¾
import matplotlib.pyplot as plt  # å¯¼å…¥ matplotlib.pyplot æ¨¡å—ï¼Œç”¨äºç»˜å›¾ï¼Œå¹¶ç®€å†™ä¸º plt
```

## æ—¶é—´åºåˆ—æ•°æ®ç®€ä»‹

æ—¶é—´åºåˆ—æ•°æ®æ˜¯æŒ‰æ—¶é—´é—´éš”æ”¶é›†çš„ä¸€ç³»åˆ—æ•°æ®ç‚¹ã€‚â±ï¸ å®ƒåœ¨å„ä¸ªé¢†åŸŸéƒ½æ˜¯è‡³å…³é‡è¦çš„æ•°æ®ç±»å‹ï¼š

-   **é‡‘è:** è‚¡ç¥¨ä»·æ ¼ã€äº¤æ˜“é‡ã€åˆ©ç‡ ğŸ’°
-   **ç»æµ:** GDPã€é€šè´§è†¨èƒ€ç‡ã€å¤±ä¸šç‡ ğŸ“ˆ
-   **ç”Ÿæ€:** ç§ç¾¤è§„æ¨¡ã€æ¸©åº¦å˜åŒ– ğŸŒ¡ï¸
-   **ç¥ç»ç§‘å­¦:** è„‘ç”µæ³¢æ´»åŠ¨ã€ç¥ç»ä¿¡å· ğŸ§ 
-   **ç‰©ç†:** è¿åŠ¨ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ ğŸš€

æœ¬è´¨ä¸Šï¼Œä»»ä½•éšæ—¶é—´é‡å¤è®°å½•çš„å†…å®¹éƒ½æ„æˆæ—¶é—´åºåˆ—ã€‚

## æ—¶é—´åºåˆ—æ•°æ®çš„ç±»å‹

æ—¶é—´åºåˆ—æ•°æ®å¯ä»¥æ ¹æ®æ•°æ®ç‚¹ç›¸å¯¹äºæ—¶é—´çš„åº¦é‡æ–¹å¼è¿›è¡Œåˆ†ç±»ï¼š

1.  **æ—¶é—´æˆ³ (Timestamps):** æ—¶é—´ä¸Šçš„ç‰¹å®šæ—¶åˆ» (ä¾‹å¦‚ï¼Œ2024-10-27 09:30:00)ã€‚
2.  **å›ºå®šå‘¨æœŸ (Fixed Periods):**  è¡¨ç¤ºæ•´ä¸ªæŒç»­æ—¶é—´ (ä¾‹å¦‚ï¼Œ2017 å¹´ 1 æœˆï¼Œ2020 å¹´)ã€‚
3.  **æ—¶é—´é—´éš” (Intervals of Time):** ç”±å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³æŒ‡ç¤º (ä¾‹å¦‚ï¼Œä»ä¸‹åˆ 2:00 åˆ° 2:30 çš„ç”¨æˆ·ä¼šè¯)ã€‚
4.  **å®éªŒæˆ–ç»è¿‡æ—¶é—´ (Experiment or Elapsed Time):** ç›¸å¯¹äºèµ·å§‹ç‚¹çš„æ—¶é—´ (ä¾‹å¦‚ï¼Œé¥¼å¹²æ”¾å…¥çƒ¤ç®±åçš„ç§’æ•°)ã€‚

æœ¬ç« ä¸»è¦å…³æ³¨å‰ä¸‰ç§ç±»å‹ (æ—¶é—´æˆ³ã€å›ºå®šå‘¨æœŸå’Œæ—¶é—´é—´éš”)ã€‚

## æ—¶é—´åºåˆ—ï¼šè§„åˆ™ä¸ä¸è§„åˆ™

æ—¶é—´åºåˆ—ä¹Ÿå¯ä»¥æ˜¯ï¼š

-   **å›ºå®šé¢‘ç‡ (è§„åˆ™):** æ•°æ®ç‚¹ä»¥å›ºå®šçš„æ—¶é—´é—´éš”å‡ºç° (ä¾‹å¦‚ï¼Œæ¯ 15 ç§’ã€æ¯ 5 åˆ†é’Ÿã€æ¯æœˆ)ã€‚ğŸ—“ï¸
-   **ä¸è§„åˆ™:** æ•°æ®ç‚¹ä¸éµå¾ªå›ºå®šçš„æ—¶é—´å•ä½ (ä¾‹å¦‚ï¼Œç½‘ç«™è®¿é—®çš„æ—¶é—´æˆ³)ã€‚ğŸš¶

è¡¨ç¤ºæ–¹å¼çš„é€‰æ‹©å–å†³äºå…·ä½“çš„åº”ç”¨ã€‚

## pandas ä¸­çš„æ—¶é—´åºåˆ—

`pandas` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Python åº“ï¼Œä¸ºæ—¶é—´åºåˆ—åˆ†ææä¾›äº†å¹¿æ³›çš„å·¥å…·ã€‚å®ƒå…è®¸ä½ ï¼š

-   é«˜æ•ˆå¤„ç†å¤§å‹æ—¶é—´åºåˆ—ã€‚ğŸ—‚ï¸
-   åˆ‡ç‰‡ã€åˆ‡å—å’Œèšåˆæ•°æ®ã€‚ğŸ”ª
-   å¯¹ä¸è§„åˆ™å’Œå›ºå®šé¢‘ç‡çš„æ—¶é—´åºåˆ—è¿›è¡Œé‡é‡‡æ ·ã€‚ğŸ”„
-   å¤„ç†ç¼ºå¤±æ•°æ®ã€‚â“

è¿™äº›åŠŸèƒ½å¯¹äºé‡‘èå’Œç»æµåº”ç”¨è‡³å…³é‡è¦ï¼Œä½†å®ƒä»¬åŒæ ·é€‚ç”¨äºåˆ†æå„ç§æ•°æ®é›†ï¼Œå¦‚æœåŠ¡å™¨æ—¥å¿—ã€‚

## å¯¼å…¥å¿…è¦çš„åº“

åœ¨æ·±å…¥ç ”ç©¶æ—¶é—´åºåˆ—æ“ä½œä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¯¼å…¥å¿…è¦çš„åº“ï¼šç”¨äºæ•°å€¼è¿ç®—çš„ `NumPy` å’Œç”¨äºæ•°æ®åˆ†æçš„ `pandas`ã€‚

```{python}
import numpy as np  # å¯¼å…¥ NumPy åº“ï¼Œç”¨äºæ•°å€¼è®¡ç®—
import pandas as pd  # å¯¼å…¥ pandas åº“ï¼Œç”¨äºæ•°æ®åˆ†æ
```

## æ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹åŠå·¥å…·

Python çš„æ ‡å‡†åº“æä¾›äº†ç”¨äºå¤„ç†æ—¥æœŸå’Œæ—¶é—´çš„æ¨¡å—ï¼š

-   `datetime`:  æä¾›ç”¨äºæ“ä½œæ—¥æœŸå’Œæ—¶é—´çš„ç±» (ä¾‹å¦‚ï¼Œ`datetime`ã€`date`ã€`time`ã€`timedelta`)ã€‚
-   `time`:  æä¾›ä¸æ—¶é—´ç›¸å…³çš„å‡½æ•°ã€‚
-   `calendar`:  ä¸æ—¥å†ç›¸å…³çš„å‡½æ•°ã€‚

`datetime.datetime` ç±»å‹ (æˆ–ç®€ç§°ä¸º `datetime`) æ˜¯å¸¸ç”¨çš„ã€‚

## `datetime` å¯¹è±¡

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `datetime` å¯¹è±¡æ¥è¡¨ç¤ºå½“å‰æ—¶é—´ï¼š

```{python}
from datetime import datetime  # ä» datetime æ¨¡å—å¯¼å…¥ datetime ç±»

now = datetime.now()  # è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´
print(now)  # æ‰“å°å½“å‰æ—¥æœŸå’Œæ—¶é—´
```

æ­¤ä»£ç ç‰‡æ®µæ£€ç´¢å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚

## `datetime` å¯¹è±¡ (ç»­)

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ„å»ºä¸€ä¸ª datetime å¯¹è±¡ï¼š

```{python}
from datetime import datetime  # ç¡®ä¿å¯¼å…¥äº† datetime ç±»

my_date = datetime(2024, 10, 27, 10, 30, 0)  # å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’
print(my_date)  # æ‰“å°æ‰‹åŠ¨åˆ›å»ºçš„ datetime å¯¹è±¡
```

è®¿é—®å„ä¸ªç»„æˆéƒ¨åˆ†ï¼š

```{python}
from datetime import datetime # ç¡®ä¿å¯¼å…¥äº†datetime

now = datetime.now()  # è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´
print(f"Year: {now.year}, Month: {now.month}, Day: {now.day}")  # æ‰“å°å¹´ã€æœˆã€æ—¥
```

## `timedelta` å¯¹è±¡

`timedelta` å¯¹è±¡è¡¨ç¤ºä¸¤ä¸ª `datetime` å¯¹è±¡ä¹‹é—´çš„å·®ï¼š

```{python}
from datetime import datetime  # ç¡®ä¿å¯¼å…¥äº† datetime

delta = datetime(2011, 1, 7) - datetime(2008, 6, 24, 8, 15)  # è®¡ç®—ä¸¤ä¸ª datetime å¯¹è±¡ä¹‹é—´çš„å·®
print(delta)  # æ‰“å°æ—¶é—´å·®
print(f"Days: {delta.days}, Seconds: {delta.seconds}")  # æ‰“å°å¤©æ•°å’Œç§’æ•°
```

## `timedelta` å¯¹è±¡ (ç»­)

-   `delta.days`: è¿”å›ç›¸å·®çš„å¤©æ•°ã€‚
-   `delta.seconds`: è¿”å›ç›¸å·®çš„ç§’æ•° (åœ¨æœ€åä¸€å¤©å†…)ã€‚å®ƒ*ä¸*åŒ…æ‹¬åŒ…å«åœ¨ `days` å·®å¼‚ä¸­çš„ç§’æ•°ã€‚

## `timedelta` å¯¹è±¡ (ç»­)

æ‚¨å¯ä»¥å°† `timedelta` å¯¹è±¡ä¸ `datetime` å¯¹è±¡ç›¸åŠ æˆ–ç›¸å‡ï¼š

```{python}
from datetime import datetime, timedelta  # ç¡®ä¿å¯¼å…¥äº† datetime å’Œ timedelta

start = datetime(2011, 1, 7)  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡
print(start + timedelta(12))  # åŠ ä¸Š 12 å¤©
print(start - 2 * timedelta(12))  # å‡å» 24 å¤©
```

## `datetime` æ¨¡å—ä¸­çš„ç±»å‹

| ç±»å‹        | æè¿°                                                                   |
| :- | :- |
| `date`      | å­˜å‚¨æ—¥å†æ—¥æœŸ (å¹´ã€æœˆã€æ—¥)ã€‚    |
| `time`      | å­˜å‚¨ä¸€å¤©ä¸­çš„æ—¶é—´ (å°æ—¶ã€åˆ†é’Ÿã€ç§’ã€å¾®ç§’)ã€‚               |
| `datetime`  | åŒæ—¶å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´ã€‚                                                    |
| `timedelta` | è¡¨ç¤ºä¸¤ä¸ª `datetime` å€¼ä¹‹é—´çš„å·®ã€‚                      |
| `tzinfo`    | ç”¨äºå­˜å‚¨æ—¶åŒºä¿¡æ¯çš„åŸºç±»å‹ã€‚                                   |

## å­—ç¬¦ä¸²å’Œ Datetime ä¹‹é—´çš„è½¬æ¢

-   **`strftime()`:** å°† `datetime` å¯¹è±¡æ ¼å¼åŒ–*ä¸º*å­—ç¬¦ä¸²ã€‚
-   **`strptime()`:** å°†å­—ç¬¦ä¸²è§£æ*ä¸º* `datetime` å¯¹è±¡ã€‚
-   **`pd.to_datetime()`:** åœ¨ pandas ä¸­å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º DatetimeIndexã€‚

```{python}
from datetime import datetime  # ç¡®ä¿å¯¼å…¥äº† datetime

stamp = datetime(2011, 1, 3)  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡

# datetime to string
print(str(stamp))  # å°† datetime å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸² (ä½¿ç”¨é»˜è®¤æ ¼å¼)
print(stamp.strftime('%Y-%m-%d'))  # ä½¿ç”¨ strftime() æ ¼å¼åŒ–æ—¥æœŸ (å¹´-æœˆ-æ—¥)
```

## å­—ç¬¦ä¸²å’Œ Datetime ä¹‹é—´çš„è½¬æ¢ (ç»­)

```{python}
from datetime import datetime  # ç¡®ä¿å¯¼å…¥äº† datetime

# string to datetime
value = '2011-01-03'  # å®šä¹‰ä¸€ä¸ªæ—¥æœŸå­—ç¬¦ä¸²
print(datetime.strptime(value, '%Y-%m-%d'))  # ä½¿ç”¨ strptime() å°†å­—ç¬¦ä¸²è§£æä¸º datetime å¯¹è±¡

datestrs = ['7/6/2011', '8/6/2011']  # å®šä¹‰ä¸€ä¸ªæ—¥æœŸå­—ç¬¦ä¸²åˆ—è¡¨
dt_list = [datetime.strptime(x, '%m/%d/%Y') for x in datestrs]  # åˆ—è¡¨æ¨å¯¼å¼ï¼Œå°†å­—ç¬¦ä¸²åˆ—è¡¨è½¬æ¢ä¸º datetime å¯¹è±¡åˆ—è¡¨
print(dt_list)  # æ‰“å° datetime å¯¹è±¡åˆ—è¡¨
```

## å¸¸ç”¨ `strftime` å’Œ `strptime` æ ¼å¼ä»£ç 

| ä»£ç  | æè¿°                                                                                                                               |
| : | :- |
| `%Y` | 4 ä½æ•°çš„å¹´ä»½                                                                                                                              |
| `%y` | 2 ä½æ•°çš„å¹´ä»½                                                                                                                              |
| `%m` | 2 ä½æ•°çš„æœˆä»½ \[01, 12]                                                                                                                   |
| `%d` | 2 ä½æ•°çš„æ—¥æœŸ \[01, 31]                                                                                                                     |
| `%H` | å°æ—¶ (24 å°æ—¶åˆ¶) \[00, 23]                                                                                                            |
| `%I` | å°æ—¶ (12 å°æ—¶åˆ¶) \[01, 12]                                                                                                            |
| `%M` | 2 ä½æ•°çš„åˆ†é’Ÿ \[00, 59]                                                                                                                   |
| `%S` | ç§’ \[00, 61] (60 å’Œ 61 ç”¨äºé—°ç§’)                                                                                           |
| `%f` | å¾®ç§’ï¼Œæ•´æ•°ï¼Œé›¶å¡«å…… (ä» 000000 åˆ° 999999)                                                                             |
| `%j` | ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼Œé›¶å¡«å……æ•´æ•° (ä» 001 åˆ° 366)   |

## æ›´å¤š `strftime` å’Œ `strptime` æ ¼å¼ä»£ç 

| ä»£ç   | æè¿°                                                                                    |
| :- | : |
| `%w`  | æ˜ŸæœŸå‡ ï¼Œæ•´æ•° \[0 (æ˜ŸæœŸæ—¥), 6]                                                          |
| `%u`	| æ˜ŸæœŸå‡ ï¼Œä» 1 å¼€å§‹çš„æ•´æ•°ï¼Œ1 ä»£è¡¨æ˜ŸæœŸä¸€ã€‚ |
| `%U`  | ä¸€å¹´ä¸­çš„å‘¨æ•° \[00, 53]; æ˜ŸæœŸæ—¥æ˜¯ç¬¬ä¸€å¤©ï¼Œç¬¬ä¸€ä¸ªæ˜ŸæœŸæ—¥ä¹‹å‰çš„æ—¥å­æ˜¯ "ç¬¬ 0 å‘¨" |
| `%W`	| ä¸€å¹´ä¸­çš„å‘¨æ•° [00, 53]; æ˜ŸæœŸä¸€è¢«è®¤ä¸ºæ˜¯æ¯å‘¨çš„ç¬¬ä¸€å¤©ï¼Œä¸€å¹´ä¸­ç¬¬ä¸€ä¸ªæ˜ŸæœŸä¸€ä¹‹å‰çš„æ—¥å­æ˜¯ "ç¬¬ 0 å‘¨" |
| `%z`  | UTC æ—¶åŒºåç§»é‡ï¼Œ+HHMM æˆ– -HHMM; å¦‚æœæ˜¯ naive åˆ™ä¸ºç©º                                         |
|`%Z`	|æ—¶åŒºåç§°ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰æ—¶åŒºï¼Œåˆ™ä¸ºç©ºå­—ç¬¦ä¸² |
| `%F`  | `%Y-%m-%d` çš„å¿«æ·æ–¹å¼ (ä¾‹å¦‚ï¼Œ2012-4-18)                                                       |
| `%D`  | `%m/%d/%y` çš„å¿«æ·æ–¹å¼ (ä¾‹å¦‚ï¼Œ04/18/12)                                                       |

## pandas ä¸­çš„ `pd.to_datetime()`

`pandas` ä¸“ä¸ºå¤„ç†æ—¥æœŸæ•°ç»„è€Œè®¾è®¡ã€‚`pd.to_datetime()` æ–¹æ³•éå¸¸é€šç”¨ï¼š

```{python}
import pandas as pd  # ç¡®ä¿å¯¼å…¥äº† pandas

datestrs = ['2011-07-06 12:00:00', '2011-08-06 00:00:00']  # å®šä¹‰ä¸€ä¸ªæ—¥æœŸå­—ç¬¦ä¸²åˆ—è¡¨
dt_index = pd.to_datetime(datestrs)  # ä½¿ç”¨ pd.to_datetime() å°†å­—ç¬¦ä¸²åˆ—è¡¨è½¬æ¢ä¸º DatetimeIndex
print(dt_index)  # æ‰“å° DatetimeIndex
```

## pandas ä¸­çš„ `pd.to_datetime()` (ç»­)

å®ƒä¼šè‡ªåŠ¨å¤„ç†å„ç§æ—¥æœŸæ ¼å¼ï¼Œè¿˜å¯ä»¥è¯†åˆ«ç¼ºå¤±å€¼ï¼š

```{python}
import pandas as pd  # ç¡®ä¿å¯¼å…¥äº† pandas

idx = pd.to_datetime(datestrs + [None])  # å°†åŒ…å« None çš„åˆ—è¡¨è½¬æ¢ä¸º DatetimeIndex
print(idx)  # æ‰“å° DatetimeIndex
print(idx[2])  # NaT (Not a Time)  # æ‰“å°ç¬¬ä¸‰ä¸ªå…ƒç´  (NaT)
print(pd.isna(idx))  # æ£€æŸ¥ DatetimeIndex ä¸­çš„ç¼ºå¤±å€¼ (NaT)
```

`NaT` æ˜¯ pandas ä¸­è¡¨ç¤ºç©ºæ—¶é—´æˆ³çš„æ–¹å¼ã€‚

## ç‰¹å®šäºåŒºåŸŸè®¾ç½®çš„æ—¥æœŸæ ¼å¼

`datetime` å¯¹è±¡å…·æœ‰ç‰¹å®šäºåŒºåŸŸè®¾ç½®çš„æ ¼å¼åŒ–é€‰é¡¹ã€‚

| ç±»å‹ | æè¿°                                                                         |
| : | :- |
| `%a` | ç¼©å†™çš„æ˜ŸæœŸå‡ åç§°ã€‚                                                              |
| `%A` | å®Œæ•´çš„æ˜ŸæœŸå‡ åç§°ã€‚                                                                   |
| `%b` | ç¼©å†™çš„æœˆä»½åç§°ã€‚                                                              |
| `%B` | å®Œæ•´çš„æœˆä»½åç§°ã€‚                                                                     |
| `%c` | å®Œæ•´çš„æ—¥æœŸå’Œæ—¶é—´ (ä¾‹å¦‚ï¼Œ'Tue 01 May 2012 04:20:57 PM')ã€‚                              |
| `%p` | åŒºåŸŸè®¾ç½®ä¸­ç›¸å½“äº AM æˆ– PM çš„å€¼ã€‚                                                        |
| `%x` | åŒºåŸŸè®¾ç½®çš„æ ¼å¼åŒ–æ—¥æœŸ (ä¾‹å¦‚ï¼Œåœ¨ç¾å›½ï¼Œ2012 å¹´ 5 æœˆ 1 æ—¥ä¼šäº§ç”Ÿ '05/01/2012')ã€‚ |
| `%X` | åŒºåŸŸè®¾ç½®çš„æ—¶é—´ (ä¾‹å¦‚ï¼Œ'04:24:12 PM')ã€‚                                       |

## pandas ä¸­çš„æ—¶é—´åºåˆ—åŸºç¡€

`pandas` ä¸­ä¸€ä¸ªåŸºæœ¬çš„æ—¶é—´åºåˆ—å¯¹è±¡æ˜¯ä¸€ä¸ªä»¥æ—¶é—´æˆ³ä¸ºç´¢å¼•çš„ `Series`ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime

dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡åˆ—è¡¨
ts = pd.Series(np.random.randn(6), index=dates)  # åˆ›å»ºä¸€ä¸ª Seriesï¼Œä»¥ datetime å¯¹è±¡åˆ—è¡¨ä½œä¸ºç´¢å¼•
print(ts)  # æ‰“å°æ—¶é—´åºåˆ—
print(type(ts))  # æ‰“å° ts çš„ç±»å‹
```

-   ç´¢å¼•æ˜¯ä¸€ä¸ª `DatetimeIndex`ã€‚

## pandas ä¸­çš„æ—¶é—´åºåˆ—åŸºç¡€ (ç»­)

ä¸åŒç´¢å¼•çš„æ—¶é—´åºåˆ—ä¹‹é—´çš„ç®—æœ¯è¿ç®—ä¼šè‡ªåŠ¨æŒ‰æ—¥æœŸå¯¹é½ã€‚

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime

dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡åˆ—è¡¨
ts = pd.Series(np.random.randn(6), index=dates)  # åˆ›å»ºä¸€ä¸ª Seriesï¼Œä»¥ datetime å¯¹è±¡åˆ—è¡¨ä½œä¸ºç´¢å¼•

print(ts.index) #æ‰“å°æ—¶é—´åºåˆ—çš„ç´¢å¼•
print(ts + ts[::2])  # [::2] é€‰æ‹©æ¯ç¬¬äºŒä¸ªå…ƒç´ ã€‚æ³¨æ„ NaN å€¼ã€‚
```

## æ—¶é—´æˆ³å¯¹è±¡
DatetimeIndex ä¸­çš„æ ‡é‡å€¼æ˜¯ pandas Timestamp å¯¹è±¡ï¼š
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime

dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡åˆ—è¡¨
ts = pd.Series(np.random.randn(6), index=dates)  # åˆ›å»ºä¸€ä¸ª Seriesï¼Œä»¥ datetime å¯¹è±¡åˆ—è¡¨ä½œä¸ºç´¢å¼•

stamp = ts.index[0] #è·å–æ—¶é—´åºåˆ—ç´¢å¼•çš„ç¬¬ä¸€ä¸ªå€¼
print(stamp) #æ‰“å°è¿™ä¸ªå€¼
print(type(stamp)) #æ‰“å°å€¼çš„ç±»å‹
```
pandas.Timestamp å¯ä»¥åœ¨å¤§å¤šæ•°ä½¿ç”¨ datetime å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨ã€‚

## ç´¢å¼•ã€é€‰æ‹©å’Œå­é›†

æ‚¨å¯ä»¥ä½¿ç”¨å„ç§æ–¹å¼ä½¿ç”¨æ ‡ç­¾ (æ—¥æœŸ) å¯¹æ—¶é—´åºåˆ—è¿›è¡Œç´¢å¼•ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime

dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡åˆ—è¡¨
ts = pd.Series(np.random.randn(6), index=dates)  # åˆ›å»ºä¸€ä¸ª Seriesï¼Œä»¥ datetime å¯¹è±¡åˆ—è¡¨ä½œä¸ºç´¢å¼•
stamp = ts.index[2]  # è·å–æ—¶é—´åºåˆ—ç´¢å¼•çš„ç¬¬ä¸‰ä¸ªå…ƒç´ 
print(ts[stamp])  # ä½¿ç”¨æ—¶é—´æˆ³ç´¢å¼•
print(ts['2011-01-10'])  # ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²ç´¢å¼•
```

## ç´¢å¼•ã€é€‰æ‹©å’Œå­é›† (ç»­)

å¯¹äºè¾ƒé•¿çš„æ—¶é—´åºåˆ—ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¹´ä»½æˆ–å¹´æœˆæ¥é€‰æ‹©åˆ‡ç‰‡ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

longer_ts = pd.Series(np.random.randn(1000),
                      index=pd.date_range('1/1/2000', periods=1000))  # åˆ›å»ºä¸€ä¸ªè¾ƒé•¿çš„æ—¶é—´åºåˆ—
print(longer_ts['2001'])  # é€‰æ‹© 2001 å¹´çš„æ‰€æœ‰æ•°æ®
print(longer_ts['2001-05'])  # é€‰æ‹© 2001 å¹´ 5 æœˆçš„æ‰€æœ‰æ•°æ®
```

## ç´¢å¼•ã€é€‰æ‹©å’Œå­é›† (ç»­)

ä½¿ç”¨ `datetime` å¯¹è±¡è¿›è¡Œåˆ‡ç‰‡ä¹Ÿæœ‰æ•ˆï¼ŒåŒ…æ‹¬èŒƒå›´æŸ¥è¯¢ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime

dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡åˆ—è¡¨
ts = pd.Series(np.random.randn(6), index=dates)
print(ts[datetime(2011, 1, 7):])  # ä½¿ç”¨ datetime å¯¹è±¡è¿›è¡Œåˆ‡ç‰‡ (èŒƒå›´æŸ¥è¯¢)
print(ts['2011-01-06':'2011-01-11'])  # ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²è¿›è¡Œåˆ‡ç‰‡ (èŒƒå›´æŸ¥è¯¢)
```

## ç´¢å¼•ã€é€‰æ‹©å’Œå­é›† (ç»­)

`truncate()` æ–¹æ³•åœ¨ä¸¤ä¸ªæ—¥æœŸä¹‹é—´å¯¹ `Series` è¿›è¡Œåˆ‡ç‰‡ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime

dates = [datetime(2011, 1, 2), datetime(2011, 1, 5),
         datetime(2011, 1, 7), datetime(2011, 1, 8),
         datetime(2011, 1, 10), datetime(2011, 1, 12)]  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡åˆ—è¡¨
ts = pd.Series(np.random.randn(6), index=dates)
print(ts.truncate(after='2011-01-09'))  # åœ¨ 2011-01-09 ä¹‹åæˆªæ–­
```

## ç´¢å¼•ã€é€‰æ‹©å’Œå­é›† (ç»­)

æ‰€æœ‰è¿™äº›åˆ‡ç‰‡æ“ä½œéƒ½é€‚ç”¨äº `DataFrame`ï¼Œåœ¨è¡Œä¸Šè¿›è¡Œç´¢å¼•ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/1/2000', periods=100, freq='W-WED')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯å‘¨ä¸‰)
long_df = pd.DataFrame(np.random.randn(100, 4),
                       index=dates,
                       columns=['Colorado', 'Texas', 'New York', 'Ohio'])  # åˆ›å»ºä¸€ä¸ª DataFrame
print(long_df.loc['2001-05'])  # ä½¿ç”¨ .loc æŒ‰æ ‡ç­¾é€‰æ‹© 2001 å¹´ 5 æœˆçš„æ‰€æœ‰è¡Œ
```

## å…·æœ‰é‡å¤ç´¢å¼•çš„æ—¶é—´åºåˆ—

å¯¹äºåŒä¸€æ—¶é—´æˆ³ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªæ•°æ®è§‚å¯Ÿå€¼ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.DatetimeIndex(['1/1/2000', '1/2/2000', '1/2/2000', '1/2/2000',
                        '1/3/2000'])  # åˆ›å»ºä¸€ä¸ªå…·æœ‰é‡å¤æ—¥æœŸçš„ DatetimeIndex
dup_ts = pd.Series(np.arange(5), index=dates)  # åˆ›å»ºä¸€ä¸ªå…·æœ‰é‡å¤ç´¢å¼•çš„ Series
print(dup_ts)  # æ‰“å° Series
print(dup_ts.index.is_unique)  # æ£€æŸ¥ç´¢å¼•æ˜¯å¦å”¯ä¸€
```

## å…·æœ‰é‡å¤ç´¢å¼•çš„æ—¶é—´åºåˆ— (ç»­)

ç´¢å¼•ç°åœ¨å°†äº§ç”Ÿæ ‡é‡å€¼æˆ–åˆ‡ç‰‡ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.DatetimeIndex(['1/1/2000', '1/2/2000', '1/2/2000', '1/2/2000',
                        '1/3/2000'])  # åˆ›å»ºä¸€ä¸ªå…·æœ‰é‡å¤æ—¥æœŸçš„ DatetimeIndex
dup_ts = pd.Series(np.arange(5), index=dates)  # åˆ›å»ºä¸€ä¸ªå…·æœ‰é‡å¤ç´¢å¼•çš„ Series
print(dup_ts['1/3/2000'])  # æœªé‡å¤çš„æ—¥æœŸï¼Œè¿”å›æ ‡é‡å€¼
print(dup_ts['1/2/2000'])  # é‡å¤çš„æ—¥æœŸï¼Œè¿”å›åˆ‡ç‰‡
```

## å…·æœ‰é‡å¤ç´¢å¼•çš„æ—¶é—´åºåˆ— (ç»­)

è¦èšåˆå…·æœ‰éå”¯ä¸€æ—¶é—´æˆ³çš„æ•°æ®ï¼Œè¯·ä½¿ç”¨ `groupby` å’Œ `level=0`ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.DatetimeIndex(['1/1/2000', '1/2/2000', '1/2/2000', '1/2/2000',
                        '1/3/2000'])  # åˆ›å»ºä¸€ä¸ªå…·æœ‰é‡å¤æ—¥æœŸçš„ DatetimeIndex
dup_ts = pd.Series(np.arange(5), index=dates)  # åˆ›å»ºä¸€ä¸ªå…·æœ‰é‡å¤ç´¢å¼•çš„ Series
grouped = dup_ts.groupby(level=0)  # æŒ‰ç´¢å¼•çº§åˆ« 0 (æ—¥æœŸ) åˆ†ç»„
print(grouped.mean())  # è®¡ç®—æ¯ä¸ªæ—¥æœŸçš„å¹³å‡å€¼
print(grouped.count())  # è®¡ç®—æ¯ä¸ªæ—¥æœŸçš„è®¡æ•°
```

## æ—¥æœŸèŒƒå›´ã€é¢‘ç‡å’Œç§»ä½
### ç”Ÿæˆæ—¥æœŸèŒƒå›´
`pandas.date_range()` ç”¨äºç”Ÿæˆå…·æœ‰ç‰¹å®šé•¿åº¦å’Œé¢‘ç‡çš„ `DatetimeIndex`ï¼š
```{python}
import pandas as pd  # å¯¼å…¥ pandas

index = pd.date_range('2012-04-01', '2012-06-01')  # åˆ›å»ºä¸€ä¸ªä» 2012-04-01 åˆ° 2012-06-01 çš„æ¯æ—¥æ—¥æœŸèŒƒå›´
print(index)  # æ‰“å° DatetimeIndex
```

## ç”Ÿæˆæ—¥æœŸèŒƒå›´(ç»­)
é»˜è®¤æƒ…å†µä¸‹ï¼Œ`date_range` ç”Ÿæˆæ¯æ—¥æ—¶é—´æˆ³ã€‚æ‚¨å¯ä»¥æŒ‡å®šå¼€å§‹æˆ–ç»“æŸæ—¥æœŸä»¥åŠå‘¨æœŸæ•°ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas

print(pd.date_range(start='2012-04-01', periods=20))  # ä» 2012-04-01 å¼€å§‹ï¼Œç”Ÿæˆ 20 ä¸ªæ¯æ—¥æ—¥æœŸ
print(pd.date_range(end='2012-06-01', periods=20))  # åˆ° 2012-06-01 ç»“æŸï¼Œç”Ÿæˆ 20 ä¸ªæ¯æ—¥æ—¥æœŸ
```

## ç”Ÿæˆæ—¥æœŸèŒƒå›´(ç»­)
æ‚¨è¿˜å¯ä»¥æŒ‡å®šé¢‘ç‡ã€‚ä¾‹å¦‚ï¼Œè·å–æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas

print(pd.date_range('2000-01-01', '2000-12-01', freq='BM'))  # 'BM' = Business Month end (æ¯æœˆæœ€åä¸€ä¸ªå·¥ä½œæ—¥)
```

### é¢‘ç‡å’Œæ—¥æœŸåç§»

`pandas` ä¸­çš„é¢‘ç‡ç”±*åŸºæœ¬é¢‘ç‡*å’Œ*ä¹˜æ•°*ç»„æˆã€‚åŸºæœ¬é¢‘ç‡é€šå¸¸æ˜¯å­—ç¬¦ä¸²åˆ«å (ä¾‹å¦‚ï¼Œ'M' è¡¨ç¤ºæ¯æœˆï¼Œ'H' è¡¨ç¤ºæ¯å°æ—¶)ã€‚

| åˆ«å        | åç§»ç±»å‹          | æè¿°                          |
| :-- | :- | :-- |
| `D`          | `Day`                | æ—¥å†æ—¥                        |
| `B`          | `BusinessDay`        | å·¥ä½œæ—¥                        |
| `H`          | `Hour`               | æ¯å°æ—¶                               |
| `T` æˆ– `min` | `Minute`             | æ¯åˆ†é’Ÿ                             |
| `S`          | `Second`             | æ¯ç§’                               |
| `L` æˆ– `ms` | `Milli`             |æ¯«ç§’ (1/1,000 ç§’)|
|`U`|`Micro`|å¾®ç§’ (1/1,000,000 ç§’)|
| `M`          | `MonthEnd`           | æ¯æœˆæœ€åä¸€ä¸ªæ—¥å†æ—¥           |

## é¢‘ç‡å’Œæ—¥æœŸåç§»(ç»­)
| åˆ«å        | åç§»ç±»å‹          | æè¿°                          |
| :-- | :- | :-- |
| `BM`         | `BusinessMonthEnd`   | æ¯æœˆæœ€åä¸€ä¸ªå·¥ä½œæ—¥ |
| `MS`         | `MonthBegin`         | æ¯æœˆç¬¬ä¸€ä¸ªæ—¥å†æ—¥          |
| `BMS`        | `BusinessMonthBegin` | æ¯æœˆç¬¬ä¸€ä¸ªå·¥ä½œæ—¥               |
| `W-MON`, `W-TUE`, ... | `Week` | æ¯å‘¨çš„æŒ‡å®šæ˜ŸæœŸå‡  (MON, TUE, WED, THU,FRI, SAT, or SUN) |
| `WOM-1MON`, `WOM-2MON`, ... | `WeekOfMonth` | ç”Ÿæˆæ¯æœˆç¬¬ä¸€ã€ç¬¬äºŒã€ç¬¬ä¸‰æˆ–ç¬¬å››å‘¨çš„æ¯å‘¨æ—¥æœŸ (ä¾‹å¦‚ï¼ŒWOM-3FRI è¡¨ç¤ºæ¯æœˆç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”) |

## é¢‘ç‡å’Œæ—¥æœŸåç§»(ç»­)

| åˆ«å        | åç§»ç±»å‹          | æè¿°                          |
| :-- | :- | :-- |
|`Q-JAN`, `Q-FEB`, ...|`QuarterEnd`|å­£åº¦æ—¥æœŸé”šå®šåœ¨æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªæ—¥å†æ—¥ï¼Œå¹´ä»½ä»¥æŒ‡å®šæœˆä»½ç»“æŸ (JAN, FEB,MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV, or DEC)|
|`BQ-JAN`, `BQ-FEB`, ...|`BusinessQuarterEnd`|å­£åº¦æ—¥æœŸé”šå®šåœ¨æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥ï¼Œå¹´ä»½ä»¥æŒ‡å®šæœˆä»½ç»“æŸ|
|`QS-JAN`, `QS-FEB`, ...|`QuarterBegin`|å­£åº¦æ—¥æœŸé”šå®šåœ¨æ¯ä¸ªæœˆçš„ç¬¬ä¸€ä¸ªæ—¥å†æ—¥ï¼Œå¹´ä»½ä»¥æŒ‡å®šæœˆä»½ç»“æŸ|
|`BQS-JAN`, `BQS-FEB`, ...|`BusinessQuarterBegin`|å­£åº¦æ—¥æœŸé”šå®šåœ¨æ¯ä¸ªæœˆçš„ç¬¬ä¸€ä¸ªå·¥ä½œæ—¥ï¼Œå¹´ä»½ä»¥æŒ‡å®šæœˆä»½ç»“æŸ|
|`A-JAN`, `A-FEB`, ...|`YearEnd`|å¹´åº¦æ—¥æœŸé”šå®šåœ¨ç»™å®šæœˆä»½çš„æœ€åä¸€ä¸ªæ—¥å†æ—¥ (JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP,OCT, NOV, or DEC)|
|`BA-JAN`, `BA-FEB`, ...|`BusinessYearEnd`|å¹´åº¦æ—¥æœŸé”šå®šåœ¨ç»™å®šæœˆä»½çš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥|
|`AS-JAN`, `AS-FEB`, ...|`YearBegin`|å¹´åº¦æ—¥æœŸé”šå®šåœ¨ç»™å®šæœˆä»½çš„ç¬¬ä¸€å¤©|
|`BAS-JAN`, `BAS-FEB`, ...|`BusinessYearBegin`|å¹´åº¦æ—¥æœŸé”šå®šåœ¨ç»™å®šæœˆä»½çš„ç¬¬ä¸€ä¸ªå·¥ä½œæ—¥|

## é¢‘ç‡å’Œæ—¥æœŸåç§» - ç¤ºä¾‹

```{python}
import pandas as pd  # å¯¼å…¥ pandas
from pandas.tseries.offsets import Hour, Minute  # å¯¼å…¥ Hour å’Œ Minute åç§»

print(Hour())  # é»˜è®¤ 1 å°æ—¶
print(Hour(4))  # 4 å°æ—¶
print(pd.date_range('2000-01-01', '2000-01-03 23:59', freq='4H'))  # æ¯ 4 å°æ—¶
```

## é¢‘ç‡å’Œæ—¥æœŸåç§» - ç¤ºä¾‹(ç»­)
```{python}
import pandas as pd  # å¯¼å…¥ pandas
from pandas.tseries.offsets import Hour, Minute  # å¯¼å…¥ Hour å’Œ Minute

print(Hour(2) + Minute(30))  # 2 å°æ—¶ 30 åˆ†é’Ÿ
print(pd.date_range('2000-01-01', periods=10, freq='1h30min'))  # æ¯ 1 å°æ—¶ 30 åˆ†é’Ÿ
```

## é¢‘ç‡å’Œæ—¥æœŸåç§» - "Week of Month"

```{python}
import pandas as pd  # å¯¼å…¥ pandas

rng = pd.date_range('2012-01-01', '2012-09-01', freq='WOM-3FRI')  # æ¯æœˆç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”
print(list(rng))  # æ‰“å°æ—¥æœŸåˆ—è¡¨
```

### ç§»ä½ (è¶…å‰å’Œæ»å) æ•°æ®

*ç§»ä½*å°†æ•°æ®åœ¨æ—¶é—´ä¸Šå‘åæˆ–å‘å‰ç§»åŠ¨ã€‚ä½¿ç”¨ `shift()` æ–¹æ³•ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

ts = pd.Series(np.random.randn(4),
               index=pd.date_range('1/1/2000', periods=4, freq='M'))  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ— (æ¯æœˆ)
print(ts)  # æ‰“å°åŸå§‹æ—¶é—´åºåˆ—
print(ts.shift(2))  # å‘åç§»åŠ¨ 2 ä¸ªå‘¨æœŸ (æ»å)
print(ts.shift(-2))  # å‘å‰ç§»åŠ¨ 2 ä¸ªå‘¨æœŸ (è¶…å‰)
```

## ç§»ä½ (è¶…å‰å’Œæ»å) æ•°æ® (ç»­)

ä¸€ä¸ªå¸¸è§çš„ç”¨é€”æ˜¯è®¡ç®—ç™¾åˆ†æ¯”å˜åŒ–ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

ts = pd.Series(np.random.randn(4),
               index=pd.date_range('1/1/2000', periods=4, freq='M'))  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ— (æ¯æœˆ)
print(ts / ts.shift(1) - 1)  # è®¡ç®—ç™¾åˆ†æ¯”å˜åŒ–
```

## ç§»ä½ (è¶…å‰å’Œæ»å) æ•°æ® (ç»­)

æ‚¨è¿˜å¯ä»¥ç§»åŠ¨*æ—¶é—´æˆ³*ï¼Œä¿æŒæ•°æ®ä¸å˜ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

ts = pd.Series(np.random.randn(4),
               index=pd.date_range('1/1/2000', periods=4, freq='M'))  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ— (æ¯æœˆ)
print(ts.shift(2, freq='M'))  # å°†æ—¶é—´æˆ³å‘åç§»åŠ¨ 2 ä¸ªæœˆ
print(ts.shift(3, freq='D'))  # å°†æ—¶é—´æˆ³å‘åç§»åŠ¨ 3 å¤©
print(ts.shift(1, freq='90T'))  # å°†æ—¶é—´æˆ³å‘åç§»åŠ¨ 90 åˆ†é’Ÿ ('T' è¡¨ç¤ºåˆ†é’Ÿ)
```

### ä½¿ç”¨åç§»é‡ç§»åŠ¨æ—¥æœŸ

`pandas` æ—¥æœŸåç§»é‡å¯ä»¥ä¸ `datetime` æˆ– `Timestamp` å¯¹è±¡ä¸€èµ·ä½¿ç”¨ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime
from pandas.tseries.offsets import Day, MonthEnd  # å¯¼å…¥ Day å’Œ MonthEnd åç§»

now = datetime(2011, 11, 17)  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡
print(now + 3 * Day())  # åŠ ä¸Š 3 å¤©
print(now + MonthEnd())  # æ»šåŠ¨åˆ°æœˆåº•
print(now + MonthEnd(2))  # æ»šåŠ¨åˆ°ä¸‹ä¸ªæœˆåº•
```

## ä½¿ç”¨åç§»é‡ç§»åŠ¨æ—¥æœŸ(ç»­)
```{python}
import pandas as pd  # å¯¼å…¥ pandas
from datetime import datetime  # å¯¼å…¥ datetime
from pandas.tseries.offsets import  MonthEnd  # å¯¼å…¥ MonthEnd åç§»

now = datetime(2011, 11, 17)  # åˆ›å»ºä¸€ä¸ª datetime å¯¹è±¡
offset = MonthEnd()  # åˆ›å»º MonthEnd åç§»å¯¹è±¡
print(offset.rollforward(now))  # æ˜¾å¼å‘å‰æ»šåŠ¨
print(offset.rollback(now))  # æ˜¾å¼å‘åæ»šåŠ¨
```

## ä½¿ç”¨åç§»é‡ç§»åŠ¨æ—¥æœŸ(ç»­)

å°†æ—¥æœŸåç§»é‡ä¸ `groupby` ç»“åˆä½¿ç”¨çš„ä¸€ç§å·§å¦™æ–¹æ³•æ˜¯ "æ»šåŠ¨" æ—¥æœŸï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from pandas.tseries.offsets import MonthEnd  # å¯¼å…¥ MonthEnd

ts = pd.Series(np.random.randn(20),
                index=pd.date_range('1/15/2000', periods=20, freq='4D'))  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ— (æ¯ 4 å¤©)
print(ts.groupby(MonthEnd().rollforward).mean())  # æŒ‰æœˆåº•åˆ†ç»„å¹¶è®¡ç®—å¹³å‡å€¼
print(ts.resample('M').mean())  # ç­‰æ•ˆï¼Œä¸”é€Ÿåº¦æ›´å¿« (æŒ‰æœˆé‡é‡‡æ ·)
```

## æ—¶åŒºå¤„ç†

å¤„ç†æ—¶åŒºå¯èƒ½å¾ˆå¤æ‚ã€‚`pandas` ä½¿ç”¨ `pytz` åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œpandas ä¸­çš„æ—¶é—´åºåˆ—æ˜¯æ—¶åŒºæœ´ç´ çš„(æ²¡æœ‰æ—¶åŒºä¿¡æ¯)ã€‚

```{python}
import pytz  # å¯¼å…¥ pytz

print(pytz.common_timezones[-5:])  # æ‰“å°æœ€å 5 ä¸ªå¸¸è§æ—¶åŒº
tz = pytz.timezone('America/New_York')  # è·å–çº½çº¦æ—¶åŒº
print(tz)  # æ‰“å°æ—¶åŒºå¯¹è±¡
```

### æ—¶åŒºæœ¬åœ°åŒ–å’Œè½¬æ¢

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('3/9/2012 9:30', periods=6, freq='D')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯æ—¥)
ts = pd.Series(np.random.randn(len(dates)), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
print(ts)  # æ‰“å°æ—¶é—´åºåˆ—
print(ts.index.tz)  # æ—¶åŒºæœ´ç´  (None)
```

### æ—¶åŒºæœ¬åœ°åŒ–å’Œè½¬æ¢(ç»­)
```{python}
import pandas as pd  # å¯¼å…¥ pandas

# ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰æ—¶åŒºçš„æ—¶é—´èŒƒå›´
date_rng = pd.date_range('3/9/2012 9:30', periods=10, freq='D', tz='UTC')  # åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ—¶åŒº (UTC) çš„æ—¥æœŸèŒƒå›´
print(date_rng.tz)  # æ‰“å°æ—¶åŒº

# æœ¬åœ°åŒ–åˆ°æ—¶åŒºã€‚
ts_utc = ts.tz_localize('UTC')  # å°†æ—¶é—´åºåˆ—æœ¬åœ°åŒ–åˆ° UTC
print(ts_utc)  # æ‰“å°æœ¬åœ°åŒ–åçš„æ—¶é—´åºåˆ—
print(ts_utc.index)  # æ‰“å°å¸¦æœ‰æ—¶åŒºçš„ç´¢å¼•
```

### æ—¶åŒºæœ¬åœ°åŒ–å’Œè½¬æ¢(ç»­)


```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('3/9/2012 9:30', periods=6, freq='D')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯æ—¥)
ts = pd.Series(np.random.randn(len(dates)), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
ts_utc = ts.tz_localize('UTC')  # å°†æ—¶é—´åºåˆ—æœ¬åœ°åŒ–åˆ° UTC
# è½¬æ¢ä¸ºå¦ä¸€ä¸ªæ—¶åŒºã€‚
ts_eastern = ts_utc.tz_convert('America/New_York')  # å°†æ—¶é—´åºåˆ—è½¬æ¢ä¸ºçº½çº¦æ—¶åŒº
print(ts_eastern)  # æ‰“å°è½¬æ¢åçš„æ—¶é—´åºåˆ—
```

### ä½¿ç”¨å¸¦æœ‰æ—¶åŒºæ„è¯†çš„ Timestamp å¯¹è±¡è¿›è¡Œæ“ä½œ

`Timestamp` å¯¹è±¡ä¹Ÿæ”¯æŒæ—¶åŒºæœ¬åœ°åŒ–å’Œè½¬æ¢ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas

stamp = pd.Timestamp('2011-03-12 04:00')  # åˆ›å»ºä¸€ä¸ª Timestamp å¯¹è±¡
stamp_utc = stamp.tz_localize('utc')  # æœ¬åœ°åŒ–åˆ° UTC
print(stamp_utc.tz_convert('America/New_York'))  # è½¬æ¢ä¸ºçº½çº¦æ—¶åŒº
```

### ä½¿ç”¨å¸¦æœ‰æ—¶åŒºæ„è¯†çš„ Timestamp å¯¹è±¡è¿›è¡Œæ“ä½œ(ç»­)

åœ¨ä¸åŒæ—¶åŒºä¹‹é—´æ‰§è¡Œæ“ä½œæ—¶ï¼Œç»“æœå°†é‡‡ç”¨ UTCã€‚

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('3/7/2012 9:30', periods=10, freq='B')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (å·¥ä½œæ—¥)
ts = pd.Series(np.random.randn(len(dates)), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
ts1 = ts[:7].tz_localize('Europe/London')  # æœ¬åœ°åŒ–åˆ°ä¼¦æ•¦æ—¶åŒº
ts2 = ts1[2:].tz_convert('Europe/Moscow')  # è½¬æ¢ä¸ºè«æ–¯ç§‘æ—¶åŒº
result = ts1 + ts2  # ä¸åŒæ—¶åŒºçš„æ—¶é—´åºåˆ—ç›¸åŠ 
print(result.index)  # ç»“æœçš„ç´¢å¼•å°†æ˜¯ UTC
```

## å‘¨æœŸå’Œå‘¨æœŸç®—æœ¯

*å‘¨æœŸ (Periods)* è¡¨ç¤ºæ—¶é—´è·¨åº¦ (ä¾‹å¦‚ï¼Œå¤©ã€æœˆã€å­£åº¦ã€å¹´)ã€‚`Period` ç±»ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas

p = pd.Period(2011, freq='A-DEC')  # åˆ›å»ºä¸€ä¸ªå¹´åº¦å‘¨æœŸ (ä»¥ 12 æœˆç»“æŸ)
print(p)  # æ‰“å°å‘¨æœŸ
print(p + 5)  # åŠ ä¸Š 5 å¹´
print(p - 2)  # å‡å» 2 å¹´
print(pd.Period('2014', freq='A-DEC') - p)  # è®¡ç®—ä¸¤ä¸ªå‘¨æœŸä¹‹é—´çš„å·® (å¹´æ•°)
```

## å‘¨æœŸå’Œå‘¨æœŸç®—æœ¯ (ç»­)

`period_range` åˆ›å»ºå‘¨æœŸçš„è§„åˆ™èŒƒå›´ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

rng = pd.period_range('2000-01-01', '2000-06-30', freq='M')  # åˆ›å»ºä¸€ä¸ªæ¯æœˆå‘¨æœŸèŒƒå›´
print(rng)  # æ‰“å° PeriodIndex
print(pd.Series(np.random.randn(6), index=rng))  # åˆ›å»ºä¸€ä¸ªä»¥ PeriodIndex ä¸ºç´¢å¼•çš„ Series
```

## å‘¨æœŸå’Œå‘¨æœŸç®—æœ¯ (ç»­)
```{python}
import pandas as pd  # å¯¼å…¥ pandas

values = ['2001Q3', '2002Q2', '2003Q1']  # å®šä¹‰ä¸€ä¸ªå­£åº¦å­—ç¬¦ä¸²åˆ—è¡¨
index = pd.PeriodIndex(values, freq='Q-DEC')  # ä»å­—ç¬¦ä¸²åˆ—è¡¨åˆ›å»ºä¸€ä¸ª PeriodIndex (ä»¥ 12 æœˆç»“æŸçš„å­£åº¦)
print(index)  # æ‰“å° PeriodIndex
```

### å‘¨æœŸé¢‘ç‡è½¬æ¢

å¯ä»¥ä½¿ç”¨ `asfreq` è½¬æ¢å‘¨æœŸå’Œ `PeriodIndex` å¯¹è±¡ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas

p = pd.Period('2011', freq='A-DEC')  # åˆ›å»ºä¸€ä¸ªå¹´åº¦å‘¨æœŸ (ä»¥ 12 æœˆç»“æŸ)
print(p.asfreq('M', how='start'))  # è½¬æ¢ä¸ºæ¯æœˆå‘¨æœŸ (å¼€å§‹)
print(p.asfreq('M', how='end'))  # è½¬æ¢ä¸ºæ¯æœˆå‘¨æœŸ (ç»“æŸ)

p = pd.Period('Aug-2011', 'M') # åˆ›å»ºä¸€ä¸ªæœˆçš„å‘¨æœŸ
print(p.asfreq('A-JUN')) # è½¬æ¢ä¸ºä»¥å…­æœˆç»“æŸçš„å¹´åº¦å‘¨æœŸ
```

### å‘¨æœŸé¢‘ç‡è½¬æ¢(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

periods = pd.period_range('2006', '2009', freq='A-DEC')  # åˆ›å»ºä¸€ä¸ªå¹´åº¦å‘¨æœŸèŒƒå›´ (ä»¥ 12 æœˆç»“æŸ)
ts = pd.Series(np.random.randn(len(periods)), index=periods)  # åˆ›å»ºä¸€ä¸ªä»¥ PeriodIndex ä¸ºç´¢å¼•çš„ Series
print(ts.asfreq('M', how='start'))   # è½¬æ¢ä¸ºæ¯æœˆå‘¨æœŸ (å¼€å§‹)
print(ts.asfreq('B', how='end'))  # è½¬æ¢ä¸ºå·¥ä½œæ—¥å‘¨æœŸ (ç»“æŸ)
```

### å­£åº¦å‘¨æœŸé¢‘ç‡

å­£åº¦æ•°æ®åœ¨è´¢åŠ¡ä¸­å¾ˆå¸¸è§ã€‚`pandas` æ”¯æŒå­£åº¦é¢‘ç‡ (Q-JAN åˆ° Q-DEC)ï¼š
```{python}
import pandas as pd  # å¯¼å…¥ pandas
#åœ¨è´¢æ”¿å¹´åº¦äº 1 æœˆç»“æŸçš„æƒ…å†µä¸‹ï¼Œ2012Q4 çš„æ—¶é—´èŒƒå›´æ˜¯ä» 2011 å¹´ 11 æœˆåˆ° 2012 å¹´ 1 æœˆ
p = pd.Period('2012Q4', freq='Q-JAN')  # åˆ›å»ºä¸€ä¸ªå­£åº¦å‘¨æœŸ (ä»¥ 1 æœˆç»“æŸ)
print(p)  # æ‰“å°å‘¨æœŸ
print(p.asfreq('D', how='start'))  # è½¬æ¢ä¸ºæ¯æ—¥å‘¨æœŸ (å¼€å§‹)
print(p.asfreq('D', how='end'))  # è½¬æ¢ä¸ºæ¯æ—¥å‘¨æœŸ (ç»“æŸ)
```

### å­£åº¦å‘¨æœŸé¢‘ç‡(ç»­)
è·å–å­£åº¦å€’æ•°ç¬¬äºŒä¸ªå·¥ä½œæ—¥ä¸‹åˆ 4 ç‚¹çš„æ—¶é—´æˆ³
```{python}
import pandas as pd  # å¯¼å…¥ pandas
p = pd.Period('2012Q4', freq='Q-JAN')  # åˆ›å»ºä¸€ä¸ªå­£åº¦å‘¨æœŸ (ä»¥ 1 æœˆç»“æŸ)
p4pm = (p.asfreq('B', 'e') - 1).asfreq('T', 's') + 16 * 60 #è½¬æ¢ä¸ºäº¤æ˜“æ—¥ï¼Œå–å‰ä¸€å¤©ã€‚è½¬æ¢ä¸ºåˆ†é’Ÿï¼Œå–å½“å¤©çš„å¼€å§‹æ—¶é—´ã€‚ç„¶åå†åŠ ä¸Š16*60åˆ†é’Ÿ
print(p4pm)  # æ‰“å°å‘¨æœŸ
print(p4pm.to_timestamp())  # è½¬æ¢ä¸º Timestamp
```

### å­£åº¦å‘¨æœŸé¢‘ç‡(ç»­)
ä½¿ç”¨ pandas.period_range ç”Ÿæˆå­£åº¦èŒƒå›´
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

periods = pd.period_range('2011Q3', '2012Q4', freq='Q-JAN')  # åˆ›å»ºä¸€ä¸ªå­£åº¦å‘¨æœŸèŒƒå›´ (ä»¥ 1 æœˆç»“æŸ)
ts = pd.Series(np.arange(len(periods)), index=periods)  # åˆ›å»ºä¸€ä¸ªä»¥ PeriodIndex ä¸ºç´¢å¼•çš„ Series
print(ts)  # æ‰“å°æ—¶é—´åºåˆ—
new_periods = (periods.asfreq('B', 'e') - 1).asfreq('H', 's') + 16  # è®¡ç®—ä¸‹åˆ 4 ç‚¹çš„æ—¶é—´æˆ³
ts.index = new_periods.to_timestamp()  # å°†ç´¢å¼•è½¬æ¢ä¸º Timestamp
print(ts)  # æ‰“å°è½¬æ¢åçš„æ—¶é—´åºåˆ—
```

### å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºå‘¨æœŸ (åŠè¿”å›)

`to_period()` å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºå‘¨æœŸï¼š
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/1/2000', periods=3, freq='M')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯æœˆ)
ts = pd.Series(np.random.randn(3), index=dates)  # åˆ›å»ºä¸€ä¸ªä»¥ DatetimeIndex ä¸ºç´¢å¼•çš„ Series
pts = ts.to_period()  # è½¬æ¢ä¸º PeriodIndex
print(ts)  # æ‰“å°åŸå§‹æ—¶é—´åºåˆ—
print(pts)  # æ‰“å°è½¬æ¢ä¸ºå‘¨æœŸçš„æ—¶é—´åºåˆ—
```

### å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºå‘¨æœŸ (åŠè¿”å›)(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/29/2000', periods=6, freq='D')   # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯æ—¥)
ts2 = pd.Series(np.random.randn(6), index=dates)  # åˆ›å»ºä¸€ä¸ªä»¥ DatetimeIndex ä¸ºç´¢å¼•çš„ Series
print(ts2.to_period('M'))  # è½¬æ¢ä¸ºæ¯æœˆå‘¨æœŸ
print(ts2.to_period('M').to_timestamp(how='end'))  # è½¬æ¢å› Timestamp (æœˆæœ«)
```

### ä»æ•°ç»„åˆ›å»º PeriodIndex

æ‚¨å¯ä»¥ç»„åˆå¹´ä»½å’Œå­£åº¦åˆ—æ¥åˆ›å»º `PeriodIndex`ï¼š

```{python}
import pandas as pd  # å¯¼å…¥ pandas

data = pd.read_csv('examples/macrodata.csv')  # è¯»å– CSV æ–‡ä»¶
print(data.head(5))  # æ‰“å°å‰ 5 è¡Œ
```

### ä»æ•°ç»„åˆ›å»º PeriodIndex (ç»­)

```{python}
import pandas as pd  # å¯¼å…¥ pandas
data = pd.read_csv('examples/macrodata.csv')  # è¯»å– CSV æ–‡ä»¶
index = pd.PeriodIndex(year=data['year'], quarter=data['quarter'],freq='Q-DEC')  # ä» year å’Œ quarter åˆ—åˆ›å»º PeriodIndex
data.index = index  # è®¾ç½® DataFrame çš„ç´¢å¼•
print(data['infl'].head())  # æ‰“å° 'infl' åˆ—çš„å‰å‡ è¡Œ
```

## é‡é‡‡æ ·å’Œé¢‘ç‡è½¬æ¢

*é‡é‡‡æ ·*å°†æ—¶é—´åºåˆ—ä»ä¸€ä¸ªé¢‘ç‡è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢‘ç‡ã€‚

-   **é™é‡‡æ ·:** å°†è¾ƒé«˜é¢‘ç‡çš„æ•°æ®èšåˆåˆ°è¾ƒä½é¢‘ç‡ (ä¾‹å¦‚ï¼Œæ¯æ—¥åˆ°æ¯æœˆ)ã€‚
-   **å‡é‡‡æ ·:** å°†è¾ƒä½é¢‘ç‡çš„æ•°æ®è½¬æ¢ä¸ºè¾ƒé«˜é¢‘ç‡ (ä¾‹å¦‚ï¼Œæ¯æ—¥åˆ°æ¯å°æ—¶)ã€‚

ä½¿ç”¨ `resample()` æ–¹æ³•ã€‚å®ƒç±»ä¼¼äº `groupby`ã€‚
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/1/2000', periods=100, freq='D')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯æ—¥)
ts = pd.Series(np.random.randn(len(dates)), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
print(ts.resample('M').mean())  # æ¯æœˆå¹³å‡å€¼ (é™é‡‡æ ·)
print(ts.resample('M', kind='period').mean())  # æ¯æœˆå¹³å‡å€¼ (é™é‡‡æ ·ï¼Œä½¿ç”¨å‘¨æœŸ)
```

### Resample æ–¹æ³•å‚æ•°
| å‚æ•°   | æè¿°                                                                                                                                                     |
| : | :-- |
| `rule`       | å­—ç¬¦ä¸²ã€DateOffset æˆ– timedeltaï¼ŒæŒ‡ç¤ºæ‰€éœ€çš„é‡é‡‡æ ·é¢‘ç‡ (ä¾‹å¦‚ï¼Œ'M'ã€'5min' æˆ– Second(15))                                           |
| `axis`      | è¦é‡é‡‡æ ·çš„è½´ï¼›é»˜è®¤ axis=0                                                                                                                              |
|`fill_method`|å‡é‡‡æ ·æ—¶å¦‚ä½•æ’å€¼ï¼Œå¦‚ "ffill" æˆ– "bfill"ï¼›é»˜è®¤ä¸æ’å€¼|
|`closed`|åœ¨é™é‡‡æ ·ä¸­ï¼Œæ¯ä¸ªé—´éš”çš„å“ªä¸€ç«¯æ˜¯é—­åˆçš„ (åŒ…å«çš„)ï¼Œâ€œrightâ€ æˆ– â€œleftâ€|

### Resample æ–¹æ³•å‚æ•°(ç»­)

| å‚æ•°   | æè¿°                                                                                                                                                     |
| : | :-- |
|`label`|åœ¨é™é‡‡æ ·ä¸­ï¼Œå¦‚ä½•æ ‡è®°èšåˆç»“æœï¼Œä½¿ç”¨ â€œrightâ€ æˆ– â€œleftâ€ ç®±è¾¹ (ä¾‹å¦‚ï¼Œ9:30 åˆ° 9:35 çš„äº”åˆ†é’Ÿé—´éš”å¯ä»¥æ ‡è®°ä¸º 9:30 æˆ– 9:35)|
|`limit`|å‘å‰æˆ–å‘åå¡«å……æ—¶ï¼Œè¦å¡«å……çš„æœ€å¤§å‘¨æœŸæ•°|
|`kind`|èšåˆåˆ°å‘¨æœŸ (â€œperiodâ€) æˆ–æ—¶é—´æˆ³ (â€œtimestampâ€)ï¼›é»˜è®¤ä¸ºæ—¶é—´åºåˆ—çš„ç´¢å¼•ç±»å‹|
|`convention`|é‡é‡‡æ ·å‘¨æœŸæ—¶ï¼Œå°†ä½é¢‘å‘¨æœŸè½¬æ¢ä¸ºé«˜é¢‘å‘¨æœŸçš„çº¦å®š (â€œstartâ€ æˆ– â€œendâ€)ï¼›é»˜è®¤ä¸º â€œstartâ€|
|`origin`|ç”¨äºç¡®å®šé‡é‡‡æ ·ç®±è¾¹ç¼˜çš„â€œåŸºå‡†â€æ—¶é—´æˆ³ï¼›ä¹Ÿå¯ä»¥æ˜¯â€œepochâ€ã€â€œstartâ€ã€â€œstart_dayâ€ã€â€œendâ€æˆ–â€œend_dayâ€ä¹‹ä¸€ï¼›æœ‰å…³å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é‡é‡‡æ ·æ–‡æ¡£å­—ç¬¦ä¸²|
|`offset`|æ·»åŠ åˆ°åŸç‚¹çš„åç§» timedeltaï¼›é»˜è®¤ä¸º None|

### é™é‡‡æ ·

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/1/2000', periods=12, freq='T')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯åˆ†é’Ÿ)
ts = pd.Series(np.arange(12), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
print(ts)  # æ‰“å°åŸå§‹æ—¶é—´åºåˆ—
print(ts.resample('5min').sum())  # æ¯ 5 åˆ†é’Ÿæ±‚å’Œ (é™é‡‡æ ·)
```

## é™é‡‡æ ·(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/1/2000', periods=12, freq='T')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯åˆ†é’Ÿ)
ts = pd.Series(np.arange(12), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
# closed='right', label='left'
print(ts.resample('5min', closed='right').sum())  # æ¯ 5 åˆ†é’Ÿæ±‚å’Œ (å³é—­åˆï¼Œå·¦æ ‡ç­¾)

# closed='right', label='right'
print(ts.resample('5min', closed='right', label='right').sum())  # æ¯ 5 åˆ†é’Ÿæ±‚å’Œ (å³é—­åˆï¼Œå³æ ‡ç­¾)
```

## é™é‡‡æ ·(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
from pandas.tseries.frequencies import to_offset

dates = pd.date_range('1/1/2000', periods=12, freq='T')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯åˆ†é’Ÿ)
ts = pd.Series(np.arange(12), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
# ç§»åŠ¨ç»“æœç´¢å¼•
result = ts.resample('5min', closed='right', label='right').sum()  # æ¯ 5 åˆ†é’Ÿæ±‚å’Œ (å³é—­åˆï¼Œå³æ ‡ç­¾)
result.index = result.index + to_offset("-1s")   # å°†ç´¢å¼•å‡å» 1 ç§’
print(result)  # æ‰“å°ä¿®æ”¹åçš„æ—¶é—´åºåˆ—
```

#### å¼€ç›˜-æœ€é«˜-æœ€ä½-æ”¶ç›˜ (OHLC) é‡é‡‡æ ·
é‡‘èæ•°æ®é‡é‡‡æ ·
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

dates = pd.date_range('1/1/2000', periods=12, freq='T')  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯åˆ†é’Ÿ)
ts = pd.Series(np.arange(12), index=dates)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
print(ts.resample('5min').ohlc())  # æ¯ 5 åˆ†é’Ÿçš„ OHLC (å¼€ç›˜ã€æœ€é«˜ã€æœ€ä½ã€æ”¶ç›˜)
```

### å‡é‡‡æ ·å’Œæ’å€¼

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

frame = pd.DataFrame(np.random.randn(2, 4),
                    index=pd.date_range('1/1/2000', periods=2, freq='W-WED'),  # æ¯å‘¨ä¸‰
                    columns=['Colorado', 'Texas', 'New York', 'Ohio'])  # åˆ›å»ºä¸€ä¸ª DataFrame
print(frame)  # æ‰“å° DataFrame
```

## å‡é‡‡æ ·å’Œæ’å€¼(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

frame = pd.DataFrame(np.random.randn(2, 4),
                    index=pd.date_range('1/1/2000', periods=2, freq='W-WED'),  # æ¯å‘¨ä¸‰
                    columns=['Colorado', 'Texas', 'New York', 'Ohio'])  # åˆ›å»ºä¸€ä¸ª DataFrame
df_daily = frame.resample('D').asfreq()  # å‡é‡‡æ ·åˆ°æ¯æ—¥ (ç”¨ NaN å¡«å……)
print(df_daily)  # æ‰“å°å‡é‡‡æ ·åçš„ DataFrame
print(frame.resample('D').ffill())  # å‡é‡‡æ ·åˆ°æ¯æ—¥ (å‘å‰å¡«å……)
print(frame.resample('D').ffill(limit=2))  # å‡é‡‡æ ·åˆ°æ¯æ—¥ (å‘å‰å¡«å……ï¼Œé™åˆ¶ä¸º 2 ä¸ªå‘¨æœŸ)
print(frame.resample('W-THU').ffill())   # å‡é‡‡æ ·åˆ°æ¯å‘¨å›› (å‘å‰å¡«å……)
```

### ä½¿ç”¨å‘¨æœŸè¿›è¡Œé‡é‡‡æ ·

é‡é‡‡æ ·ä»¥å‘¨æœŸä¸ºç´¢å¼•çš„æ•°æ®ç±»ä¼¼ï¼š

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

frame = pd.DataFrame(np.random.randn(24, 4),
                     index=pd.period_range('1-2000', '12-2001', freq='M'),  # æ¯æœˆå‘¨æœŸ
                     columns=['Colorado', 'Texas', 'New York', 'Ohio'])  # åˆ›å»ºä¸€ä¸ª DataFrame
print(frame.head())  # æ‰“å° DataFrame çš„å‰å‡ è¡Œ
```

## ä½¿ç”¨å‘¨æœŸè¿›è¡Œé‡é‡‡æ ·(ç»­)

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

frame = pd.DataFrame(np.random.randn(24, 4),
                     index=pd.period_range('1-2000', '12-2001', freq='M'),  # æ¯æœˆå‘¨æœŸ
                     columns=['Colorado', 'Texas', 'New York', 'Ohio'])  # åˆ›å»ºä¸€ä¸ª DataFrame
annual_frame = frame.resample('A-DEC').mean()  # é™é‡‡æ ·åˆ°å¹´åº¦ (ä»¥ 12 æœˆç»“æŸ)
print(annual_frame)  # æ‰“å°é™é‡‡æ ·åçš„ DataFrame

# Q-DEC: å­£åº¦ï¼Œå¹´ä»½ä»¥ 12 æœˆç»“æŸ
print(annual_frame.resample('Q-DEC', convention='end').asfreq())  # é™é‡‡æ ·åˆ°å­£åº¦ (å¹´åº•ï¼Œè½¬æ¢ä¸ºé¢‘ç‡)
print(annual_frame.resample('Q-MAR').ffill())  # é™é‡‡æ ·åˆ°å­£åº¦(ä»¥ä¸‰æœˆç»“å°¾ï¼Œå¹¶å‘å‰å¡«å……)
```

## åˆ†ç»„æ—¶é—´é‡é‡‡æ ·

```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

N = 15  # å®šä¹‰æ—¶é—´åºåˆ—çš„é•¿åº¦
times = pd.date_range('2017-05-20 00:00', freq='1min', periods=N)  # åˆ›å»ºä¸€ä¸ªæ—¶é—´èŒƒå›´ (æ¯åˆ†é’Ÿ)
df = pd.DataFrame({'time': times, 'value': np.arange(N)})  # åˆ›å»ºä¸€ä¸ª DataFrame
print(df)  # æ‰“å° DataFrame
print(df.set_index('time').resample('5min').count())  # æŒ‰æ—¶é—´åˆ†ç»„ï¼Œæ¯ 5 åˆ†é’Ÿè®¡æ•°
```

## åˆ†ç»„æ—¶é—´é‡é‡‡æ ·(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

N = 15
times = pd.date_range('2017-05-20 00:00', freq='1min', periods=N)  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯åˆ†é’Ÿ)
df2 = pd.DataFrame({'time': times.repeat(3),  # time åˆ—é‡å¤ 3 æ¬¡
                    'key': np.tile(['a', 'b', 'c'], N),  # åˆ›å»º key åˆ— (a, b, c é‡å¤)
                    'value': np.arange(N * 3.)})  # åˆ›å»º value åˆ—
print(df2.head(7))  # æ‰“å° DataFrame çš„å‰å‡ è¡Œ
```

## åˆ†ç»„æ—¶é—´é‡é‡‡æ ·(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

N = 15
times = pd.date_range('2017-05-20 00:00', freq='1min', periods=N)  # åˆ›å»ºä¸€ä¸ªæ—¥æœŸèŒƒå›´ (æ¯åˆ†é’Ÿ)
df2 = pd.DataFrame({'time': times.repeat(3),
                    'key': np.tile(['a', 'b', 'c'], N),
                    'value': np.arange(N * 3.)})  # åˆ›å»º DataFrame
time_key = pd.Grouper(freq='5min')  # åˆ›å»ºä¸€ä¸ªæ—¶é—´åˆ†ç»„å™¨ (æ¯ 5 åˆ†é’Ÿ)
resampled = (df2.set_index('time')  # è®¾ç½® time åˆ—ä¸ºç´¢å¼•
             .groupby(['key', time_key])  # æŒ‰ key å’Œ time_key åˆ†ç»„
             .sum())  # æ±‚å’Œ
print(resampled)  # æ‰“å°é‡é‡‡æ ·åçš„ DataFrame
```

## ç§»åŠ¨çª—å£å‡½æ•°

*ç§»åŠ¨çª—å£å‡½æ•°* (ä¹Ÿç§°ä¸º*æ»šåŠ¨çª—å£å‡½æ•°*) å¯¹æ•°æ®çš„æ»‘åŠ¨çª—å£è¿›è¡Œæ“ä½œã€‚å®ƒä»¬é€šå¸¸ç”¨äºå¹³æ»‘å˜ˆæ‚çš„æ—¶é—´åºåˆ—ã€‚
```{python}
import numpy as np   # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)
```

## ç§»åŠ¨çª—å£å‡½æ•°(ç»­)
```{python}
import matplotlib.pyplot as plt #å¯¼å…¥ç»˜å›¾æ¨¡å—
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)

close_px['AAPL'].plot()  # ç»˜åˆ¶ AAPL çš„æ”¶ç›˜ä»·
close_px['AAPL'].rolling(250).mean().plot()  # ç»˜åˆ¶ AAPL çš„ 250 å¤©ç§»åŠ¨å¹³å‡çº¿
```

## ç§»åŠ¨çª—å£å‡½æ•°(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
import matplotlib.pyplot as plt #å¯¼å…¥ç»˜å›¾æ¨¡å—

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)

std250 = close_px['AAPL'].pct_change().rolling(250, min_periods=10).std()  # è®¡ç®— 250 å¤©æ»šåŠ¨æ ‡å‡†å·® (è‡³å°‘ 10 ä¸ªå‘¨æœŸ)
print(std250[5:12])  # æ‰“å°ä¸€éƒ¨åˆ†æ ‡å‡†å·®
std250.plot()  # ç»˜åˆ¶æ ‡å‡†å·®
```

## ç§»åŠ¨çª—å£å‡½æ•°(ç»­)
```{python}
import numpy as np  # å¯¼å…¥ NumPy
import pandas as pd  # å¯¼å…¥ pandas
import matplotlib.pyplot as plt #å¯¼å…¥ç»˜å›¾æ¨¡å—
close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)
std250 = close_px['AAPL'].pct_change().rolling(250, min_periods=10).std()  # è®¡ç®— 250 å¤©æ»šåŠ¨æ ‡å‡†å·® (è‡³å°‘ 10 ä¸ªå‘¨æœŸ)
expanding_mean = std250.expanding().mean()  # è®¡ç®—æ‰©å±•å¹³å‡å€¼
```

## ç§»åŠ¨çª—å£å‡½æ•°(ç»­)
```{python}
import matplotlib.pyplot as plt  # å¯¼å…¥ matplotlib.pyplot
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)

plt.style.use('grayscale')  # ä½¿ç”¨ç°åº¦æ ·å¼
close_px.rolling(60).mean().plot(logy=True)  # ç»˜åˆ¶ 60 å¤©æ»šåŠ¨å¹³å‡çº¿ (å¯¹æ•° y è½´)
```

## ç§»åŠ¨çª—å£å‡½æ•°(ç»­)
```{python}
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)
print(close_px.rolling('20D').mean())  # è®¡ç®— 20 å¤©æ»šåŠ¨å¹³å‡çº¿
```

### æŒ‡æ•°åŠ æƒå‡½æ•°
```{python}
import matplotlib.pyplot as plt  # å¯¼å…¥ matplotlib.pyplot
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)

aapl_px = close_px['AAPL']['2006':'2007']  # é€‰æ‹© 2006 å¹´å’Œ 2007 å¹´çš„ AAPL æ•°æ®
ma30 = aapl_px.rolling(30, min_periods=20).mean()  # 30 å¤©ç®€å•ç§»åŠ¨å¹³å‡çº¿ (è‡³å°‘ 20 ä¸ªå‘¨æœŸ)
ewma30 = aapl_px.ewm(span=30).mean()  # 30 å¤©æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡çº¿

aapl_px.plot(style='k-', label='Price')  # ç»˜åˆ¶ AAPL ä»·æ ¼
ma30.plot(style='k--', label='Simple Moving Avg')  # ç»˜åˆ¶ç®€å•ç§»åŠ¨å¹³å‡çº¿
ewma30.plot(style='k-', label='EW MA')  # ç»˜åˆ¶æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡çº¿
plt.legend()  # æ˜¾ç¤ºå›¾ä¾‹
```

### äºŒå…ƒç§»åŠ¨çª—å£å‡½æ•°

```{python}
import matplotlib.pyplot as plt  # å¯¼å…¥ matplotlib.pyplot
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)

spx_px = close_px_all['SPX']  # è·å– S&P 500 æŒ‡æ•°
spx_rets = spx_px.pct_change()  # è®¡ç®— S&P 500 æŒ‡æ•°çš„æ”¶ç›Šç‡
returns = close_px.pct_change()  # è®¡ç®—æ‰€æœ‰è‚¡ç¥¨çš„æ”¶ç›Šç‡

# AAPL æ”¶ç›Šç‡ä¸ S&P 500 æ”¶ç›Šç‡çš„ç›¸å…³æ€§
corr = returns['AAPL'].rolling(125, min_periods=100).corr(spx_rets)  # è®¡ç®— 125 å¤©æ»šåŠ¨ç›¸å…³æ€§ (è‡³å°‘ 100 ä¸ªå‘¨æœŸ)
corr.plot()  # ç»˜åˆ¶ç›¸å…³æ€§
```

### äºŒå…ƒç§»åŠ¨çª—å£å‡½æ•° (ç»­)

```{python}
import matplotlib.pyplot as plt  # å¯¼å…¥ matplotlib.pyplot
import pandas as pd  # å¯¼å…¥ pandas

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)

spx_px = close_px_all['SPX']  # è·å– S&P 500 æŒ‡æ•°
spx_rets = spx_px.pct_change()  # è®¡ç®— S&P 500 æŒ‡æ•°çš„æ”¶ç›Šç‡
returns = close_px.pct_change()  # è®¡ç®—æ‰€æœ‰è‚¡ç¥¨çš„æ”¶ç›Šç‡
# æ‰€æœ‰è‚¡ç¥¨æ”¶ç›Šç‡ä¸ S&P 500 çš„ç›¸å…³æ€§
corr = returns.rolling(125, min_periods=100).corr(spx_rets)  # è®¡ç®— 125 å¤©æ»šåŠ¨ç›¸å…³æ€§ (è‡³å°‘ 100 ä¸ªå‘¨æœŸ)
corr.plot()  # ç»˜åˆ¶ç›¸å…³æ€§
```

### ç”¨æˆ·å®šä¹‰çš„ç§»åŠ¨çª—å£å‡½æ•°

`apply` æ–¹æ³•å…è®¸æ‚¨åº”ç”¨è‡ªå®šä¹‰å‡½æ•°ï¼š

```{python}
import matplotlib.pyplot as plt  # å¯¼å…¥ matplotlib.pyplot
import pandas as pd  # å¯¼å…¥ pandas
from scipy.stats import percentileofscore  # å¯¼å…¥ percentileofscore

close_px_all = pd.read_csv('examples/stock_px.csv',parse_dates=True, index_col=0)  # è¯»å– CSV æ–‡ä»¶ï¼Œè§£ææ—¥æœŸï¼Œè®¾ç½®ç¬¬ä¸€åˆ—ä¸ºç´¢å¼•
close_px = close_px_all[['AAPL', 'MSFT', 'XOM']]  # é€‰æ‹© AAPL, MSFT, XOM åˆ—
close_px = close_px.resample('B').ffill()  # æŒ‰å·¥ä½œæ—¥é‡é‡‡æ · (å‘å‰å¡«å……)
returns = close_px.pct_change()  # è®¡ç®—æ‰€æœ‰è‚¡ç¥¨çš„æ”¶ç›Šç‡

def score_at_2percent(x):
    """è®¡ç®— 0.02 åœ¨æ•°ç»„ x ä¸­çš„ç™¾åˆ†ä½æ•°"""
    return percentileofscore(x, 0.02)

result = returns['AAPL'].rolling(250).apply(score_at_2percent)  # è®¡ç®— 250 å¤©æ»šåŠ¨ç™¾åˆ†ä½æ•°
result.plot()  # ç»˜åˆ¶ç™¾åˆ†ä½æ•°
```

## æ€»ç»“

æœ¬ç« ä»‹ç»äº†åœ¨ `pandas` ä¸­å¤„ç†æ—¶é—´åºåˆ—æ•°æ®çš„åŸºæœ¬æŠ€æœ¯ï¼ŒåŒ…æ‹¬ï¼š

-   æ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹ã€‚
-   æ—¶é—´åºåˆ—ç´¢å¼•ã€é€‰æ‹©å’Œå­é›†åŒ–ã€‚
-   ç”Ÿæˆæ—¥æœŸèŒƒå›´å’Œé¢‘ç‡ã€‚
-   ç§»åŠ¨æ•°æ®ã€‚
-   æ—¶åŒºå¤„ç†ã€‚
-   å‘¨æœŸå’Œå‘¨æœŸç®—æœ¯ã€‚
-   é‡é‡‡æ · (é™é‡‡æ ·å’Œå‡é‡‡æ ·)ã€‚
-   ç§»åŠ¨çª—å£å‡½æ•°ã€‚

è¿™äº›å·¥å…·æ˜¯åˆ†æåŸºäºæ—¶é—´çš„æ•°æ®çš„åŸºç¡€ã€‚

## å°ç»“

-   **æ—¶é—´åºåˆ—æ•°æ®:** æŒ‰æ—¶é—´é¡ºåºç´¢å¼•çš„æ•°æ®ç‚¹åºåˆ—ã€‚
-   **pandas åŠŸèƒ½:** `pandas` æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ“ä½œæ—¶é—´åºåˆ—æ•°æ®ã€‚
-   **å…³é”®æ“ä½œ:** å­¦ä¹ äº†å¤„ç†æ—¥æœŸ/æ—¶é—´ç±»å‹ã€é‡é‡‡æ ·ã€ç§»ä½å’Œåº”ç”¨æ»šåŠ¨å‡½æ•°ã€‚
-   **åº”ç”¨:** è¿™äº›æŠ€æœ¯é€‚ç”¨äºé‡‘èã€ç»æµã€ç”Ÿæ€ç­‰é¢†åŸŸã€‚
-   **æ„å»ºå—:** é«˜çº§æ—¶é—´åºåˆ—å»ºæ¨¡çš„åŸºç¡€ã€‚

## æ€è€ƒä¸è®¨è®º

1.  **æ•°æ®é¢‘ç‡é€‰æ‹©:** é¢‘ç‡é€‰æ‹©å¦‚ä½•å½±å“æ´å¯ŸåŠ›ï¼Ÿ
2.  **ç¼ºå¤±æ•°æ®ç­–ç•¥:** è®¨è®ºå¤„ç†ç¼ºå¤±æ•°æ®çš„ç­–ç•¥ã€‚
3.  **ç§»åŠ¨çª—å£å‡½æ•°é€‰æ‹©:**  ä¸åŒç±»å‹ç§»åŠ¨å¹³å‡çº¿ä¹‹é—´çš„æƒè¡¡ã€‚
4.  **æ—¶åŒºæ„è¯†:** ä¸ºä»€ä¹ˆæ—¶åŒºæ„è¯†è‡³å…³é‡è¦ï¼Ÿ
5.  **é‡é‡‡æ ·åº”ç”¨:** é‡é‡‡æ ·çš„å…¶ä»–åº”ç”¨ã€‚
6.  **å‘¨æœŸä¸æ—¶é—´æˆ³:** ä½•æ—¶ä½¿ç”¨å‘¨æœŸä¸æ—¶é—´æˆ³ï¼Ÿ
